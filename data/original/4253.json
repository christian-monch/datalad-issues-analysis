{"url": "https://api.github.com/repos/datalad/datalad/issues/4253", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/4253/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/4253/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/4253/events", "html_url": "https://github.com/datalad/datalad/issues/4253", "id": 577208789, "node_id": "MDU6SXNzdWU1NzcyMDg3ODk=", "number": 4253, "title": "update does not handle  \"redone\"/replaced subdatasets (in ria style remote at least)", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 2767213993, "node_id": "MDU6TGFiZWwyNzY3MjEzOTkz", "url": "https://api.github.com/repos/datalad/datalad/labels/cmd-update", "name": "cmd-update", "color": "FEF2C0", "default": false, "description": "Issues relates to update functionality"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-03-06T22:27:18Z", "updated_at": "2021-02-23T23:33:11Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "Ran into while trying to update my copy of the hcp.\r\n\r\n```shell\r\n(git)smaug:/mnt/btrfs/datasets/datalad/crawl/hcp-openaccess[master]git\r\n$> time datalad update -r --merge=ff-only --follow=parentds\r\n....\r\n[INFO   ] Fetching updates for <Dataset path=/mnt/btrfs/datasets/datalad/crawl/hcp-openaccess/HCP1200/675661>\r\nCommandError: 'git fetch --verbose --progress --prune --recurse-submodules=no origin' failed with exitcode 128 under /mnt/btrfs/datasets/datalad/crawl/hcp-openaccess/HCP1200/675661\r\nfatal: repository 'http://store.datalad.org/383/ef60e-2217-11ea-8f71-002590496000/' not found\r\ndatalad update -r --merge=ff-only --follow=parentds  574.44s user 461.18s system 74% cpu 23:14.47 total\r\n\r\n$> datalad --version\r\ndatalad 0.12.2.dev368\r\n```\r\nit is due to the fact that some subdatasets were redone in https://github.com/datalad-datasets/human-connectome-project-openaccess/commit/dfbf817ce0345be568cd9451060832297030062e .  Situation might be somewhat specific to \"ria-remote\" setups, but most likely might manifest itself in other cases as well where subdataset is replaced with another URL and not present on the superdataset's remote.\r\nI think that ideally `datalad update` should handle this more gracefully (in particular in case of `--merge=ff-only --follow=parentds` tandem which pretty much instructs to just update to the state of the remote; in case of another `--merge` strategy -- I expect it to fail at git level if git commit histories have no common ancestors, but proceed if they do which might be undesired but at least \"logical\"):\r\n- realize that subdataset is replaced, by e.g. comparing known to its parent dataset `dataset-id` \r\n- if there is no local changes to the subdataset to be replaced (as e.g., reflected by no commits ahead of the remote(s)), it should attempt `datalad uninstall` and `datalad install` (for the new state).\r\n\r\nMay be there should be an additional mode/option for such cases to instruct explicitly on what to do if a subdataset is replaced.\r\n\r\nFeel welcome to close if there is already a known issue highlighting this issue -- I failed to find one on a quick search.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/4253/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/4253/timeline", "performed_via_github_app": null}