{"url": "https://api.github.com/repos/datalad/datalad/issues/5429", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/5429/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/5429/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/5429/events", "html_url": "https://github.com/datalad/datalad/issues/5429", "id": 812367440, "node_id": "MDU6SXNzdWU4MTIzNjc0NDA=", "number": 5429, "title": "datalad crawl adds multiple wrong URLs to certain files", "user": {"login": "cmadjar", "id": 1402456, "node_id": "MDQ6VXNlcjE0MDI0NTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1402456?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cmadjar", "html_url": "https://github.com/cmadjar", "followers_url": "https://api.github.com/users/cmadjar/followers", "following_url": "https://api.github.com/users/cmadjar/following{/other_user}", "gists_url": "https://api.github.com/users/cmadjar/gists{/gist_id}", "starred_url": "https://api.github.com/users/cmadjar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cmadjar/subscriptions", "organizations_url": "https://api.github.com/users/cmadjar/orgs", "repos_url": "https://api.github.com/users/cmadjar/repos", "events_url": "https://api.github.com/users/cmadjar/events{/privacy}", "received_events_url": "https://api.github.com/users/cmadjar/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2021-02-19T21:34:47Z", "updated_at": "2021-02-22T16:28:23Z", "closed_at": "2021-02-20T02:03:12Z", "author_association": "NONE", "active_lock_reason": null, "body": "#### What is the problem?\r\n\r\nWhen running `datalad crawl`, all `*scans.json` files get added to the list of URLs of all scans.json files in git-annex:\r\n\r\n```\r\n(datalad_v0.14.0_python3.8.5) preventad-open-bids $ git annex whereis BIDS_dataset/sub-5458966/ses-NAPBL00/sub-5458966_ses-NAPBL00_scans.json\r\nwhereis BIDS_dataset/sub-5458966/ses-NAPBL00/sub-5458966_ses-NAPBL00_scans.json (4 copies) \r\n  \t2930065c-0d6e-4f44-bb37-5e3bd38c670c -- cmadjar@Ceciles-Mac-mini.local:~/tmp_pad/preventad-open-bids [here]\r\n   \tc1310042-0393-48a1-9b0f-886f0353c93d -- cecile@cecile-dev.loris.ca:/data/CONP/preventad-open-bids\r\n   \tc6a15a49-4e7f-4cf7-8d63-7b70b5376bb0 -- cecile@cecile-dev.loris.ca:/data/CONP/preventad-open-bids\r\n   \tcf13d535-b47c-5df6-8590-0793cb08a90a -- [datalad]\r\n\r\n  datalad: https://openpreventad.loris.ca/api/v0.0.3-dev//candidates/1000173/NAPBL00/bidsfiles/sub-1000173_ses-NAPBL00_scans.json\r\n  datalad: https://openpreventad.loris.ca/api/v0.0.3-dev//candidates/1000173/NAPEN00/bidsfiles/sub-1000173_ses-NAPEN00_scans.json\r\n  datalad: https://openpreventad.loris.ca/api/v0.0.3-dev//candidates/1000173/NAPFU03/bidsfiles/sub-1000173_ses-NAPFU03_scans.json\r\n  datalad: https://openpreventad.loris.ca/api/v0.0.3-dev//candidates/1000173/NAPFU12/bidsfiles/sub-1000173_ses-NAPFU12_scans.json\r\n  datalad: https://openpreventad.loris.ca/api/v0.0.3-dev//candidates/1004359/PREBL00/bidsfiles/sub-1004359_ses-PREBL00_scans.json\r\n  datalad: https://openpreventad.loris.ca/api/v0.0.3-dev//candidates/1004359/PREFU12/bidsfiles/sub-1004359_ses-PREFU12_scans.json\r\n  datalad: https://openpreventad.loris.ca/api/v0.0.3-dev//candidates/1004359/PREFU24/bidsfiles/sub-1004359_ses-PREFU24_scans.json\r\n  datalad: https://openpreventad.loris.ca/api/v0.0.3-dev//candidates/1016072/PREFU24/bidsfiles/sub-1016072_ses-PREFU24_scans.json\r\n  datalad: https://openpreventad.loris.ca/api/v0.0.3-dev//candidates/1072774/PREEN00/bidsfiles/sub-1072774_ses-PREEN00_scans.json\r\n  datalad: https://openpreventad.loris.ca/api/v0.0.3-dev//candidates/1072774/PREFU12/bidsfiles/sub-1072774_ses-PREFU12_scans.json\r\n .... for over 1300 files...\r\n```\r\n\r\nThis is consistent for all the `*scans.json` files and `*bval` files crawled. All the other crawled files are fine and only have one URL attached to them. I keep looking at the pipelines code and cannot figure out why this is happening. Any idea?\r\n\r\nI checked the LORIS API and there is indeed only one entry for each scans.json file returned so that does not seem to come from the LORIS API.\r\n\r\n#### What steps will reproduce the problem?\r\n\r\n1) install latest release of datalad (v0.14.0)\r\n2) checkout the following branch from my fork of datalad-crawler (note, branch based on tag 0.8.0 of datalad-crawler): https://github.com/cmadjar/datalad-crawler/tree/0.8.0_preventad_bids_test\r\n3) run the following statements to install preventad-open-bids, remove all *scans.json files and run the crawler\r\n\r\n```\r\ndatalad install https://github.com/conpdatasets/preventad-open-bids.git\r\ncd preventad-open-bids/\r\ndatalad remove BIDS_dataset/*/*/*scans.json\r\ndatalad crawl\r\n```\r\n\r\nNotes: \r\n- `datalad crawl` will ask for credentials on openpreventad.loris.ca. If you do not have already an account, you can request one and it will be quickly approved.\r\n- on my fork, I commented out most of the code and added a break in the for loop to just download the first `scans.json` file for testing purposes instead of waiting for all the files to be downloaded... I am not that patient ;).\r\n\r\n\r\n#### What version of DataLad are you using (run `datalad --version`)? On what operating system (consider running `datalad wtf`)?\r\n\r\nWas confirmed on a fresh install of `datalad` tag `v0.14.0` and `datalad-crawler` tag `0.8.0` but has been present on older versions as well.\r\n\r\n#### Have you had any success using DataLad before? (to assess your expertise/prior luck.  We would welcome your testimonial additions to https://github.com/datalad/datalad/wiki/Testimonials as well)\r\n\r\nThe error mentioned here seems consistent across all the crawled `*scans.json` and `*.bvals` files. For every other files crawled by that crawler, there is only one URL added in git annex. \r\n\r\n", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/5429/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/5429/timeline", "performed_via_github_app": null}