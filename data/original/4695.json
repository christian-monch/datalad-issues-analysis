{"url": "https://api.github.com/repos/datalad/datalad/issues/4695", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/4695/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/4695/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/4695/events", "html_url": "https://github.com/datalad/datalad/pull/4695", "id": 655480244, "node_id": "MDExOlB1bGxSZXF1ZXN0NDQ3OTU3NDMy", "number": 4695, "title": "Use console_scripts entry points", "user": {"login": "jwodder", "id": 98207, "node_id": "MDQ6VXNlcjk4MjA3", "avatar_url": "https://avatars.githubusercontent.com/u/98207?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwodder", "html_url": "https://github.com/jwodder", "followers_url": "https://api.github.com/users/jwodder/followers", "following_url": "https://api.github.com/users/jwodder/following{/other_user}", "gists_url": "https://api.github.com/users/jwodder/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwodder/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwodder/subscriptions", "organizations_url": "https://api.github.com/users/jwodder/orgs", "repos_url": "https://api.github.com/users/jwodder/repos", "events_url": "https://api.github.com/users/jwodder/events{/privacy}", "received_events_url": "https://api.github.com/users/jwodder/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2020-07-12T21:30:13Z", "updated_at": "2020-11-21T03:00:22Z", "closed_at": "2020-07-14T14:34:28Z", "author_association": "MEMBER", "active_lock_reason": null, "pull_request": {"url": "https://api.github.com/repos/datalad/datalad/pulls/4695", "html_url": "https://github.com/datalad/datalad/pull/4695", "diff_url": "https://github.com/datalad/datalad/pull/4695.diff", "patch_url": "https://github.com/datalad/datalad/pull/4695.patch"}, "body": "In #1384, it was decided to declare datalad's command-line commands via `setup()`'s `scripts` keyword instead of via `entry_points`.  The reasoning given was that the entry point wrappers that setuptools generated were too slow.  However, this decision ignored a crucial fact: Packages are normally installed with `pip install`, which uses a different set of entry points wrappers (provided by the distlib package) than those used when installing with setuptools via `python setup.py install`.  (Note that installing a package in editable mode with `pip install -e` also uses the setuptools wrappers, as pip currently delegates editable installations to `python setup.py develop`.)\r\n\r\nThe entry point wrappers created by pip (both the latest version (20.1.1) and the current version when #1384 was written (9.0.1)) look like:\r\n\r\n```\r\n#!/usr/bin/python3\r\n\r\n# -*- coding: utf-8 -*-\r\nimport re\r\nimport sys\r\n\r\nfrom datalad.cmdline.main import main\r\n\r\nif __name__ == '__main__':\r\n    sys.argv[0] = re.sub(r'(-script\\.pyw?|\\.exe)?$', '', sys.argv[0])\r\n    sys.exit(main())\r\n```\r\n\r\nCompare this to the scripts that datalad currently generates:\r\n\r\n```\r\n#!/usr/bin/python3\r\n#\r\n# Custom simplistic runner for DataLad. Assumes datalad module\r\n# being available.  Generated by monkey patching monkey patched\r\n# setuptools.\r\n#\r\nfrom datalad.cmdline.main import main\r\nmain()\r\n```\r\n\r\nThe biggest difference is a regex, which (based on my unscientific experiments) does not seem to have an appreciable effect on the command's runtime.  Hence, there is no real downside to using `entry_points` as long as users are installing with `pip install` (which has been the recommended way to install Python packages for many years now).\r\n\r\nAs a benefit, switching back to always using `entry_points` instead of autogenerating scripts will allow the project to begin distributing wheels again, as there will be no difference in the arguments passed to `setup()` on Windows vs. Unix (cf. #4315).", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/4695/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/4695/timeline", "performed_via_github_app": null}