{"url": "https://api.github.com/repos/datalad/datalad/issues/3088", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/3088/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/3088/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/3088/events", "html_url": "https://github.com/datalad/datalad/issues/3088", "id": 389928544, "node_id": "MDU6SXNzdWUzODk5Mjg1NDQ=", "number": 3088, "title": "datalad ls can trigger \"AttributeError: 'tuple' object has no attribute 'replace'\"", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 63778590, "node_id": "MDU6TGFiZWw2Mzc3ODU5MA==", "url": "https://api.github.com/repos/datalad/datalad/labels/severity-normal", "name": "severity-normal", "color": "ff8888", "default": false, "description": "standard severity"}], "state": "closed", "locked": false, "assignee": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 7, "created_at": "2018-12-11T19:57:04Z", "updated_at": "2020-10-13T12:52:32Z", "closed_at": "2020-10-13T12:52:31Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "```\r\n  File \"/home/yoh/proj/datalad/datalad/datalad/interface/ls.py\", line 178, in __call__\r\n    if ds.is_installed():\r\n  File \"/home/yoh/proj/datalad/datalad/datalad/distribution/dataset.py\", line 381, in is_installed\r\n    self.repo is not None\r\n  File \"/home/yoh/proj/datalad/datalad/datalad/distribution/dataset.py\", line 256, in repo\r\n    self._repo = cls(self._path, create=False, **kw)\r\n  File \"/home/yoh/proj/datalad/datalad/datalad/support/repo.py\", line 146, in __call__\r\n    instance = type.__call__(cls, *new_args, **new_kwargs)\r\n  File \"/home/yoh/proj/datalad/datalad/datalad/support/annexrepo.py\", line 220, in __init__\r\n    self._set_shared_connection(r, url)\r\n  File \"/home/yoh/proj/datalad/datalad/datalad/support/annexrepo.py\", line 400, in _set_shared_connection\r\n    if is_ssh(url):\r\n  File \"/home/yoh/proj/datalad/datalad/datalad/support/network.py\", line 890, in is_ssh\r\n    _ri = RI(ri) if not isinstance(ri, RI) else ri\r\n  File \"/home/yoh/proj/datalad/datalad/datalad/support/network.py\", line 404, in __new__\r\n    cls = _guess_ri_cls(ri)\r\n  File \"/home/yoh/proj/datalad/datalad/datalad/support/_lru_cache2.py\", line 135, in wrapper\r\n    result = user_function(*args, **kwds)\r\n  File \"/home/yoh/proj/datalad/datalad/datalad/support/network.py\", line 324, in _guess_ri_cls\r\n    if is_windows_path(ri):\r\n  File \"/home/yoh/proj/datalad/datalad/datalad/support/network.py\", line 71, in is_windows_path\r\n    win_split = win_splitdrive(path)\r\n  File \"/home/yoh/proj/datalad/datalad/venvs/dev/lib/python2.7/ntpath.py\", line 116, in splitdrive\r\n    normp = p.replace(altsep, sep)\r\nAttributeError: 'tuple' object has no attribute 'replace'\r\n```\r\nmore context\r\n```\r\n> /home/yoh/proj/datalad/datalad/datalad/support/annexrepo.py(220)__init__()\r\n-> self._set_shared_connection(r, url)\r\n(Pdb) l\r\n215             # shared connections:\r\n216             for r in self.get_remotes():\r\n217                 for url in [self.get_remote_url(r),\r\n218                             self.get_remote_url(r, push=True)]:\r\n219                     if url is not None:\r\n220  ->                     self._set_shared_connection(r, url)\r\n221\r\n222             self.always_commit = always_commit\r\n223\r\n224             if version is None:\r\n225                 version = self.config.get(\"datalad.repo.version\", None)\r\n(Pdb) p url\r\n(u'git://github.com/yarikoptic/datalad', u'https://yarikoptic@github.com/yarikoptic/datalad')\r\n(Pdb) p self\r\n<AnnexRepo path=/home/yoh/proj/datalad/datalad (<class 'datalad.support.annexrepo.AnnexRepo'>)>\r\n(Pdb) p self.get_remote_url(r)\r\n(u'git://github.com/yarikoptic/datalad', u'https://yarikoptic@github.com/yarikoptic/datalad')\r\n(Pdb) p r\r\nu'gh-yarikoptic'\r\n*(Pdb) p self.get_remote_url(r, push=True)\r\nNone\r\n```\r\n\r\nnot sure why or how I have got two URLs in my .git/config\r\n```shell\r\n[remote \"gh-yarikoptic\"]\r\n    url = git://github.com/yarikoptic/datalad\r\n    url = https://yarikoptic@github.com/yarikoptic/datalad\r\n```\r\nbut \r\n1. git seems to use only the first one (at least with `git fetch`) so we should do the same in `get_remote_url` (at least by default)\r\n2. `datalad ls` should guard better to not blow up completely (did in cde64146b5e8f1feba1296ad23fc4f2930642b4e which is a part of #2126)\r\n3. may be even `ds.is_installed` should not just blow, but rather return False if something is finicky inside of the dataset?  what do you think @datalad/developers?", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/3088/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/3088/timeline", "performed_via_github_app": null}