{"url": "https://api.github.com/repos/datalad/datalad/issues/3356", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/3356/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/3356/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/3356/events", "html_url": "https://github.com/datalad/datalad/issues/3356", "id": 437030845, "node_id": "MDU6SXNzdWU0MzcwMzA4NDU=", "number": 3356, "title": "`get` fails to get more than one file from an uninstalled subdataset", "user": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 63778590, "node_id": "MDU6TGFiZWw2Mzc3ODU5MA==", "url": "https://api.github.com/repos/datalad/datalad/labels/severity-normal", "name": "severity-normal", "color": "ff8888", "default": false, "description": "standard severity"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-04-25T06:35:35Z", "updated_at": "2019-10-18T08:44:47Z", "closed_at": "2019-10-18T08:44:47Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Demo\r\n\r\n```sh\r\n# create a new dataset with a populated subdataset\r\n% dl rev-create super\r\n[INFO   ] Creating a new annex repo at /tmp/super \r\ncreate(ok): /tmp/super (dataset)                                                                                             \r\n% dl install -d super -s https://github.com/psychoinformatics-de/studyforrest-data-phase2.git data/raw\r\n[INFO   ] Cloning https://github.com/psychoinformatics-de/studyforrest-data-phase2.git [1 other candidates] into '/tmp/super/data/raw' \r\n[INFO   ]   Remote origin not usable by git-annex; setting annex-ignore                                                      \r\ninstall(ok): data/raw (dataset)\r\naction summary:\r\n  add (notneeded: 1, ok: 1)\r\n  install (ok: 1)\r\n  save (ok: 1)\r\n\r\n# clone the new superdataset to a fresh location to have the sub be absent\r\n% dl install -s super superclone\r\n[INFO   ] Cloning super into '/tmp/superclone' \r\ninstall(ok): /tmp/superclone (dataset)\r\n\r\n# now get TWO files, all is good with one file, or two subsequent calls with one file each\r\n% dl -C superclone get data/raw/sub-32/beh/sub-32_task-movie_run-4_events.tsv data/raw/sub-32/beh/sub-32_task-movie_run-5_events.tsv\r\n[INFO   ] Cloning /tmp/super/data/raw [2 other candidates] into '/tmp/superclone/data/raw' \r\ninstall(ok): /tmp/superclone/data/raw (dataset) [Installed subdataset in order to get /tmp/superclone/data/raw/sub-32/beh/sub-32_task-movie_run-4_events.tsv]\r\nget(impossible): /tmp/superclone/data/raw/sub-32/beh/sub-32_task-movie_run-5_events.tsv [path does not exist]\r\nget(ok): /tmp/superclone/data/raw/sub-32/beh/sub-32_task-movie_run-4_events.tsv (file) [from mddatasrc...]\r\naction summary:\r\n  get (impossible: 1, ok: 1)\r\n  install (ok: 1)\r\n```\r\n\r\nThe culprit is this test: https://github.com/datalad/datalad/blob/master/datalad/distribution/get.py#L518\r\n\r\nWhen two paths are given, the missing subdataset is installed in the first loop iteration and all works fine. In the second loop, the logic is unaware that the subdataset is now already present, hence nothing gets installed and 'impossible' is issued, although everything is just fine.", "closed_by": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/3356/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/3356/timeline", "performed_via_github_app": null}