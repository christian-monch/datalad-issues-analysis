{"url": "https://api.github.com/repos/datalad/datalad/issues/4160", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/4160/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/4160/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/4160/events", "html_url": "https://github.com/datalad/datalad/pull/4160", "id": 566528432, "node_id": "MDExOlB1bGxSZXF1ZXN0Mzc2MzIzNTMw", "number": 4160, "title": "tests: Improve display of results in assertion messages", "user": {"login": "kyleam", "id": 1297788, "node_id": "MDQ6VXNlcjEyOTc3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1297788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kyleam", "html_url": "https://github.com/kyleam", "followers_url": "https://api.github.com/users/kyleam/followers", "following_url": "https://api.github.com/users/kyleam/following{/other_user}", "gists_url": "https://api.github.com/users/kyleam/gists{/gist_id}", "starred_url": "https://api.github.com/users/kyleam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kyleam/subscriptions", "organizations_url": "https://api.github.com/users/kyleam/orgs", "repos_url": "https://api.github.com/users/kyleam/repos", "events_url": "https://api.github.com/users/kyleam/events{/privacy}", "received_events_url": "https://api.github.com/users/kyleam/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 545918236, "node_id": "MDU6TGFiZWw1NDU5MTgyMzY=", "url": "https://api.github.com/repos/datalad/datalad/labels/DX", "name": "DX", "color": "0052cc", "default": false, "description": "developer experience"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-02-17T21:39:36Z", "updated_at": "2020-02-18T14:24:00Z", "closed_at": "2020-02-18T06:53:39Z", "author_association": "MEMBER", "active_lock_reason": null, "pull_request": {"url": "https://api.github.com/repos/datalad/datalad/pulls/4160", "html_url": "https://github.com/datalad/datalad/pull/4160", "diff_url": "https://github.com/datalad/datalad/pull/4160.diff", "patch_url": "https://github.com/datalad/datalad/pull/4160.patch"}, "body": "When working with `assert_in_results` failures, I noticed that I often end up pasting them somewhere and reformatting them because I have a hard time digesting long lines like\r\n\r\n```\r\nAssertionError: Found no desired result ({'action': 'get', 'status': 'ok'}) among [{'action': 'get', 'path': '/tmp/datalad_temp_test_reobtain_datawmb8reri/load.dat', 'type': 'file', 'refds': '/tmp/datalad_temp_test_reobtain_datawmb8reri', 'status': 'notneeded', 'message': 'already present'}, {'action': 'update', 'path': '/tmp/datalad_temp_test_reobtain_datawmb8reri', 'type': 'dataset', 'refds': '/tmp/datalad_temp_test_reobtain_datawmb8reri', 'status': 'ok'}]\r\n```\r\n\r\n`assert_result_count`, on the other hand, formats the records with `json.dumps`, which I find much more helpful.\r\n\r\nThis series applies the same approach to `assert_in_results` and also makes a few additional tweaks to the formatting used in both `assert_result_count` and `assert_in_results`.\r\n\r\n<details>\r\n<summary>example of output change</summary>\r\n\r\n```diff\r\n-  File \"/home/kyle/src/python/datalad/datalad/tests/utils.py\", line 1371, in assert_in_results\r\n-    assert found, \"Found no desired result (%s) among %s\" % (repr(kwargs), repr(results))\r\n-AssertionError: Found no desired result ({'action': 'get', 'status': 'ok'}) among [{'action': 'get', 'path': '/tmp/datalad_temp_test_reobtain_datawmb8reri/load.dat', 'type': 'file', 'refds': '/tmp/datalad_temp_test_reobtain_datawmb8reri', 'status': 'notneeded', 'message': 'already present'}, {'action': 'update', 'path': '/tmp/datalad_temp_test_reobtain_datawmb8reri', 'type': 'dataset', 'refds': '/tmp/datalad_temp_test_reobtain_datawmb8reri', 'status': 'ok'}]\r\n+  File \"/home/kyle/src/python/datalad/datalad/tests/utils.py\", line 1381, in assert_in_results\r\n+    .format(_format_res(kwargs), _format_res(results)))\r\n+AssertionError: Desired result\r\n+  {\r\n+   \"action\": \"get\",\r\n+   \"status\": \"ok\"\r\n+  }\r\n+not found among\r\n+  [\r\n+   {\r\n+    \"action\": \"get\",\r\n+    \"message\": \"already present\",\r\n+    \"path\": \"/tmp/datalad_temp_test_reobtain_data6pin05pp/load.dat\",\r\n+    \"refds\": \"/tmp/datalad_temp_test_reobtain_data6pin05pp\",\r\n+    \"status\": \"notneeded\",\r\n+    \"type\": \"file\"\r\n+   },\r\n+   {\r\n+    \"action\": \"update\",\r\n+    \"path\": \"/tmp/datalad_temp_test_reobtain_data6pin05pp\",\r\n+    \"refds\": \"/tmp/datalad_temp_test_reobtain_data6pin05pp\",\r\n+    \"status\": \"ok\",\r\n+    \"type\": \"dataset\"\r\n+   }\r\n+  ]\r\n\r\n\r\n-  File \"/home/kyle/src/python/datalad/datalad/tests/utils.py\", line 1361, in assert_result_count\r\n-    dumps(results, indent=1, default=lambda x: str(x))))\r\n-AssertionError: Got 0 instead of 3 expected results matching {'status': 'error', 'type': 'dataset'}. Inspected 3 record(s):\r\n-[\r\n- {\r\n-  \"action\": \"update\",\r\n-  \"path\": \"/tmp/datalad_temp_test_update_simplenlgj1vb9\",\r\n-  \"type\": \"dataset\",\r\n-  \"refds\": \"/tmp/datalad_temp_test_update_simplenlgj1vb9\",\r\n-  \"status\": \"ok\"\r\n- },\r\n- {\r\n-  \"action\": \"update\",\r\n-  \"path\": \"/tmp/datalad_temp_test_update_simplenlgj1vb9/2\",\r\n-  \"type\": \"dataset\",\r\n-  \"refds\": \"/tmp/datalad_temp_test_update_simplenlgj1vb9\",\r\n-  \"status\": \"ok\"\r\n- },\r\n- {\r\n-  \"action\": \"update\",\r\n-  \"path\": \"/tmp/datalad_temp_test_update_simplenlgj1vb9/subm 1\",\r\n-  \"type\": \"dataset\",\r\n-  \"refds\": \"/tmp/datalad_temp_test_update_simplenlgj1vb9\",\r\n-  \"status\": \"ok\"\r\n- }\r\n-]\r\n+  File \"/home/kyle/src/python/datalad/datalad/tests/utils.py\", line 1368, in assert_result_count\r\n+    _format_res(results)))\r\n+AssertionError: Got 0 instead of 3 expected results matching\r\n+  {\r\n+   \"status\": \"error\",\r\n+   \"type\": \"dataset\"\r\n+  }\r\n+Inspected 3 record(s):\r\n+  [\r\n+   {\r\n+    \"action\": \"update\",\r\n+    \"path\": \"/tmp/datalad_temp_test_update_simple519zsud3\",\r\n+    \"refds\": \"/tmp/datalad_temp_test_update_simple519zsud3\",\r\n+    \"status\": \"ok\",\r\n+    \"type\": \"dataset\"\r\n+   },\r\n+   {\r\n+    \"action\": \"update\",\r\n+    \"path\": \"/tmp/datalad_temp_test_update_simple519zsud3/2\",\r\n+    \"refds\": \"/tmp/datalad_temp_test_update_simple519zsud3\",\r\n+    \"status\": \"ok\",\r\n+    \"type\": \"dataset\"\r\n+   },\r\n+   {\r\n+    \"action\": \"update\",\r\n+    \"path\": \"/tmp/datalad_temp_test_update_simple519zsud3/subm 1\",\r\n+    \"refds\": \"/tmp/datalad_temp_test_update_simple519zsud3\",\r\n+    \"status\": \"ok\",\r\n+    \"type\": \"dataset\"\r\n+   }\r\n+  ]\r\n```\r\n\r\n</details>\r\n", "closed_by": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/4160/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/4160/timeline", "performed_via_github_app": null}