{"url": "https://api.github.com/repos/datalad/datalad/issues/4255", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/4255/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/4255/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/4255/events", "html_url": "https://github.com/datalad/datalad/pull/4255", "id": 577234165, "node_id": "MDExOlB1bGxSZXF1ZXN0Mzg1MDY5NTYy", "number": 4255, "title": "BF: annexrepo: Set annex.dotfiles=true in .git/config", "user": {"login": "kyleam", "id": 1297788, "node_id": "MDQ6VXNlcjEyOTc3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1297788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kyleam", "html_url": "https://github.com/kyleam", "followers_url": "https://api.github.com/users/kyleam/followers", "following_url": "https://api.github.com/users/kyleam/following{/other_user}", "gists_url": "https://api.github.com/users/kyleam/gists{/gist_id}", "starred_url": "https://api.github.com/users/kyleam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kyleam/subscriptions", "organizations_url": "https://api.github.com/users/kyleam/orgs", "repos_url": "https://api.github.com/users/kyleam/repos", "events_url": "https://api.github.com/users/kyleam/events{/privacy}", "received_events_url": "https://api.github.com/users/kyleam/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-03-06T23:54:31Z", "updated_at": "2020-03-09T18:54:44Z", "closed_at": "2020-03-09T18:41:29Z", "author_association": "MEMBER", "active_lock_reason": null, "pull_request": {"url": "https://api.github.com/repos/datalad/datalad/pulls/4255", "html_url": "https://github.com/datalad/datalad/pull/4255", "diff_url": "https://github.com/datalad/datalad/pull/4255.diff", "patch_url": "https://github.com/datalad/datalad/pull/4255.patch"}, "body": "As of version 8.20200226, git-annex no longer has --include-dotfiles\r\nand, instead of skipping dotfiles that are not explicitly given as\r\npaths, now adds dotfiles to git by default.  When the new\r\nannex.dotfiles option is configured to true, git-annex decides the\r\nfate of dotfiles based on the normal annex.largefiles mechanism.\r\n\r\n97c28c7bc5 (RF: annexrepo: Adjust for removal of --include-dotfiles,\r\ngh-4214) dealt with the removal of --include-dotfiles, but it only\r\n_partially_ dealt with the new \"dot files to git\" behavior.  That\r\ncommit set annex.dotfiles=true for our calls to git-annex.  However,\r\nwhen we set this transiently, later actions can result in annexed\r\ndotfiles being added as regular git files [0], a problem that was\r\nhinted at by the workarounds needed for test_run.test_sidecar and\r\ntest_save.test_save_dotfiles in adjusted mode.\r\n\r\nWe rely on annexing dotfiles (e.g., `.datalad/metadata/objects`), so\r\nit seems we can't get around setting annex.dotfiles=true in the\r\nrepository.  When AnnexRepo is initialized, check whether\r\nannex.dotfiles is configured in .git/config.  If it's not, set it to\r\ntrue unless it has explicitly been set to false outside of DataLad.\r\n\r\nNote that this solution doesn't consider the annex.dotfiles\r\nconfiguration that could be stored in git-annex:config.log, which is\r\noverridden by the value in .git/config.  This could be added to the\r\ncheck if we decide the correctness is worth the expense for each\r\nAnnexRepo initialization.\r\n\r\n[0] Two posts on the git-annex site have discussion and demo scripts\r\n    related to this:\r\n    https://git-annex.branchable.com/forum/Get_annex.dotfiles__61__true_behavior_without_persistent_configuration__63__/\r\n    https://git-annex.branchable.com/bugs/Guard_against_previously_annexed_dotfiles_being_converted_to_git_files__63__/\r\n\r\n---\r\n\r\nto-dos:\r\n\r\n- [x] wait a bit to see what comes of any discussion on git-annex's site\r\n- [ ] explicitly test this behavior", "closed_by": {"login": "kyleam", "id": 1297788, "node_id": "MDQ6VXNlcjEyOTc3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1297788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kyleam", "html_url": "https://github.com/kyleam", "followers_url": "https://api.github.com/users/kyleam/followers", "following_url": "https://api.github.com/users/kyleam/following{/other_user}", "gists_url": "https://api.github.com/users/kyleam/gists{/gist_id}", "starred_url": "https://api.github.com/users/kyleam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kyleam/subscriptions", "organizations_url": "https://api.github.com/users/kyleam/orgs", "repos_url": "https://api.github.com/users/kyleam/repos", "events_url": "https://api.github.com/users/kyleam/events{/privacy}", "received_events_url": "https://api.github.com/users/kyleam/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/4255/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/4255/timeline", "performed_via_github_app": null}