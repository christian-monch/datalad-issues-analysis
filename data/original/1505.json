{"url": "https://api.github.com/repos/datalad/datalad/issues/1505", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/1505/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/1505/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/1505/events", "html_url": "https://github.com/datalad/datalad/issues/1505", "id": 227299012, "node_id": "MDU6SXNzdWUyMjcyOTkwMTI=", "number": 1505, "title": "`get_paths_by_dataset()` is MAJOR source of slowdown!", "user": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 390153891, "node_id": "MDU6TGFiZWwzOTAxNTM4OTE=", "url": "https://api.github.com/repos/datalad/datalad/labels/UX", "name": "UX", "color": "0052cc", "default": false, "description": "user experience"}, {"id": 440544386, "node_id": "MDU6TGFiZWw0NDA1NDQzODY=", "url": "https://api.github.com/repos/datalad/datalad/labels/fix-implemented", "name": "fix-implemented", "color": "0e8a16", "default": false, "description": "A fix is available, but has not been merged or released, yet."}, {"id": 526935563, "node_id": "MDU6TGFiZWw1MjY5MzU1NjM=", "url": "https://api.github.com/repos/datalad/datalad/labels/feedback-desired", "name": "feedback-desired", "color": "fbca04", "default": false, "description": ""}, {"id": 533730441, "node_id": "MDU6TGFiZWw1MzM3MzA0NDE=", "url": "https://api.github.com/repos/datalad/datalad/labels/:woman_facepalming:", "name": ":woman_facepalming:", "color": "ffffff", "default": false, "description": "facepalm"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/datalad/datalad/milestones/41", "html_url": "https://github.com/datalad/datalad/milestone/41", "labels_url": "https://api.github.com/repos/datalad/datalad/milestones/41/labels", "id": 2580592, "node_id": "MDk6TWlsZXN0b25lMjU4MDU5Mg==", "number": 41, "title": "Release 0.6.0", "description": "A huge refactoring of input/output of API commands etc", "creator": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 56, "state": "closed", "created_at": "2017-06-13T14:33:04Z", "updated_at": "2017-08-29T08:14:19Z", "due_on": "2017-06-14T07:00:00Z", "closed_at": "2017-06-15T10:55:30Z"}, "comments": 13, "created_at": "2017-05-09T09:11:02Z", "updated_at": "2017-06-13T14:37:24Z", "closed_at": "2017-06-07T10:59:52Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "@bpoldrack @yarikoptic This is the climax of the OPT saga of the past few days:\r\n\r\nLet me introduce you to: `get_paths_by_dataset()`, a function that runs every time a path is passed into almost any top-level command. Now watch this (with our big collection):\r\n\r\n````\r\n% time DATALAD_LOG_LEVEL=debug \\\r\n  python -c \"import datalad.api; from datalad.interface.utils import get_paths_by_dataset; get_paths_by_dataset(['$PWD'], recursive=True)\"\r\n<snip>\r\nDATALAD_LOG_LEVEL=debug python -c   1,31s user 1,10s system 18% cpu 12,744 total\r\n\r\n# and now for fun and games, we give the same path twice\r\nmih@meiner /tmp/datasets.datalad.org (git)-[master] % time DATALAD_LOG_LEVEL=debug \\\r\n  python -c \"import datalad.api; from datalad.interface.utils import get_paths_by_dataset; get_paths_by_dataset(['$PWD', '$PWD'], recursive=True)\"\r\n<snip>\r\nDATALAD_LOG_LEVEL=debug python -c   2,14s user 2,09s system 16% cpu 25,093 total\r\n````\r\n\r\nSo this is not only slow, it is also stupid. I can say that, I wrote it.\r\n\r\nI see no way how to make the individual pieces faster. If we ask for the full list of datasets in a tree, we have to get them at some point (which does not mean we should carefully evaluate when to ask for such a list). However, the logic purely within that function could be improved. In particular wrt the wasteful rediscovery when multiple input paths are given (even beyond a plain `unique(paths)`).\r\n\r\nI won't have time to work on this now, but if you ever feel something is slow, consider throwing some computer science in this approximate direction first!", "closed_by": {"login": "bpoldrack", "id": 10498301, "node_id": "MDQ6VXNlcjEwNDk4MzAx", "avatar_url": "https://avatars.githubusercontent.com/u/10498301?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bpoldrack", "html_url": "https://github.com/bpoldrack", "followers_url": "https://api.github.com/users/bpoldrack/followers", "following_url": "https://api.github.com/users/bpoldrack/following{/other_user}", "gists_url": "https://api.github.com/users/bpoldrack/gists{/gist_id}", "starred_url": "https://api.github.com/users/bpoldrack/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bpoldrack/subscriptions", "organizations_url": "https://api.github.com/users/bpoldrack/orgs", "repos_url": "https://api.github.com/users/bpoldrack/repos", "events_url": "https://api.github.com/users/bpoldrack/events{/privacy}", "received_events_url": "https://api.github.com/users/bpoldrack/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/1505/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/1505/timeline", "performed_via_github_app": null}