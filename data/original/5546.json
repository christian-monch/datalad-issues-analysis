{"url": "https://api.github.com/repos/datalad/datalad/issues/5546", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/5546/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/5546/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/5546/events", "html_url": "https://github.com/datalad/datalad/issues/5546", "id": 852284017, "node_id": "MDU6SXNzdWU4NTIyODQwMTc=", "number": 5546, "title": "Git-annex 8.20210223 is broken in a Condor job ", "user": {"login": "adswa", "id": 29738718, "node_id": "MDQ6VXNlcjI5NzM4NzE4", "avatar_url": "https://avatars.githubusercontent.com/u/29738718?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adswa", "html_url": "https://github.com/adswa", "followers_url": "https://api.github.com/users/adswa/followers", "following_url": "https://api.github.com/users/adswa/following{/other_user}", "gists_url": "https://api.github.com/users/adswa/gists{/gist_id}", "starred_url": "https://api.github.com/users/adswa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adswa/subscriptions", "organizations_url": "https://api.github.com/users/adswa/orgs", "repos_url": "https://api.github.com/users/adswa/repos", "events_url": "https://api.github.com/users/adswa/events{/privacy}", "received_events_url": "https://api.github.com/users/adswa/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 32, "created_at": "2021-04-07T10:55:32Z", "updated_at": "2021-04-21T11:39:47Z", "closed_at": "2021-04-20T16:29:28Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "I haven't pinpointed where the issue is, so the title of the issue may be misleading, and it could be something on our cluster that is at fault.\r\n\r\nAfter an upgrade to git-annex 8.20210223 a previously working workflow of mine crashes. The workflow executes a shell script with a datalad based analysis through condor. Once basically any datalad-related command is executed, ~git-annex~ git complains about not finding basic shell functionality:\r\n\r\n```\r\n+ datalad clone ria+file:///data/group/psyinf/myinputstore#32296733-7386-4e81-afcc-37eb33f34144 ds\r\nTraceback (most recent call last):\r\n  File \"/usr/bin/datalad\", line 11, in <module>\r\n    load_entry_point('datalad==0.14.0', 'console_scripts', 'datalad')()\r\n  File \"/usr/lib/python3/dist-packages/pkg_resources/__init__.py\", line 489, in load_entry_point\r\n    return get_distribution(dist).load_entry_point(group, name)\r\n  File \"/usr/lib/python3/dist-packages/pkg_resources/__init__.py\", line 2793, in load_entry_point\r\n    return ep.load()\r\n  File \"/usr/lib/python3/dist-packages/pkg_resources/__init__.py\", line 2411, in load\r\n    return self.resolve()\r\n  File \"/usr/lib/python3/dist-packages/pkg_resources/__init__.py\", line 2417, in resolve\r\n    module = __import__(self.module_name, fromlist=['__name__'], level=0)\r\n  File \"/usr/lib/python3/dist-packages/datalad/__init__.py\", line 47, in <module>\r\n    cfg = ConfigManager()\r\n  File \"/usr/lib/python3/dist-packages/datalad/config.py\", line 274, in __init__\r\n    self.reload(force=True)\r\n  File \"/usr/lib/python3/dist-packages/datalad/config.py\", line 327, in reload\r\n    self._stores[store_id] = self._reload(runargs)\r\n  File \"/usr/lib/python3/dist-packages/datalad/config.py\", line 359, in _reload\r\n    encoding='utf-8',\r\n  File \"/usr/lib/python3/dist-packages/datalad/config.py\", line 717, in _run\r\n    out = self._runner.run(self._config_cmd + args, **kwargs)\r\n  File \"/usr/lib/python3/dist-packages/datalad/cmd.py\", line 413, in run\r\n    **results,\r\ndatalad.support.exceptions.CommandError: CommandError: 'git --git-dir= config -z -l --show-origin' failed with exitcode 1 [err: '/usr/lib/git-annex.linux/git: 2: /usr/lib/git-annex.linux/git: readlink: not found\r\n/usr/lib/git-annex.linux/git: 6: /usr/lib/git-annex.linux/git: dirname: not found\r\n** cannot find base directory (I seem to be /usr/lib/git-annex.linux/git)']\r\n```\r\n\r\nThis fails reliably, for all jobs, for common datalad operations (I have tried clone and create). Nevertheless, I can not reproduce this outside a Condor job. I have tried to trigger it on compute nodes that were affected outside a condor job, and I have tried to SSH into the job and trigger it in an interactive session - it works fine in these cases. The head node and compute nodes have the same annex version, but between the working state and the current broken state there was a system-wide git-annex update.\r\n\r\nCurrent git-annex version:\r\n\r\n```\r\ngit-annex version: 8.20210223-1~ndall+1\r\nbuild flags: Assistant Webapp Pairing Inotify DBus DesktopNotify TorrentParser MagicMime Feeds Testsuite S3 WebDAV\r\ndependency versions: aws-0.20 bloomfilter-2.0.1.0 cryptonite-0.25 DAV-1.3.3 feed-1.0.0.0 ghc-8.4.4 http-client-0.5.13.1 persistent-sqlite-2.8.2 torrent-10000.1.1 uuid-1.3.13 yesod-1.6.0\r\nkey/value backends: SHA256E SHA256 SHA512E SHA512 SHA224E SHA224 SHA384E SHA384 SHA3_256E SHA3_256 SHA3_512E SHA3_512 SHA3_224E SHA3_224 SHA3_384E SHA3_384 SKEIN256E SKEIN256 SKEIN512E SKEIN512 BLAKE2B256E BLAKE2B256 BLAKE2B512E BLAKE2B512 BLAKE2B160E BLAKE2B160 BLAKE2B224E BLAKE2B224 BLAKE2B384E BLAKE2B384 BLAKE2BP512E BLAKE2BP512 BLAKE2S256E BLAKE2S256 BLAKE2S160E BLAKE2S160 BLAKE2S224E BLAKE2S224 BLAKE2SP256E BLAKE2SP256 BLAKE2SP224E BLAKE2SP224 SHA1E SHA1 MD5E MD5 WORM URL X*\r\nremote types: git gcrypt p2p S3 bup directory rsync web bittorrent webdav adb tahoe glacier ddar git-lfs httpalso borg hook external\r\noperating system: linux x86_64\r\nsupported repository versions: 8\r\nupgrade supported from repository versions: 0 1 2 3 4 5 6 7\r\n```\r\n\r\n<details><summary>Here is the output of ``set`` inside the compute job:</summary>\r\n\r\n```\r\nBASH=/bin/bash\r\nBASHOPTS=checkwinsize:cmdhist:complete_fullquote:extquote:force_fignore:globasciiranges:hostcomplete:interactive_comments:progcomp:promptvars:sourcepath\r\nBASH_ALIASES=()\r\nBASH_ARGC=()\r\nBASH_ARGV=()\r\nBASH_CMDS=()\r\nBASH_LINENO=([0]=\"0\")\r\nBASH_SOURCE=([0]=\"/var/lib/condor/execute/dir_3170/condor_exec.exe\")\r\nBASH_VERSINFO=([0]=\"5\" [1]=\"0\" [2]=\"3\" [3]=\"1\" [4]=\"release\" [5]=\"x86_64-pc-linux-gnu\")\r\nBASH_VERSION='5.0.3(1)-release'\r\nBATCH_SYSTEM=HTCondor\r\nDATALAD_GET_SUBDATASET__SOURCE__CANDIDATE__101cat='ria+http://containers.ds.inm7.de#{id}'\r\nDIRSTACK=()\r\nDSLOCKFILE=/data/group/psyinf/ukb_workflow_template/forrest/.condor_datalad_lock\r\nEUID=42000\r\nGIT_AUTHOR_EMAIL=adina.wagner@t-online.de\r\nGIT_AUTHOR_NAME='Adina Wagner'\r\nGROUPS=()\r\nHOSTNAME=cpu16\r\nHOSTTYPE=x86_64\r\nIFS=$' \\t\\n'\r\nJOBID=14.463529\r\nMACHTYPE=x86_64-pc-linux-gnu\r\nOMP_NUM_THREADS=1\r\nOPTERR=1\r\nOPTIND=1\r\nOSTYPE=linux-gnu\r\nPATH=/usr/local/bin:/usr/local/sbin:/usr/bin:/usr/sbin:/bin:/sbin:.\r\nPIPESTATUS=([0]=\"0\")\r\nPPID=3170\r\nPS4='+ '\r\nPWD=/var/lib/condor/execute/dir_3170\r\nSHELL=/usr/bin/zsh\r\nSHELLOPTS=braceexpand:errexit:hashall:interactive-comments:nounset:xtrace\r\nSHLVL=1\r\nTEMP=/var/lib/condor/execute/dir_3170\r\nTERM=dumb\r\nTMP=/var/lib/condor/execute/dir_3170\r\nTMPDIR=/var/lib/condor/execute/dir_3170\r\nUID=42000\r\n_=\r\n_CHIRP_DELAYED_UPDATE_PREFIX='Chirp*'\r\n_CONDOR_ANCESTOR_28450=28485:1614348909:2681609250\r\n_CONDOR_ANCESTOR_28485=3170:1617789945:1009793848\r\n_CONDOR_ANCESTOR_3170=3177:1617789945:612364609\r\n_CONDOR_CHIRP_CONFIG=/var/lib/condor/execute/dir_3170/.chirp.config\r\n_CONDOR_JOB_AD=/var/lib/condor/execute/dir_3170/.job.ad\r\n_CONDOR_JOB_IWD=/var/lib/condor/execute/dir_3170\r\n_CONDOR_JOB_PIDS=\r\n_CONDOR_MACHINE_AD=/var/lib/condor/execute/dir_3170/.machine.ad\r\n_CONDOR_SCRATCH_DIR=/var/lib/condor/execute/dir_3170\r\n_CONDOR_SLOT=slot1_16\r\ndssource=ria+file:///data/group/psyinf/myinputstore#32296733-7386-4e81-afcc-37eb33f34144\r\npushgitremote=/data/group/psyinf/myoutputstore/322/96733-7386-4e81-afcc-37eb33f34144\r\nsubid=sub-14\r\n```\r\n</details>\r\n\r\nDoes anyone have an idea how I can debug this, or an idea what may be the problem? ", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/5546/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/5546/timeline", "performed_via_github_app": null}