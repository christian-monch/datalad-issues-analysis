{"url": "https://api.github.com/repos/datalad/datalad/issues/2696", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/2696/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/2696/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/2696/events", "html_url": "https://github.com/datalad/datalad/issues/2696", "id": 340636254, "node_id": "MDU6SXNzdWUzNDA2MzYyNTQ=", "number": 2696, "title": "Should complain but tollerate inability to establish/use sockets for ssh connections", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-07-12T13:23:55Z", "updated_at": "2021-04-16T15:01:48Z", "closed_at": "2021-04-16T15:01:48Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "#### What is the problem?\r\nyet to dig down why here in particular,  but in many cases users might work on repositories which are not even having any remotes yet, thus all operations would be local. And in some cases it might happen that their $HOME being non-existent or mount readonly (e.g. to guarantee reproducibility and absent dependency on the environment in the container etc), so no sockets directory could be produced/used.  ATM even `datalad add` then would just crash\r\n```\r\n  File \"/usr/local/lib/python2.7/dist-packages/heudiconv/cli/run.py\", line 321, in process_args\r\n    session, seqinfo, dicoms, args.bids) \r\n  File \"/usr/local/lib/python2.7/dist-packages/heudiconv/external/dlad.py\", line 28, in prepare_datalad \r\n    bids=bids) \r\n  File \"/usr/local/lib/python2.7/dist-packages/heudiconv/external/dlad.py\", line 51, in add_to_datalad \r\n    if not ds.is_installed(): \r\n  File \"/usr/lib/python2.7/dist-packages/datalad/distribution/dataset.py\", line 316, in is_installed \r\n    self.repo is not None \r\n  File \"/usr/lib/python2.7/dist-packages/datalad/distribution/dataset.py\", line 207, in repo \r\n    if cls.is_valid_repo(self._path, **ckw): \r\n  File \"/usr/lib/python2.7/dist-packages/datalad/support/annexrepo.py\", line 876, in is_valid_repo \r\n    or GitRepo(path, create=False, init=False).is_with_annex() \r\n  File \"/usr/lib/python2.7/dist-packages/datalad/support/repo.py\", line 146, in __call__ \r\n    instance = type.__call__(cls, *new_args, **new_kwargs) \r\n  File \"/usr/lib/python2.7/dist-packages/datalad/support/gitrepo.py\", line 537, in __init__ \r\n    ssh_manager.assure_initialized() \r\n  File \"/usr/lib/python2.7/dist-packages/datalad/support/sshconnector.py\", line 380, in assure_initialized \r\n    assure_dir(self._socket_dir) \r\n  File \"/usr/lib/python2.7/dist-packages/datalad/utils.py\", line 966, in assure_dir \r\n    os.makedirs(dirname) \r\n  File \"/usr/lib/python2.7/os.py\", line 150, in makedirs \r\n    makedirs(head, mode) \r\n  File \"/usr/lib/python2.7/os.py\", line 150, in makedirs \r\n    makedirs(head, mode) \r\n  File \"/usr/lib/python2.7/os.py\", line 150, in makedirs \r\n    makedirs(head, mode)\r\n  File \"/usr/lib/python2.7/os.py\", line 150, in makedirs \r\n    makedirs(head, mode) \r\n  File \"/usr/lib/python2.7/os.py\", line 157, in makedirs \r\n    mkdir(name, mode)\r\nOSError: [Errno 30] Read-only file system: '/usr/people'\r\n```\r\n(originally reported by @snastase). We will figure out how it got to that `/usr/people` but my overall point is that we shouldn't just crash in such situations where we could proceed and operate correctly (although possibly prompting for the password many times if finally some ssh network interaction happens)", "closed_by": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/2696/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/2696/timeline", "performed_via_github_app": null}