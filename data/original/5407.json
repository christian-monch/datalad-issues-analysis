{"url": "https://api.github.com/repos/datalad/datalad/issues/5407", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/5407/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/5407/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/5407/events", "html_url": "https://github.com/datalad/datalad/pull/5407", "id": 800792332, "node_id": "MDExOlB1bGxSZXF1ZXN0NTY3MjIwNTg5", "number": 5407, "title": "log: Add target name filters to ProgressHandler", "user": {"login": "kyleam", "id": 1297788, "node_id": "MDQ6VXNlcjEyOTc3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1297788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kyleam", "html_url": "https://github.com/kyleam", "followers_url": "https://api.github.com/users/kyleam/followers", "following_url": "https://api.github.com/users/kyleam/following{/other_user}", "gists_url": "https://api.github.com/users/kyleam/gists{/gist_id}", "starred_url": "https://api.github.com/users/kyleam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kyleam/subscriptions", "organizations_url": "https://api.github.com/users/kyleam/orgs", "repos_url": "https://api.github.com/users/kyleam/repos", "events_url": "https://api.github.com/users/kyleam/events{/privacy}", "received_events_url": "https://api.github.com/users/kyleam/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-02-03T23:47:20Z", "updated_at": "2021-02-10T14:58:22Z", "closed_at": "2021-02-10T14:58:01Z", "author_association": "MEMBER", "active_lock_reason": null, "pull_request": {"url": "https://api.github.com/repos/datalad/datalad/pulls/5407", "html_url": "https://github.com/datalad/datalad/pull/5407", "diff_url": "https://github.com/datalad/datalad/pull/5407.diff", "patch_url": "https://github.com/datalad/datalad/pull/5407.patch"}, "body": "get_initialized_logger() used to add two handlers to the logger for\r\ninteractive calls:\r\n\r\n  * a plain log handler with a filter to remove dlm_progress records\r\n  * a ProgressHandler with a filter to keep dlm_progress records\r\n\r\nSince 8f776d396e (ENH: make ProgressHandler emit via default handler\r\nif not a progress record, 2020-10-12), only ProgressHandler is added\r\nas a handler, and its .emit() relays non-dlm_progress records to the\r\nplain handler.\r\n\r\nThis change causes `test_log.test_filters` to fail when executed with\r\n--nocapture:\r\n\r\n    AssertionError: 'log3' unexpectedly found in\r\n    '[DEBUG] log1\\n[INFO] log2\\n[INFO] log3\\n\r\n\r\nThe non-test aspect to the failure is that the target name filter that\r\nis added to the plain logger isn't honored in the new arrangement.\r\nFix that by adding those filters to ProgressHandler's (currently\r\nempty) .filters.\r\n\r\nAn additional issue is that swallow_logs() discards filters from\r\nProgressHandler when setting up its custom handler.  That made sense\r\nbefore 8f776d396e, when ProgressHandler had a filter that only kept\r\ndlm_progress records, but it doesn't work if ProgressHandler is used\r\nas the primary handler that relays to the plain one.\r\n\r\nRe: #5402\r\n", "closed_by": {"login": "kyleam", "id": 1297788, "node_id": "MDQ6VXNlcjEyOTc3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1297788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kyleam", "html_url": "https://github.com/kyleam", "followers_url": "https://api.github.com/users/kyleam/followers", "following_url": "https://api.github.com/users/kyleam/following{/other_user}", "gists_url": "https://api.github.com/users/kyleam/gists{/gist_id}", "starred_url": "https://api.github.com/users/kyleam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kyleam/subscriptions", "organizations_url": "https://api.github.com/users/kyleam/orgs", "repos_url": "https://api.github.com/users/kyleam/repos", "events_url": "https://api.github.com/users/kyleam/events{/privacy}", "received_events_url": "https://api.github.com/users/kyleam/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/5407/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/5407/timeline", "performed_via_github_app": null}