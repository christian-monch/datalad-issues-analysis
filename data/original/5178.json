{"url": "https://api.github.com/repos/datalad/datalad/issues/5178", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/5178/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/5178/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/5178/events", "html_url": "https://github.com/datalad/datalad/issues/5178", "id": 747720612, "node_id": "MDU6SXNzdWU3NDc3MjA2MTI=", "number": 5178, "title": "FOI: git-annex \"mints\" \"correct\" git-annex branch from \"thin air\"", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-11-20T18:50:53Z", "updated_at": "2020-12-16T17:44:39Z", "closed_at": "2020-12-16T17:44:38Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Even if no remote present and git-annex branch is gone, `git-annex get` manages to re-establish the branch... have't looked in detail but also \r\n```shell\r\n$> datalad install ///openneuro/ds000001; builtin cd ds000001; git remote remove origin; git branch -D git-annex; git branch -a; git annex get --debug sub-01/anat/sub-01_T1w.nii.gz\r\n[INFO   ] access to 1 dataset sibling s3-PRIVATE not auto-enabled, enable with:                                  \r\n|               datalad siblings -d \"/tmp/ds000001\" enable -s s3-PRIVATE                                         \r\ninstall(ok): /tmp/ds000001 (dataset)\r\nDeleted branch git-annex (was 7e30fe8).\r\n* master\r\n[2020-11-20 13:46:29.038337236] read: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"symbolic-ref\",\"-q\",\"HEAD\"]\r\n[2020-11-20 13:46:29.043290298] process done ExitSuccess\r\n[2020-11-20 13:46:29.04338591] read: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"show-ref\",\"refs/heads/master\"]\r\n[2020-11-20 13:46:29.054372976] process done ExitSuccess\r\n[2020-11-20 13:46:29.055078508] read: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"ls-files\",\"--cached\",\"-z\",\"--\",\"sub-01/anat/sub-01_T1w.nii.gz\"]\r\nget sub-01/anat/sub-01_T1w.nii.gz [2020-11-20 13:46:29.068331488] read: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"show-ref\",\"git-annex\"]\r\n[2020-11-20 13:46:29.079609115] process done ExitFailure 1\r\n[2020-11-20 13:46:29.079930859] read: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"show-ref\",\"--hash\",\"refs/heads/git-annex\"]\r\n[2020-11-20 13:46:29.090715327] process done ExitFailure 1\r\n[2020-11-20 13:46:29.090860774] call: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"show-ref\",\"--verify\",\"-q\",\"origin/git-annex\"]\r\n[2020-11-20 13:46:29.101775626] process done ExitFailure 1\r\n[2020-11-20 13:46:29.105549676] read: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"write-tree\"]\r\n[2020-11-20 13:46:29.121579265] process done ExitSuccess\r\n[2020-11-20 13:46:29.121903712] chat: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"commit-tree\",\"8eb465ec199edef79bbc3c2f84d09d99158bf598\",\"--no-gpg-sign\"]\r\n[2020-11-20 13:46:29.132227261] process done ExitSuccess\r\n[2020-11-20 13:46:29.132608267] call: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"update-ref\",\"refs/heads/git-annex\",\"66a555b58eb386e821963eee8da26a703bb7b41d\"]\r\n[2020-11-20 13:46:29.152826081] process done ExitSuccess\r\n[2020-11-20 13:46:29.157423117] chat: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"cat-file\",\"--batch\"]\r\n[2020-11-20 13:46:29.16043985] chat: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"cat-file\",\"--batch-check=%(objectname) %(objecttype) %(objectsize)\"]\r\n(from s3-PUBLIC...) \r\n\r\n[2020-11-20 13:46:29.215570206] Request {\r\n  host                 = \"s3.amazonaws.com\"\r\n  port                 = 443\r\n  secure               = True\r\n  requestHeaders       = [(\"Accept-Encoding\",\"identity\"),(\"User-Agent\",\"git-annex/7.20190819+git2-g908476a9b-1~ndall+1\")]\r\n  path                 = \"/openneuro.org/ds000001/sub-01/anat/sub-01_T1w.nii.gz\"\r\n  queryString          = \"?versionId=SHOhSfza0LCFpgctRH3sMZ8iwAGSUwIy\"\r\n  method               = \"GET\"\r\n  proxy                = Nothing\r\n  rawBody              = False\r\n  redirectCount        = 10\r\n  responseTimeout      = ResponseTimeoutDefault\r\n  requestVersion       = HTTP/1.1\r\n}\r\n\r\n(checksum...) ok                     \r\n[2020-11-20 13:46:32.101748466] chat: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"hash-object\",\"-w\",\"--stdin-paths\",\"--no-filters\"]\r\n[2020-11-20 13:46:32.10419528] feed: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"update-index\",\"-z\",\"--index-info\"]\r\n[2020-11-20 13:46:32.116505567] process done ExitSuccess\r\n[2020-11-20 13:46:32.116784441] read: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"show-ref\",\"--hash\",\"refs/heads/git-annex\"]\r\n[2020-11-20 13:46:32.124235683] process done ExitSuccess\r\n(recording state in git...)\r\n[2020-11-20 13:46:32.124985114] read: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"write-tree\"]\r\n[2020-11-20 13:46:32.142186446] process done ExitSuccess\r\n[2020-11-20 13:46:32.142625208] chat: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"commit-tree\",\"8b18800619b1cb354f114b9e34569cad4126d156\",\"--no-gpg-sign\",\"-p\",\"refs/heads/git-annex\"]\r\n[2020-11-20 13:46:32.158518251] process done ExitSuccess\r\n[2020-11-20 13:46:32.158677611] call: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"update-ref\",\"refs/heads/git-annex\",\"6f5daf341bd6acc53510664153143a1c3969ffc4\"]\r\n[2020-11-20 13:46:32.172528531] process done ExitSuccess\r\n[2020-11-20 13:46:32.177188312] process done ExitSuccess\r\n[2020-11-20 13:46:32.177526189] process done ExitSuccess\r\n[2020-11-20 13:46:32.177882204] process done ExitSuccess\r\n```\r\n\r\nwell -- most likely comes from `.git/annex`... \r\n\r\n<details>\r\n<summary>yep</summary> \r\n\r\n```shell\r\n$> datalad install ///openneuro/ds000001; builtin cd ds000001; git remote remove origin; git branch -D git-annex; git branch -a; rm -rf .git/annex;  git annex get --debug sub-01/anat/sub-01_T1w.nii.gz\r\n\r\n[INFO   ] access to 1 dataset sibling s3-PRIVATE not auto-enabled, enable with:                                  \r\n|               datalad siblings -d \"/tmp/ds000001\" enable -s s3-PRIVATE                                         \r\ninstall(ok): /tmp/ds000001 (dataset)\r\nDeleted branch git-annex (was da29913).\r\n* master\r\n[2020-11-20 13:49:53.962550144] read: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"symbolic-ref\",\"-q\",\"HEAD\"]\r\n[2020-11-20 13:49:53.980105647] process done ExitSuccess\r\n[2020-11-20 13:49:53.98022466] read: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"show-ref\",\"refs/heads/master\"]\r\n[2020-11-20 13:49:53.994499714] process done ExitSuccess\r\n[2020-11-20 13:49:53.994939511] read: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"ls-files\",\"--cached\",\"-z\",\"--\",\"sub-01/anat/sub-01_T1w.nii.gz\"]\r\nget sub-01/anat/sub-01_T1w.nii.gz [2020-11-20 13:49:54.00984919] read: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"show-ref\",\"git-annex\"]\r\n[2020-11-20 13:49:54.021989963] process done ExitFailure 1\r\n[2020-11-20 13:49:54.02246296] read: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"show-ref\",\"--hash\",\"refs/heads/git-annex\"]\r\n[2020-11-20 13:49:54.035497426] process done ExitFailure 1\r\n[2020-11-20 13:49:54.035982527] call: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"show-ref\",\"--verify\",\"-q\",\"origin/git-annex\"]\r\n[2020-11-20 13:49:54.04513097] process done ExitFailure 1\r\n[2020-11-20 13:49:54.047381091] read: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"write-tree\"]\r\n[2020-11-20 13:49:54.063737562] process done ExitSuccess\r\n[2020-11-20 13:49:54.064145018] chat: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"commit-tree\",\"4b825dc642cb6eb9a060e54bf8d69288fbee4904\",\"--no-gpg-sign\"]\r\n[2020-11-20 13:49:54.077036468] process done ExitSuccess\r\n[2020-11-20 13:49:54.077366304] call: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"update-ref\",\"refs/heads/git-annex\",\"2a0efbc003adebd7607b4d52b4142ce2293bb0be\"]\r\n[2020-11-20 13:49:54.094620862] process done ExitSuccess\r\n[2020-11-20 13:49:54.095197245] chat: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"cat-file\",\"--batch\"]\r\n[2020-11-20 13:49:54.095904408] chat: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"cat-file\",\"--batch-check=%(objectname) %(objecttype) %(objectsize)\"]\r\n\r\ngit-annex: S3 bucket not configured\r\nfailed\r\n[2020-11-20 13:49:54.108325753] process done ExitSuccess\r\n[2020-11-20 13:49:54.109606341] process done ExitSuccess\r\ngit-annex: get: 1 failed\r\n\r\n```\r\n</details>", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/5178/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/5178/timeline", "performed_via_github_app": null}