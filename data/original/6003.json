{"url": "https://api.github.com/repos/datalad/datalad/issues/6003", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/6003/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/6003/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/6003/events", "html_url": "https://github.com/datalad/datalad/issues/6003", "id": 1005498845, "node_id": "I_kwDOANZqws477rHd", "number": 6003, "title": "Datalad 0.15 fails if user.email is not set in Docker environment", "user": {"login": "effigies", "id": 83442, "node_id": "MDQ6VXNlcjgzNDQy", "avatar_url": "https://avatars.githubusercontent.com/u/83442?v=4", "gravatar_id": "", "url": "https://api.github.com/users/effigies", "html_url": "https://github.com/effigies", "followers_url": "https://api.github.com/users/effigies/followers", "following_url": "https://api.github.com/users/effigies/following{/other_user}", "gists_url": "https://api.github.com/users/effigies/gists{/gist_id}", "starred_url": "https://api.github.com/users/effigies/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/effigies/subscriptions", "organizations_url": "https://api.github.com/users/effigies/orgs", "repos_url": "https://api.github.com/users/effigies/repos", "events_url": "https://api.github.com/users/effigies/events{/privacy}", "received_events_url": "https://api.github.com/users/effigies/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2021-09-23T14:23:10Z", "updated_at": "2021-09-23T15:35:51Z", "closed_at": "2021-09-23T15:25:06Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "#### What is the problem?\r\n\r\nAs of datalad 0.15, running datalad in a Docker environment fails with a message like `fatal: unable to auto-detect email address (got 'root@c91dfaf74f83.(none)') `. This is coming up in Nipype's CI tests.\r\n\r\n<details>\r\n<summary>Docker build log</summary>\r\n\r\n```\r\nStep 7/8 : RUN datalad install -s https://datasets-tests.datalad.org/dicoms/dcm2niix-tests /opt/dcm2niix-tests\r\n ---> Running in c91dfaf74f83\r\nIt is highly recommended to configure Git before using DataLad. Set both 'user.name' and 'user.email' configuration variables.\r\nIt is highly recommended to configure Git before using DataLad. Set both 'user.name' and 'user.email' configuration variables.\r\n[INFO] Cloning dataset to Dataset(/opt/dcm2niix-tests) \r\n[INFO] Attempting to clone from https://datasets-tests.datalad.org/dicoms/dcm2niix-tests to /opt/dcm2niix-tests \r\n[INFO] Attempting to clone from https://datasets-tests.datalad.org/dicoms/dcm2niix-tests/.git to /opt/dcm2niix-tests \r\n[INFO] Start enumerating objects \r\n[INFO] Start counting objects \r\n[INFO] Start compressing objects \r\n[INFO] Start receiving objects \r\n[INFO] Start resolving deltas \r\n[INFO] Completed clone attempts for Dataset(/opt/dcm2niix-tests) \r\n[INFO] scanning for annexed files (this may take some time) \r\n[INFO] It is highly recommended to configure Git before using DataLad. Set both 'user.name' and 'user.email' configuration variables. \r\n[INFO] It is highly recommended to configure Git before using DataLad. Set both 'user.name' and 'user.email' configuration variables. \r\n[INFO] It is highly recommended to configure Git before using DataLad. Set both 'user.name' and 'user.email' configuration variables. \r\n[INFO] It is highly recommended to configure Git before using DataLad. Set both 'user.name' and 'user.email' configuration variables. \r\n[INFO] Author identity unknown\r\n| \r\n| *** Please tell me who you are.\r\n| \r\n| Run\r\n| \r\n|   git config --global user.email \"you@example.com\"\r\n|   git config --global user.name \"Your Name\"\r\n| \r\n| to set your account's default identity.\r\n| Omit --global to set the identity only in this repository.\r\n| \r\n| fatal: unable to auto-detect email address (got 'root@c91dfaf74f83.(none)') \r\n[INFO] git-annex: \r\n[INFO] user error (git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"-c\",\"annex.dotfiles=true\",\"commit-tree\",\"62a320cb5f24e60d6420820f356d5981e3d34b58\",\"--no-gpg-sign\",\"-p\",\"refs/heads/git-annex\"] exited 128) \r\nCommandError: 'git -c diff.ignoreSubmodules=none annex init -c annex.dotfiles=true' failed with exitcode 1 under /opt/dcm2niix-tests\r\n```\r\n\r\n</details>\r\n\r\nThis can be fixed by setting `user.email`. Not sure if this is intended behavior, and the information to fix the issue is in the error text, so no worries if this gets marked wontfix.\r\n\r\n#### What steps will reproduce the problem?\r\n\r\n`docker build` the following `Dockerfile`:\r\n\r\n<details>\r\n<summary>Docker file</summary>\r\n\r\n```Dockerfile\r\nFROM neurodebian:nd110-non-free@sha256:da71cf9be42f2798bc93383e60c8f98a2dd53c7996ca7c250fc0056eed13afe8\r\n\r\nARG DEBIAN_FRONTEND=\"noninteractive\"\r\nENV LANG=\"en_US.UTF-8\" \\\r\n    LC_ALL=\"en_US.UTF-8\"\r\nRUN apt-get update -qq \\\r\n    && apt-get install -y -q --no-install-recommends \\\r\n           apt-utils \\\r\n           bzip2 \\\r\n           ca-certificates \\\r\n           curl \\\r\n           locales \\\r\n           unzip \\\r\n    && apt-get clean \\\r\n    && rm -rf /var/lib/apt/lists/* \\\r\n    && sed -i -e 's/# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/' /etc/locale.gen \\\r\n    && dpkg-reconfigure --frontend=noninteractive locales \\\r\n    && update-locale LANG=\"en_US.UTF-8\"\r\n\r\nRUN apt-get update -qq \\\r\n    && apt-get install -y -q --no-install-recommends \\\r\n           python3 \\\r\n           python3-pip \\\r\n           git-annex-standalone \\\r\n    && apt-get clean \\\r\n    && rm -rf /var/lib/apt/lists/*\r\n\r\nRUN pip install datalad\r\n\r\n# Uncomment to fix\r\n# RUN git config --global user.email fake@email.com\r\n\r\nRUN datalad install -s https://datasets-tests.datalad.org/dicoms/dcm2niix-tests /opt/dcm2niix-tests\r\n\r\nENTRYPOINT [\"/bin/bash\"]\r\n```\r\n\r\n</details>\r\n\r\nIf you uncomment the `git config` line, the build will be successful.\r\n\r\n#### What version of DataLad are you using (run `datalad --version`)? On what operating system (consider running `datalad wtf`)?\r\n\r\n<details>\r\n<summary>WTF</summary>\r\n\r\n```\r\n# WTF\r\n## configuration <SENSITIVE, report disabled by configuration>\r\n## credentials \r\n  - keyring: \r\n    - active_backends: \r\n      - PlaintextKeyring with no encyption v.1.0 at /root/.local/share/python_keyring/keyring_pass.cfg\r\n    - config_file: /root/.config/python_keyring/keyringrc.cfg\r\n    - data_root: /root/.local/share/python_keyring\r\n## datalad \r\n  - full_version: 0.15.0\r\n  - version: 0.15.0\r\n## dependencies \r\n  - annexremote: 1.5.0\r\n  - appdirs: 1.4.4\r\n  - boto: 2.49.0\r\n  - cmd:annex: 8.20210903-1~ndall+1\r\n  - cmd:bundled-git: 2.30.2\r\n  - cmd:git: 2.30.2\r\n  - cmd:system-git: 2.30.2\r\n  - cmd:system-ssh: 8.4p1\r\n  - humanize: 3.11.0\r\n  - iso8601: 0.1.16\r\n  - keyring: 23.2.1\r\n  - keyrings.alt: 4.1.0\r\n  - msgpack: 1.0.2\r\n  - requests: 2.26.0\r\n  - wrapt: 1.12.1\r\n## environment \r\n  - LANG: en_US.UTF-8\r\n  - LC_ALL: en_US.UTF-8\r\n  - PATH: /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\r\n## extensions \r\n## git-annex \r\n  - build flags: \r\n    - Assistant\r\n    - Webapp\r\n    - Pairing\r\n    - Inotify\r\n    - DBus\r\n    - DesktopNotify\r\n    - TorrentParser\r\n    - MagicMime\r\n    - Feeds\r\n    - Testsuite\r\n    - S3\r\n    - WebDAV\r\n  - dependency versions: \r\n    - aws-0.22\r\n    - bloomfilter-2.0.1.0\r\n    - cryptonite-0.26\r\n    - DAV-1.3.4\r\n    - feed-1.3.0.1\r\n    - ghc-8.8.4\r\n    - http-client-0.6.4.1\r\n    - persistent-sqlite-2.10.6.2\r\n    - torrent-10000.1.1\r\n    - uuid-1.3.13\r\n    - yesod-1.6.1.0\r\n  - key/value backends: \r\n    - SHA256E\r\n    - SHA256\r\n    - SHA512E\r\n    - SHA512\r\n    - SHA224E\r\n    - SHA224\r\n    - SHA384E\r\n    - SHA384\r\n    - SHA3_256E\r\n    - SHA3_256\r\n    - SHA3_512E\r\n    - SHA3_512\r\n    - SHA3_224E\r\n    - SHA3_224\r\n    - SHA3_384E\r\n    - SHA3_384\r\n    - SKEIN256E\r\n    - SKEIN256\r\n    - SKEIN512E\r\n    - SKEIN512\r\n    - BLAKE2B256E\r\n    - BLAKE2B256\r\n    - BLAKE2B512E\r\n    - BLAKE2B512\r\n    - BLAKE2B160E\r\n    - BLAKE2B160\r\n    - BLAKE2B224E\r\n    - BLAKE2B224\r\n    - BLAKE2B384E\r\n    - BLAKE2B384\r\n    - BLAKE2BP512E\r\n    - BLAKE2BP512\r\n    - BLAKE2S256E\r\n    - BLAKE2S256\r\n    - BLAKE2S160E\r\n    - BLAKE2S160\r\n    - BLAKE2S224E\r\n    - BLAKE2S224\r\n    - BLAKE2SP256E\r\n    - BLAKE2SP256\r\n    - BLAKE2SP224E\r\n    - BLAKE2SP224\r\n    - SHA1E\r\n    - SHA1\r\n    - MD5E\r\n    - MD5\r\n    - WORM\r\n    - URL\r\n    - X*\r\n  - operating system: linux x86_64\r\n  - remote types: \r\n    - git\r\n    - gcrypt\r\n    - p2p\r\n    - S3\r\n    - bup\r\n    - directory\r\n    - rsync\r\n    - web\r\n    - bittorrent\r\n    - webdav\r\n    - adb\r\n    - tahoe\r\n    - glacier\r\n    - ddar\r\n    - git-lfs\r\n    - httpalso\r\n    - borg\r\n    - hook\r\n    - external\r\n  - supported repository versions: \r\n    - 8\r\n  - upgrade supported from repository versions: \r\n    - 0\r\n    - 1\r\n    - 2\r\n    - 3\r\n    - 4\r\n    - 5\r\n    - 6\r\n    - 7\r\n  - version: 8.20210903-1~ndall+1\r\n## location \r\n  - path: /\r\n  - type: directory\r\n## metadata_extractors \r\n  - annex (datalad 0.15.0): \r\n    - distribution: datalad 0.15.0\r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.annex\r\n    - version: None\r\n  - audio (datalad 0.15.0): \r\n    - distribution: datalad 0.15.0\r\n    - load_error: ModuleNotFoundError(No module named 'mutagen')\r\n    - module: datalad.metadata.extractors.audio\r\n  - datacite (datalad 0.15.0): \r\n    - distribution: datalad 0.15.0\r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.datacite\r\n    - version: None\r\n  - datalad_core (datalad 0.15.0): \r\n    - distribution: datalad 0.15.0\r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.datalad_core\r\n    - version: None\r\n  - datalad_rfc822 (datalad 0.15.0): \r\n    - distribution: datalad 0.15.0\r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.datalad_rfc822\r\n    - version: None\r\n  - exif (datalad 0.15.0): \r\n    - distribution: datalad 0.15.0\r\n    - load_error: ModuleNotFoundError(No module named 'exifread')\r\n    - module: datalad.metadata.extractors.exif\r\n  - frictionless_datapackage (datalad 0.15.0): \r\n    - distribution: datalad 0.15.0\r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.frictionless_datapackage\r\n    - version: None\r\n  - image (datalad 0.15.0): \r\n    - distribution: datalad 0.15.0\r\n    - load_error: ModuleNotFoundError(No module named 'PIL')\r\n    - module: datalad.metadata.extractors.image\r\n  - xmp (datalad 0.15.0): \r\n    - distribution: datalad 0.15.0\r\n    - load_error: ModuleNotFoundError(No module named 'libxmp')\r\n    - module: datalad.metadata.extractors.xmp\r\n## metadata_indexers \r\n## python \r\n  - implementation: CPython\r\n  - version: 3.9.2\r\n## system \r\n  - distribution: debian/11/bullseye\r\n  - encoding: \r\n    - default: utf-8\r\n    - filesystem: utf-8\r\n    - locale.prefered: UTF-8\r\n  - max_path_length: 256\r\n  - name: Linux\r\n  - release: 5.11.0-27-generic\r\n  - type: posix\r\n  - version: #29~20.04.1-Ubuntu SMP Wed Aug 11 15:58:17 UTC 2021\r\n```\r\n\r\n</details>\r\n", "closed_by": {"login": "effigies", "id": 83442, "node_id": "MDQ6VXNlcjgzNDQy", "avatar_url": "https://avatars.githubusercontent.com/u/83442?v=4", "gravatar_id": "", "url": "https://api.github.com/users/effigies", "html_url": "https://github.com/effigies", "followers_url": "https://api.github.com/users/effigies/followers", "following_url": "https://api.github.com/users/effigies/following{/other_user}", "gists_url": "https://api.github.com/users/effigies/gists{/gist_id}", "starred_url": "https://api.github.com/users/effigies/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/effigies/subscriptions", "organizations_url": "https://api.github.com/users/effigies/orgs", "repos_url": "https://api.github.com/users/effigies/repos", "events_url": "https://api.github.com/users/effigies/events{/privacy}", "received_events_url": "https://api.github.com/users/effigies/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/6003/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/6003/timeline", "performed_via_github_app": null}