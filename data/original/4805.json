{"url": "https://api.github.com/repos/datalad/datalad/issues/4805", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/4805/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/4805/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/4805/events", "html_url": "https://github.com/datalad/datalad/issues/4805", "id": 673964118, "node_id": "MDU6SXNzdWU2NzM5NjQxMTg=", "number": 4805, "title": "Download-url doesn't forwards bearer token authentication on redirects", "user": {"login": "joeyzhou98", "id": 35869923, "node_id": "MDQ6VXNlcjM1ODY5OTIz", "avatar_url": "https://avatars.githubusercontent.com/u/35869923?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joeyzhou98", "html_url": "https://github.com/joeyzhou98", "followers_url": "https://api.github.com/users/joeyzhou98/followers", "following_url": "https://api.github.com/users/joeyzhou98/following{/other_user}", "gists_url": "https://api.github.com/users/joeyzhou98/gists{/gist_id}", "starred_url": "https://api.github.com/users/joeyzhou98/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joeyzhou98/subscriptions", "organizations_url": "https://api.github.com/users/joeyzhou98/orgs", "repos_url": "https://api.github.com/users/joeyzhou98/repos", "events_url": "https://api.github.com/users/joeyzhou98/events{/privacy}", "received_events_url": "https://api.github.com/users/joeyzhou98/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-08-06T02:20:19Z", "updated_at": "2021-05-20T14:36:39Z", "closed_at": "2021-05-20T14:36:39Z", "author_association": "NONE", "active_lock_reason": null, "body": "#### What is the problem?\r\n\r\nI use [OSF](https://osf.io/) to store and retrieve datasets, clients will use their web interface to upload private datasets and my goal is to grab those datasets files into a local datalad dataset. I setup a new provider using the steps [here](https://github.com/datalad/datalad/issues/4376) and input my OSF token when prompted. Problem is that OSF redirects download links about 3 times: from their API to another internal API link to finally a Google drive link containing the private file and each redirect requires a `{\"Authorization\": \"Bearer <token>\"}` header in order to proceed except the last google drive link. It doesn't seem like `datalad download-url` adds that header after the first redirect, causing the authentication to fail even though the bearer token is perfectly good. So it would be great if the Bearer token authentication adds the token to subsequent redirect requests so cases like this won't cause problems\r\n\r\n![image](https://user-images.githubusercontent.com/35869923/89483265-9d5ee000-d769-11ea-9fbd-6f9d4842b24f.png)\r\n\r\n\r\n#### What steps will reproduce the problem?\r\n\r\n- Setup a new provider by running `python -c 'from datalad.downloaders.providers import Providers; Providers().enter_new(url=\"https://api.osf.io/v2/\")'\r\n- Hit enter\r\n- Enter regex `.*` to match all links\r\n- Enter `bearer_token`\r\n- Enter `token`\r\n- Hit enter\r\n- `datalad download-url https://osf.io/download/5e8524691ab24301dae037a9/`\r\n- Enter `yes`\r\n- Enter this throwaway token: `KysP9I5gIBKVWLLIMK8wZDc5xlkqawJ5wnzncKWOtORGi4jMhsyjGzYemMtd3dEbQsD7Xq`\r\n- Enter this token again\r\n- See that the command failed to authenticate\r\n\r\n![image](https://user-images.githubusercontent.com/35869923/89482935-f11cf980-d768-11ea-9666-ae092bb28468.png)\r\n\r\n\r\n#### What version of DataLad are you using (run `datalad --version`)? On what operating system (consider running `datalad wtf`)?\r\ndatalad 0.12.6\r\n### Is there anything else that would be useful to know in this context?\r\n#### Have you had any success using DataLad before? (to assess your expertise/prior luck.  We would welcome your testimonial additions to https://github.com/datalad/datalad/wiki/Testimonials as well)\r\n", "closed_by": {"login": "joeyzhou98", "id": 35869923, "node_id": "MDQ6VXNlcjM1ODY5OTIz", "avatar_url": "https://avatars.githubusercontent.com/u/35869923?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joeyzhou98", "html_url": "https://github.com/joeyzhou98", "followers_url": "https://api.github.com/users/joeyzhou98/followers", "following_url": "https://api.github.com/users/joeyzhou98/following{/other_user}", "gists_url": "https://api.github.com/users/joeyzhou98/gists{/gist_id}", "starred_url": "https://api.github.com/users/joeyzhou98/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joeyzhou98/subscriptions", "organizations_url": "https://api.github.com/users/joeyzhou98/orgs", "repos_url": "https://api.github.com/users/joeyzhou98/repos", "events_url": "https://api.github.com/users/joeyzhou98/events{/privacy}", "received_events_url": "https://api.github.com/users/joeyzhou98/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/4805/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/4805/timeline", "performed_via_github_app": null}