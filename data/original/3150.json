{"url": "https://api.github.com/repos/datalad/datalad/issues/3150", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/3150/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/3150/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/3150/events", "html_url": "https://github.com/datalad/datalad/issues/3150", "id": 408274934, "node_id": "MDU6SXNzdWU0MDgyNzQ5MzQ=", "number": 3150, "title": "(python3.4 + Ubuntu 14.04) specific fallout with long filenames", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2019-02-08T18:40:33Z", "updated_at": "2021-09-09T14:48:44Z", "closed_at": "2019-02-14T22:41:13Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "While building pkgs for neurodebian, 14.04 build failed with\r\n```\r\n======================================================================\r\nERROR: datalad.support.tests.test_annexrepo.test_files_split_exc(<class 'datalad.support.annexrepo.AnnexRepo'>,)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python3/dist-packages/nose/case.py\", line 198, in runTest\r\n    self.test(*self.arg)\r\n  File \"/build/datalad-0.11.2/.pybuild/pythonX.Y_3.4/build/datalad/tests/utils.py\", line 615, in newfunc\r\n    return t(*(arg + (filename,)), **kw)\r\n  File \"/build/datalad-0.11.2/.pybuild/pythonX.Y_3.4/build/datalad/support/tests/test_annexrepo.py\", line 2512, in check_files_split_exc\r\n    r.add(files)\r\n  File \"/build/datalad-0.11.2/.pybuild/pythonX.Y_3.4/build/datalad/support/gitrepo.py\", line 316, in newfunc\r\n    result = func(self, files_new, *args, **kwargs)\r\n  File \"/build/datalad-0.11.2/.pybuild/pythonX.Y_3.4/build/datalad/support/annexrepo.py\", line 1475, in add\r\n    git_options=git_options, annex_options=annex_options, update=update\r\n  File \"/build/datalad-0.11.2/.pybuild/pythonX.Y_3.4/build/datalad/support/annexrepo.py\", line 1550, in add_\r\n    for rec in to_be_added_recs\r\n  File \"/build/datalad-0.11.2/.pybuild/pythonX.Y_3.4/build/datalad/support/annexrepo.py\", line 1549, in <dictcomp>\r\n    rec['file']: self.get_file_size(rec['file'])\r\n  File \"/build/datalad-0.11.2/.pybuild/pythonX.Y_3.4/build/datalad/support/annexrepo.py\", line 1520, in _get_to_be_added_recs\r\n    files, git_options=_git_options, update=update):\r\n  File \"/build/datalad-0.11.2/.pybuild/pythonX.Y_3.4/build/datalad/support/gitrepo.py\", line 1089, in add_\r\n    to_options(update=update) + ['--verbose']\r\n  File \"/build/datalad-0.11.2/.pybuild/pythonX.Y_3.4/build/datalad/support/annexrepo.py\", line 1261, in _git_custom_command\r\n    return super(AnnexRepo, self)._git_custom_command(*args, **kwargs)\r\n  File \"/build/datalad-0.11.2/.pybuild/pythonX.Y_3.4/build/datalad/support/gitrepo.py\", line 316, in newfunc\r\n    result = func(self, files_new, *args, **kwargs)\r\n  File \"/build/datalad-0.11.2/.pybuild/pythonX.Y_3.4/build/datalad/support/gitrepo.py\", line 1748, in _git_custom_command\r\n    expect_fail=expect_fail)\r\n  File \"/build/datalad-0.11.2/.pybuild/pythonX.Y_3.4/build/datalad/support/gitrepo.py\", line 1800, in _run_command_files_split\r\n    *args, **kwargs)\r\n  File \"/build/datalad-0.11.2/.pybuild/pythonX.Y_3.4/build/datalad/cmd.py\", line 683, in run\r\n    cmd, env=self.get_git_environ_adjusted(env), *args, **kwargs)\r\n  File \"/build/datalad-0.11.2/.pybuild/pythonX.Y_3.4/build/datalad/cmd.py\", line 496, in run\r\n    stdin=stdin)\r\n  File \"/usr/lib/python3.4/subprocess.py\", line 848, in __init__\r\n    restore_signals, start_new_session)\r\n  File \"/usr/lib/python3.4/subprocess.py\", line 1446, in _execute_child\r\n    raise child_exception_type(errno_num, err_msg)\r\nOSError: [Errno 7] Argument list too long\r\n\r\n======================================================================\r\nFAIL: datalad.support.tests.test_annexrepo.test_files_split_exc(<class 'datalad.support.gitrepo.GitRepo'>,)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python3/dist-packages/nose/case.py\", line 198, in runTest\r\n    self.test(*self.arg)\r\n  File \"/build/datalad-0.11.2/.pybuild/pythonX.Y_3.4/build/datalad/tests/utils.py\", line 615, in newfunc\r\n    return t(*(arg + (filename,)), **kw)\r\n  File \"/build/datalad-0.11.2/.pybuild/pythonX.Y_3.4/build/datalad/support/tests/test_annexrepo.py\", line 2516, in check_files_split_exc\r\n    assert_not_in('too long', str(ecm.exception))\r\nAssertionError: 'too long' unexpectedly found in '[Errno 7] Argument list too long'\r\n\r\n----------------------------------------------------------------------\r\nRan 887 tests in 1432.142s\r\n\r\nFAILED (SKIP=99, errors=1, failures=1)\r\n/tmp/datalad_temp_tree_test_paths_with_forward_slashesk2jsqatu\r\nVersions: appdirs=1.3.0 boto=2.44.0 cmd:annex=7.20181121+git58-gbc4aa3f0e-1~ndall+1 cmd:git=2.19.2 cmd:system-git=1.9.1 cmd:system-ssh=6.6p1 exifread=2.1.2 git=2.1.8 gitdb=2.0.0 humanize=0.5.1 iso8601=0.1.10 keyring=3.5 msgpack=0.4.2 mutagen=1.38 patoolib=1.12 requests=2.2.1 six=1.9.0 tqdm=4.11.2 wrapt=1.9.0\r\n```\r\nafter passing the tests for python 2.  Also it passed with python 3.4 in Debian 80. Versions of 3.4 are a bit different\r\n```\r\nneurodebian@smaug ~/deb/builds/datalad/0.11.2-1 % grep -A1 'Selecting.*libpython3.4-minimal' datalad_0.11.2-1*+1_amd64.build \r\ndatalad_0.11.2-1~nd14.04+1_amd64.build:Selecting previously unselected package libpython3.4-minimal:amd64.\r\ndatalad_0.11.2-1~nd14.04+1_amd64.build-Preparing to unpack .../libpython3.4-minimal_3.4.0-2ubuntu1_amd64.deb ...\r\n--\r\ndatalad_0.11.2-1~nd80+1_amd64.build:Selecting previously unselected package libpython3.4-minimal:amd64.\r\ndatalad_0.11.2-1~nd80+1_amd64.build-Preparing to unpack .../libpython3.4-minimal_3.4.2-1_amd64.deb ...\r\n```\r\nI am rerunning 14.04 build to see if it is reproducible.  If not -- means that there is more to fixup to guarantee robustness :-/  If reproducible - I guess we should blacklist/skip with 3.4 < 3.4.2", "closed_by": {"login": "kyleam", "id": 1297788, "node_id": "MDQ6VXNlcjEyOTc3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1297788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kyleam", "html_url": "https://github.com/kyleam", "followers_url": "https://api.github.com/users/kyleam/followers", "following_url": "https://api.github.com/users/kyleam/following{/other_user}", "gists_url": "https://api.github.com/users/kyleam/gists{/gist_id}", "starred_url": "https://api.github.com/users/kyleam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kyleam/subscriptions", "organizations_url": "https://api.github.com/users/kyleam/orgs", "repos_url": "https://api.github.com/users/kyleam/repos", "events_url": "https://api.github.com/users/kyleam/events{/privacy}", "received_events_url": "https://api.github.com/users/kyleam/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/3150/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/3150/timeline", "performed_via_github_app": null}