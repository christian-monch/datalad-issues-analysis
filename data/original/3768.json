{"url": "https://api.github.com/repos/datalad/datalad/issues/3768", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/3768/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/3768/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/3768/events", "html_url": "https://github.com/datalad/datalad/pull/3768", "id": 505682889, "node_id": "MDExOlB1bGxSZXF1ZXN0MzI3MDY0MDM3", "number": 3768, "title": "OPT: Half the number of for-each-ref calls in GitRepo.is_with_annex()", "user": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2019-10-11T07:19:48Z", "updated_at": "2019-10-11T15:28:53Z", "closed_at": "2019-10-11T15:28:47Z", "author_association": "MEMBER", "active_lock_reason": null, "pull_request": {"url": "https://api.github.com/repos/datalad/datalad/pulls/3768", "html_url": "https://github.com/datalad/datalad/pull/3768", "diff_url": "https://github.com/datalad/datalad/pull/3768.diff", "patch_url": "https://github.com/datalad/datalad/pull/3768.patch"}, "body": "This addresses some aspect of gh-3766\r\n\r\nIt also removes an unused feature to limit the check to remote branches.\r\nEven the crawler doesn't use it.\r\n\r\nIt also removes an explicit check for a direct mode related branch name,\r\nthat doesn't seem to be relevant, even for direct mode repos, and\r\n@bpoldrack oldrack also had no memory on when exactly this could happen. Given\r\nthat we do not support it anymore, I decided to remove the additional\r\ncomplexity.\r\n\r\nHere is the updated profile (compare to https://github.com/datalad/datalad/issues/3766#issuecomment-540937940)\r\n\r\n![image](https://user-images.githubusercontent.com/136479/66632273-5915b880-ec08-11e9-81a6-ba2766e21017.png)\r\n\r\n```\r\n       before           after         ratio\r\n     [6ad8d02f]       [91bc32fa]\r\n     <bm/merge-target>       <bm/pr>   \r\n       1.75\u00b10.07s       1.46\u00b10.05s    ~0.83  api.supers.time_createadd\r\n-      2.78\u00b10.06s       1.89\u00b10.04s     0.68  api.supers.time_createadd_to_dataset\r\n       10.2\u00b10.06s       7.55\u00b10.02s    ~0.74  api.supers.time_installr\r\n-        286\u00b110ms          208\u00b17ms     0.73  api.supers.time_ls\r\n-      3.08\u00b10.07s       2.17\u00b10.01s     0.70  api.supers.time_ls_recursive\r\n-      3.23\u00b10.03s       2.37\u00b10.02s     0.73  api.supers.time_ls_recursive_long_all\r\n-        965\u00b110ms          873\u00b17ms     0.90  api.supers.time_status\r\n-      2.01\u00b10.05s       1.65\u00b10.03s     0.82  api.supers.time_status_recursive\r\n-         250\u00b17ms          156\u00b13ms     0.62  api.supers.time_subdatasets\r\n-        795\u00b120ms         537\u00b110ms     0.68  api.supers.time_subdatasets_recursive\r\n-         220\u00b12ms          150\u00b13ms     0.68  api.supers.time_subdatasets_recursive_first\r\n       7.75\u00b10.08s        4.92\u00b10.1s    ~0.64  api.supers.time_uninstall\r\n-        890\u00b120ms         756\u00b110ms     0.85  api.testds.time_create_test_dataset1\r\n-      5.03\u00b10.03s       4.31\u00b10.05s     0.86  api.testds.time_create_test_dataset2x2\r\n      2.22\u00b10.06ms       2.28\u00b10.1ms     1.03  core.runner.time_echo\r\n      2.43\u00b10.04ms      2.36\u00b10.04ms     0.97  core.runner.time_echo_gitrunner\r\n-            1.03             0.86     0.83  core.runner.track_overhead_100ms\r\n+           63.58            85.15     1.34  core.runner.track_overhead_echo\r\n-            6.55            -1.46    -0.22  core.runner.track_overhead_heavyout\r\n-             3.9             3.22     0.83  core.runner.track_overhead_heavyout_online_process\r\n-           28.16            25.04     0.89  core.runner.track_overhead_heavyout_online_through\r\n         620\u00b120ms         607\u00b110ms     0.98  core.startup.time_help_np\r\n          148\u00b12ms          143\u00b15ms     0.97  core.startup.time_import\r\n          559\u00b16ms         534\u00b120ms     0.96  core.startup.time_import_api\r\n       17.3\u00b10.6ms         17.4\u00b11ms     1.00  repo.gitrepo.time_get_content_info\r\n       7.85\u00b10.4ms       8.12\u00b10.5ms     1.03  support.path.get_parent_paths.time_allsubmods_toplevel\r\n       6.66\u00b10.2ms       7.51\u00b10.5ms    ~1.13  support.path.get_parent_paths.time_allsubmods_toplevel_only\r\n         349\u00b110ns         352\u00b120ns     1.01  support.path.get_parent_paths.time_no_submods\r\n       5.95\u00b10.2ms       5.90\u00b10.3ms     0.99  support.path.get_parent_paths.time_one_submod_subdir\r\n       6.01\u00b10.2ms       6.30\u00b10.5ms     1.05  support.path.get_parent_paths.time_one_submod_toplevel\r\n        33.9\u00b10.2s       32.7\u00b10.07s     0.97  usecases.study_forrest.time_make_studyforrest_mockup\r\n```", "closed_by": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/3768/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/3768/timeline", "performed_via_github_app": null}