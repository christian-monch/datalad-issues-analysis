{"url": "https://api.github.com/repos/datalad/datalad/issues/5449", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/5449/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/5449/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/5449/events", "html_url": "https://github.com/datalad/datalad/issues/5449", "id": 819077836, "node_id": "MDU6SXNzdWU4MTkwNzc4MzY=", "number": 5449, "title": "branches in nested dataset", "user": {"login": "bpinsard", "id": 1155388, "node_id": "MDQ6VXNlcjExNTUzODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1155388?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bpinsard", "html_url": "https://github.com/bpinsard", "followers_url": "https://api.github.com/users/bpinsard/followers", "following_url": "https://api.github.com/users/bpinsard/following{/other_user}", "gists_url": "https://api.github.com/users/bpinsard/gists{/gist_id}", "starred_url": "https://api.github.com/users/bpinsard/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bpinsard/subscriptions", "organizations_url": "https://api.github.com/users/bpinsard/orgs", "repos_url": "https://api.github.com/users/bpinsard/repos", "events_url": "https://api.github.com/users/bpinsard/events{/privacy}", "received_events_url": "https://api.github.com/users/bpinsard/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2021-03-01T17:16:04Z", "updated_at": "2021-03-01T21:04:09Z", "closed_at": "2021-03-01T20:27:31Z", "author_association": "NONE", "active_lock_reason": null, "body": "#### What is the problem?\r\n\r\nThis is not specifically a datalad problem, but I think that the nesting introduced by datalad and git-annex specificities make my question more pertinent here.\r\nI am trying to setup branches to track an evolving super-dataset with multiple sub-datasets.\r\nMy goal is that when switching branch in the super-dataset, it recurses in the submodules to checkout a branch with the same name.\r\nI set akk the submodule to track branch `.` which is to have submodule track the branch of the parent git.\r\n`git submodule foreach --recursive 'git config -f $toplevel/.gitmodules submodule.$sm_path.branch .'`\r\nI then created a branch `main` in each subdataset recursively.\r\nI then tried:\r\n`git checkout --recurse-submodules main `\r\nbut then only the parent dataset has changed branch, not the submodules.\r\nI tried :\r\n```$ git checkout --recurse-submodules --force  main\r\nMigrating git directory of 'anat' from\r\n'/home/basile/data/tests/cneuromod2/anat/.git' to\r\n'/home/basile/data/tests/cneuromod2/.git/modules/anat'\r\nAlready on 'main'\r\nYour branch is up to date with 'origin/main'.\r\n``` \r\nWhich effectively switched the submodule to a detached head (not ideal), but, as you can see, triggered an `absorbgitdirs` (not sure why), which of course breaks the git-annex symlinks.\r\nThis took me again to git-submodule man page to discover that \"absorbed\" .git dirs is the normal git behavior !?:\r\n> A repository that was cloned independently and later added as a submodule or old setups have the submodules git directory inside the submodule instead of embedded into the superprojects git directory.\r\nI am concerned that git will blindly decide to absorb git-dirs when running basic commands and that users will \"loose\" access to their annexed data. \r\n \r\nDo you have any experience or advice on how to cleanly set the branch tracking?\r\nThanks!", "closed_by": {"login": "bpinsard", "id": 1155388, "node_id": "MDQ6VXNlcjExNTUzODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1155388?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bpinsard", "html_url": "https://github.com/bpinsard", "followers_url": "https://api.github.com/users/bpinsard/followers", "following_url": "https://api.github.com/users/bpinsard/following{/other_user}", "gists_url": "https://api.github.com/users/bpinsard/gists{/gist_id}", "starred_url": "https://api.github.com/users/bpinsard/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bpinsard/subscriptions", "organizations_url": "https://api.github.com/users/bpinsard/orgs", "repos_url": "https://api.github.com/users/bpinsard/repos", "events_url": "https://api.github.com/users/bpinsard/events{/privacy}", "received_events_url": "https://api.github.com/users/bpinsard/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/5449/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/5449/timeline", "performed_via_github_app": null}