{"url": "https://api.github.com/repos/datalad/datalad/issues/318", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/318/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/318/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/318/events", "html_url": "https://github.com/datalad/datalad/issues/318", "id": 122556673, "node_id": "MDU6SXNzdWUxMjI1NTY2NzM=", "number": 318, "title": "publish-collection  [baseurl] is not working for publishing over ssh to access via http", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 63778590, "node_id": "MDU6TGFiZWw2Mzc3ODU5MA==", "url": "https://api.github.com/repos/datalad/datalad/labels/severity-normal", "name": "severity-normal", "color": "ff8888", "default": false, "description": "standard severity"}], "state": "closed", "locked": false, "assignee": {"login": "bpoldrack", "id": 10498301, "node_id": "MDQ6VXNlcjEwNDk4MzAx", "avatar_url": "https://avatars.githubusercontent.com/u/10498301?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bpoldrack", "html_url": "https://github.com/bpoldrack", "followers_url": "https://api.github.com/users/bpoldrack/followers", "following_url": "https://api.github.com/users/bpoldrack/following{/other_user}", "gists_url": "https://api.github.com/users/bpoldrack/gists{/gist_id}", "starred_url": "https://api.github.com/users/bpoldrack/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bpoldrack/subscriptions", "organizations_url": "https://api.github.com/users/bpoldrack/orgs", "repos_url": "https://api.github.com/users/bpoldrack/repos", "events_url": "https://api.github.com/users/bpoldrack/events{/privacy}", "received_events_url": "https://api.github.com/users/bpoldrack/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "bpoldrack", "id": 10498301, "node_id": "MDQ6VXNlcjEwNDk4MzAx", "avatar_url": "https://avatars.githubusercontent.com/u/10498301?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bpoldrack", "html_url": "https://github.com/bpoldrack", "followers_url": "https://api.github.com/users/bpoldrack/followers", "following_url": "https://api.github.com/users/bpoldrack/following{/other_user}", "gists_url": "https://api.github.com/users/bpoldrack/gists{/gist_id}", "starred_url": "https://api.github.com/users/bpoldrack/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bpoldrack/subscriptions", "organizations_url": "https://api.github.com/users/bpoldrack/orgs", "repos_url": "https://api.github.com/users/bpoldrack/repos", "events_url": "https://api.github.com/users/bpoldrack/events{/privacy}", "received_events_url": "https://api.github.com/users/bpoldrack/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 1, "created_at": "2015-12-16T17:10:59Z", "updated_at": "2016-05-20T02:29:10Z", "closed_at": "2016-05-20T02:29:10Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "```\n$> DATALAD_COLLECTION_PATH=$PWD/master-collection DATALAD_LOGTRACEBACK=1 datalad -l info publish-collection ssh://datalad.org/srv/collections.datalad.org/www/bogus-100_collection bogus-100_collection http://collections.datalad.org/bogus-100_collection\n2015-12-16 12:09:32,888 [INFO   ] datalad:9>main:205>interface.base:155>publish_collection:135  Preparing target repositories on datalad.org (publish_collection.py:135)\n2015-12-16 12:09:32,893 [ERROR  ] datalad:9>main:205>interface.base:155>publish_collection:159  DEBUG: ssh -o ControlMaster=yes -o \"ControlPath=/var/run/user/47521/datalad/datalad.org\" -o ControlPersist=yes datalad.org exit (publish_collection.py:159)\nbind: Address already in use\nchannel_setup_fwd_listener_tcpip: cannot listen to port: 3389\nCould not request local forwarding.\nControlSocket /var/run/user/47521/datalad/datalad.org already exists, disabling multiplexing\n2015-12-16 12:09:42,438 [INFO   ] datalad:9>main:205>interface.base:155>publish_collection:218  Preparing 100 handles for publishing (publish_collection.py:218)\n2015-12-16 12:09:42,450 [INFO   ] datalad:9>main:205>interface.base:155>publish_collection:238  Publishing handle /home/yoh/proj/datalad/datalad-master/docs/examples/collection-100/bogus1-100 (publish_collection.py:238)\n2015-12-16 12:09:42,563 [ERROR  ] datalad:9>main:205>interface.base:155>publish_collection:241>publish_handle:137>gitrepo:498,159,437>cmd:259,108,323  stderr| fatal: repository 'http://collections.datalad.org/bogus-100_collection/bogus1-100/' not found (cmd.py:323)\n2015-12-16 12:09:42,564 [ERROR  ] datalad:9>main:205>interface.base:155>publish_collection:241>publish_handle:137>gitrepo:498,159,437>cmd:267  Failed to run ['git', '-c', 'receive.autogc=false', 'push', 'published7', '+publish7:master'] under '/home/yoh/proj/datalad/datalad-master/docs/examples/collection-100/bogus1-100'. Exit code=128. out= err=fatal: repository 'http://collections.datalad.org/bogus-100_collection/bogus1-100/' not found\n|  (cmd.py:267)\n2015-12-16 12:09:42,565 [ERROR  ] datalad:9>main:207  CommandError: command '['git', '-c', 'receive.autogc=false', 'push', 'published7', '+publish7:master']' failed with exitcode 128.\n| Failed to run ['git', '-c', 'receive.autogc=false', 'push', 'published7', '+publish7:master'] under '/home/yoh/proj/datalad/datalad-master/docs/examples/collection-100/bogus1-100'. Exit code=128. out= err=fatal: repository 'http://collections.datalad.org/bogus-100_collection/bogus1-100/' not found\n|  [cmd.py:run:268] (CommandError) (main.py:207)\n```\n\nLooking at the code, I think culprit is in publish-handle (could be the same for publish-collection), since it adds remote with public url, and then tries to push to it, which wouldn't be possible.  So it should not assume that url is the one to push to.  It should have clearer separation between location to publish to (will serve as a remote) and a public url others would be able to access it from.\n", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/318/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/318/timeline", "performed_via_github_app": null}