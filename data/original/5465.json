{"url": "https://api.github.com/repos/datalad/datalad/issues/5465", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/5465/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/5465/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/5465/events", "html_url": "https://github.com/datalad/datalad/issues/5465", "id": 822492102, "node_id": "MDU6SXNzdWU4MjI0OTIxMDI=", "number": 5465, "title": "ssh: we are \"holding\" stderr of the ssh mux process forbidding a clean exit if piped", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 2805362221, "node_id": "MDU6TGFiZWwyODA1MzYyMjIx", "url": "https://api.github.com/repos/datalad/datalad/labels/cmd-sshrun", "name": "cmd-sshrun", "color": "FEF2C0", "default": false, "description": ""}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-03-04T20:45:27Z", "updated_at": "2021-07-20T04:44:23Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "dedicated extract from https://github.com/datalad/datalad/issues/5460#issuecomment-790923286\r\n\r\nrepoducer demonstrating the issue is a stalling script like\r\n\r\n```\r\n$> cat ./chronic-halt\r\n#!/bin/bash\r\n\r\nset -eu\r\n\r\n(\r\npstree -p $$\r\necho \"starting ssh mux\"\r\nssh -fN -o ControlMaster=auto -o ControlPersist=15m -o ControlPath=/home/yoh/.cache/datalad/sockets/chronic-stall datasets.datalad.org\r\necho \"done, exiting\"\r\npstree -p $$\r\n) 2>&1 | tee /tmp/chronic-stall.log\r\n\r\n```\r\nin interaction with #5464 we ending up with a stalled process.  Since it is interaction with #5464 and we do take care about closing all the ssh mux processes we started, this issue should not manifest itself.  But I still wonder if we should somehow take care about not dragging those pipes of `ssh -fN` with us (e.g. if we decide to change policy for those ssh processes to outlast our datalad process life time)\r\n\r\nedit 1: adding `2>/dev/null` is sufficient to resolve the stall.  So it seems to be about the process inheriting stderr.\r\nedit 2: adding `2>&1` isn't sufficient. Redirecting 2 to a file - sufficient", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/5465/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/5465/timeline", "performed_via_github_app": null}