{"url": "https://api.github.com/repos/datalad/datalad/issues/5351", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/5351/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/5351/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/5351/events", "html_url": "https://github.com/datalad/datalad/issues/5351", "id": 790145159, "node_id": "MDU6SXNzdWU3OTAxNDUxNTk=", "number": 5351, "title": "logging is freaking out and starts to breed ValueError: I/O operation on closed file.", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 545918236, "node_id": "MDU6TGFiZWw1NDU5MTgyMzY=", "url": "https://api.github.com/repos/datalad/datalad/labels/DX", "name": "DX", "color": "0052cc", "default": false, "description": "developer experience"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-01-20T16:44:40Z", "updated_at": "2021-07-22T17:08:28Z", "closed_at": "2021-07-22T17:08:28Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "While doing a full `python -m nose -s -v datalad/ 2>&1 | tee /tmp/all-tests-asyncio.log` for #5350 at some point screen starts to get flooded with complaints from logger ... First encounter:\r\n\r\n```\r\ndatalad.interface.tests.test_add_archive_content.test_add_archive_use_archive_dir ... ok\r\ndatalad.interface.tests.test_annotate_paths.test_annotate_paths ... --- Logging error ---\r\nTraceback (most recent call last):\r\n  File \"/home/yoh/anaconda-5.2.0-2.7/envs/datalad-py3.7.9/lib/python3.7/logging/__init__.py\", line 1028, in emit\r\n    stream.write(msg + self.terminator)\r\nValueError: I/O operation on closed file.\r\nCall stack:\r\n  File \"/home/yoh/anaconda-5.2.0-2.7/envs/datalad-py3.7.9/lib/python3.7/runpy.py\", line 193, in _run_module_as_main\r\n    \"__main__\", mod_spec)\r\n  File \"/home/yoh/anaconda-5.2.0-2.7/envs/datalad-py3.7.9/lib/python3.7/runpy.py\", line 85, in _run_code\r\n    exec(code, run_globals)\r\n  File \"/home/yoh/anaconda-5.2.0-2.7/envs/datalad-py3.7.9/lib/python3.7/site-packages/nose/__main__.py\", line 8, in <module>\r\n    run_exit()\r\n  File \"/home/yoh/anaconda-5.2.0-2.7/envs/datalad-py3.7.9/lib/python3.7/site-packages/nose/core.py\", line 121, in __init__\r\n    **extra_args)\r\n  File \"/home/yoh/anaconda-5.2.0-2.7/envs/datalad-py3.7.9/lib/python3.7/unittest/main.py\", line 101, in __init__\r\n    self.runTests()\r\n  File \"/home/yoh/anaconda-5.2.0-2.7/envs/datalad-py3.7.9/lib/python3.7/site-packages/nose/core.py\", line 207, in runTests\r\n    result = self.testRunner.run(self.test)\r\n  File \"/home/yoh/anaconda-5.2.0-2.7/envs/datalad-py3.7.9/lib/python3.7/site-packages/nose/core.py\", line 62, in run\r\n    test(result)\r\n  File \"/home/yoh/anaconda-5.2.0-2.7/envs/datalad-py3.7.9/lib/python3.7/site-packages/nose/suite.py\", line 178, in __call__\r\n    return self.run(*arg, **kw)\r\n  File \"/home/yoh/anaconda-5.2.0-2.7/envs/datalad-py3.7.9/lib/python3.7/site-packages/nose/suite.py\", line 225, in run\r\n    test(orig)\r\n  File \"/home/yoh/anaconda-5.2.0-2.7/envs/datalad-py3.7.9/lib/python3.7/site-packages/nose/suite.py\", line 178, in __call__\r\n    return self.run(*arg, **kw)\r\n  File \"/home/yoh/anaconda-5.2.0-2.7/envs/datalad-py3.7.9/lib/python3.7/site-packages/nose/suite.py\", line 225, in run\r\n    test(orig)\r\n  File \"/home/yoh/anaconda-5.2.0-2.7/envs/datalad-py3.7.9/lib/python3.7/site-packages/nose/suite.py\", line 178, in __call__\r\n    return self.run(*arg, **kw)\r\n  File \"/home/yoh/anaconda-5.2.0-2.7/envs/datalad-py3.7.9/lib/python3.7/site-packages/nose/suite.py\", line 225, in run\r\n    test(orig)\r\n  File \"/home/yoh/anaconda-5.2.0-2.7/envs/datalad-py3.7.9/lib/python3.7/site-packages/nose/suite.py\", line 178, in __call__\r\n    return self.run(*arg, **kw)\r\n  File \"/home/yoh/anaconda-5.2.0-2.7/envs/datalad-py3.7.9/lib/python3.7/site-packages/nose/suite.py\", line 225, in run\r\n    test(orig)\r\n  File \"/home/yoh/anaconda-5.2.0-2.7/envs/datalad-py3.7.9/lib/python3.7/site-packages/nose/suite.py\", line 178, in __call__\r\n    return self.run(*arg, **kw)\r\n  File \"/home/yoh/anaconda-5.2.0-2.7/envs/datalad-py3.7.9/lib/python3.7/site-packages/nose/suite.py\", line 225, in run\r\n    test(orig)\r\n  File \"/home/yoh/anaconda-5.2.0-2.7/envs/datalad-py3.7.9/lib/python3.7/site-packages/nose/case.py\", line 46, in __call__\r\n    return self.run(*arg, **kwarg)\r\n  File \"/home/yoh/anaconda-5.2.0-2.7/envs/datalad-py3.7.9/lib/python3.7/site-packages/nose/case.py\", line 134, in run\r\n    self.runTest(result)\r\n  File \"/home/yoh/anaconda-5.2.0-2.7/envs/datalad-py3.7.9/lib/python3.7/site-packages/nose/case.py\", line 152, in runTest\r\n    test(result)\r\n  File \"/home/yoh/anaconda-5.2.0-2.7/envs/datalad-py3.7.9/lib/python3.7/unittest/case.py\", line 676, in __call__\r\n    return self.run(*args, **kwds)\r\n  File \"/home/yoh/anaconda-5.2.0-2.7/envs/datalad-py3.7.9/lib/python3.7/unittest/case.py\", line 628, in run\r\n    testMethod()\r\n  File \"/home/yoh/anaconda-5.2.0-2.7/envs/datalad-py3.7.9/lib/python3.7/site-packages/nose/case.py\", line 198, in runTest\r\n    self.test(*self.arg)\r\n  File \"/home/yoh/proj/datalad/datalad-master/datalad/tests/utils.py\", line 578, in _wrap_with_tree\r\n    return t(*(arg + (d,)), **kw)\r\n  File \"/home/yoh/proj/datalad/datalad-master/datalad/tests/utils.py\", line 757, in _wrap_with_tempfile\r\n    return t(*(arg + (filename,)), **kw)\r\n  File \"/home/yoh/proj/datalad/datalad-master/datalad/interface/tests/test_annotate_paths.py\", line 122, in test_annotate_paths\r\n    annotate_paths(path=['a', 'b'])\r\n  File \"/home/yoh/proj/datalad/datalad-master/datalad/interface/utils.py\", line 330, in eval_func\r\n    wrapped_class = get_wrapped_class(wrapped)\r\n  File \"/home/yoh/proj/datalad/datalad-master/datalad/utils.py\", line 2533, in get_wrapped_class\r\n    lgr.debug(\"Determined class of decorated function: %s\", _func_class)\r\nMessage: 'Determined class of decorated function: %s'\r\nArguments: (<class 'datalad.interface.annotate_paths.AnnotatePaths'>,)\r\n--- Logging error ---\r\nTraceback (most recent call last):\r\n  File \"/home/yoh/anaconda-5.2.0-2.7/envs/datalad-py3.7.9/lib/python3.7/logging/__init__.py\", line 1028, in emit\r\n    stream.write(msg + self.terminator)\r\nValueError: I/O operation on closed file.\r\n```\r\n\r\n\r\n<details><summary>DataLad 0.13.7.dev714 WTF (datalad, dependencies)</summary>\r\n\r\n# WTF\r\n- datalad: version=0.13.7.dev714 full_version=0.13.7.dev714-g33d3-dirty\r\n- dependencies: cmd:git=2.24.0 cmd:annex=8.20201127+git54-ga1b227171-1~ndall+1 cmd:bundled-git=2.24.0 cmd:system-git=2.29.2 cmd:system-ssh=8.4p1 cmd:7z=16.02 annexremote=1.4.3 appdirs=1.4.4 boto=2.49.0 exifread=2.3.1 humanize=3.0.1 iso8601=0.1.13 keyring=21.4.0 keyrings.alt=4.0.0 msgpack=1.0.0 mutagen=1.45.1 requests=2.24.0 wrapt=1.12.1\r\n\r\n</details>\r\n\r\n\r\n<details><summary>DataLad 0.13.7.dev714 WTF (configuration, credentials, datalad, dataset, dependencies, environment, extensions, git-annex, location, metadata_extractors, metadata_indexers, python, system)</summary>\r\n\r\n# WTF\r\n## configuration <SENSITIVE, report disabled by configuration>\r\n## credentials \r\n  - keyring: \r\n    - active_backends: \r\n      - SecretService Keyring\r\n      - PlaintextKeyring with no encyption v.1.0 at /home/yoh/.local/share/python_keyring/keyring_pass.cfg\r\n    - config_file: /home/yoh/.config/python_keyring/keyringrc.cfg\r\n    - data_root: /home/yoh/.local/share/python_keyring\r\n## datalad \r\n  - full_version: 0.13.7.dev714-g33d3-dirty\r\n  - version: 0.13.7.dev714\r\n## dataset \r\n  - id: None\r\n  - metadata: <SENSITIVE, report disabled by configuration>\r\n  - path: /home/yoh/proj/datalad/datalad-master\r\n  - repo: GitRepo\r\n## dependencies \r\n  - annexremote: 1.4.3\r\n  - appdirs: 1.4.4\r\n  - boto: 2.49.0\r\n  - cmd:7z: 16.02\r\n  - cmd:annex: 8.20201127+git54-ga1b227171-1~ndall+1\r\n  - cmd:bundled-git: 2.24.0\r\n  - cmd:git: 2.24.0\r\n  - cmd:system-git: 2.29.2\r\n  - cmd:system-ssh: 8.4p1\r\n  - exifread: 2.3.1\r\n  - humanize: 3.0.1\r\n  - iso8601: 0.1.13\r\n  - keyring: 21.4.0\r\n  - keyrings.alt: 4.0.0\r\n  - msgpack: 1.0.0\r\n  - mutagen: 1.45.1\r\n  - requests: 2.24.0\r\n  - wrapt: 1.12.1\r\n## environment \r\n  - GIT_PAGER: less --no-init --quit-if-one-screen\r\n  - LANG: en_US.UTF-8\r\n  - PATH: /home/yoh/anaconda-5.2.0-2.7/envs/datalad-py3.7.9/bin:/home/yoh/anaconda-5.2.0-2.7/condabin:/home/yoh/gocode/bin:/home/yoh/gocode/bin:/home/yoh/bin:/home/yoh/.local/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games:/sbin:/usr/sbin:/usr/local/sbin\r\n## extensions \r\n## git-annex \r\n  - build flags: \r\n    - Assistant\r\n    - Webapp\r\n    - Pairing\r\n    - Inotify\r\n    - DBus\r\n    - DesktopNotify\r\n    - TorrentParser\r\n    - MagicMime\r\n    - Feeds\r\n    - Testsuite\r\n    - S3\r\n    - WebDAV\r\n  - dependency versions: \r\n    - aws-0.20\r\n    - bloomfilter-2.0.1.0\r\n    - cryptonite-0.25\r\n    - DAV-1.3.3\r\n    - feed-1.0.0.0\r\n    - ghc-8.4.4\r\n    - http-client-0.5.13.1\r\n    - persistent-sqlite-2.8.2\r\n    - torrent-10000.1.1\r\n    - uuid-1.3.13\r\n    - yesod-1.6.0\r\n  - key/value backends: \r\n    - SHA256E\r\n    - SHA256\r\n    - SHA512E\r\n    - SHA512\r\n    - SHA224E\r\n    - SHA224\r\n    - SHA384E\r\n    - SHA384\r\n    - SHA3_256E\r\n    - SHA3_256\r\n    - SHA3_512E\r\n    - SHA3_512\r\n    - SHA3_224E\r\n    - SHA3_224\r\n    - SHA3_384E\r\n    - SHA3_384\r\n    - SKEIN256E\r\n    - SKEIN256\r\n    - SKEIN512E\r\n    - SKEIN512\r\n    - BLAKE2B256E\r\n    - BLAKE2B256\r\n    - BLAKE2B512E\r\n    - BLAKE2B512\r\n    - BLAKE2B160E\r\n    - BLAKE2B160\r\n    - BLAKE2B224E\r\n    - BLAKE2B224\r\n    - BLAKE2B384E\r\n    - BLAKE2B384\r\n    - BLAKE2BP512E\r\n    - BLAKE2BP512\r\n    - BLAKE2S256E\r\n    - BLAKE2S256\r\n    - BLAKE2S160E\r\n    - BLAKE2S160\r\n    - BLAKE2S224E\r\n    - BLAKE2S224\r\n    - BLAKE2SP256E\r\n    - BLAKE2SP256\r\n    - BLAKE2SP224E\r\n    - BLAKE2SP224\r\n    - SHA1E\r\n    - SHA1\r\n    - MD5E\r\n    - MD5\r\n    - WORM\r\n    - URL\r\n    - X*\r\n  - operating system: linux x86_64\r\n  - remote types: \r\n    - git\r\n    - gcrypt\r\n    - p2p\r\n    - S3\r\n    - bup\r\n    - directory\r\n    - rsync\r\n    - web\r\n    - bittorrent\r\n    - webdav\r\n    - adb\r\n    - tahoe\r\n    - glacier\r\n    - ddar\r\n    - git-lfs\r\n    - httpalso\r\n    - hook\r\n    - external\r\n  - supported repository versions: \r\n    - 8\r\n  - upgrade supported from repository versions: \r\n    - 0\r\n    - 1\r\n    - 2\r\n    - 3\r\n    - 4\r\n    - 5\r\n    - 6\r\n    - 7\r\n  - version: 8.20201127+git54-ga1b227171-1~ndall+1\r\n## location \r\n  - path: /home/yoh/proj/datalad/datalad-master\r\n  - type: dataset\r\n## metadata_extractors \r\n  - annex (datalad 0.13.7): \r\n    - distribution: datalad 0.13.7\r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.annex\r\n    - version: None\r\n  - audio (datalad 0.13.7): \r\n    - distribution: datalad 0.13.7\r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.audio\r\n    - version: None\r\n  - datacite (datalad 0.13.7): \r\n    - distribution: datalad 0.13.7\r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.datacite\r\n    - version: None\r\n  - datalad_core (datalad 0.13.7): \r\n    - distribution: datalad 0.13.7\r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.datalad_core\r\n    - version: None\r\n  - datalad_rfc822 (datalad 0.13.7): \r\n    - distribution: datalad 0.13.7\r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.datalad_rfc822\r\n    - version: None\r\n  - exif (datalad 0.13.7): \r\n    - distribution: datalad 0.13.7\r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.exif\r\n    - version: None\r\n  - frictionless_datapackage (datalad 0.13.7): \r\n    - distribution: datalad 0.13.7\r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.frictionless_datapackage\r\n    - version: None\r\n  - image (datalad 0.13.7): \r\n    - distribution: datalad 0.13.7\r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.image\r\n    - version: None\r\n  - xmp (datalad 0.13.7): \r\n    - distribution: datalad 0.13.7\r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.xmp\r\n    - version: None\r\n## metadata_indexers \r\n## python \r\n  - implementation: CPython\r\n  - version: 3.7.9\r\n## system \r\n  - distribution: debian/bullseye/sid\r\n  - encoding: \r\n    - default: utf-8\r\n    - filesystem: utf-8\r\n    - locale.prefered: UTF-8\r\n  - max_path_length: 293\r\n  - name: Linux\r\n  - release: 5.9.0-4-amd64\r\n  - type: posix\r\n  - version: #1 SMP Debian 5.9.11-1 (2020-11-27)\r\n</details>\r\n", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/5351/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/5351/timeline", "performed_via_github_app": null}