{"url": "https://api.github.com/repos/datalad/datalad/issues/5749", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/5749/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/5749/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/5749/events", "html_url": "https://github.com/datalad/datalad/pull/5749", "id": 922799241, "node_id": "MDExOlB1bGxSZXF1ZXN0NjcxNjMxMTUy", "number": 5749, "title": "Clone URL mapping ability", "user": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 3049454381, "node_id": "MDU6TGFiZWwzMDQ5NDU0Mzgx", "url": "https://api.github.com/repos/datalad/datalad/labels/minor", "name": "minor", "color": "f1a60e", "default": false, "description": "Increment the minor version when merged"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/datalad/datalad/milestones/86", "html_url": "https://github.com/datalad/datalad/milestone/86", "labels_url": "https://api.github.com/repos/datalad/datalad/milestones/86/labels", "id": 6382960, "node_id": "MDk6TWlsZXN0b25lNjM4Mjk2MA==", "number": 86, "title": "0.15.0", "description": "", "creator": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 22, "state": "open", "created_at": "2021-02-02T14:46:01Z", "updated_at": "2021-09-10T17:50:04Z", "due_on": null, "closed_at": null}, "comments": 10, "created_at": "2021-06-16T15:58:55Z", "updated_at": "2021-07-08T15:43:11Z", "closed_at": "2021-06-30T05:59:14Z", "author_association": "MEMBER", "active_lock_reason": null, "pull_request": {"url": "https://api.github.com/repos/datalad/datalad/pulls/5749", "html_url": "https://github.com/datalad/datalad/pull/5749", "diff_url": "https://github.com/datalad/datalad/pull/5749.diff", "patch_url": "https://github.com/datalad/datalad/pull/5749.patch"}, "body": "This implements a simple feature and fix for #4822. It allows for configuring an arbitrary number of URL mapping specification. With this change one can configure datalad to transfer URLs like `https://osf.io/q8xnk/` (copied from a browser window), which do not work, but can be reliably mapped into working URLs (`osf://q8xnk` in this case) via a regular expression specification.\r\n\r\nIn the example above, this would do the trick:\r\n\r\n```\r\ndatalad -c 'datalad.url.substitute.osf=,^https://osf.io/([^/]+)[/]*$,osf://\\1' clone https://osf.io/q8xnk/\r\n```\r\n\r\nas usual, configuration is read from all supported places. Here is an example of a mapping rule\r\nfor GitHub\r\n\r\n```\r\n% datalad x-configuration\r\n...\r\n# GitHub URL substitution rule\r\n# Substitution specification defined as a string with a match and\r\n# substitution expression, each following Python's regular expression\r\n# syntax. Both expressions are concatenated to a single string with an\r\n# arbitrary delimiter character. The delimiter is defined by prefixing\r\n# the string with the delimiter. Prefix and delimiter are stripped\r\n# from the expressions (Example: \",^http://(.*)$,https://\\1\"). This\r\n# setting can be defined multiple times. Substitutions will be applied\r\n# incrementally, in order of their definition. The first substitution\r\n# in such a series must match, otherwise no further substitutions in a\r\n# series will be considered. However, following the first match all\r\n# further substitutions in a series are processed, regardless whether\r\n# intermediate expressions match or not.\r\ndatalad.clone.url-substitute.github=(',https?://github.com/([^/]+)/(.*)$,\\\\1###\\\\2', ',[/\\\\\\\\]+,-', ',\\\\s+|(%2520)+|(%20)+,_', ',([^#]+)###(.*),https://github.com/\\\\1/\\\\2')\r\n...\r\n```\r\n\r\nIt would be possible to implement a mechanism to read additional specifications from an entrypoint that can be provided by extensions. However, it would make also sense to finally support extension-provided (default) configuration and use that mechanism.\r\n\r\nTODO:\r\n\r\n- [x] Implement sketch for discussion\r\n- [x] Documentation\r\n- [x] Test\r\n- [x] should it rather be `datalad.clone.url-substitute`? (to limit the scope)\r\n- [x] Institutionalize OSF-related mapping from example above?\r\n\r\nCloses #4822 ", "closed_by": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/5749/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/5749/timeline", "performed_via_github_app": null}