{"url": "https://api.github.com/repos/datalad/datalad/issues/995", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/995/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/995/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/995/events", "html_url": "https://github.com/datalad/datalad/pull/995", "id": 182504058, "node_id": "MDExOlB1bGxSZXF1ZXN0ODkwMDAzOTc=", "number": 995, "title": "Addressing direct mode", "user": {"login": "bpoldrack", "id": 10498301, "node_id": "MDQ6VXNlcjEwNDk4MzAx", "avatar_url": "https://avatars.githubusercontent.com/u/10498301?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bpoldrack", "html_url": "https://github.com/bpoldrack", "followers_url": "https://api.github.com/users/bpoldrack/followers", "following_url": "https://api.github.com/users/bpoldrack/following{/other_user}", "gists_url": "https://api.github.com/users/bpoldrack/gists{/gist_id}", "starred_url": "https://api.github.com/users/bpoldrack/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bpoldrack/subscriptions", "organizations_url": "https://api.github.com/users/bpoldrack/orgs", "repos_url": "https://api.github.com/users/bpoldrack/repos", "events_url": "https://api.github.com/users/bpoldrack/events{/privacy}", "received_events_url": "https://api.github.com/users/bpoldrack/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 15, "created_at": "2016-10-12T11:41:56Z", "updated_at": "2020-09-02T10:20:58Z", "closed_at": "2016-11-02T10:44:14Z", "author_association": "MEMBER", "active_lock_reason": null, "pull_request": {"url": "https://api.github.com/repos/datalad/datalad/pulls/995", "html_url": "https://github.com/datalad/datalad/pull/995", "diff_url": "https://github.com/datalad/datalad/pull/995.diff", "patch_url": "https://github.com/datalad/datalad/pull/995.patch"}, "body": "General idea:\nIn order to solve direct mode issues provide a \"central switch\" (see #982) to let datalad create annex repos in direct mode. This is done by a new config item `datalad.repo.direct`, that can be set via env variable or config files. Then have a dedicated matrix entry for Travis, that makes use of this switch. This means, that - for now - this build will fail! But: At least we can make sure to not add even more failures by PRs to come and fix the issue over time. ~~So, failing of this travis build should NOT prevent this PR from being merged.~~\nChanged: We have now 3 extra travis builds (one per python version), that are running in direct mode, but are allowed to fail. So travis doesn't consider this to be an overall failure.\nFixing these issues is a lot of things and won't be done in a single PR. Depending on the failures, there are different reasons like:\n- GitPython's git calls, that can't be easily modified yet whenever we are in a direct mode repo\n- Not using `AnnexRepo` to invoke a git call, but either `Runner` or just `GitRepo` (ignoring the fact, that it actually is an annex)\n- wrong assertions in test code or test code, that was correct but isn't anymore, since new \"central switch\" works slightly different\n- broken commit refs comparisons, since `origin/master` becomes `origin/annex/direct/master` for example\n- ...\n\nFurthermore, also introduced a config item `datalad.repo.version` to set a default for annex repository version. This also leads to realizing, that we should go for version 6 by default eventually. But this is kind of different story and doesn't mean we don't have to care for direct mode, I think. Especially given, that one way or another, we could have to deal with version 5 (and therefore direct mode) nevertheless.\n- [x] Closes #982 \n- [x] Add a direct mode matrix entry for Travis\n- [x] fix AutoMagicIO (two tests are somehow broken by this PR even when not using direct mode switch)\n- [x] some basic fixes for direct mode\n- [x] make GitPython use _GIT_COMMON_OPTIONS of `GitRepo` class and therefore deal with direct mode\n- [x] fix python 3\n\nFinal note: This PR does not solve all the issues, but provides the mechanisms to use when solving them. Whenever git is called correctly via an `AnnexRepo` instance it should be able to deal with direct mode now, even when GitPython is used. However, not even all tests and methods of `AnnexRepo` and `GitRepo` are properly adapted by now. But hopefully there are all the means to not make it worse during further development of datalad and to solve the issues, that are already there within PR(s) to come.\n", "closed_by": {"login": "bpoldrack", "id": 10498301, "node_id": "MDQ6VXNlcjEwNDk4MzAx", "avatar_url": "https://avatars.githubusercontent.com/u/10498301?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bpoldrack", "html_url": "https://github.com/bpoldrack", "followers_url": "https://api.github.com/users/bpoldrack/followers", "following_url": "https://api.github.com/users/bpoldrack/following{/other_user}", "gists_url": "https://api.github.com/users/bpoldrack/gists{/gist_id}", "starred_url": "https://api.github.com/users/bpoldrack/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bpoldrack/subscriptions", "organizations_url": "https://api.github.com/users/bpoldrack/orgs", "repos_url": "https://api.github.com/users/bpoldrack/repos", "events_url": "https://api.github.com/users/bpoldrack/events{/privacy}", "received_events_url": "https://api.github.com/users/bpoldrack/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/995/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/995/timeline", "performed_via_github_app": null}