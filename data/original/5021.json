{"url": "https://api.github.com/repos/datalad/datalad/issues/5021", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/5021/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/5021/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/5021/events", "html_url": "https://github.com/datalad/datalad/issues/5021", "id": 719763410, "node_id": "MDU6SXNzdWU3MTk3NjM0MTA=", "number": 5021, "title": "save: does not add subdataset(s) to .gitmodules if nested", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1782622781, "node_id": "MDU6TGFiZWwxNzgyNjIyNzgx", "url": "https://api.github.com/repos/datalad/datalad/labels/severity-important", "name": "severity-important", "color": "cc0000", "default": false, "description": "major effect on the usability of a package, without rendering it completely unusable to everyone"}], "state": "closed", "locked": false, "assignee": {"login": "kyleam", "id": 1297788, "node_id": "MDQ6VXNlcjEyOTc3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1297788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kyleam", "html_url": "https://github.com/kyleam", "followers_url": "https://api.github.com/users/kyleam/followers", "following_url": "https://api.github.com/users/kyleam/following{/other_user}", "gists_url": "https://api.github.com/users/kyleam/gists{/gist_id}", "starred_url": "https://api.github.com/users/kyleam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kyleam/subscriptions", "organizations_url": "https://api.github.com/users/kyleam/orgs", "repos_url": "https://api.github.com/users/kyleam/repos", "events_url": "https://api.github.com/users/kyleam/events{/privacy}", "received_events_url": "https://api.github.com/users/kyleam/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "kyleam", "id": 1297788, "node_id": "MDQ6VXNlcjEyOTc3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1297788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kyleam", "html_url": "https://github.com/kyleam", "followers_url": "https://api.github.com/users/kyleam/followers", "following_url": "https://api.github.com/users/kyleam/following{/other_user}", "gists_url": "https://api.github.com/users/kyleam/gists{/gist_id}", "starred_url": "https://api.github.com/users/kyleam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kyleam/subscriptions", "organizations_url": "https://api.github.com/users/kyleam/orgs", "repos_url": "https://api.github.com/users/kyleam/repos", "events_url": "https://api.github.com/users/kyleam/events{/privacy}", "received_events_url": "https://api.github.com/users/kyleam/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2020-10-13T00:41:12Z", "updated_at": "2020-10-19T19:24:44Z", "closed_at": "2020-10-19T19:24:44Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "<details>\r\n<summary>reproducer with 2 parts -- 1) create/save 1 direct; 2) create/save 1 direct and nested within </summary> \r\n\r\n```shell\r\n#!/bin/bash\r\n\r\nexport PS4='> '\r\nset -x\r\nset -eu\r\ncd \"$(mktemp -d ${TMPDIR:-/tmp}/dl-XXXXXXX)\"\r\n\r\n: \"=================== 1 -- ok\"\r\ndatalad create testgh1; \r\n(\r\ncd testgh1\r\ndatalad create subds\r\ndatalad save -d . subds\r\ngit status\r\ndatalad subdatasets -r\r\n)\r\n\r\n: \"=================== 2 - nested -- not ok\"\r\ndatalad create testgh2; \r\n(\r\ncd testgh2\r\ndatalad create subds\r\ndatalad create subds/subsubds\r\ndatalad save -d . subds subds/subsubds\r\ngit status\r\ndatalad subdatasets -r\r\n)\r\n```\r\n</details>\r\n\r\n\r\n<details>\r\n<summary>output</summary> \r\n\r\n```shell\r\n> set -eu\r\n>> mktemp -d /home/yoh/.tmp/dl-XXXXXXX\r\n> cd /home/yoh/.tmp/dl-kskmghy\r\n> : '=================== 1 -- ok'\r\n> datalad create testgh1\r\n[INFO] Creating a new annex repo at /home/yoh/.tmp/dl-kskmghy/testgh1 \r\ncreate(ok): /home/yoh/.tmp/dl-kskmghy/testgh1 (dataset)\r\n> cd testgh1\r\n> datalad create subds\r\n[INFO] Creating a new annex repo at /home/yoh/.tmp/dl-kskmghy/testgh1/subds \r\ncreate(ok): /home/yoh/.tmp/dl-kskmghy/testgh1/subds (dataset)\r\n> datalad save -d . subds\r\nadd(ok): /home/yoh/.tmp/dl-kskmghy/testgh1/subds (file)\r\nadd(ok): /home/yoh/.tmp/dl-kskmghy/testgh1/.gitmodules (file)\r\nsave(ok): /home/yoh/.tmp/dl-kskmghy/testgh1 (dataset)\r\naction summary:\r\n  add (ok: 2)\r\n  save (ok: 1)\r\n> git status\r\nOn branch master\r\nnothing to commit, working tree clean\r\n> datalad subdatasets -r\r\nsubdataset(ok): /home/yoh/.tmp/dl-kskmghy/testgh1/subds (dataset)\r\n> : '=================== 2 - nested -- not ok'\r\n> datalad create testgh2\r\n[INFO] Creating a new annex repo at /home/yoh/.tmp/dl-kskmghy/testgh2 \r\ncreate(ok): /home/yoh/.tmp/dl-kskmghy/testgh2 (dataset)\r\n> cd testgh2\r\n> datalad create subds\r\n[INFO] Creating a new annex repo at /home/yoh/.tmp/dl-kskmghy/testgh2/subds \r\ncreate(ok): /home/yoh/.tmp/dl-kskmghy/testgh2/subds (dataset)\r\n> datalad create subds/subsubds\r\n[INFO] Creating a new annex repo at /home/yoh/.tmp/dl-kskmghy/testgh2/subds/subsubds \r\ncreate(ok): /home/yoh/.tmp/dl-kskmghy/testgh2/subds/subsubds (dataset)\r\n> datalad save -d . subds subds/subsubds\r\nadd(ok):../ /home/yoh/.tmp/dl-kskmghy/testgh2/subds/subsubds (file)\r\nadd(ok):../ /home/yoh/.tmp/dl-kskmghy/testgh2/subds/.gitmodules (file)\r\nsave(ok): /home/yoh/.tmp/dl-kskmghy/testgh2/subds (dataset)\r\nadd(ok): /home/yoh/.tmp/dl-kskmghy/testgh2/subds (file)\r\nsave(ok): /home/yoh/.tmp/dl-kskmghy/testgh2 (dataset)\r\naction summary:\r\n  add (ok: 3)\r\n  save (ok: 2)\r\n> git status\r\nOn branch master\r\nnothing to commit, working tree clean\r\n> datalad subdatasets -r\r\n\r\n```\r\n</details>\r\n\r\nso the end of above log looks like\r\n```\r\n> datalad save -d . subds subds/subsubds\r\nadd(ok):../ /home/yoh/.tmp/dl-kskmghy/testgh2/subds/subsubds (file)\r\nadd(ok):../ /home/yoh/.tmp/dl-kskmghy/testgh2/subds/.gitmodules (file)\r\nsave(ok): /home/yoh/.tmp/dl-kskmghy/testgh2/subds (dataset)\r\nadd(ok): /home/yoh/.tmp/dl-kskmghy/testgh2/subds (file)\r\nsave(ok): /home/yoh/.tmp/dl-kskmghy/testgh2 (dataset)\r\naction summary:\r\n  add (ok: 3)\r\n  save (ok: 2)\r\n> git status\r\nOn branch master\r\nnothing to commit, working tree clean\r\n> datalad subdatasets -r\r\n```\r\n\r\nnot to mention confusing `../` (hopefully #4454 would get revived some time), what is interesting is that top level dataset got no `.gitmodules` record for `subds` (although there is `add(ok)` for it.  the nested one seems got its record added ok\r\n\r\n```shell\r\n(git-annex)lena:~/.tmp/dl-kskmghy/testgh2[master]git\r\n$> cat subds/.gitmodules \r\n[submodule \"subsubds\"]\r\n\tpath = subsubds\r\n\turl = ./subsubds\r\n\tdatalad-id = 32fd57b8-b343-442b-b332-937707dad644\r\n```\r\n\r\nIMHO it is of an important severity\r\ntested also with `maint` - the same", "closed_by": {"login": "kyleam", "id": 1297788, "node_id": "MDQ6VXNlcjEyOTc3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1297788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kyleam", "html_url": "https://github.com/kyleam", "followers_url": "https://api.github.com/users/kyleam/followers", "following_url": "https://api.github.com/users/kyleam/following{/other_user}", "gists_url": "https://api.github.com/users/kyleam/gists{/gist_id}", "starred_url": "https://api.github.com/users/kyleam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kyleam/subscriptions", "organizations_url": "https://api.github.com/users/kyleam/orgs", "repos_url": "https://api.github.com/users/kyleam/repos", "events_url": "https://api.github.com/users/kyleam/events{/privacy}", "received_events_url": "https://api.github.com/users/kyleam/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/5021/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/5021/timeline", "performed_via_github_app": null}