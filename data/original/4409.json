{"url": "https://api.github.com/repos/datalad/datalad/issues/4409", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/4409/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/4409/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/4409/events", "html_url": "https://github.com/datalad/datalad/pull/4409", "id": 601720646, "node_id": "MDExOlB1bGxSZXF1ZXN0NDA0OTM2MDY4", "number": 4409, "title": "RF: Make default number of annex jobs configurable and 1 by default", "user": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/datalad/datalad/milestones/73", "html_url": "https://github.com/datalad/datalad/milestone/73", "labels_url": "https://api.github.com/repos/datalad/datalad/milestones/73/labels", "id": 5272227, "node_id": "MDk6TWlsZXN0b25lNTI3MjIyNw==", "number": 73, "title": "0.12.6", "description": "", "creator": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 15, "state": "closed", "created_at": "2020-04-03T18:47:30Z", "updated_at": "2020-05-13T19:30:07Z", "due_on": null, "closed_at": "2020-05-13T19:30:07Z"}, "comments": 6, "created_at": "2020-04-17T05:52:57Z", "updated_at": "2020-04-23T15:40:10Z", "closed_at": "2020-04-20T06:02:51Z", "author_association": "MEMBER", "active_lock_reason": null, "pull_request": {"url": "https://api.github.com/repos/datalad/datalad/pulls/4409", "html_url": "https://github.com/datalad/datalad/pull/4409", "diff_url": "https://github.com/datalad/datalad/pull/4409.diff", "patch_url": "https://github.com/datalad/datalad/pull/4409.patch"}, "body": "The previous default behavior `(max(8, min(3, nCPUs)))` could cause\r\nissues (crashes, system stalls) due to the large number of child\r\nprocesses spawned and file descriptors opened.\r\n\r\nThis change introduces a new config switch\r\n`datalad.runtime.max-annex-jobs` that can be used to tailor\r\nparallelization behavior, and effectively replaces the previously\r\nhard-coded maximum value of `8`. Moreover, it drops the default to `1`\r\nto disable parallel annex jobs by default to ensure a potentially\r\nslower, but more robust behavior out of the box.\r\n\r\nThe config switch is specific to annex jobs in order to leave room for\r\nan anticipated parallelization of some functionality in DataLad itself.\r\nThis will likely need separate configuration to be able to handle the\r\nmultiplicative impact of parallelization on two levels.\r\n\r\nImplementation detail: The number of jobs is now lazily evaluated on\r\nfirst use. While it only takes ~100ns to get the CPU count, adding a\r\nconfig query would make this longer (still microsecond range). However,\r\nthe configuration scope would then be limited to the user-level, and\r\ncould not be tailored to individual datasets, which may be desired for\r\ndatasets with a huge number of files.\r\n\r\nI left the previously defined `N_AUTO_JOBS` symbol in place to avoid\r\nbreaking consumer code (I am not aware of any). But it now also reflects\r\nthe changed default behavior.\r\n\r\nFixes gh-4404\r\nFixes gh-4141\r\n\r\nPR is targeting `maint` based on this comment: https://github.com/datalad/datalad/issues/4404#issuecomment-614043733", "closed_by": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/4409/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/4409/timeline", "performed_via_github_app": null}