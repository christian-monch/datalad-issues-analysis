{"url": "https://api.github.com/repos/datalad/datalad/issues/1212", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/1212/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/1212/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/1212/events", "html_url": "https://github.com/datalad/datalad/issues/1212", "id": 202580739, "node_id": "MDU6SXNzdWUyMDI1ODA3Mzk=", "number": 1212, "title": "GitRepo.get_active_branch() broken", "user": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 63778590, "node_id": "MDU6TGFiZWw2Mzc3ODU5MA==", "url": "https://api.github.com/repos/datalad/datalad/labels/severity-normal", "name": "severity-normal", "color": "ff8888", "default": false, "description": "standard severity"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-01-23T16:22:38Z", "updated_at": "2017-02-13T08:27:59Z", "closed_at": "2017-02-13T08:27:59Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "here its is:\r\n\r\n````mih@meiner /tmp/demo % git init\r\nInitialized empty Git repository in /tmp/demo/.git/\r\nmih@meiner /tmp/demo (git)-[master] % python -c \"from datalad.support.gitrepo import GitRepo; print(GitRepo('.').get_active_branch())\"\r\nmaster\r\nmih@meiner /tmp/demo (git)-[master] % touch test\r\n1 mih@meiner /tmp/demo (git)-[master] % git add .\r\nmih@meiner /tmp/demo (git)-[master] % git commit test\r\n[master (root-commit) 2b9ee4b] Demo\r\n 1 file changed, 0 insertions(+), 0 deletions(-)\r\n create mode 100644 test\r\nmih@meiner /tmp/demo (git)-[master] % python -c \"from datalad.support.gitrepo import GitRepo; print(GitRepo('.').get_active_branch())\"\r\nmaster\r\nmih@meiner /tmp/demo (git)-[master] % touch test2\r\nmih@meiner /tmp/demo (git)-[master] % git add .\r\nmih@meiner /tmp/demo (git)-[master] % git commit test2 -m demo\r\n[master 1ad90ee] demo\r\n 1 file changed, 0 insertions(+), 0 deletions(-)\r\n create mode 100644 test2\r\nmih@meiner /tmp/demo (git)-[master] % python -c \"from datalad.support.gitrepo import GitRepo; print(GitRepo('.').get_active_branch())\"\r\nmaster\r\nmih@meiner /tmp/demo (git)-[master] % git co HEAD~1\r\nNote: checking out 'HEAD~1'.\r\n\r\nYou are in 'detached HEAD' state. You can look around, make experimental\r\nchanges and commit them, and you can discard any commits you make in this\r\nstate without impacting any branches by performing another checkout.\r\n\r\nIf you want to create a new branch to retain commits you create, you may\r\ndo so (now or later) by using -b with the checkout command again. Example:\r\n\r\n  git checkout -b <new-branch-name>\r\n\r\nHEAD is now at 2b9ee4b... Demo\r\nmih@meiner /tmp/demo (git)-[2b9ee4b...] % python -c \"from datalad.support.gitrepo import GitRepo; print(GitRepo('.').get_active_branch())\"\r\nTraceback (most recent call last):\r\n  File \"<string>\", line 1, in <module>\r\n  File \"/home/mih/hacking/datalad/git/datalad/support/gitrepo.py\", line 1010, in get_active_branch\r\n    return self.repo.active_branch.name\r\n  File \"/home/mih/.local/lib/python2.7/site-packages/git/repo/base.py\", line 649, in active_branch\r\n    return self.head.reference\r\n  File \"/home/mih/.local/lib/python2.7/site-packages/git/refs/symbolic.py\", line 251, in _get_reference\r\n    raise TypeError(\"%s is a detached symbolic reference as it points to %r\" % (self, sha))\r\nTypeError: HEAD is a detached symbolic reference as it points to '2b9ee4b46009ea8b8ba060164ed83881b307442a'\r\n````\r\n\r\nWithout an active branch it should probably return `None` and not just crash.", "closed_by": {"login": "bpoldrack", "id": 10498301, "node_id": "MDQ6VXNlcjEwNDk4MzAx", "avatar_url": "https://avatars.githubusercontent.com/u/10498301?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bpoldrack", "html_url": "https://github.com/bpoldrack", "followers_url": "https://api.github.com/users/bpoldrack/followers", "following_url": "https://api.github.com/users/bpoldrack/following{/other_user}", "gists_url": "https://api.github.com/users/bpoldrack/gists{/gist_id}", "starred_url": "https://api.github.com/users/bpoldrack/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bpoldrack/subscriptions", "organizations_url": "https://api.github.com/users/bpoldrack/orgs", "repos_url": "https://api.github.com/users/bpoldrack/repos", "events_url": "https://api.github.com/users/bpoldrack/events{/privacy}", "received_events_url": "https://api.github.com/users/bpoldrack/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/1212/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/1212/timeline", "performed_via_github_app": null}