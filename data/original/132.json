{"url": "https://api.github.com/repos/datalad/datalad/issues/132", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/132/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/132/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/132/events", "html_url": "https://github.com/datalad/datalad/issues/132", "id": 70488168, "node_id": "MDU6SXNzdWU3MDQ4ODE2OA==", "number": 132, "title": "we are breeding git zombies like crazy", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2015-04-23T19:08:09Z", "updated_at": "2015-04-24T18:29:58Z", "closed_at": "2015-04-24T18:29:58Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "in the docker buildbot slaves, we produce around 2k (across all 4 dockers) `git <defunc>` for each sweep, which is quite a number:\n\nif before running any tests we have around 586 zombies:\n\n```\n(venv)buildbot@33c1b2f3efed:/tmp/test$ ps auxw | grep defunc | nl | tail -1\n   587  buildbot 17824  0.0  0.0   8872   772 ?        S+   19:04   0:00 grep --color=auto defunc\n```\n\nand running pure git tests doesn't change it:\n\n```\n(venv)buildbot@33c1b2f3efed:/tmp/test$ nosetests datalad/tests/test_gitrepo.py\n........\n----------------------------------------------------------------------\nRan 8 tests in 1.005s\n\nOK\n(venv)buildbot@33c1b2f3efed:/tmp/test$ ps auxw | grep defunc | nl | tail -1\n   587  buildbot 17850  0.0  0.0   8872   784 ?        S+   19:04   0:00 grep --color=auto defunc\n```\n\nRunning annex tests (until a failure which I am yet to comprehend) results in the growing number of zombies:\n\n```\n(venv)buildbot@33c1b2f3efed:/tmp/test$ nosetests -x datalad/tests/test_annexrepo.py\n...E\n======================================================================\nERROR: datalad.tests.test_annexrepo.test_AnnexRepo_get_file_backend\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/usr/lib/python2.7/dist-packages/nose/case.py\", line 197, in runTest\n    self.test(*self.arg)\n  File \"/tmp/test/datalad/tests/utils.py\", line 425, in newfunc\n    t(*(arg + (repo,)), **kw)\n  File \"/tmp/test/datalad/tests/utils.py\", line 302, in newfunc\n    return t(*(arg + (filename,)), **kw)\n  File \"/tmp/test/datalad/tests/test_annexrepo.py\", line 363, in test_AnnexRepo_get_file_backend\n    ok_annex_get(ar, 'test-annex.dat')\n  File \"/tmp/test/datalad/tests/utils.py\", line 172, in ok_annex_get\n    ar.annex_get(files)\n  File \"/tmp/test/datalad/support/annexrepo.py\", line 52, in newfunc\n    return func(self, *args, options=option_list)\n  File \"/tmp/test/datalad/support/gitrepo.py\", line 145, in newfunc\n    result = func(self, files_new, *args, **kwargs)\n  File \"/tmp/test/datalad/support/annexrepo.py\", line 262, in annex_get\n    log_online=True, expect_stderr=True)\n  File \"/tmp/test/datalad/support/annexrepo.py\", line 172, in _run_annex_command\n    raise e\nCommandError: CommandError: command '['git', 'annex', 'get', 'test-annex.dat']' failed with exitcode 1.\nFailed to run ['git', 'annex', 'get', 'test-annex.dat'] under '/tmp/datalad_temp_test_AnnexRepo_get_file_backendFjB66o'. Exit code=1\n-------------------- >> begin captured logging << --------------------\ndatalad.cmd: ERROR: Failed to run ['git', 'annex', 'get', 'test-annex.dat'] under '/tmp/datalad_temp_test_AnnexRepo_get_file_backendFjB66o'. Exit code=1\n--------------------- >> end captured logging << ---------------------\n\n----------------------------------------------------------------------\nRan 4 tests in 3.266s\n\nFAILED (errors=1)\n(venv)buildbot@33c1b2f3efed:/tmp/test$ ps auxw | grep defunc | nl | tail -3\n   604  buildbot 18364  0.0  0.0      0     0 ?        Z    19:04   0:00 [git] <defunct>\n   605  buildbot 18385  0.0  0.0      0     0 ?        Z    19:04   0:00 [git] <defunct>\n   606  buildbot 18398  0.0  0.0   8872   776 ?        S+   19:06   0:00 grep --color=auto defunc\n```\n\neven running a simple 'git annex init' creates a single zombie:\n\n```\n(venv)buildbot@33c1b2f3efed:/tmp/test$ ps auxw | grep defunc | nl | tail -3\n   604  buildbot 18364  0.0  0.0      0     0 ?        Z    19:04   0:00 [git] <defunct>\n   605  buildbot 18385  0.0  0.0      0     0 ?        Z    19:04   0:00 [git] <defunct>\n   606  buildbot 18417  0.0  0.0   8872   776 ?        S+   19:07   0:00 grep --color=auto defunc\n(venv)buildbot@33c1b2f3efed:/tmp/test$ git annex init\ninit  ok\n(recording state in git...)\n(venv)buildbot@33c1b2f3efed:/tmp/test$ ps auxw | grep defunc | nl | tail -3\n   605  buildbot 18385  0.0  0.0      0     0 ?        Z    19:04   0:00 [git] <defunct>\n   606  buildbot 18443  0.0  0.0      0     0 ?        Z    19:07   0:00 [git] <defunct>\n   607  buildbot 18458  0.0  0.0   8872   804 ?        S+   19:07   0:00 grep --color=auto defunc\n```\n\n@joeyh  any hints?\n", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/132/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/132/timeline", "performed_via_github_app": null}