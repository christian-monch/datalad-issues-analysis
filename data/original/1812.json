{"url": "https://api.github.com/repos/datalad/datalad/issues/1812", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/1812/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/1812/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/1812/events", "html_url": "https://github.com/datalad/datalad/issues/1812", "id": 256322013, "node_id": "MDU6SXNzdWUyNTYzMjIwMTM=", "number": 1812, "title": "publish -r --since=EXACTCOMMIT goes into dirty submodules", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-09-08T17:32:23Z", "updated_at": "2017-09-19T02:29:57Z", "closed_at": "2017-09-19T02:29:57Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "So, even if specified a commit since which to \"care\", publish seems to go and \"investigate\" submodules which were not modified since last published point pointed by the commit in --since\r\n\r\n```shell\r\n$> git diff e1046e69133df9f6ab933a7759a64c2536b0ce0e.. --stat\r\n dbic | 2 +-\r\n```\r\nso, datalad should only consider publishing changes in `dbic` and this top level dataset, but log shows and it starts going through other submodules:\r\n\r\n```shell\r\n$> DATALAD_LOG_TIMESTAMP=1 datalad -l debug --dbg publish --to=datalad-public --missing=inherit -r --since=e1046e69133df9f6ab933a7759a64c2536b0ce0e\r\n2017-09-08 13:27:45,314 [DEBUG  ] Determined class of decorated function: <class 'datalad.distribution.publish.Publish'>                           \r\n2017-09-08 13:27:45,315 [DEBUG  ] Resolved dataset for publishing: <Dataset path=/mnt/btrfs/datasets/datalad/crawl> \r\n2017-09-08 13:27:45,334 [DEBUG  ] Determined class of decorated function: <class 'datalad.interface.annotate_paths.AnnotatePaths'> \r\n2017-09-08 13:27:45,334 [DEBUG  ] Determined class of decorated function: <class 'datalad.interface.diff.Diff'> \r\n2017-09-08 13:27:45,334 [DEBUG  ] Determined class of decorated function: <class 'datalad.interface.annotate_paths.AnnotatePaths'> \r\n2017-09-08 13:27:45,335 [DEBUG  ] Running: ['git', '--work-tree=.', 'diff', '--raw', '-z', '--ignore-submodules=none', '--abbrev=40', 'e1046e69133df9f6ab933a7759a64c2536b0ce0e', '--'] \r\n2017-09-08 13:27:49,163 [DEBUG  ] Running: ['git', '--work-tree=.', 'status', '--porcelain', '-z', '--ignore-submodules=all', '--untracked=all'] \r\n2017-09-08 13:27:49,180 [DEBUG  ] Determined class of decorated function: <class 'datalad.distribution.subdatasets.Subdatasets'> \r\n2017-09-08 13:27:49,180 [DEBUG  ] Resolved dataset for subdataset reporting/modification: <Dataset path=/mnt/btrfs/datasets/datalad/crawl> \r\n2017-09-08 13:27:49,181 [DEBUG  ] Running: ['git', '--work-tree=.', 'submodule', 'status'] \r\n2017-09-08 13:27:49,469 [DEBUG  ] Running: ['git', 'version'] \r\n2017-09-08 13:27:49,482 [DEBUG  ] Running: ['git', 'config', '-z', '-l', '--show-origin', '--file', '/mnt/btrfs/datasets/datalad/crawl/dbic/.datalad/config'] \r\n2017-09-08 13:27:49,495 [DEBUG  ] Running: ['git', 'config', '-z', '-l', '--show-origin'] \r\n2017-09-08 13:27:49,508 [DEBUG  ] Using existing Git repository at /mnt/btrfs/datasets/datalad/crawl/dbic \r\n2017-09-08 13:27:49,521 [DEBUG  ] Determined class of decorated function: <class 'datalad.distribution.subdatasets.Subdatasets'> \r\n2017-09-08 13:27:49,521 [DEBUG  ] Resolved dataset for subdataset reporting/modification: <Dataset path=/mnt/btrfs/datasets/datalad/crawl/dbic> \r\n2017-09-08 13:27:49,521 [DEBUG  ] Running: ['git', '--work-tree=.', 'submodule', 'status', '--recursive'] \r\n2017-09-08 13:27:49,578 [DEBUG  ] Determined class of decorated function: <class 'datalad.interface.diff.Diff'> \r\n2017-09-08 13:27:49,578 [DEBUG  ] Determined class of decorated function: <class 'datalad.interface.annotate_paths.AnnotatePaths'> \r\n2017-09-08 13:27:49,579 [DEBUG  ] Running: ['git', '--work-tree=.', 'diff', '--raw', '-z', '--ignore-submodules=none', '--abbrev=40', 'e1046e69133df9f6ab933a7759a64c2536b0ce0e', '--'] \r\n2017-09-08 13:27:53,935 [DEBUG  ] Running: ['git', '--work-tree=.', 'status', '--porcelain', '-z', '--ignore-submodules=all', '--untracked=all'] \r\n2017-09-08 13:27:53,951 [DEBUG  ] Determined class of decorated function: <class 'datalad.interface.diff.Diff'> \r\n2017-09-08 13:27:53,952 [DEBUG  ] Determined class of decorated function: <class 'datalad.interface.annotate_paths.AnnotatePaths'> \r\n2017-09-08 13:27:53,953 [DEBUG  ] Running: ['git', '--work-tree=.', 'diff', '--raw', '-z', '--ignore-submodules=none', '--abbrev=40', 'd89c835b0422f0df18454a8b538e41bf6bb75de7..3cceb1f9604e134628a56942210e43b74965bfe7', '--'] \r\n2017-09-08 13:27:54,040 [DEBUG  ] Using existing Git repository at /mnt/btrfs/datasets/datalad/crawl/dbic/QA \r\n2017-09-08 13:27:54,072 [DEBUG  ] Determined class of decorated function: <class 'datalad.interface.diff.Diff'> \r\n2017-09-08 13:27:54,072 [DEBUG  ] Determined class of decorated function: <class 'datalad.interface.annotate_paths.AnnotatePaths'> \r\n2017-09-08 13:27:54,072 [DEBUG  ] Running: ['git', '--work-tree=.', 'diff', '--raw', '-z', '--ignore-submodules=none', '--abbrev=40', '9529efa47157e5e941381b22ae5bf8372befe74c..3006c6db5be73bedc4b67cf9649dfdc6761ee78c', '--'] \r\n2017-09-08 13:27:54,092 [DEBUG  ] Determined class of decorated function: <class 'datalad.distribution.subdatasets.Subdatasets'> \r\n2017-09-08 13:27:54,093 [DEBUG  ] Resolved dataset for subdataset reporting/modification: <Dataset path=/mnt/btrfs/datasets/datalad/crawl> \r\n2017-09-08 13:27:54,093 [DEBUG  ] Running: ['git', '--work-tree=.', 'submodule', 'status'] \r\n2017-09-08 13:27:54,359 [DEBUG  ] Running: ['git', 'version'] \r\n2017-09-08 13:27:54,370 [DEBUG  ] Running: ['git', 'config', '-z', '-l', '--show-origin', '--file', '/mnt/btrfs/datasets/datalad/crawl/kaggle/.datalad/config'] \r\n2017-09-08 13:27:54,381 [DEBUG  ] Running: ['git', 'config', '-z', '-l', '--show-origin'] \r\n2017-09-08 13:27:54,392 [DEBUG  ] Using existing Git repository at /mnt/btrfs/datasets/datalad/crawl/kaggle \r\n2017-09-08 13:27:54,408 [DEBUG  ] Determined class of decorated function: <class 'datalad.distribution.subdatasets.Subdatasets'> \r\n2017-09-08 13:27:54,408 [DEBUG  ] Resolved dataset for subdataset reporting/modification: <Dataset path=/mnt/btrfs/datasets/datalad/crawl/kaggle> \r\n2017-09-08 13:27:54,408 [DEBUG  ] Running: ['git', '--work-tree=.', 'submodule', 'status', '--recursive'] \r\n2017-09-08 13:27:54,464 [DEBUG  ] Determined class of decorated function: <class 'datalad.interface.diff.Diff'> \r\n2017-09-08 13:27:54,464 [DEBUG  ] Determined class of decorated function: <class 'datalad.interface.annotate_paths.AnnotatePaths'> \r\n2017-09-08 13:27:54,465 [DEBUG  ] Running: ['git', '--work-tree=.', 'diff', '--raw', '-z', '--ignore-submodules=none', '--abbrev=40', 'e1046e69133df9f6ab933a7759a64c2536b0ce0e', '--'] \r\n2017-09-08 13:28:00,111 [DEBUG  ] Running: ['git', '--work-tree=.', 'status', '--porcelain', '-z', '--ignore-submodules=all', '--untracked=all'] \r\n2017-09-08 13:28:00,126 [DEBUG  ] Determined class of decorated function: <class 'datalad.interface.diff.Diff'> \r\n2017-09-08 13:28:00,127 [DEBUG  ] Determined class of decorated function: <class 'datalad.interface.annotate_paths.AnnotatePaths'> \r\n2017-09-08 13:28:00,127 [DEBUG  ] Running: ['git', '--work-tree=.', 'diff', '--raw', '-z', '--ignore-submodules=none', '--abbrev=40', '82feee6097aea5c86f9919c32537212960809257', '--'] \r\n2017-09-08 13:28:00,155 [DEBUG  ] Running: ['git', '--work-tree=.', 'status', '--porcelain', '-z', '--ignore-submodules=all', '--untracked=all'] \r\n2017-09-08 13:28:00,169 [DEBUG  ] Determined class of decorated function: <class 'datalad.distribution.subdatasets.Subdatasets'> \r\n2017-09-08 13:28:00,169 [DEBUG  ] Resolved dataset for subdataset reporting/modification: <Dataset path=/mnt/btrfs/datasets/datalad/crawl> \r\n2017-09-08 13:28:00,169 [DEBUG  ] Running: ['git', '--work-tree=.', 'submodule', 'status'] \r\n2017-09-08 13:28:00,504 [DEBUG  ] Running: ['git', 'version'] \r\n2017-09-08 13:28:00,519 [DEBUG  ] Running: ['git', 'config', '-z', '-l', '--show-origin', '--file', '/mnt/btrfs/datasets/datalad/crawl/openfmri/.datalad/config'] \r\n2017-09-08 13:28:00,533 [DEBUG  ] Running: ['git', 'config', '-z', '-l', '--show-origin'] \r\n2017-09-08 13:28:00,553 [DEBUG  ] Using existing Git repository at /mnt/btrfs/datasets/datalad/crawl/openfmri \r\n2017-09-08 13:28:00,580 [DEBUG  ] Determined class of decorated function: <class 'datalad.distribution.subdatasets.Subdatasets'> \r\n2017-09-08 13:28:00,580 [DEBUG  ] Resolved dataset for subdataset reporting/modification: <Dataset path=/mnt/btrfs/datasets/datalad/crawl/openfmri> \r\n2017-09-08 13:28:00,581 [DEBUG  ] Running: ['git', '--work-tree=.', 'submodule', 'status', '--recursive'] \r\n2017-09-08 13:28:02,103 [DEBUG  ] Determined class of decorated function: <class 'datalad.interface.diff.Diff'> \r\n2017-09-08 13:28:02,103 [DEBUG  ] Determined class of decorated function: <class 'datalad.interface.annotate_paths.AnnotatePaths'> \r\n2017-09-08 13:28:02,104 [DEBUG  ] Running: ['git', '--work-tree=.', 'diff', '--raw', '-z', '--ignore-submodules=none', '--abbrev=40', 'e1046e69133df9f6ab933a7759a64c2536b0ce0e', '--'] \r\n^CERROR: \r\nInterrupted by user while doing magic:  [subprocess.py:_communicate_with_poll:1152]\r\n2017-09-08 13:28:05,128 [DEBUG  ] Using existing Git repository at /mnt/btrfs/datasets/datalad/crawl \r\nDATALAD_LOG_TIMESTAMP=1 datalad -l debug --dbg publish --to=datalad-public  -  9.59s user 13.71s system 113% cpu 20.558 total\r\n\r\n\r\n```", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/1812/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/1812/timeline", "performed_via_github_app": null}