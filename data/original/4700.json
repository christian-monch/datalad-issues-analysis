{"url": "https://api.github.com/repos/datalad/datalad/issues/4700", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/4700/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/4700/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/4700/events", "html_url": "https://github.com/datalad/datalad/issues/4700", "id": 656184298, "node_id": "MDU6SXNzdWU2NTYxODQyOTg=", "number": 4700, "title": "`rerun` does not cherry pick regular commits before first RUNCMD", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 2767259861, "node_id": "MDU6TGFiZWwyNzY3MjU5ODYx", "url": "https://api.github.com/repos/datalad/datalad/labels/cmd-run/rerun", "name": "cmd-run/rerun", "color": "FEF2C0", "default": false, "description": "Issues about the favorite command of ReproPeople"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-07-13T22:21:43Z", "updated_at": "2021-09-13T08:49:44Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "The use case I had tried to pursue is (ab)using `datalad rerun` to re-establish dataset history with fake dates enabled.   There is a number of commits which were created by `datalad run` but they come late in the history. I know that most likely it would have been a failure (cherry picking commits on top of possibly changed by `rerun` data would fail) but I just thought to try.  \r\n\r\nIt might be \"by design\" that it does not CP all those commits `--since` until it runs into a commit which it needs to rerun.  It makes sense if `onto` is some commit inbetween `since` and `onto`.  Documentation says\r\n\r\n    The decision to skip rather than cherry pick a revision is based on whether\r\n    the revision would be reachable from HEAD at the time of execution.\r\n\r\nwhich is not 100% clear what actually decision would be (skip or not) and either it is applicable here.\r\n\r\nI have made the entire dataset (with all annexed files content history) available on smaug under `/mnt/btrfs/scrap/tmp/budapest` and here is  sequence of commands I had ran (under @kyleam 's account to make sure that permissions are right etc):\r\n\r\nNB not yet sure why it is trying to reach out to the very original clone of that dataset, to which kyle has no access to (happens in the initial `clone` or `install` invocation)\r\n\r\n```shell\r\n(dev3) kyle@smaug:/mnt/btrfs/scrap/tmp$ datalad --version\r\ndatalad 0.13.0\r\n(dev3) kyle@smaug:/mnt/btrfs/scrap/tmp$ datalad clone budapest budapest-fakedates\r\n[INFO   ] Fetching updates for Dataset(/mnt/btrfs/scrap/tmp/budapest-fakedates)\r\nCommandError: 'git fetch --verbose --progress --prune --recurse-submodules=no origin-2' failed with exitcode 128 under /mnt/btrfs/scrap/tmp/budapest-fakedates\r\nfatal: '/mnt/btrfs/datasets/datalad/crawl/labs/gobbini/budapest' does not appear to be a git repository\r\nfatal: Could not read from remote repository.\r\n\r\nPlease make sure you have the correct access rights\r\nand the repository exists.\r\n(dev3) kyle@smaug:/mnt/btrfs/scrap/tmp$ cd budapest-fakedates/\r\n(dev3) kyle@smaug:/mnt/btrfs/scrap/tmp/budapest-fakedates$ datalad get .heudiconv/\r\ninstall(ok): /mnt/btrfs/scrap/tmp/budapest-fakedates/.heudiconv (dataset) [Installed subdataset in order to get /mnt/btrfs/scrap/tmp/budapest-fakedates/.heudiconv]\r\nget(ok): .heudiconv/sid000005/info/dicominfo.tsv (file) [from origin...]\r\nget(ok): .heudiconv/sid000005/info/filegroup.json (file) [from origin...]\r\nget(ok): .heudiconv/sid000005/info/heuristic.py (file) [from origin...]\r\nget(ok): .heudiconv/sid000005/info/sid000005.auto.txt (file) [from origin...]\r\nget(ok): .heudiconv/sid000005/info/sid000005.edit.txt (file) [from origin...]\r\nget(ok): .heudiconv/sid000007/info/dicominfo.tsv (file) [from origin...]\r\nget(ok): .heudiconv/sid000007/info/filegroup.json (file) [from origin...]\r\nget(ok): .heudiconv/sid000009/info/dicominfo.tsv (file) [from origin...]\r\nget(ok): .heudiconv/sid000009/info/filegroup.json (file) [from origin...]\r\nget(ok): .heudiconv/sid000010/info/dicominfo.tsv (file) [from origin...]\r\n  [43 similar messages have been suppressed]\r\naction summary:\r\n  get (ok: 53)\r\n  install (ok: 1)\r\n(dev3) kyle@smaug:/mnt/btrfs/scrap/tmp/budapest-fakedates$ git co -b fake-dates 24cadf2f739cfee09220d8264c25abd1b9e2a2f9\r\ngit: 'co' is not a git command. See 'git --help'.\r\n\r\nThe most similar commands are\r\n        commit\r\n        clone\r\n        log\r\n(dev3) kyle@smaug:/mnt/btrfs/scrap/tmp/budapest-fakedates$ git checkout -b fake-dates 24cadf2f739cfee09220d8264c25abd1b9e2a2f9\r\nwarning: unable to rmdir '.heudiconv': Directory not empty\r\nSwitched to a new branch 'fake-dates'\r\n(dev3) kyle@smaug:/mnt/btrfs/scrap/tmp/budapest-fakedates$ git config -f .datalad/config datalad.fake-dates true\r\n(dev3) kyle@smaug:/mnt/btrfs/scrap/tmp/budapest-fakedates$ datalad save -m \"enabling fake dates\" .datalad/config\r\nadd(ok): .datalad/config (file)\r\nsave(ok): . (dataset)\r\naction summary:\r\n  add (ok: 1)\r\n  save (ok: 1)\r\n(dev3) kyle@smaug:/mnt/btrfs/scrap/tmp/budapest-fakedates$ git checkout -\r\nSwitched to branch 'master'\r\nYour branch is up to date with 'origin/master'.\r\n```\r\nwith the actual `rerun` then following:\r\n```shell\r\n(dev3) kyle@smaug:/mnt/btrfs/scrap/tmp/budapest-fakedates$ datalad rerun --onto fake-dates -b fake-dates-redone --since 24cadf2f739cfee09220d8264c25abd1b9e2a2f9\r\n[INFO   ] == Command start (output follows) ===== \r\npython: can't open file 'code/add_intendedfor.py': [Errno 2] No such file or directory\r\nCommandError: ''python code/add_intendedfor.py sub-sid000005/fmap/sub-sid000005_acq-25mm_phasediff.json sub-sid000005/func/sub-sid000005_task-movie_run-01_bold.nii.gz sub-sid000005/func/sub-sid000005_task-movie_run-02_bold.nii.\r\ngz sub-sid000005/func/sub-sid000005_task-movie_run-03_bold.nii.gz sub-sid000005/func/sub-sid000005_task-movie_run-04_bold.nii.gz sub-sid000005/func/sub-sid000005_task-movie_run-05_bold.nii.gz'' failed with exitcode 2 under /mnt\r\n/btrfs/scrap/tmp/budapest-fakedates\r\n```\r\n\r\n It is not clear (there is no logging about what `rerun` is doing - e.g. which commit is considering to rerun or cherry pick, edit: found https://github.com/datalad/datalad/issues/3584), which commit it tried to redo but I guess it is the following one, which you can see preceded with the commit which actually adds the script\r\n\r\n```\r\ncommit a5e5f3059e146b53e5aa2ccb9854aa02bdbeae21\r\nAuthor: Matteo Visconti dOC <matteo.visconti.gr@dartmouth.edu>\r\nDate:   XXXXXXXXXXXXX\r\n\r\n    [DATALAD RUNCMD] python code/add_intendedfor.py sub-sid00...\r\n    \r\n    === Do not change lines below ===\r\n    {\r\n     \"cmd\": [\r\n      \"python\",\r\n      \"code/add_intendedfor.py\",\r\n      \"sub-sid000005/fmap/sub-sid000005_acq-25mm_phasediff.json\",\r\n      \"sub-sid000005/func/sub-sid000005_task-movie_run-01_bold.nii.gz\",\r\n      \"sub-sid000005/func/sub-sid000005_task-movie_run-02_bold.nii.gz\",\r\n      \"sub-sid000005/func/sub-sid000005_task-movie_run-03_bold.nii.gz\",\r\n      \"sub-sid000005/func/sub-sid000005_task-movie_run-04_bold.nii.gz\",\r\n      \"sub-sid000005/func/sub-sid000005_task-movie_run-05_bold.nii.gz\"\r\n     ],\r\n     \"exit\": 0,\r\n     \"chain\": [],\r\n     \"pwd\": \".\"\r\n    }\r\n    ^^^ Do not change lines above ^^^\r\n\r\n sub-sid000005/fmap/sub-sid000005_acq-25mm_phasediff.json | 1244 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-----------------\r\n 1 file changed, 1117 insertions(+), 127 deletions(-)\r\n\r\ncommit d2c77bd694378c826613aa27d788da56757d803f\r\nAuthor: Matteo Visconti dOC <matteo.visconti.gr@dartmouth.edu>\r\nDate:   XXXXXXXXXXXXXXX\r\n\r\n    Add script to add intended for\r\n\r\n code/add_intendedfor.py | 41 +++++++++++++++++++++++++++++++++++++++++\r\n 1 file changed, 41 insertions(+)\r\n```\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/4700/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/4700/timeline", "performed_via_github_app": null}