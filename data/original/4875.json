{"url": "https://api.github.com/repos/datalad/datalad/issues/4875", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/4875/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/4875/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/4875/events", "html_url": "https://github.com/datalad/datalad/issues/4875", "id": 694098998, "node_id": "MDU6SXNzdWU2OTQwOTg5OTg=", "number": 4875, "title": "BF: 7z based re-implementation of archives handling doesn't handle .tgz (and others) \"fully\" (only get .tar)", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 440544386, "node_id": "MDU6TGFiZWw0NDA1NDQzODY=", "url": "https://api.github.com/repos/datalad/datalad/labels/fix-implemented", "name": "fix-implemented", "color": "0e8a16", "default": false, "description": "A fix is available, but has not been merged or released, yet."}, {"id": 447185719, "node_id": "MDU6TGFiZWw0NDcxODU3MTk=", "url": "https://api.github.com/repos/datalad/datalad/labels/regression", "name": "regression", "color": "fc8387", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2020-09-05T14:39:05Z", "updated_at": "2020-09-08T15:02:11Z", "closed_at": "2020-09-08T15:02:10Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Extracts only .tar, thus requiring a 2nd step.\r\n\r\nOriginal discovery: https://github.com/datalad-handbook/book/pull/569/files/639b8c1602542d9d4bc8975414e82967162c100c#diff-950b7583ea5bdc7e6f1ab0492c8b3eea\r\n\r\nin particular https://github.com/datalad/datalad/blob/HEAD/datalad/support/archive_utils_7z.py#L43 : it doesn't know about `.tg?`.  and `7z x` doesn't care about \"composition\" -- one step extraction of such archives seems to be a feature asked for a decade: https://sourceforge.net/p/sevenzip/discussion/45797/thread/5eb1b8d5/?page=3  .\r\n\r\nMeanwhile, the undesired behavior could be overcome with `-c datalad.runtime.use-patool=1` and that one (after patool step, so most likely unrelated to 7z vs patool) manages to trigger the workaround for stuck git annex batch processes!, heh heh (might be of advantage to be able to pin point underlying issue in such as case vs strange order of tests):\r\n\r\n```shell\r\n(git)smaug:/tmp/testds[master]data/raw\r\n$> datalad -c datalad.runtime.use-patool=1 add-archive-content imagenette2-160.tgz\r\n[INFO   ] Adding content of the archive imagenette2-160.tgz into annex AnnexRepo(/tmp/testds) \r\n[INFO   ] Finished adding imagenette2-160.tgz: Files processed: 13394, renamed: 13394, +annex: 13394 \r\n[WARNING] Caught Command '['git', 'annex', 'addurl', '--with-files', '--json', '--json-error-messages', '--batch']' timed out after 3.0 seconds [subprocess.py:_wait:1616] on trial #1. Sleeping 1.000000 and retrying \r\n[WARNING] Caught Command '['git', 'annex', 'addurl', '--with-files', '--json', '--json-error-messages', '--batch']' timed out after 3.0 seconds [subprocess.py:_wait:1616] on trial #2. Sleeping 1.000000 and retrying \r\ndatalad -c datalad.runtime.use-patool=1 add-archive-content   94.95s user 36.41s system 103% cpu 2:06.96 total\r\n\r\n$> git annex version 2>&1 | head -n 1\r\ngit-annex version: 7.20190819+git2-g908476a9b-1~ndall+1\r\n\r\n$> datalad --version                 \r\ndatalad 0.13.3.dev191\r\n\r\n$> cd ~datalad/datalad-master \r\n\r\n\r\n(git)smaug:~datalad/datalad-master[master]\r\n$> git describe\r\n0.13.3-191-g105e1ff0c\r\n```\r\n", "closed_by": {"login": "adswa", "id": 29738718, "node_id": "MDQ6VXNlcjI5NzM4NzE4", "avatar_url": "https://avatars.githubusercontent.com/u/29738718?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adswa", "html_url": "https://github.com/adswa", "followers_url": "https://api.github.com/users/adswa/followers", "following_url": "https://api.github.com/users/adswa/following{/other_user}", "gists_url": "https://api.github.com/users/adswa/gists{/gist_id}", "starred_url": "https://api.github.com/users/adswa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adswa/subscriptions", "organizations_url": "https://api.github.com/users/adswa/orgs", "repos_url": "https://api.github.com/users/adswa/repos", "events_url": "https://api.github.com/users/adswa/events{/privacy}", "received_events_url": "https://api.github.com/users/adswa/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/4875/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/4875/timeline", "performed_via_github_app": null}