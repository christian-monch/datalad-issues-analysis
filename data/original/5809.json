{"url": "https://api.github.com/repos/datalad/datalad/issues/5809", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/5809/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/5809/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/5809/events", "html_url": "https://github.com/datalad/datalad/pull/5809", "id": 950993847, "node_id": "MDExOlB1bGxSZXF1ZXN0Njk1NDUxNzU3", "number": 5809, "title": "BF: Report info from annex JSON error message in CommandError", "user": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 3049454433, "node_id": "MDU6TGFiZWwzMDQ5NDU0NDMz", "url": "https://api.github.com/repos/datalad/datalad/labels/patch", "name": "patch", "color": "870048", "default": false, "description": "Increment the patch version when merged"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2021-07-22T19:46:30Z", "updated_at": "2021-07-26T15:49:24Z", "closed_at": "2021-07-26T15:49:20Z", "author_association": "MEMBER", "active_lock_reason": null, "pull_request": {"url": "https://api.github.com/repos/datalad/datalad/pulls/5809", "html_url": "https://github.com/datalad/datalad/pull/5809", "diff_url": "https://github.com/datalad/datalad/pull/5809.diff", "patch_url": "https://github.com/datalad/datalad/pull/5809.patch"}, "body": "When a `CommandError` bubbles up to the main entrypoint it is rendered\r\ndifferently than anywhere else (calls `to_str()` with\r\n`include_output=False`. This is done to be able to write the\r\n`stdout|err` output of a failed command to the proper channels. However,\r\nthis also caused all information extraction from JSON records to be\r\ndisabled.\r\n\r\nThis change, makes sure that JSON records are processed even in this\r\ncase. It also RFs the exception rendering code to make it less\r\nrepr()-like.\r\n\r\nFrom:\r\n\r\n```\r\nCommandError: 'git -c diff.ignoreSubmodules=none annex copy --batch -z --to expdir --fast --json --json-error-messages --json-progress -c annex.dotfiles=true' failed with exitcode 1 under /tmp/testds\r\ngit-annex: copy: 2 failed\r\n```\r\n\r\nTo:\r\n\r\n```\r\nCommandError: 'git -c diff.ignoreSubmodules=none annex copy --batch -z --to expdir --fast --json --json-error-messages --json-progress -c annex.dotfiles=true' failed with exitcode 1 under /tmp/testds [info keys: stdout_json]\r\n> to expdir...\r\n  remote is configured with exporttree=yes; use `git-annex export` to store content on it\r\n  This could have failed because --fast is enabled. [2 times]\r\ngit-annex: copy: 2 failed\r\n```\r\n\r\nFixes datalad/datalad#5807", "closed_by": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/5809/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/5809/timeline", "performed_via_github_app": null}