{"url": "https://api.github.com/repos/datalad/datalad/issues/2493", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/2493/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/2493/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/2493/events", "html_url": "https://github.com/datalad/datalad/issues/2493", "id": 323455231, "node_id": "MDU6SXNzdWUzMjM0NTUyMzE=", "number": 2493, "title": "\"Integration\" testing failures", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 440544386, "node_id": "MDU6TGFiZWw0NDA1NDQzODY=", "url": "https://api.github.com/repos/datalad/datalad/labels/fix-implemented", "name": "fix-implemented", "color": "0e8a16", "default": false, "description": "A fix is available, but has not been merged or released, yet."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2018-05-16T03:20:34Z", "updated_at": "2018-05-16T14:03:58Z", "closed_at": "2018-05-16T12:54:17Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "#### What is the problem?\r\n\r\nBelow you could see a list of failed tests discovered after doing \r\n```shell\r\nmkdir datalad-integration\r\ncd datalad-integration\r\nvirtualenv --system-site-packages venvs/dev\r\nsource venvs/dev/bin/activate\r\npip install -e ../datalad-master ../datalad-neuroimaging ../datalad-crawler\r\nDATALAD_TESTS_SSH=1 python -m nose -s -v datalad datalad_crawler datalad_neuroimaging 2>&1 | tee tests.log\r\n```\r\n\r\n- I've excluded the ones for #2489 (and khm, failure which #2490 was supposed to fix and I thought it did... need to look again on a fresh eye)\r\n- Just now realized that I was running it with git annex 6.20180510+gitg500f7ea78-1~ndall+1 which I've been test driving before uploading ... I will make it available now in debian-devel of neurodebian\r\n\r\nSome failures seems to hint on not installed resources needed for tests\r\n```\r\n======================================================================\r\nERROR: datalad_neuroimaging.extractors.tests.test_dicom.test_dicom\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python2.7/dist-packages/nose/case.py\", line 197, in runTest\r\n    self.test(*self.arg)\r\n  File \"/home/yoh/proj/datalad/datalad-integration/venvs/dev/local/lib/python2.7/site-packages/datalad/tests/utils.py\", line 662, in newfunc\r\n    return t(*(arg + (filename,)), **kw)\r\n  File \"/home/yoh/proj/datalad/datalad-integration/venvs/dev/local/lib/python2.7/site-packages/datalad_neuroimaging/extractors/tests/test_dicom.py\", line 37, in test_dicom\r\n    path)\r\n  File \"/usr/lib/python2.7/shutil.py\", line 133, in copy\r\n    copyfile(src, dst)\r\n  File \"/usr/lib/python2.7/shutil.py\", line 96, in copyfile\r\n    with open(src, 'rb') as fsrc:\r\nIOError: [Errno 2] No such file or directory: '/home/yoh/proj/datalad/datalad-integration/venvs/dev/local/lib/python2.7/site-packages/datalad_neuroimaging/tests/data/dicom.dcm'\r\n\r\n======================================================================\r\nERROR: datalad_neuroimaging.extractors.tests.test_nidm.test_nidm\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python2.7/dist-packages/nose/case.py\", line 197, in runTest\r\n    self.test(*self.arg)\r\n  File \"/home/yoh/proj/datalad/datalad-integration/venvs/dev/local/lib/python2.7/site-packages/datalad/tests/utils.py\", line 662, in newfunc\r\n    return t(*(arg + (filename,)), **kw)\r\n  File \"/home/yoh/proj/datalad/datalad-integration/venvs/dev/local/lib/python2.7/site-packages/datalad_neuroimaging/extractors/tests/test_nidm.py\", line 28, in test_nidm\r\n    path)\r\n  File \"/usr/lib/python2.7/shutil.py\", line 133, in copy\r\n    copyfile(src, dst)\r\n  File \"/usr/lib/python2.7/shutil.py\", line 96, in copyfile\r\n    with open(src, 'rb') as fsrc:\r\nIOError: [Errno 2] No such file or directory: '/home/yoh/proj/datalad/datalad-integration/venvs/dev/local/lib/python2.7/site-packages/datalad_neuroimaging/tests/data/nifti1.nii.gz'\r\n\r\n======================================================================\r\nERROR: datalad_neuroimaging.extractors.tests.test_nifti1.test_nifti\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python2.7/dist-packages/nose/case.py\", line 197, in runTest\r\n    self.test(*self.arg)\r\n  File \"/home/yoh/proj/datalad/datalad-integration/venvs/dev/local/lib/python2.7/site-packages/datalad/tests/utils.py\", line 662, in newfunc\r\n    return t(*(arg + (filename,)), **kw)\r\n  File \"/home/yoh/proj/datalad/datalad-integration/venvs/dev/local/lib/python2.7/site-packages/datalad_neuroimaging/extractors/tests/test_nifti1.py\", line 63, in test_nifti\r\n    path)\r\n  File \"/usr/lib/python2.7/shutil.py\", line 133, in copy\r\n    copyfile(src, dst)\r\n  File \"/usr/lib/python2.7/shutil.py\", line 96, in copyfile\r\n    with open(src, 'rb') as fsrc:\r\nIOError: [Errno 2] No such file or directory: '/home/yoh/proj/datalad/datalad-integration/venvs/dev/local/lib/python2.7/site-packages/datalad_neuroimaging/tests/data/nifti1.nii.gz'\r\n\r\n======================================================================\r\nERROR: datalad_neuroimaging.tests.test_bids2scidata.test_minimal\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python2.7/dist-packages/nose/case.py\", line 197, in runTest\r\n    self.test(*self.arg)\r\n  File \"/home/yoh/proj/datalad/datalad-integration/venvs/dev/local/lib/python2.7/site-packages/datalad/tests/utils.py\", line 492, in newfunc\r\n    return t(*(arg + (d,)), **kw)\r\n  File \"/home/yoh/proj/datalad/datalad-integration/venvs/dev/local/lib/python2.7/site-packages/datalad_neuroimaging/tests/test_bids2scidata.py\", line 108, in test_minimal\r\n    repo_url='http://example.com',\r\n  File \"/home/yoh/proj/datalad/datalad-integration/venvs/dev/local/lib/python2.7/site-packages/datalad/distribution/dataset.py\", line 439, in apply_func\r\n    return f(**kwargs)\r\n  File \"/home/yoh/proj/datalad/datalad-integration/venvs/dev/local/lib/python2.7/site-packages/datalad/interface/utils.py\", line 470, in eval_func\r\n    return return_func(generator_func)(*args, **kwargs)\r\n  File \"/home/yoh/proj/datalad/datalad-integration/venvs/dev/local/lib/python2.7/site-packages/datalad/interface/utils.py\", line 458, in return_func\r\n    results = list(results)\r\n  File \"/home/yoh/proj/datalad/datalad-integration/venvs/dev/local/lib/python2.7/site-packages/datalad/interface/utils.py\", line 414, in generator_func\r\n    result_renderer, result_xfm, _result_filter, **_kwargs):\r\n  File \"/home/yoh/proj/datalad/datalad-integration/venvs/dev/local/lib/python2.7/site-packages/datalad/interface/utils.py\", line 482, in _process_results\r\n    for res in results:\r\n  File \"/home/yoh/proj/datalad/datalad-integration/venvs/dev/local/lib/python2.7/site-packages/datalad_neuroimaging/bids2scidata.py\", line 678, in __call__\r\n    itmpl = open(itmpl_path, encoding='utf-8').read()\r\nIOError: [Errno 2] No such file or directory: '/home/yoh/proj/datalad/datalad-integration/venvs/dev/local/lib/python2.7/site-packages/datalad_neuroimaging/resources/isatab/scidata_bids_investigator.txt'\r\n\r\n======================================================================\r\nERROR: datalad_neuroimaging.tests.test_dicomconv.test_dicom_metadata_aggregation\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python2.7/dist-packages/nose/case.py\", line 197, in runTest\r\n    self.test(*self.arg)\r\n  File \"/home/yoh/proj/datalad/datalad-integration/venvs/dev/local/lib/python2.7/site-packages/datalad/tests/utils.py\", line 662, in newfunc\r\n    return t(*(arg + (filename,)), **kw)\r\n  File \"/home/yoh/proj/datalad/datalad-integration/venvs/dev/local/lib/python2.7/site-packages/datalad_neuroimaging/tests/test_dicomconv.py\", line 40, in test_dicom_metadata_aggregation\r\n    dicoms = get_dicom_dataset('structural')\r\n  File \"/home/yoh/proj/datalad/datalad-integration/venvs/dev/local/lib/python2.7/site-packages/datalad_neuroimaging/tests/test_dicomconv.py\", line 32, in get_dicom_dataset\r\n    path=opj(modpath, 'tests', 'data', 'dicoms', flavor))\r\n  File \"/home/yoh/proj/datalad/datalad-integration/venvs/dev/local/lib/python2.7/site-packages/datalad/interface/utils.py\", line 470, in eval_func\r\n    return return_func(generator_func)(*args, **kwargs)\r\n  File \"/home/yoh/proj/datalad/datalad-integration/venvs/dev/local/lib/python2.7/site-packages/datalad/interface/utils.py\", line 458, in return_func\r\n    results = list(results)\r\n  File \"/home/yoh/proj/datalad/datalad-integration/venvs/dev/local/lib/python2.7/site-packages/datalad/interface/utils.py\", line 414, in generator_func\r\n    result_renderer, result_xfm, _result_filter, **_kwargs):\r\n  File \"/home/yoh/proj/datalad/datalad-integration/venvs/dev/local/lib/python2.7/site-packages/datalad/interface/utils.py\", line 482, in _process_results\r\n    for res in results:\r\n  File \"/home/yoh/proj/datalad/datalad-integration/venvs/dev/local/lib/python2.7/site-packages/datalad/distribution/install.py\", line 194, in __call__\r\n    purpose='installation')\r\n  File \"/home/yoh/proj/datalad/datalad-integration/venvs/dev/local/lib/python2.7/site-packages/datalad/distribution/dataset.py\", line 505, in require_dataset\r\n    \"{0}.\".format(dataset.path))\r\nValueError: No installed dataset found at /home/yoh/proj/datalad/datalad-integration/venvs/dev/local/lib/python2.7/site-packages.\r\n\r\n======================================================================\r\nFAIL: datalad.cmdline.tests.test_main.test_help_np\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python2.7/dist-packages/nose/case.py\", line 197, in runTest\r\n    self.test(*self.arg)\r\n  File \"/home/yoh/proj/datalad/datalad-integration/venvs/dev/local/lib/python2.7/site-packages/datalad/cmdline/tests/test_main.py\", line 100, in test_help_np\r\n    'Plugins'})\r\nAssertionError: Items in the first set but not the second:\r\n'Neuroimaging tools'\r\n'Crawl web resources'\r\n\r\n======================================================================\r\nFAIL: datalad.distribution.tests.test_create_sibling.test_target_ssh_simple\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python2.7/dist-packages/nose/case.py\", line 197, in runTest\r\n    self.test(*self.arg)\r\n  File \"/home/yoh/proj/datalad/datalad-integration/venvs/dev/local/lib/python2.7/site-packages/datalad/tests/utils.py\", line 943, in newfunc\r\n    return func(*args, **kwargs)\r\n  File \"/home/yoh/proj/datalad/datalad-integration/venvs/dev/local/lib/python2.7/site-packages/datalad/tests/utils.py\", line 835, in newfunc\r\n    t(*(arg + (uri,)), **kw)\r\n  File \"/home/yoh/proj/datalad/datalad-integration/venvs/dev/local/lib/python2.7/site-packages/datalad/tests/utils.py\", line 662, in newfunc\r\n    return t(*(arg + (filename,)), **kw)\r\n  File \"/home/yoh/proj/datalad/datalad-integration/venvs/dev/local/lib/python2.7/site-packages/datalad/tests/utils.py\", line 662, in newfunc\r\n    return t(*(arg + (filename,)), **kw)\r\n  File \"/home/yoh/proj/datalad/datalad-integration/venvs/dev/local/lib/python2.7/site-packages/datalad/distribution/tests/test_create_sibling.py\", line 186, in test_target_ssh_simple\r\n    ok_endswith(target_description, target_path)\r\n  File \"/home/yoh/proj/datalad/datalad-integration/venvs/dev/local/lib/python2.7/site-packages/datalad/tests/utils.py\", line 395, in ok_endswith\r\n    msg=\"String %r doesn't end with %r\" % (s, suffix))\r\nAssertionError: String 'yoh@hopa:~/.tmp/datalad_temp_test_target_ssh_simplefXVh8F/basic' doesn't end with '/home/yoh/.tmp/datalad_temp_test_target_ssh_simplefXVh8F/basic'\r\n```\r\n", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/2493/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/2493/timeline", "performed_via_github_app": null}