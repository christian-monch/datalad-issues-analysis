{"url": "https://api.github.com/repos/datalad/datalad/issues/4762", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/4762/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/4762/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/4762/events", "html_url": "https://github.com/datalad/datalad/pull/4762", "id": 664074136, "node_id": "MDExOlB1bGxSZXF1ZXN0NDU1Mzc1Mjk2", "number": 4762, "title": "travis: Use a Docker target for the SSH tests", "user": {"login": "kyleam", "id": 1297788, "node_id": "MDQ6VXNlcjEyOTc3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1297788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kyleam", "html_url": "https://github.com/kyleam", "followers_url": "https://api.github.com/users/kyleam/followers", "following_url": "https://api.github.com/users/kyleam/following{/other_user}", "gists_url": "https://api.github.com/users/kyleam/gists{/gist_id}", "starred_url": "https://api.github.com/users/kyleam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kyleam/subscriptions", "organizations_url": "https://api.github.com/users/kyleam/orgs", "repos_url": "https://api.github.com/users/kyleam/repos", "events_url": "https://api.github.com/users/kyleam/events{/privacy}", "received_events_url": "https://api.github.com/users/kyleam/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2020-07-22T21:56:03Z", "updated_at": "2020-07-28T17:40:11Z", "closed_at": "2020-07-28T17:39:18Z", "author_association": "MEMBER", "active_lock_reason": null, "pull_request": {"url": "https://api.github.com/repos/datalad/datalad/pulls/4762", "html_url": "https://github.com/datalad/datalad/pull/4762", "diff_url": "https://github.com/datalad/datalad/pull/4762.diff", "patch_url": "https://github.com/datalad/datalad/pull/4762.patch"}, "body": "This series adjusts the SSH-dependent tests to facilitate using a target other than localhost and switches Travis over to using a Docker target.  The motivation for this is to make it easier to run our SSH tests outside of Travis without requiring that the localhost allows SSH connections and maps datalad-test to localhost.  The new setup here can hopefully be adapted easily for use in the testing at datalad-extensions (right now those builds skip SSH tests).\r\n\r\nI've been using an earlier iteration of this Docker container for a while to run our SSH-based tests locally, replacing \"localhost\" if present with \"datalad-test\" temporarily.\r\n\r\n---\r\n\r\nThings to do:\r\n\r\n- [X] Figure out why the last assertion in `test_annex_ssh` is failing\r\n\r\n  I thought I blindly worked around it in the commit marked with \"[maybe]\", but I've seen it since, so I guess that was a fluke.\r\n\r\n  This failure happens with `_DL_ANNEX_INSTALL_SCENARIO=\"conda-forge 7.20190819\"`.  If Travis is switched to using neurodebian (7.20190819) or the autobuild, the assertion doesn't fail.  It also doesn't fail if I use install-annex.sh to install \"conda-forge 7.20190819\" locally and test with the Docker SSH target.  I tried the same in a Xenial VM and cannot get it to fail.  I suppose at least it isn't hanging.\r\n\r\n  Update: \"Figure out\" is too strong for this item or the next, but these failures are avoided by b527a75b4 (TST: test_annex_ssh: Avoid syncing unrelated histories, 2020-07-21), hopefully.\r\n\r\n- [X] Figure out non-SSH related failures\r\n\r\n   Based on a recent scratch run of this branch on Travis, I expect `test_AnnexRepo_get_remote_na` and `test_is_available` to fail: <https://travis-ci.org/github/datalad/datalad/builds/710864799#L3171>.  I don't think these should involve SSH, I didn't see them fail in earlier runs with this PR's changes, and I can't trigger the failures locally, so I'm puzzled.\r\n\r\n- [X] Move temporary git repo for Docker image to datalad-tester account\r\n\r\n  Perhaps \"datalad-tester/docker-ssh-target\".\r\n\r\n  https://github.com/kyleam/datalad-tests-docker-ssh-target\r\n\r\n  Update: Now at <https://github.com/datalad-tester/docker-ssh-target>.  Thanks @yarikoptic.\r\n\r\n- [X] Connect the git repo to Docker Hub repo under the datalad organization\r\n\r\n  Update: Now at <https://hub.docker.com/r/dataladtester/docker-ssh-target>.  Thanks @yarikoptic.\r\n\r\n\r\nClose #4514.\r\n", "closed_by": {"login": "kyleam", "id": 1297788, "node_id": "MDQ6VXNlcjEyOTc3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1297788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kyleam", "html_url": "https://github.com/kyleam", "followers_url": "https://api.github.com/users/kyleam/followers", "following_url": "https://api.github.com/users/kyleam/following{/other_user}", "gists_url": "https://api.github.com/users/kyleam/gists{/gist_id}", "starred_url": "https://api.github.com/users/kyleam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kyleam/subscriptions", "organizations_url": "https://api.github.com/users/kyleam/orgs", "repos_url": "https://api.github.com/users/kyleam/repos", "events_url": "https://api.github.com/users/kyleam/events{/privacy}", "received_events_url": "https://api.github.com/users/kyleam/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/4762/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/4762/timeline", "performed_via_github_app": null}