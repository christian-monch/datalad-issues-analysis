{"url": "https://api.github.com/repos/datalad/datalad/issues/4931", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/4931/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/4931/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/4931/events", "html_url": "https://github.com/datalad/datalad/pull/4931", "id": 704430765, "node_id": "MDExOlB1bGxSZXF1ZXN0NDg5MzU3MTY5", "number": 4931, "title": "ENH+RF: @try_multiple_dec_s3 to retry interaction with S3 upon \"retriable\" errors", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1746781627, "node_id": "MDU6TGFiZWwxNzQ2NzgxNjI3", "url": "https://api.github.com/repos/datalad/datalad/labels/merge-if-ok", "name": "merge-if-ok", "color": "fbca04", "default": false, "description": "OP considers this work done, and requests review/merge"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/datalad/datalad/milestones/80", "html_url": "https://github.com/datalad/datalad/milestone/80", "labels_url": "https://api.github.com/repos/datalad/datalad/milestones/80/labels", "id": 6095126, "node_id": "MDk6TWlsZXN0b25lNjA5NTEyNg==", "number": 80, "title": "0.13.5", "description": "It is already released but PRs merged were not annotated, makes harder to figure out what was merged into what without looking at CHANGELOG or gitk or git describe", "creator": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 45, "state": "closed", "created_at": "2020-11-11T15:33:51Z", "updated_at": "2021-01-03T22:29:23Z", "due_on": null, "closed_at": "2021-01-03T22:29:23Z"}, "comments": 9, "created_at": "2020-09-18T14:35:27Z", "updated_at": "2020-12-12T14:24:20Z", "closed_at": "2020-09-24T13:11:53Z", "author_association": "MEMBER", "active_lock_reason": null, "pull_request": {"url": "https://api.github.com/repos/datalad/datalad/pulls/4931", "html_url": "https://github.com/datalad/datalad/pull/4931", "diff_url": "https://github.com/datalad/datalad/pull/4931.diff", "patch_url": "https://github.com/datalad/datalad/pull/4931.patch"}, "body": "I think this is an alternative (as a better solution to the underlying issue) to the https://github.com/datalad/datalad/pull/4928 -- I kept hitting a `400` error from S3 while `addurls` ABCD.  I believe in the course of DANDI project we had similar occasions whenever S3 would fail with 400 without apparent reason: well, there are many reasons why 400 could be returned - https://docs.aws.amazon.com/AmazonS3/latest/API/ErrorResponses.html#ErrorCodeList and some of them are \"legit\", i.e. retry probably should not 'fix' that.  But I do not want to sift through all of them ATM.  IMHO it would be perfectly fine to retry a few times.\r\n\r\nI have also added other codes (with comments in the code) which I think are legit to retry with sleep upon hitting.\r\n\r\nAlso `@try_multiple_dec` was enhanced and refactored a little to make it more useful generally.\r\n\r\nI will now do a rerun of `addurls` with this PR applied so I could see if I finally manage to complete the runs of `addurls` without crash.\r\n\r\nTODOs\r\n- [x] figure out why not \"effective\" for my use case\r\n- test the code by mocking `.get_bucket` to raise an exception on first try so forcing a retry - I did come up with a test but it is only an integration test which has extended run time... was not sure if mocked up test would be more pain than gain since it is really to test interaction with S3.  So decided to not pursue that.", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/4931/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/4931/timeline", "performed_via_github_app": null}