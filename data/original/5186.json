{"url": "https://api.github.com/repos/datalad/datalad/issues/5186", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/5186/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/5186/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/5186/events", "html_url": "https://github.com/datalad/datalad/issues/5186", "id": 752295098, "node_id": "MDU6SXNzdWU3NTIyOTUwOTg=", "number": 5186, "title": "`datalad clone \"ria+file:/some/store/#~myds\"` leads to undesired establishment of an \"annex\"", "user": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1782622781, "node_id": "MDU6TGFiZWwxNzgyNjIyNzgx", "url": "https://api.github.com/repos/datalad/datalad/labels/severity-important", "name": "severity-important", "color": "cc0000", "default": false, "description": "major effect on the usability of a package, without rendering it completely unusable to everyone"}], "state": "closed", "locked": false, "assignee": {"login": "bpoldrack", "id": 10498301, "node_id": "MDQ6VXNlcjEwNDk4MzAx", "avatar_url": "https://avatars.githubusercontent.com/u/10498301?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bpoldrack", "html_url": "https://github.com/bpoldrack", "followers_url": "https://api.github.com/users/bpoldrack/followers", "following_url": "https://api.github.com/users/bpoldrack/following{/other_user}", "gists_url": "https://api.github.com/users/bpoldrack/gists{/gist_id}", "starred_url": "https://api.github.com/users/bpoldrack/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bpoldrack/subscriptions", "organizations_url": "https://api.github.com/users/bpoldrack/orgs", "repos_url": "https://api.github.com/users/bpoldrack/repos", "events_url": "https://api.github.com/users/bpoldrack/events{/privacy}", "received_events_url": "https://api.github.com/users/bpoldrack/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "bpoldrack", "id": 10498301, "node_id": "MDQ6VXNlcjEwNDk4MzAx", "avatar_url": "https://avatars.githubusercontent.com/u/10498301?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bpoldrack", "html_url": "https://github.com/bpoldrack", "followers_url": "https://api.github.com/users/bpoldrack/followers", "following_url": "https://api.github.com/users/bpoldrack/following{/other_user}", "gists_url": "https://api.github.com/users/bpoldrack/gists{/gist_id}", "starred_url": "https://api.github.com/users/bpoldrack/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bpoldrack/subscriptions", "organizations_url": "https://api.github.com/users/bpoldrack/orgs", "repos_url": "https://api.github.com/users/bpoldrack/repos", "events_url": "https://api.github.com/users/bpoldrack/events{/privacy}", "received_events_url": "https://api.github.com/users/bpoldrack/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 7, "created_at": "2020-11-27T14:34:35Z", "updated_at": "2020-12-17T07:48:23Z", "closed_at": "2020-12-17T07:48:23Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "After such a clone, the config of the dataset in the store gets an `[annex]` section that it should not have:\r\n\r\n```\r\n% cat config\r\n[core]\r\n        repositoryformatversion = 0\r\n        filemode = true\r\n        bare = true\r\n[datalad \"ora-remote\"]\r\n        uuid = 08ba549c-2991-4b7f-94c2-0fbfed0914d3\r\n[annex]\r\n        uuid = 37f33fa8-4eff-4c90-bc83-597b3aa16224\r\n        version = 8\r\n```\r\n\r\nI suspect this is `git-annex` automatically doing this, because the clone is on the same filesystem and the user had write permissions. As a consequence, the `config` file also has a different owner now (the cloner).\r\n\r\nThis is a problem. `git-annex` should not become aware of that remote as having an annex directly, because its availability is recorded in the corresponding ORA special remote. In such a configuration, git-annex will now push to the remote directly, and not via ORA. This leads to confusion at minimum, and to data loss in the worst case.\r\n\r\nThe full list of modifications is here:\r\n\r\n```\r\n./14a/5e5b6-d30d-11ea-8836-b4969157768c/annex\r\n./14a/5e5b6-d30d-11ea-8836-b4969157768c/annex/sentinal\r\n./14a/5e5b6-d30d-11ea-8836-b4969157768c/annex/index\r\n./14a/5e5b6-d30d-11ea-8836-b4969157768c/annex/journal\r\n./14a/5e5b6-d30d-11ea-8836-b4969157768c/annex/journal/uuid.log\r\n./14a/5e5b6-d30d-11ea-8836-b4969157768c/annex/othertmp\r\n./14a/5e5b6-d30d-11ea-8836-b4969157768c/annex/sentinal.cache\r\n./14a/5e5b6-d30d-11ea-8836-b4969157768c/annex/journal.lck\r\n./14a/5e5b6-d30d-11ea-8836-b4969157768c/annex/othertmp.lck\r\n./14a/5e5b6-d30d-11ea-8836-b4969157768c/config\r\n```", "closed_by": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/5186/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/5186/timeline", "performed_via_github_app": null}