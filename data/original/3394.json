{"url": "https://api.github.com/repos/datalad/datalad/issues/3394", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/3394/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/3394/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/3394/events", "html_url": "https://github.com/datalad/datalad/pull/3394", "id": 441379274, "node_id": "MDExOlB1bGxSZXF1ZXN0Mjc2NzE4MTYx", "number": 3394, "title": "TST: rev-save: Demonstrate partial index failure", "user": {"login": "kyleam", "id": 1297788, "node_id": "MDQ6VXNlcjEyOTc3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1297788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kyleam", "html_url": "https://github.com/kyleam", "followers_url": "https://api.github.com/users/kyleam/followers", "following_url": "https://api.github.com/users/kyleam/following{/other_user}", "gists_url": "https://api.github.com/users/kyleam/gists{/gist_id}", "starred_url": "https://api.github.com/users/kyleam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kyleam/subscriptions", "organizations_url": "https://api.github.com/users/kyleam/orgs", "repos_url": "https://api.github.com/users/kyleam/repos", "events_url": "https://api.github.com/users/kyleam/events{/privacy}", "received_events_url": "https://api.github.com/users/kyleam/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2019-05-07T18:13:59Z", "updated_at": "2019-05-09T13:42:36Z", "closed_at": "2019-05-09T13:42:17Z", "author_association": "MEMBER", "active_lock_reason": null, "pull_request": {"url": "https://api.github.com/repos/datalad/datalad/pulls/3394", "html_url": "https://github.com/datalad/datalad/pull/3394", "diff_url": "https://github.com/datalad/datalad/pull/3394.diff", "patch_url": "https://github.com/datalad/datalad/pull/3394.patch"}, "body": "When an unlocked annex file is added by 'git annex add' to git rather\r\nthan back to the annex (e.g., because its size now falls under the\r\nannex.largefiles threshold), git-annex's pre-commit hook will fail\r\nwith a partial commit error on 'git commit -- FILE'.  See\r\n1a609d4be (BF: annexrepo: Avoid typechange when using temporary index,\r\n2019-04-30) for a more complete description.\r\n\r\nAnnexRepo.commit() (and thus add/save) work around this by dropping\r\nthe pathspec from the commit call, using a temporary index if needed\r\nto avoid committing staged changes that weren't in the specified\r\npathspec.\r\n\r\nOn the other hand, rev-save, which doesn't use AnnexRepo.commit(),\r\npartially works around this by calling 'git commit' with no\r\npathspec (after updating the specified paths in the index) only if\r\nthere initially weren't any staged changes.  Otherwise, it calls 'git\r\ncommit' with the pathspec, and the failure still occurs.  This\r\napproach makes sense given that rev-save embraces a \"no index\"\r\nphilosophy, but for clarity and posterity, let's add a test that\r\ndemonstrates the known failure.", "closed_by": {"login": "kyleam", "id": 1297788, "node_id": "MDQ6VXNlcjEyOTc3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1297788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kyleam", "html_url": "https://github.com/kyleam", "followers_url": "https://api.github.com/users/kyleam/followers", "following_url": "https://api.github.com/users/kyleam/following{/other_user}", "gists_url": "https://api.github.com/users/kyleam/gists{/gist_id}", "starred_url": "https://api.github.com/users/kyleam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kyleam/subscriptions", "organizations_url": "https://api.github.com/users/kyleam/orgs", "repos_url": "https://api.github.com/users/kyleam/repos", "events_url": "https://api.github.com/users/kyleam/events{/privacy}", "received_events_url": "https://api.github.com/users/kyleam/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/3394/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/3394/timeline", "performed_via_github_app": null}