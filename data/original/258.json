{"url": "https://api.github.com/repos/datalad/datalad/issues/258", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/258/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/258/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/258/events", "html_url": "https://github.com/datalad/datalad/issues/258", "id": 110779324, "node_id": "MDU6SXNzdWUxMTA3NzkzMjQ=", "number": 258, "title": "install doesn't do the right thing on crippled file systems", "user": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2015-10-10T08:14:36Z", "updated_at": "2017-06-12T11:20:26Z", "closed_at": "2017-06-12T11:20:26Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Here the protocol of my troubles:\n\nPrep test repo:\n\n```\n/tmp/testhd % git init\nInitialized empty Git repository in /tmp/testhd/.git/\nmih@meiner /tmp/testhd (git)-[master] % git annex init\ninit  ok\n(recording state in git...)\nmih@meiner /tmp/testhd (git)-[master] % touch some\nmih@meiner /tmp/testhd (git)-[master] % git annex add some\nadd some ok\n(recording state in git...)\nmih@meiner /tmp/testhd (git)-[master] % git commit\n[master (root-commit) d7d3a57] New\n 1 file changed, 1 insertion(+)\n create mode 120000 some\n```\n\nNow trying to install this on a locally mounted samba share:\n\n```\n/mnt/smb/fritz/datalad % PATH=~/hacking/datalad/git/bin:$PATH PYTHONPATH=~/hacking/datalad/git datalad install-handle /tmp/testhd test                     \n2015-10-10 09:53:22,313 [ERROR  ] 'git clone -v /tmp/testhd /mnt/smb/fritz/datalad/test' returned with exit code 128\n| stderr: 'Cloning into '/mnt/smb/fritz/datalad/test'...\n| done.\n| error: unable to create symlink some (Permission denied)\n| fatal: unable to checkout working tree\n| warning: Clone succeeded, but checkout failed.\n| You can inspect what was checked out with 'git status'\n| and retry the checkout with 'git checkout -f HEAD'\n| \n| ' (gitrepo.py:244)\n2015-10-10 09:53:22,314 [ERROR  ] 'git clone -v /tmp/testhd /mnt/smb/fritz/datalad/test' returned with exit code 128\n| stderr: 'Cloning into '/mnt/smb/fritz/datalad/test'...\n| done.\n| error: unable to create symlink some (Permission denied)\n| fatal: unable to checkout working tree\n| warning: Clone succeeded, but checkout failed.\n| You can inspect what was checked out with 'git status'\n| and retry the checkout with 'git checkout -f HEAD'\n| \n| ' (GitCommandError) (main.py:206)\n```\n\nHere is how it would look like to annex init on that samba share\n\n```\n/mnt/smb/fritz/datalad/demo_init % git init\ngit Initialized empty Git repository in /mnt/smb/fritz/datalad/demo_init/.git/\n/mnt/smb/fritz/datalad/demo_init (git)-[master] % git annex init\ninit  \n  Detected a crippled filesystem.\n\n  Disabling core.symlinks.\n\n  Enabling direct mode.\nok\n(recording state in git...)\n```\n\nIt does not matter, if I put the source repo in direct mode now:\n\n```\n% git annex direct\ncommit  \nOn branch master\nnothing to commit, working directory clean\nok\ndirect some ok\ndirect  ok\n% git annex sync\ncommit  ok\n```\n\nStill fails to install (same error).\n\nHowever, when the original source repo always lived in direct mode things work:\n\n```\n/tmp/testhd (git)-[master] % git annex init\ninit  ok\n(recording state in git...)\n/tmp/testhd (git)-[master] % git annex direct\ncommit  \nOn branch master\n\nInitial commit\n\nnothing to commit\nok\ndirect  ok\n/tmp/testhd (git)-[annex/direct/master] % echo test > some\n/tmp/testhd (git)-[annex/direct/master] % git annex proxy -- git add some\n/tmp/testhd (git)-[annex/direct/master] % git annex proxy -- git commit \nok\n[annex/direct/master (root-commit) 055dd89] Some\n 1 file changed, 1 insertion(+)\n create mode 100644 some\n```\n\nleading to\n\n```\n/mnt/smb/fritz/datalad % PATH=~/hacking/datalad/git/bin:$PATH PYTHONPATH=~/hacking/datalad/git datalad install-handle /tmp/testhd test\n2015-10-10 10:11:28,153 [ERROR  ] stderr|   Detected a crippled filesystem.\n|   Disabling core.symlinks.\n|   Enabling direct mode. (cmd.py:319)\n2015-10-10 10:11:33,613 [ERROR  ] stderr| Switched to a new branch 'filemntsmbfritzdataladtest_import_IlgHHr' (cmd.py:319)\n2015-10-10 10:11:33,625 [ERROR  ] stderr| Switched to branch 'master' (cmd.py:319)\n```\n\nStill looks scary, but actually indicates success.\n\nConclusion: Either install-handle is doing it wrong, or we cannot use indirect mode (ever) -- which would be a BIG bummer.\n", "closed_by": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/258/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/258/timeline", "performed_via_github_app": null}