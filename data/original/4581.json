{"url": "https://api.github.com/repos/datalad/datalad/issues/4581", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/4581/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/4581/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/4581/events", "html_url": "https://github.com/datalad/datalad/pull/4581", "id": 626413817, "node_id": "MDExOlB1bGxSZXF1ZXN0NDI0NDA3NjE3", "number": 4581, "title": "Finishing touches to `push` for 0.13", "user": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 12, "created_at": "2020-05-28T10:53:10Z", "updated_at": "2020-06-06T08:25:45Z", "closed_at": "2020-06-06T08:25:39Z", "author_association": "MEMBER", "active_lock_reason": null, "pull_request": {"url": "https://api.github.com/repos/datalad/datalad/pulls/4581", "html_url": "https://github.com/datalad/datalad/pull/4581", "diff_url": "https://github.com/datalad/datalad/pull/4581.diff", "patch_url": "https://github.com/datalad/datalad/pull/4581.patch"}, "body": "Rename push(force='all') -> push(force='pushall')  to better forward-compatibility.\r\n\r\nThis also adds the implementation of the conclusion of a discussion on this topic. Follow-up to gh-4541.\r\n\r\nAdd --auto to `git annex copy` if `datalad.push.copy-auto-if-wanted` is set, and `--force datatransfer` isn't given.\r\n\r\nFixes gh-4550: --auto is never added, unless requested via config\r\n\r\nFixes gh-4551 and fixes gh-4483: now obeys distribution-restrictions in a \"default\"  `datalad push --to target` if configuration says so (not the default (yet?))\r\n\r\nTODO:\r\n\r\n- [x] Is this secure enough (see gh-4357). A dataset could set this flag in its own config (.datalad/config). Are we confident that it would never override a user config (add test)?\r\n- [x] update docstring to say that be default \"all content\" will be pushed, and explain under which conditions exactly (tracking remote, etc.)\r\n\r\n<details>\r\n<summary>Script to play with the changes</summary>\r\n\r\n```sh\r\n\r\n#!/bin/bash\r\n\r\nexport PS4='> '\r\nset -eu\r\ncd \"$(mktemp -d ${TMPDIR:-/tmp}/dl-XXXXXXX)\"\r\nset -x\r\n\r\ndatalad create src\r\n\r\n(\r\ncd src\r\n# Produce and annotate some data\r\necho -e '\\x00' > data.0\r\necho -e '\\x01' > secure.1\r\necho -e '\\x02' > secure.2\r\ndatalad save -m \"added some files\"\r\n\r\n# Dropping a file to mimic a case of simply not having it locally (thus not to be \"pushed\")\r\ngit annex drop --force secure.2\r\n\r\n# Annotate sensitive content, actual value \"verysecure\" does not matter in this example\r\ngit annex metadata --set distribution-restrictions=verysecure secure.1 secure.2\r\n\r\ndatalad save -m \"added a file\"\r\ndatalad create-sibling --annex-wanted \"not metadata=distribution-restrictions=*\" -r -s target ../target\r\n#datalad -c datalad.push.copy-auto-if-wanted=true push --to target\r\ndatalad push --to target\r\n\r\n)\r\n\r\n(\r\ncd target\r\ngit annex list\r\n)\r\n```\r\n\r\n</details>\r\n", "closed_by": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/4581/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/4581/timeline", "performed_via_github_app": null}