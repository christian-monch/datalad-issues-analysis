{"url": "https://api.github.com/repos/datalad/datalad/issues/3464", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/3464/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/3464/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/3464/events", "html_url": "https://github.com/datalad/datalad/issues/3464", "id": 450295903, "node_id": "MDU6SXNzdWU0NTAyOTU5MDM=", "number": 3464, "title": "problematic effect of \"git mv\" of a submodule - not renamed", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2019-05-30T13:00:43Z", "updated_at": "2019-06-01T13:00:44Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "```shell\r\n$> p=/tmp/testds; rm -rf $p; datalad create $p; cd $p; datalad create -d . subm1 && datalad save && git mv subm1 subm1-moved && datalad create -d . subm1                                                                           \r\n[INFO   ] Creating a new annex repo at /tmp/testds                                                  \r\ncreate(ok): /tmp/testds (dataset)                                                                                 \r\n[INFO   ] Creating a new annex repo at /tmp/testds/subm1 \r\ncreate(ok): subm1 (dataset)                                                                                       \r\nadd(ok): subm1 (file)\r\nadd(ok): .gitmodules (file)\r\nsave(ok): . (dataset)                                                                                             \r\naction summary:\r\n  add (ok: 2)\r\n  save (ok: 1)\r\n[ERROR  ] collision with content in parent dataset at /tmp/testds: ['/tmp/testds/subm1'] [create(/tmp/testds/subm1)] \r\n\r\n$> ls -l\r\ntotal 4\r\ndrwx------ 4 yoh yoh 4096 May 30 08:55 subm1-moved/\r\n\r\n$> git submodule\r\n b096a2f0558c817767872b89e888957463d9d5f3 subm1-moved (heads/master)\r\n\r\n$> cat .gitmodules \r\n[submodule \"subm1\"]\r\n\tpath = subm1-moved\r\n\turl = ./subm1\r\n\tdatalad-id = 3dbc6d14-82da-11e9-8069-8019340ce7f2\r\n\r\n$> datalad subdatasets\r\nsubdataset(ok): subm1-moved (dataset)\r\n\r\n$> git version\r\ngit version 2.21.0.593.g511ec345e18\r\n```\r\n\r\nI wonder if that is something we should seek fixed in git -- I expect both submodule name and url being adjusted by `git mv`?\r\n\r\n0.11.x works out without crash but information about moved one is gone:\r\n```\r\n(git)hopa:~datalad/datalad[0.11.x]git-annex\r\n$> p=/tmp/testds; rm -rf $p; datalad create $p; cd $p; datalad create -d . subm1 && datalad save && git mv subm1 subm1-moved && datalad create -d . subm1                                                                           [INFO   ] Creating a new annex repo at /tmp/testds \r\ncreate(ok): /tmp/testds (dataset)\r\n[INFO   ] Creating a new annex repo at /tmp/testds/subm1 \r\ncreate(ok): subm1 (dataset)\r\naction summary:\r\n  add (notneeded: 2, ok: 1)\r\n  create (ok: 1)\r\n  save (ok: 1)\r\n[INFO   ] Creating a new annex repo at /tmp/testds/subm1 \r\ncreate(ok): subm1 (dataset)\r\naction summary:\r\n  add (notneeded: 2, ok: 1)\r\n  create (ok: 1)\r\n  save (ok: 1)\r\n(dev3) 1 12517.....................................:Thu 30 May 2019 09:00:39 AM EDT:.\r\n(git-annex)hopa:/tmp/testds[master]git\r\n$> cat .gitmodules \r\n[submodule \"subm1\"]\r\n\tpath = subm1\r\n\turl = ./subm1\r\n(dev3) 1 12518.....................................:Thu 30 May 2019 09:00:44 AM EDT:.\r\n(git-annex)hopa:/tmp/testds[master]git\r\n$> git status\r\nOn branch master\r\nChanges to be committed:\r\n  (use \"git reset HEAD <file>...\" to unstage)\r\n\r\n\tnew file:   subm1-moved\r\n\r\n(git-annex)hopa:/tmp/testds[master]git\r\n$> git commit -m new\r\n[master 90aed10] new\r\n 1 file changed, 1 insertion(+)\r\n create mode 160000 subm1-moved\r\n(dev3) 1 12520.....................................:Thu 30 May 2019 09:01:58 AM EDT:.\r\n(git-annex)hopa:/tmp/testds[master]git\r\n$> cat .gitmodules  \r\n[submodule \"subm1\"]\r\n\tpath = subm1\r\n\turl = ./subm1\r\n(dev3) 1 12521.....................................:Thu 30 May 2019 09:02:01 AM EDT:.\r\n(git-annex)hopa:/tmp/testds[master]git\r\n$> git status\r\nOn branch master\r\nnothing to commit, working tree clean\r\n(dev3) 1 12522.....................................:Thu 30 May 2019 09:02:16 AM EDT:.\r\n(git-annex)hopa:/tmp/testds[master]git\r\n$> git submodule\r\n 316bc1be035fec6e2d8b1d7a91c9f4da8821a09f subm1 (heads/master)\r\nfatal: no submodule mapping found in .gitmodules for path 'subm1-moved'\r\n```\r\n\r\nactually, if I do save after `git mv` on master version, it also works out fine just the same problematic result and this time git submodule just \"forgets\" about new one\r\n```\r\n$> p=/tmp/testds; rm -rf $p; datalad create $p; cd $p; datalad create -d . subm1 && datalad save && git mv subm1 subm1-moved && datalad save -m moved && datalad create -d . subm1                                                  [INFO   ] Creating a new annex repo at /tmp/testds \r\ncreate(ok): /tmp/testds (dataset)                                                                                 \r\n[INFO   ] Creating a new annex repo at /tmp/testds/subm1 \r\ncreate(ok): subm1 (dataset)                                                                                       \r\nadd(ok): subm1 (file)\r\nadd(ok): .gitmodules (file)\r\nsave(ok): . (dataset)                                                                                             \r\naction summary:\r\n  add (ok: 2)\r\n  save (ok: 1)\r\nsave(ok): . (dataset)\r\n[INFO   ] Creating a new annex repo at /tmp/testds/subm1 \r\ncreate(ok): subm1 (dataset)                                                                                       \r\n(dev3) 1 12530.....................................:Thu 30 May 2019 09:03:16 AM EDT:.\r\n(git-annex)hopa:/tmp/testds[master]git\r\n$> cat .gitmodules\r\n[submodule \"subm1\"]\r\n\tpath = subm1-moved\r\n\turl = ./subm1\r\n\tdatalad-id = 47b13182-82db-11e9-8069-8019340ce7f2\r\n(dev3) 1 12531.....................................:Thu 30 May 2019 09:03:18 AM EDT:.\r\n(git-annex)hopa:/tmp/testds[master]git\r\n$> git submodule\r\n 5fcc9e437e7254a64db2a5d16e2dfea83198c886 subm1-moved (heads/master)\r\n(dev3) 1 12532.....................................:Thu 30 May 2019 09:03:23 AM EDT:.\r\n(git-annex)hopa:/tmp/testds[master]git\r\n$> ls -l\r\ntotal 8\r\ndrwx------ 4 yoh yoh 4096 May 30 09:03 subm1/\r\ndrwx------ 4 yoh yoh 4096 May 30 09:03 subm1-moved/\r\n(dev3) 1 12533.....................................:Thu 30 May 2019 09:03:32 AM EDT:.\r\n(git-annex)hopa:/tmp/testds[master]git\r\n$> datalad subdatasets\r\nsubdataset(ok): subm1-moved (dataset)\r\n```", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/3464/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/3464/timeline", "performed_via_github_app": null}