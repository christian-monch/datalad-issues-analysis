{"url": "https://api.github.com/repos/datalad/datalad/issues/4753", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/4753/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/4753/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/4753/events", "html_url": "https://github.com/datalad/datalad/issues/4753", "id": 661931179, "node_id": "MDU6SXNzdWU2NjE5MzExNzk=", "number": 4753, "title": "config does not pick up the value failing test_resulthooks.py:test_basics test on nd20.04 (focal)", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 881374230, "node_id": "MDU6TGFiZWw4ODEzNzQyMzA=", "url": "https://api.github.com/repos/datalad/datalad/labels/possibly-fixed", "name": "possibly-fixed", "color": "77dd77", "default": false, "description": "A fix might be available, but was not (yet) confirmed"}, {"id": 1782622781, "node_id": "MDU6TGFiZWwxNzgyNjIyNzgx", "url": "https://api.github.com/repos/datalad/datalad/labels/severity-important", "name": "severity-important", "color": "cc0000", "default": false, "description": "major effect on the usability of a package, without rendering it completely unusable to everyone"}, {"id": 2646797846, "node_id": "MDU6TGFiZWwyNjQ2Nzk3ODQ2", "url": "https://api.github.com/repos/datalad/datalad/labels/spurious-test-failure", "name": "spurious-test-failure", "color": "eda19a", "default": false, "description": "Tests that fail unreliably"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-07-20T15:07:00Z", "updated_at": "2021-07-26T16:47:02Z", "closed_at": "2021-07-26T16:47:01Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "original mentioning: https://github.com/datalad/datalad/issues/4748#issuecomment-661062491 -- happens only on nd20.04 (ubuntu focal), and only when I run full sweep of tests via `debian/rules binary` (I failed to reproduce by trying to run only that test or file or module directly using `python3 -m nose` etc).\r\n\r\n```shell\r\n# debian/rules binary\r\n...\r\ndatalad.core.local.tests.test_resulthooks.test_basics ... > /usr/lib/python3/dist-packages/nose/tools/trivial.py(29)eq_()\r\n-> raise AssertionError(msg or \"%r != %r\" % (a, b))\r\n(Pdb) p a\r\nNone\r\n(Pdb) p b\r\n'bids'\r\n(Pdb) up \r\n> /build/datalad-0.13.1/.pybuild/cpython3_3.8_datalad/build/datalad/core/local/tests/test_resulthooks.py(100)test_basics()\r\n-> eq_(clone_sub2.config.get('datalad.metadata.nativetype'), 'bids')\r\n(Pdb) p clone_sub2.config.get('datalad.metadata.nativetype')\r\nNone\r\n(Pdb) p clone_sub2 \r\nDataset('/tmp/datalad_temp_test_basicstx6qrrgx/subds2')\r\n(Pdb) \r\n[1]+  Stopped                 debian/rules binary\r\n# cat /tmp/datalad_temp_test_basicstx6qrrgx/subds2/.datalad/config \r\n[datalad \"dataset\"]\r\n\tid = 3120c732-ca99-11ea-b9ab-002590f97d84\r\n[datalad \"metadata\"]\r\n\tnativetype = bids\r\n```\r\n\r\nreload of the config resolves it:\r\n```\r\n(Pdb) p clone_sub2.config.get('datalad.metadata.nativetype')\r\nNone\r\n(Pdb) p clone_sub2.config.reload()\r\nNone\r\n(Pdb) p clone_sub2.config.get('datalad.metadata.nativetype')\r\n'bids'\r\n```\r\n\r\n```\r\n# stat /tmp/datalad_temp_test_basicstx6qrrgx/subds2/.datalad/config\r\n  File: /tmp/datalad_temp_test_basicstx6qrrgx/subds2/.datalad/config\r\n  Size: 103       \tBlocks: 8          IO Block: 4096   regular file\r\nDevice: 4151h/16721d\tInode: 135451      Links: 1\r\nAccess: (0644/-rw-r--r--)  Uid: (    0/    root)   Gid: (    0/    root)\r\nAccess: 2020-07-20 14:56:37.414203041 +0000\r\nModify: 2020-07-20 14:56:37.022196616 +0000\r\nChange: 2020-07-20 14:56:37.022196616 +0000\r\n Birth: -\r\n```\r\nthe code leading to it is\r\n\r\n```python\r\n    # setup done, now see if it works\r\n    clone.get('subds')\r\n    clone_sub = Dataset(clone.pathobj / 'subds')\r\n    eq_(clone_sub.config.get('datalad.metadata.nativetype'), 'bids')\r\n    # now the same thing with a result_xfm, should make no difference\r\n    clone.get('subds2')\r\n    clone_sub2 = Dataset(clone.pathobj / 'subds2')\r\n    eq_(clone_sub2.config.get('datalad.metadata.nativetype'), 'bids')\r\n```\r\nas it fails the entire build - marking as \"important\"", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/4753/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/4753/timeline", "performed_via_github_app": null}