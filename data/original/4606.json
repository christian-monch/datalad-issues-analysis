{"url": "https://api.github.com/repos/datalad/datalad/issues/4606", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/4606/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/4606/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/4606/events", "html_url": "https://github.com/datalad/datalad/issues/4606", "id": 630557895, "node_id": "MDU6SXNzdWU2MzA1NTc4OTU=", "number": 4606, "title": "Prevent `run` from crashing due to another `run` process", "user": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 63778592, "node_id": "MDU6TGFiZWw2Mzc3ODU5Mg==", "url": "https://api.github.com/repos/datalad/datalad/labels/enhancement", "name": "enhancement", "color": "0052cc", "default": true, "description": ""}, {"id": 2767259861, "node_id": "MDU6TGFiZWwyNzY3MjU5ODYx", "url": "https://api.github.com/repos/datalad/datalad/labels/cmd-run/rerun", "name": "cmd-run/rerun", "color": "FEF2C0", "default": false, "description": "Issues about the favorite command of ReproPeople"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-06-04T06:50:21Z", "updated_at": "2021-03-08T16:06:58Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "Scenario: I have an output dataset that needs to capture the outcome of 100k SLURM jobs. Each job adds one subdataset each to two intermediate superdatasets that are subdatasets of the output dataset. The is complicated, but a reality with fmriprep (it builds two disjoint subject trees, one for freesurfer and one for fmriprep, from a single invokation). The fmriprep container is configured in the superdataset, as is the single input raw dataset.\r\n\r\nIdeally, there is a run record for each subject (which matches a single SLURM job). Ideally, all SLURM jobs can be submitted at once.\r\n\r\nAt the moment, SLURM jobs would randomly fail whenever two jobs exit simultaneously and `datalad run` attempts a `save`.\r\n\r\nThis is a concrete realization of #4401 \r\n\r\nI have looked at `containers-run` and I see no way to mitigate the issue outside `datalad run` itself. It would already help, if `run` places a PID-identifying lockfile in the dataset that indicates that a `save` operation is running (which can take quite a while). Alternatively, we could investigate, if two simultaneously running `save` operations could succeed, if we only protect the final `commit`.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/4606/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/4606/timeline", "performed_via_github_app": null}