{"url": "https://api.github.com/repos/datalad/datalad/issues/4436", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/4436/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/4436/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/4436/events", "html_url": "https://github.com/datalad/datalad/issues/4436", "id": 604676320, "node_id": "MDU6SXNzdWU2MDQ2NzYzMjA=", "number": 4436, "title": "SSH process hangs", "user": {"login": "bpoldrack", "id": 10498301, "node_id": "MDQ6VXNlcjEwNDk4MzAx", "avatar_url": "https://avatars.githubusercontent.com/u/10498301?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bpoldrack", "html_url": "https://github.com/bpoldrack", "followers_url": "https://api.github.com/users/bpoldrack/followers", "following_url": "https://api.github.com/users/bpoldrack/following{/other_user}", "gists_url": "https://api.github.com/users/bpoldrack/gists{/gist_id}", "starred_url": "https://api.github.com/users/bpoldrack/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bpoldrack/subscriptions", "organizations_url": "https://api.github.com/users/bpoldrack/orgs", "repos_url": "https://api.github.com/users/bpoldrack/repos", "events_url": "https://api.github.com/users/bpoldrack/events{/privacy}", "received_events_url": "https://api.github.com/users/bpoldrack/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-04-22T11:21:22Z", "updated_at": "2021-01-19T10:25:55Z", "closed_at": "2021-01-19T10:25:55Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "In PR #4203 I'm currently seeing AppVeyor builds stalling.\r\nDebug commit with lower log level and traceback gives me this:\r\n\r\n```\r\n...\r\n[DEBUG] ...>cmd:216  Launching process ['git-annex', 'initremote', '-c', 'annex.dotfiles=true', '-c', 'annex.retry=3', 'ria-remote', 'encryption=none', 'type=external', 'externaltype=ora', 'autoenable=true', 'url=file:///C:/Users/appveyor/AppData/Local/Temp/1/datalad_temp_jlzmmjka', '--debug'] \r\n[DEBUG] ...>cmd:288  Process 1752 started \r\n[DEBUG] ...>tasks:301,239>cmd:218  Waiting for process 1752 to complete \r\n[Level 5] ...>cmd:291,277  Read 196 bytes from 1752[stderr] \r\n[Level 5] ...>cmd:291,277  Read 56 bytes from 1752[stderr] \r\n[Level 5] ...>cmd:291,277  Read 216 bytes from 1752[stderr] \r\n[Level 5] ...>cmd:291,277  Read 56 bytes from 1752[stderr] \r\n[Level 5] ...>cmd:291,277  Read 264 bytes from 1752[stderr] \r\n[Level 5] ...>cmd:291,277  Read 56 bytes from 1752[stderr] \r\n[Level 5] ...>cmd:291,277  Read 194 bytes from 1752[stderr] \r\n[Level 5] ...>cmd:291,277  Read 242 bytes from 1752[stderr] \r\n[Level 5] ...>cmd:291,277  Read 22 bytes from 1752[stdout] \r\n[Level 5] ...>cmd:291,277  Read 110 bytes from 1752[stderr] \r\n[Level 5] ...>cmd:291,277  Read 226 bytes from 1752[stderr] \r\n[Level 5] ...>cmd:291,277  Read 67 bytes from 1752[stderr] \r\n[Level 5] ...>cmd:291,277  Read 69 bytes from 1752[stderr] \r\n[Level 5] ...>cmd:291,277  Read 75 bytes from 1752[stderr] \r\n[Level 5] ...>cmd:291,277  Read 70 bytes from 1752[stderr] \r\n[Level 5] ...>cmd:291,277  Read 260 bytes from 1752[stderr] \r\n[Level 5] ...>cmd:291,277  Read 226 bytes from 1752[stderr] \r\n[Level 5] ...>cmd:291,277  Read 67 bytes from 1752[stderr] \r\n[Level 5] ...>cmd:291,277  Read 69 bytes from 1752[stderr] \r\n[Level 5] ...>cmd:291,277  Read 75 bytes from 1752[stderr] \r\n[Level 5] ...>cmd:291,277  Read 70 bytes from 1752[stderr] \r\n[Level 5] ...>cmd:291,277  Read 158 bytes from 1752[stderr] \r\n[Level 5] ...>cmd:291,277  Read 110 bytes from 1752[stderr] \r\n[Level 5] ...>cmd:291,277  Read 22 bytes from 1752[stderr] \r\n[Level 5] ...>cmd:291,277  Read 22 bytes from 1752[stderr] \r\n[Level 5] ...>cmd:291,277  Read 226 bytes from 1752[stderr] \r\n[Level 5] ...>cmd:291,277  Read 67 bytes from 1752[stderr] \r\n[Level 5] ...>cmd:291,277  Read 69 bytes from 1752[stderr] \r\n[Level 5] ...>cmd:291,277  Read 75 bytes from 1752[stderr] \r\n[Level 5] ...>cmd:291,277  Read 70 bytes from 1752[stderr] \r\n[Level 5] ...>cmd:291,277  Read 1 bytes from 1752[stdout] \r\n[Level 5] ...>cmd:291,277  Read 681 bytes from 1752[stderr] \r\n[Level 5] ...>cmd:291,277  Read 7 bytes from 1752[stdout] \r\n[Level 5] ...>cmd:291,277  Read 112 bytes from 1752[stderr] \r\n[Level 5] ...>cmd:291,277  Read 32 bytes from 1752[stderr] \r\n[DEBUG] ...>cmd:323,310  Process 1752 exited with return code 1 \r\n[Level 8] ...>cmd:143,464  Finished running ['git-annex', 'initremote', '-c', 'annex.dotfiles=true', '-c', 'annex.retry=3', 'ria-remote', 'encryption=none', 'type=external', 'externaltype=ora', 'autoenable=true', 'url=file:///C:/Users/appveyor/AppData/Local/Temp/1/datalad_temp_jlzmmjka', '--debug'] with status 1 \r\n[Level 5] ...>test_ria_basics:89>annexrepo:948>gitrepo:326,2058>cmd:143,1114,863,1010  Running: ['git', 'cat-file', 'blob', 'git-annex:remote.log'] \r\n[Level 5] ...>cmd:143,1114,929  CommandError: '\"git\" \"cat-file\" \"blob\" \"git-annex:remote.log\"' failed with exitcode 128 under C:\\Users\\appveyor\\AppData\\Local\\Temp\\1\\datalad_temp_i5t1gv__ [err: 'fatal: Not a valid object name git-annex:remote.log'] \r\n[DEBUG] ...>test_ria_basics:93>ora_remote:255>sshconnector:539  Assuming 'datalad-test' is just a hostname for ssh connection \r\n[Level 5] ...>sshconnector:541>network:414,336  Parsed ri datalad-test: into fields {'query': '', 'path': '', 'fragment': '', 'hostname': '', 'scheme': 'datalad-test', 'port': '', 'username': '', 'password': ''} \r\n[Level 5] ...>network:414,345  Assuming ssh style ri, adjusted: {'query': '', 'path': '', 'fragment': '', 'hostname': '', 'scheme': 'datalad-test', 'port': '', 'username': '', 'password': ''} \r\n[Level 5] ...>network:414,372  Detected ssh ri \r\n[DEBUG] ...>network:454  Parsed version of SSHRI 'datalad-test' differs from original 'datalad-test:' \r\n[Level 5] ...>sshconnector:559,477,486>config:259,316,606>cmd:1114,863,1010  Running: ['git', '--git-dir=', 'config', '-z', '-l', '--show-origin'] \r\n[Level 8] ...>cmd:1114,933,1010  Finished running ['git', '--git-dir=', 'config', '-z', '-l', '--show-origin'] with status 0 \r\n[Level 5] ...>sshconnector:559,477,515  Found 0 previous connections \r\n[DEBUG] ...>ora_remote:257>sshconnector:273  Opening SSHConnection(ctrl_path=<<WindowsPath('C++71 chars++8d')>>, sshri=SSHRI(hostname='datalad-test')) by calling ['ssh', '-fN', '-o', 'ControlMaster=auto', '-o', 'ControlPersist=15m', '-o', 'ControlPath=C:\\\\Users\\\\appveyor\\\\AppData\\\\Local\\\\datalad.org\\\\datalad\\\\Cache\\\\sockets\\\\e0f92d8d', 'datalad-test'] \r\n```\r\n\r\nWhatever is wrong with the SSH setup there - we need to change the way we call SSH from within `SSHConnector`, I think. It's a plain `Popen` call - no `Runner` of any kind.\r\nThere's a similar issue we are currently experiencing when using ORA/RIA on our supercomputer where the remote end is rejecting too many connections leading the ORA remote to hang. I think both issues should be addressed by using the new async based runner approach.", "closed_by": {"login": "bpoldrack", "id": 10498301, "node_id": "MDQ6VXNlcjEwNDk4MzAx", "avatar_url": "https://avatars.githubusercontent.com/u/10498301?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bpoldrack", "html_url": "https://github.com/bpoldrack", "followers_url": "https://api.github.com/users/bpoldrack/followers", "following_url": "https://api.github.com/users/bpoldrack/following{/other_user}", "gists_url": "https://api.github.com/users/bpoldrack/gists{/gist_id}", "starred_url": "https://api.github.com/users/bpoldrack/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bpoldrack/subscriptions", "organizations_url": "https://api.github.com/users/bpoldrack/orgs", "repos_url": "https://api.github.com/users/bpoldrack/repos", "events_url": "https://api.github.com/users/bpoldrack/events{/privacy}", "received_events_url": "https://api.github.com/users/bpoldrack/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/4436/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/4436/timeline", "performed_via_github_app": null}