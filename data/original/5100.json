{"url": "https://api.github.com/repos/datalad/datalad/issues/5100", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/5100/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/5100/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/5100/events", "html_url": "https://github.com/datalad/datalad/issues/5100", "id": 730647242, "node_id": "MDU6SXNzdWU3MzA2NDcyNDI=", "number": 5100, "title": "\"Cannot run the event loop while another loop is running\" if imported from within another async process", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-10-27T17:08:24Z", "updated_at": "2021-05-21T14:22:15Z", "closed_at": "2021-05-21T14:22:15Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "possibly relates to #5064 although manifests slightly differently (thus filed separately).\r\n\r\nI am \"exploring\" pycrunch , see https://github.com/gleb-sevruk/pycrunch-engine/pull/29 -- it would be nice to be able to tell which parts of code any particular test is affecting, and thus when fixing a bug also run locally only tests possibly affected by that particular code path, and actually have those tests automagically reran.\r\n\r\nBut immediate fiasco is inability to import datalad's modules (that is how pycrunch discovers tests ATM, see related https://github.com/gleb-sevruk/pycrunch-engine/pull/29) from within pycrunch:\r\n```\r\n[1076264] 2020-10-27 13:00:17,905 - pycrunch.discovery.simple - WARNING - importing datalad.distributed.tests.test_ria_basics\r\n[1076264] 2020-10-27 13:00:17,905 - pycrunch.discovery.simple - ERROR - Failed to load `datalad/distributed/tests/test_ria_basics.py`\r\n[1076264] 2020-10-27 13:00:17,905 - pycrunch.discovery.simple - ERROR - importing datalad.distributed.tests.test_ria_basics failed with exception: Cannot run the event loop while another loop is running\r\nTraceback (most recent call last):\r\n  File \"/home/yoh/proj/misc/pycrunch-engine/pycrunch/discovery/simple.py\", line 104, in find_tests_in_folder\r\n    module = importlib.import_module(module_name)\r\n  File \"/usr/lib/python3.8/importlib/__init__.py\", line 127, in import_module\r\n    return _bootstrap._gcd_import(name[level:], package, level)\r\n  File \"<frozen importlib._bootstrap>\", line 1014, in _gcd_import\r\n  File \"<frozen importlib._bootstrap>\", line 991, in _find_and_load\r\n  File \"<frozen importlib._bootstrap>\", line 961, in _find_and_load_unlocked\r\n  File \"<frozen importlib._bootstrap>\", line 219, in _call_with_frames_removed\r\n  File \"<frozen importlib._bootstrap>\", line 1014, in _gcd_import\r\n  File \"<frozen importlib._bootstrap>\", line 991, in _find_and_load\r\n  File \"<frozen importlib._bootstrap>\", line 961, in _find_and_load_unlocked\r\n  File \"<frozen importlib._bootstrap>\", line 219, in _call_with_frames_removed\r\n  File \"<frozen importlib._bootstrap>\", line 1014, in _gcd_import\r\n  File \"<frozen importlib._bootstrap>\", line 991, in _find_and_load\r\n  File \"<frozen importlib._bootstrap>\", line 961, in _find_and_load_unlocked\r\n  File \"<frozen importlib._bootstrap>\", line 219, in _call_with_frames_removed\r\n  File \"<frozen importlib._bootstrap>\", line 1014, in _gcd_import\r\n  File \"<frozen importlib._bootstrap>\", line 991, in _find_and_load\r\n  File \"<frozen importlib._bootstrap>\", line 975, in _find_and_load_unlocked\r\n  File \"<frozen importlib._bootstrap>\", line 671, in _load_unlocked\r\n  File \"<frozen importlib._bootstrap_external>\", line 783, in exec_module\r\n  File \"<frozen importlib._bootstrap>\", line 219, in _call_with_frames_removed\r\n  File \"/home/yoh/proj/datalad/datalad-master/datalad/__init__.py\", line 47, in <module>\r\n    cfg = ConfigManager()\r\n  File \"/home/yoh/proj/datalad/datalad-master/datalad/config.py\", line 247, in __init__\r\n    self.reload(force=True)\r\n  File \"/home/yoh/proj/datalad/datalad-master/datalad/config.py\", line 300, in reload\r\n    self._stores[store_id] = self._reload(runargs)\r\n  File \"/home/yoh/proj/datalad/datalad-master/datalad/config.py\", line 333, in _reload\r\n    stdout, stderr = self._run(\r\n  File \"/home/yoh/proj/datalad/datalad-master/datalad/config.py\", line 684, in _run\r\n    out = self._runner.run(self._config_cmd + args, **kwargs)\r\n  File \"/home/yoh/proj/datalad/datalad-master/datalad/cmd.py\", line 489, in run\r\n    results = event_loop.run_until_complete(\r\n  File \"/usr/lib/python3.8/asyncio/base_events.py\", line 592, in run_until_complete\r\n    self._check_running()\r\n  File \"/usr/lib/python3.8/asyncio/base_events.py\", line 554, in _check_running\r\n    raise RuntimeError(\r\nRuntimeError: Cannot run the event loop while another loop is running\r\n```\r\n(nothing ria specific here -- this is just a sample of bunch of those being dumped to the log)", "closed_by": {"login": "kyleam", "id": 1297788, "node_id": "MDQ6VXNlcjEyOTc3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1297788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kyleam", "html_url": "https://github.com/kyleam", "followers_url": "https://api.github.com/users/kyleam/followers", "following_url": "https://api.github.com/users/kyleam/following{/other_user}", "gists_url": "https://api.github.com/users/kyleam/gists{/gist_id}", "starred_url": "https://api.github.com/users/kyleam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kyleam/subscriptions", "organizations_url": "https://api.github.com/users/kyleam/orgs", "repos_url": "https://api.github.com/users/kyleam/repos", "events_url": "https://api.github.com/users/kyleam/events{/privacy}", "received_events_url": "https://api.github.com/users/kyleam/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/5100/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/5100/timeline", "performed_via_github_app": null}