{"url": "https://api.github.com/repos/datalad/datalad/issues/4060", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/4060/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/4060/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/4060/events", "html_url": "https://github.com/datalad/datalad/pull/4060", "id": 552506333, "node_id": "MDExOlB1bGxSZXF1ZXN0MzY1MDAwNTE0", "number": 4060, "title": "clone: Store stderr so it is displayed on clone failure", "user": {"login": "kyleam", "id": 1297788, "node_id": "MDQ6VXNlcjEyOTc3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1297788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kyleam", "html_url": "https://github.com/kyleam", "followers_url": "https://api.github.com/users/kyleam/followers", "following_url": "https://api.github.com/users/kyleam/following{/other_user}", "gists_url": "https://api.github.com/users/kyleam/gists{/gist_id}", "starred_url": "https://api.github.com/users/kyleam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kyleam/subscriptions", "organizations_url": "https://api.github.com/users/kyleam/orgs", "repos_url": "https://api.github.com/users/kyleam/repos", "events_url": "https://api.github.com/users/kyleam/events{/privacy}", "received_events_url": "https://api.github.com/users/kyleam/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-01-20T20:59:23Z", "updated_at": "2020-01-21T13:31:41Z", "closed_at": "2020-01-21T06:02:09Z", "author_association": "MEMBER", "active_lock_reason": null, "pull_request": {"url": "https://api.github.com/repos/datalad/datalad/pulls/4060", "html_url": "https://github.com/datalad/datalad/pull/4060", "diff_url": "https://github.com/datalad/datalad/pull/4060.diff", "patch_url": "https://github.com/datalad/datalad/pull/4060.patch"}, "body": "When GitPython raises a GitCommandError, whether the exception's\r\nstderr attribute actually contains the standard error depends on\r\nwhether progress reporting is enabled.  With progress enabled, the\r\nstandard error is stored in RemoteProgress.error_lines instead of the\r\nexception [0].\r\n\r\nAs of 3ecc68a82 (2018-09-27), we assign RemoteProgress.error_lines to\r\nour GitPythonProgressBar._last_error_lines.  In the case of clone(),\r\nwe consider _last_error_lines to some extent, but it's not included in\r\nthe errors messages that we show the clone call fails with all\r\ncandidates.  In the specific cases of an unknown version, this means\r\nthat we report that cloning failed without any indication that the\r\nunknown version was the issue.\r\n\r\nMake the standard error visible to the caller by replacing the\r\nexception's stderr with _last_error_lines.\r\n\r\nFixes #4038.\r\n\r\n[0]: https://github.com/gitpython-developers/GitPython/issues/599\r\n\r\n---\r\n\r\nAs an example, this changes\r\n\r\n```\r\n$ datalad clone ria+http://127.0.0.1:36265/#eb94c485-3bbe-11ea-b262-28c63f920482@impossible a\r\n[...]\r\ninstall(error): /tmp/ga-KyJmTKq/a (dataset) [Failed to clone from all attempted sources: ['http://127.0.0.1:36265/eb9/4c485-3bbe-11ea-b262-28c63f920482', 'http://127.0.0.1:36265/eb9/4c485-3bbe-11ea-b262-28c63f920482/.git']]\r\n```\r\n\r\ninto\r\n\r\n```\r\n$ datalad clone ria+http://127.0.0.1:36265/#eb94c485-3bbe-11ea-b262-28c63f920482@impossible a\r\n[...]\r\ninstall(error): /tmp/ga-KyJmTKq/a (dataset) [Failed to clone from any candidate source URL. Encountered errors per each url were:\r\n- http://127.0.0.1:36265/eb9/4c485-3bbe-11ea-b262-28c63f920482\r\n  Cmd('git') failed due to: exit code(128)\r\n  cmdline: git clone --progress -v --branch=impossible http://127.0.0.1:36265/eb9/4c485-3bbe-11ea-b262-28c63f920482 /tmp/ga-KyJmTKq/a\r\n  stderr: fatal: Remote branch impossible not found in upstream origin\r\n- http://127.0.0.1:36265/eb9/4c485-3bbe-11ea-b262-28c63f920482/.git\r\n  Cmd('git') failed due to: exit code(128)\r\n  cmdline: git clone --progress -v --branch=impossible http://127.0.0.1:36265/eb9/4c485-3bbe-11ea-b262-28c63f920482/.git /tmp/ga-KyJmTKq/a\r\n  stderr: fatal: repository 'http://127.0.0.1:36265/eb9/4c485-3bbe-11ea-b262-28c63f920482/.git/' not found]\r\n```", "closed_by": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/4060/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/4060/timeline", "performed_via_github_app": null}