{"url": "https://api.github.com/repos/datalad/datalad/issues/3139", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/3139/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/3139/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/3139/events", "html_url": "https://github.com/datalad/datalad/issues/3139", "id": 406351968, "node_id": "MDU6SXNzdWU0MDYzNTE5Njg=", "number": 3139, "title": "datalad add * adds subdir/subrepo/* to itself instead of within subdir/subrepo (with or without -r)", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 192403870, "node_id": "MDU6TGFiZWwxOTI0MDM4NzA=", "url": "https://api.github.com/repos/datalad/datalad/labels/external-tools", "name": "external-tools", "color": "0052cc", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2019-02-04T14:23:13Z", "updated_at": "2019-04-09T23:52:18Z", "closed_at": "2019-04-09T23:39:04Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "I think I have ran into this situation in the field but then didn't have minimal use case and blamed `git annex sync` somehow.  Now I have ran into it with smaller case and replicated.  If `add`'ing subdirectory (behaves ok if subds is at the top level of the ds), with a git repository under (not registered as a git submodule) where there is untracked file, it gets added to the top dataset, not gets ignored (no `-r` for add invocation):\r\n\r\n```shell\r\n$> mkdir ds && cd ds && git init && touch file && mkdir -p d1/subds && git -C d1/subds init && touch d1/subds/subfile && datalad add *                                                                                                \r\nInitialized empty Git repository in /tmp/ds/.git/\r\nInitialized empty Git repository in /tmp/ds/d1/subds/.git/\r\nadd(ok): /tmp/ds/d1/subds/subfile (file)\r\nadd(ok): /tmp/ds/file (file)\r\nadd(ok): /tmp/ds/d1 (directory)\r\nsave(ok): /tmp/ds (dataset)\r\naction summary:\r\n  add (ok: 3)\r\n  save (ok: 1)\r\n(dev) 1 19071 [1].....................................:Mon 04 Feb 2019 09:13:31 AM EST:.\r\n(git)hopa:/tmp/ds[master]\r\n$> git status\r\nOn branch master\r\nnothing to commit, working tree clean\r\n(dev) 1 19072 [1].....................................:Mon 04 Feb 2019 09:13:42 AM EST:.\r\n(git)hopa:/tmp/ds[master]\r\n$> git -C d1/subds status\r\nOn branch master\r\n\r\nNo commits yet\r\n\r\nUntracked files:\r\n  (use \"git add <file>...\" to include in what will be committed)\r\n\r\n\tsubfile\r\n\r\nnothing added to commit but untracked files present (use \"git add\" to track)\r\n```\r\n\r\nwith `add -r` it seems to manage to perform another atrocious act - add file in both top level and subdataset (note that subds isn't getting added as a submodule, I guess due to the lack of `-d .`):\r\n```shell\r\n$> mkdir ds && cd ds && git init && touch file && mkdir -p d1/subds && git -C d1/subds init && touch d1/subds/subfile && datalad add -r *                                                                                                                   Initialized empty Git repository in /tmp/ds/.git/\r\nInitialized empty Git repository in /tmp/ds/d1/subds/.git/\r\nadd(ok): /tmp/ds/d1/subds/subfile (file)\r\nadd(ok): /tmp/ds/d1/subds (dataset)\r\nadd(ok): /tmp/ds/d1/subds/subfile (file)\r\nadd(ok): /tmp/ds/file (file)\r\nadd(ok): /tmp/ds/d1 (directory)\r\nsave(ok): /tmp/ds/d1/subds (dataset)\r\nsave(ok): /tmp/ds (dataset)\r\naction summary:\r\n  add (ok: 5)\r\n  save (ok: 2)\r\n(dev) 1 19076 [1].....................................:Mon 04 Feb 2019 09:16:49 AM EST:.\r\n(git)hopa:/tmp/ds[master]\r\n$> git status\r\nOn branch master\r\nnothing to commit, working tree clean\r\n(dev) 1 19077 [1].....................................:Mon 04 Feb 2019 09:16:57 AM EST:.\r\n(git)hopa:/tmp/ds[master]\r\n$> git log --stat\r\ncommit fab8c31578c13ad0eb7e7c8e09257e71ecf0b195 (HEAD -> master)\r\nAuthor: Yaroslav Halchenko <debian@onerussian.com>\r\nDate:   Mon Feb 4 09:16:49 2019 -0500\r\n\r\n    [DATALAD] added content\r\n\r\n d1/subds/subfile | 0\r\n file             | 0\r\n 2 files changed, 0 insertions(+), 0 deletions(-)\r\n(dev) 1 19078 [1].....................................:Mon 04 Feb 2019 09:17:00 AM EST:.\r\n(git)hopa:/tmp/ds[master]git\r\n$> git -C d1/subds log --stat \r\ncommit da8a0d17c73d00cdc9db92be5fad2559181eb015 (HEAD -> master)\r\nAuthor: Yaroslav Halchenko <debian@onerussian.com>\r\nDate:   Mon Feb 4 09:16:49 2019 -0500\r\n\r\n    [DATALAD] added content\r\n\r\n subfile | 0\r\n 1 file changed, 0 insertions(+), 0 deletions(-)\r\n(dev) 1 19079 [1].....................................:Mon 04 Feb 2019 09:17:11 AM EST:.\r\n(git)hopa:/tmp/ds[master]git\r\n$> git status                \r\nOn branch master\r\nnothing to commit, working tree clean\r\n(dev) 1 19080 [1].....................................:Mon 04 Feb 2019 09:18:38 AM EST:.\r\n(git)hopa:/tmp/ds[master]git\r\n$> cat .gitmodules\r\ncat: .gitmodules: No such file or directory\r\n```\r\ndatalad  0.11.1-143-ga1935397\r\n", "closed_by": {"login": "kyleam", "id": 1297788, "node_id": "MDQ6VXNlcjEyOTc3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1297788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kyleam", "html_url": "https://github.com/kyleam", "followers_url": "https://api.github.com/users/kyleam/followers", "following_url": "https://api.github.com/users/kyleam/following{/other_user}", "gists_url": "https://api.github.com/users/kyleam/gists{/gist_id}", "starred_url": "https://api.github.com/users/kyleam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kyleam/subscriptions", "organizations_url": "https://api.github.com/users/kyleam/orgs", "repos_url": "https://api.github.com/users/kyleam/repos", "events_url": "https://api.github.com/users/kyleam/events{/privacy}", "received_events_url": "https://api.github.com/users/kyleam/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/3139/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/3139/timeline", "performed_via_github_app": null}