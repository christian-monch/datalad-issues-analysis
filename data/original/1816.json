{"url": "https://api.github.com/repos/datalad/datalad/issues/1816", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/1816/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/1816/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/1816/events", "html_url": "https://github.com/datalad/datalad/issues/1816", "id": 256425177, "node_id": "MDU6SXNzdWUyNTY0MjUxNzc=", "number": 1816, "title": "Store list of filenames in metadata to enable full identification of matching from from superdatasets", "user": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 63778594, "node_id": "MDU6TGFiZWw2Mzc3ODU5NA==", "url": "https://api.github.com/repos/datalad/datalad/labels/question", "name": "question", "color": "fbca04", "default": true, "description": "Issue asks a question rather than reporting a problem"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-09-09T08:46:45Z", "updated_at": "2017-10-08T07:14:34Z", "closed_at": "2017-10-08T07:14:34Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "One central issue of our recent discussion on metadata was the case of file look-up when a particular target dataset is still unknown, or unavailable.\r\n\r\nIn particular it was the issue of our inability to report exact filenames matching metadata records, when these records define the associated subset of file via a regex. Being able to report matching filenames is desirable, because this output can be used directly in subsequent processing (within datalad, e.g. `get`), or 3rd-party code.\r\n\r\nOne approach to make this happen would be to store a full list of filenames for each dataset in its aggregated metadata. More precisely, NOT storing metadata per file, but store a separate plain list of filenames for the purpose of resolving regex to concrete filename matches.\r\n\r\nTo check the feasibility of this approach I produced such a list for the entire super-dataset from datasets.d.o:\r\n\r\n```sh\r\n% find -H . -type f,l ! -path '*/.git/*' -a ! -path '*/.datalad/*' > filenames.txt\r\nfind -H . -type f,l ! -path '*/.git/*' -a ! -path '*/.datalad/*' >   5.27s user 31.69s system 91% cpu 40.346 total\r\n% gzip -9 -c filenames.txt > files.gz\r\n% du -sh file*\r\n85M\tfilenames.txt\r\n3.9M\tfiles.gz\r\n% wc -l < filenames.txt\r\n1208830\r\n```\r\n\r\nSo we have 1.2M files and would need to carry a total of 4MB of additional metadata combined across all datasets.\r\n\r\nNote, that in my demo I store filenames with full paths down from the top-most superdataset (which we would not do, but store only filenames relative to the root of each respective dataset).\r\n\r\nAlso note, that such additional metadata storage does not live in Git (but is annexed), could be obtained on demand when such lookup is needed, and could be as much compressed as necessary. Likewise, there would be no single file, but, as with the other metadata, one file with filenames per dataset in the metadata object store of the superdataset.\r\n\r\nI think this is a pretty good deal.", "closed_by": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/1816/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/1816/timeline", "performed_via_github_app": null}