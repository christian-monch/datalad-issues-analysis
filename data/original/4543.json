{"url": "https://api.github.com/repos/datalad/datalad/issues/4543", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/4543/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/4543/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/4543/events", "html_url": "https://github.com/datalad/datalad/pull/4543", "id": 619241441, "node_id": "MDExOlB1bGxSZXF1ZXN0NDE4ODA1MTcy", "number": 4543, "title": "BF: http - fix handling of fetched in bytes content, re-enable testing using httpretty", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/datalad/datalad/milestones/74", "html_url": "https://github.com/datalad/datalad/milestone/74", "labels_url": "https://api.github.com/repos/datalad/datalad/milestones/74/labels", "id": 5341727, "node_id": "MDk6TWlsZXN0b25lNTM0MTcyNw==", "number": 74, "title": "0.12.7", "description": "", "creator": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 11, "state": "closed", "created_at": "2020-04-23T15:41:13Z", "updated_at": "2020-05-26T17:55:20Z", "due_on": null, "closed_at": "2020-05-26T17:55:20Z"}, "comments": 1, "created_at": "2020-05-15T20:49:01Z", "updated_at": "2020-05-21T17:40:54Z", "closed_at": "2020-05-16T13:42:58Z", "author_association": "MEMBER", "active_lock_reason": null, "pull_request": {"url": "https://api.github.com/repos/datalad/datalad/pulls/4543", "html_url": "https://github.com/datalad/datalad/pull/4543", "diff_url": "https://github.com/datalad/datalad/pull/4543.diff", "patch_url": "https://github.com/datalad/datalad/pull/4543.patch"}, "body": "absorbs #4540 . \r\n\r\nIndividual commits provide more info but here is two major summaries:\r\n\r\ncommit d366600f04c3f9739e75a6ba66a9feae76cfb651\r\n\r\n    ENH: reenable testing using httpretty (and other tests)\r\n    \r\n    Apparently we had the entire test_http disabled due to httpretty not supporting\r\n    python3 in the past.  That masked some bugs in our code which need to be fixed up\r\n    (done in prior commit) and minimal compatible version of httpretty\r\n    verified.\r\n    \r\n    0.9.4 seems to work fine for me in conda environments with python 3.6\r\n    and 3.8.\r\n    \r\n    The only leftover inconvenience (does not cause failed tests) is a\r\n    complaint from cookies upon exit:\r\n    https://github.com/datalad/datalad/issues/4542\r\n\r\ncommit 3b55eb4e9d23fc22d175b0cfa9f1a8320b2258be\r\n\r\n    BF(TST): http - compare content to bytes not string\r\n    \r\n    In https://github.com/datalad/datalad/pull/3210 (specifically\r\n    622cada63d1876627c75fde8af2da862494f2b15) we stopped decoding\r\n    fetched content while checking the status.  It was initially triggered\r\n    within datalad-crawler pipelines and has further discussion on\r\n    https://github.com/datalad/datalad-crawler/pull/9 .  So tests should\r\n    compare to bytes not strings if not explicitly decoding.\r\n    \r\n    Situation got grave with the entire test module being disabled due to\r\n    httpretty at those times not supporting python3. That lead to these\r\n    lines not exercised at all.  This PR series includes one more fix\r\n    addressing switch from string to bytes for content and also enables\r\n    back testing using httpretty.", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/4543/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/4543/timeline", "performed_via_github_app": null}