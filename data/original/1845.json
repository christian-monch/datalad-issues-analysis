{"url": "https://api.github.com/repos/datalad/datalad/issues/1845", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/1845/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/1845/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/1845/events", "html_url": "https://github.com/datalad/datalad/pull/1845", "id": 258838414, "node_id": "MDExOlB1bGxSZXF1ZXN0MTQxODYyMzUx", "number": 1845, "title": "BF: towards fixing v6 (and may be direct mode)", "user": {"login": "bpoldrack", "id": 10498301, "node_id": "MDQ6VXNlcjEwNDk4MzAx", "avatar_url": "https://avatars.githubusercontent.com/u/10498301?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bpoldrack", "html_url": "https://github.com/bpoldrack", "followers_url": "https://api.github.com/users/bpoldrack/followers", "following_url": "https://api.github.com/users/bpoldrack/following{/other_user}", "gists_url": "https://api.github.com/users/bpoldrack/gists{/gist_id}", "starred_url": "https://api.github.com/users/bpoldrack/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bpoldrack/subscriptions", "organizations_url": "https://api.github.com/users/bpoldrack/orgs", "repos_url": "https://api.github.com/users/bpoldrack/repos", "events_url": "https://api.github.com/users/bpoldrack/events{/privacy}", "received_events_url": "https://api.github.com/users/bpoldrack/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2017-09-19T14:19:00Z", "updated_at": "2018-07-15T02:38:02Z", "closed_at": "2017-10-04T16:34:49Z", "author_association": "MEMBER", "active_lock_reason": null, "pull_request": {"url": "https://api.github.com/repos/datalad/datalad/pulls/1845", "html_url": "https://github.com/datalad/datalad/pull/1845", "diff_url": "https://github.com/datalad/datalad/pull/1845.diff", "patch_url": "https://github.com/datalad/datalad/pull/1845.patch"}, "body": "- [x] set up test repos differently to not artificially complicate things for v6 builds (at least partially done):  annexed file in test repo now has different content to not collide with a file under git\r\n- [x] ~fix remote testrepo on github, which is invalid now (see above)~\r\nCan't be done. We can not have a simple annex on github. More complex setup with additional storage elsewhere doesn't serve the needs for a basic testrepo. To be done separatly; see #1826 \r\n- [x] new decorators to be able to distinguish whether we want to skip a test in v6/DM build because it needs fixing or because it doesn't make sense in that mode\r\n- [x] decorators to allow to either skip or not skip known failures\r\n- [x] decorators to allow to probe whether or not a known failure is still failing as suggested in PR #1789\r\n- [x] actually make use of those decorators\r\n- [x] add Travis builds to use the functionality\r\n- [x] don't use empty env vars to define Travis' matrix\r\n- [x] add defaults to `datalad.repo.direct` and `datalad.repo.version`\r\n- [x] make sure the defaults above don't conflict with annex-enforced direct mode\r\n- [x] ~make known failure decorators work with generator tests (apparently only first `yield` is considered or sth like this)~\r\nWon't easily work that way. Probably need to decorate the failing `yield`'s instead as already done in `datalad/interface/tests/test_crawl_init.py`.\r\n- [x] improve and enhance implementation of `datalad unlock`, the errors of which came to attention after solving #1854; Note: Not to be enitrely done in this PR, due to #1860\r\n\r\n**Summary regarding changes to known failure decorators:**\r\nThere are several decorators in `tests/utils.py` now:\r\n - `skip_v6` and `skip_direct_mode` for skipping the decorated tests in those builds, since those tests might make no sense (like testing direct mode switches in v6 build, which isn't possible)\r\n - `known_failure`, `known_failure_v6` and `known_failure_direct_mode` to mark tests, that are are known to fail (always/in v6 build/in DM build) and need some fixing\r\n\r\nBehavior of the latter can be tuned via `datalad.tests.knownfailures.skip` (default: True) and `datalad.tests.knownfailures.probe` (default: False). Skipping takes precedence over probing. If not skipped and not probed those tests will yield the actual failure. If not skipped but probed those tests will pass if they still fail and vice versa. This is used in the new Travis builds to see, whether some of them were (may be implicitly) fixed but still marked as known to fail.\r\n\r\n**New Travis builds**\r\nThere are two new builds probing the known failures in v6 and direct mode. That way we automatically get a hint on what might have been (implicitly) fixed. However, those builds are allowed to fail, since a failure means, that a test actually passed but was marked \"known to fail\". So it's no harm to master and shouldn't prevent anything from being merged. Furthermore there are some weird tests, that don't always fail, which in return might lead to a failing probing. This hopefully will become better once some basic issues (like the testrepo mess) are fixed.", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/1845/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/1845/timeline", "performed_via_github_app": null}