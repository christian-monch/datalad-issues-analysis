{"url": "https://api.github.com/repos/datalad/datalad/issues/212", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/212/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/212/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/212/events", "html_url": "https://github.com/datalad/datalad/issues/212", "id": 106711764, "node_id": "MDU6SXNzdWUxMDY3MTE3NjQ=", "number": 212, "title": "Tests fail when Debian package is built on offline system", "user": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 63778590, "node_id": "MDU6TGFiZWw2Mzc3ODU5MA==", "url": "https://api.github.com/repos/datalad/datalad/labels/severity-normal", "name": "severity-normal", "color": "ff8888", "default": false, "description": "standard severity"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2015-09-16T06:56:22Z", "updated_at": "2015-09-18T06:08:00Z", "closed_at": "2015-09-18T06:08:00Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Here is the pattern:\n\n```\nmake[2]: Leaving directory '/home/mih/hacking/datalad/git'\nPATH=/home/mih/hacking/datalad/git/bin:$PATH dh_auto_test\n    pybuild --test --test-nose -i python{version} -p 2.7 --dir .\nI: pybuild base:170: cd /home/mih/hacking/datalad/git/.pybuild/pythonX.Y_2.7/build; python2.7 -m nose \n.E....E.........................SS............S......S...........SS.............................S.....S.......S........S......EEEEEEEEEEEEEEEE.S..............S...............EEEEEE...........\n```\n\nexample failure:\n\n```\n======================================================================\nERROR: datalad.tests.test_main.test_page2annex_same_incoming_and_public('relaxed',)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/usr/lib/python2.7/dist-packages/nose/case.py\", line 197, in runTest\n    self.test(*self.arg)\n  File \"/home/mih/hacking/datalad/git/.pybuild/pythonX.Y_2.7/build/datalad/tests/utils.py\", line 223, in newfunc\n    t(*(arg + (d,)), **kw)\n  File \"/home/mih/hacking/datalad/git/.pybuild/pythonX.Y_2.7/build/datalad/tests/utils.py\", line 288, in newfunc\n    tfunc(*(args + (path, url)), **kwargs)\n  File \"/home/mih/hacking/datalad/git/.pybuild/pythonX.Y_2.7/build/datalad/tests/test_main.py\", line 89, in check_page2annex_same_incoming_and_public\n    stats1_dry = drepo.page2annex(dry_run=True)\n  File \"/home/mih/hacking/datalad/git/.pybuild/pythonX.Y_2.7/build/datalad/crawler/main.py\", line 163, in page2annex\n    urls_all = collect_urls(top_url, recurse=scfg['recurse'], hot_cache=hot_cache, cache=cache)\n  File \"/home/mih/hacking/datalad/git/.pybuild/pythonX.Y_2.7/build/datalad/support/network.py\", line 196, in collect_urls\n    page = (hot_cache and hot_cache.get(url, None)) or fetch_page(url, cache=cache)\n  File \"/home/mih/hacking/datalad/git/.pybuild/pythonX.Y_2.7/build/datalad/support/network.py\", line 115, in fetch_page\n    return _fetch_page(url, retries=retries)\n  File \"/home/mih/hacking/datalad/git/.pybuild/pythonX.Y_2.7/build/datalad/support/network.py\", line 98, in _fetch_page\n    openurl = retry_urlopen(url, retries=retries)\n  File \"/home/mih/hacking/datalad/git/.pybuild/pythonX.Y_2.7/build/datalad/support/network.py\", line 86, in retry_urlopen\n    return urlopen(url)\n  File \"/usr/lib/python2.7/urllib2.py\", line 154, in urlopen\n    return opener.open(url, data, timeout)\n  File \"/usr/lib/python2.7/urllib2.py\", line 431, in open\n    response = self._open(req, data)\n  File \"/usr/lib/python2.7/urllib2.py\", line 449, in _open\n    '_open', req)\n  File \"/usr/lib/python2.7/urllib2.py\", line 409, in _call_chain\n    result = func(*args)\n  File \"/usr/lib/python2.7/urllib2.py\", line 1227, in http_open\n    return self.do_open(httplib.HTTPConnection, req)\n  File \"/usr/lib/python2.7/urllib2.py\", line 1197, in do_open\n    raise URLError(err)\nURLError: <urlopen error [Errno 111] Connection refused>\n-------------------- >> begin captured logging << --------------------\ndatalad.network: WARNING: Received exception while reading http://127.0.0.1:22310/: <urlopen error [Errno 111] Connection refused>\ndatalad.network: WARNING: Received exception while reading http://127.0.0.1:22310/: <urlopen error [Errno 111] Connection refused>\ndatalad.network: WARNING: Received exception while reading http://127.0.0.1:22310/: <urlopen error [Errno 111] Connection refused>\n--------------------- >> end captured logging << ---------------------\n```\n\nThe same tests work fine, even when offline, when ran outside a package build (i.e. `dpkg-buildpackage`).\n\nNo idea yet....\n", "closed_by": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/212/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/212/timeline", "performed_via_github_app": null}