{"url": "https://api.github.com/repos/datalad/datalad/issues/5144", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/5144/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/5144/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/5144/events", "html_url": "https://github.com/datalad/datalad/issues/5144", "id": 740700040, "node_id": "MDU6SXNzdWU3NDA3MDAwNDA=", "number": 5144, "title": "datalad push and datalad get via https from / to a public gin remote does not work as expected!", "user": {"login": "lnnrtwttkhn", "id": 42233065, "node_id": "MDQ6VXNlcjQyMjMzMDY1", "avatar_url": "https://avatars.githubusercontent.com/u/42233065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lnnrtwttkhn", "html_url": "https://github.com/lnnrtwttkhn", "followers_url": "https://api.github.com/users/lnnrtwttkhn/followers", "following_url": "https://api.github.com/users/lnnrtwttkhn/following{/other_user}", "gists_url": "https://api.github.com/users/lnnrtwttkhn/gists{/gist_id}", "starred_url": "https://api.github.com/users/lnnrtwttkhn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lnnrtwttkhn/subscriptions", "organizations_url": "https://api.github.com/users/lnnrtwttkhn/orgs", "repos_url": "https://api.github.com/users/lnnrtwttkhn/repos", "events_url": "https://api.github.com/users/lnnrtwttkhn/events{/privacy}", "received_events_url": "https://api.github.com/users/lnnrtwttkhn/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 2767220159, "node_id": "MDU6TGFiZWwyNzY3MjIwMTU5", "url": "https://api.github.com/repos/datalad/datalad/labels/cmd-push", "name": "cmd-push", "color": "FEF2C0", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2020-11-11T11:39:47Z", "updated_at": "2021-07-22T17:01:28Z", "closed_at": "2021-07-22T17:01:27Z", "author_association": "NONE", "active_lock_reason": null, "body": "#### What is the problem?\r\n\r\nTwo problems:\r\n\r\n1. `datalad push` annexed files to a `gin` remote does not work on first try, but only on second\r\n2. To `datalad get` an annexed file from [a public `gin` remote](https://gin.g-node.org/lnnrtwttkhn/gin-remote-test) does not work, in my case\r\n\r\n#### What steps will reproduce the problem?\r\n\r\n1. First, I create an example repo, called `gin-remote-test`\r\n\r\n```bash\r\nlip-osx-003854:Desktop wittkuhn$ datalad create -c text2git gin-remote-test\r\n[INFO   ] Creating a new annex repo at /Users/wittkuhn/Desktop/gin-remote-test \r\n[INFO   ] Scanning for unlocked files (this may take some time) \r\n[INFO   ] Running procedure cfg_text2git \r\n[INFO   ] == Command start (output follows) ===== \r\n[INFO   ] == Command exit (modification check follows) ===== \r\ncreate(ok): /Users/wittkuhn/Desktop/gin-remote-test (dataset)\r\n```\r\n\r\n2. I `cd` into the dataset and add a file to be annexed:\r\n\r\n```bash\r\nlip-osx-003854:Desktop wittkuhn$ cd gin-remote-test\r\nlip-osx-003854:gin-remote-test wittkuhn$ wget https://imgs.xkcd.com/comics/compiling.png\r\n--2020-11-11 12:16:59--  https://imgs.xkcd.com/comics/compiling.png\r\nResolving imgs.xkcd.com (imgs.xkcd.com)... 2a04:4e42:3::67, 151.101.12.67\r\nConnecting to imgs.xkcd.com (imgs.xkcd.com)|2a04:4e42:3::67|:443... connected.\r\nHTTP request sent, awaiting response... 200 OK\r\nLength: 28315 (28K) [image/png]\r\nSaving to: \u2018compiling.png\u2019\r\n\r\ncompiling.png                               100%[===========================================================================================>]  27.65K  --.-KB/s    in 0.001s  \r\n\r\n2020-11-11 12:17:00 (21.4 MB/s) - \u2018compiling.png\u2019 saved [28315/28315]\r\n```\r\n\r\n3. I save the file:\r\n\r\n```bash\r\nlip-osx-003854:gin-remote-test wittkuhn$ datalad status\r\nuntracked: compiling.png (file)\r\nlip-osx-003854:gin-remote-test wittkuhn$ datalad save -m \"add funny phd comic\"\r\nadd(ok): compiling.png (file)\r\nsave(ok): . (dataset)\r\naction summary:\r\n  add (ok: 1)\r\n  save (ok: 1)\r\n```\r\n\r\n4. I add the `gin` sibling:\r\n\r\n```bash\r\nlip-osx-003854:gin-remote-test wittkuhn$ datalad siblings add -s gin --url git@gin.g-node.org:/lnnrtwttkhn/gin-remote-test.git\r\n[INFO   ] Could not enable annex remote gin. This is expected if gin is a pure Git remote, or happens if it is not accessible. \r\n[WARNING] Could not detect whether gin carries an annex. If gin is a pure Git remote, this is expected.  \r\n.: gin(-) [git@gin.g-node.org:/lnnrtwttkhn/gin-remote-test.git (git)]\r\n```\r\n\r\n5. I push to the `gin` sibling:\r\n\r\n```bash\r\nlip-osx-003854:gin-remote-test wittkuhn$ datalad push --to gin\r\npublish(ok): . (dataset) [refs/heads/master->gin:refs/heads/master [new branch]]                                                                                                \r\npublish(ok): . (dataset) [refs/heads/git-annex->gin:refs/heads/git-annex [new branch]]\r\n```\r\n\r\n6. I want to remove the dataset locally but datalad doesn't let me:\r\n \r\n```bash                                                          \r\nlip-osx-003854:gin-remote-test wittkuhn$ cd ..\r\nlip-osx-003854:Desktop wittkuhn$ datalad remove gin-remote-test\r\n[WARNING] Running drop resulted in stderr output: git-annex: drop: 1 failed\r\n \r\n[ERROR  ] unsafe; Could only verify the existence of 0 out of 1 necessary copies; Rather than dropping this file, try using: git annex move; (Use --force to override this check, or adjust numcopies.) [drop(/Users/wittkuhn/Desktop/gin-remote-test/compiling.png)] \r\ndrop(error): /Users/wittkuhn/Desktop/gin-remote-test/compiling.png (file) [unsafe; Could only verify the existence of 0 out of 1 necessary copies; Rather than dropping this file, try using: git annex move; (Use --force to override this check, or adjust numcopies.)]\r\n[WARNING] could not drop some content in /Users/wittkuhn/Desktop/gin-remote-test ['/Users/wittkuhn/Desktop/gin-remote-test/compiling.png'] [drop(/Users/wittkuhn/Desktop/gin-remote-test)] \r\ndrop(impossible): /Users/wittkuhn/Desktop/gin-remote-test (directory) [could not drop some content in /Users/wittkuhn/Desktop/gin-remote-test ['/Users/wittkuhn/Desktop/gin-remote-test/compiling.png']]\r\naction summary:\r\n  drop (error: 1, impossible: 1)\r\n```\r\n\r\n7. I verify that the `gin\u00b4 siblings has been configured:\r\n\r\n```bash   \r\nlip-osx-003854:Desktop wittkuhn$ cd gin-remote-test/\r\nlip-osx-003854:gin-remote-test wittkuhn$ datalad siblings\r\n.: here(+) [git]\r\n.: gin(+) [git@gin.g-node.org:/lnnrtwttkhn/gin-remote-test.git (git)]\r\n```\r\n\r\n8. @adswa suggested to `datalad push` again:\r\n\r\n```bash \r\nlip-osx-003854:gin-remote-test wittkuhn$ \r\nlip-osx-003854:gin-remote-test wittkuhn$ datalad push --to gin\r\ncopy(ok): compiling.png (file) [to gin...]                                                                                        \r\npublish(ok): . (dataset) [refs/heads/git-annex->gin:refs/heads/git-annex 266bb58..6270041]\r\n```\r\n\r\n**Only now are the annexed files transferred to `gin`**\r\n\r\n9. Now I can remove the dataset:\r\n\r\n```bash                \r\nlip-osx-003854:gin-remote-test wittkuhn$ cd ..                                                                                    \r\nlip-osx-003854:Desktop wittkuhn$ datalad remove gin-remote-test\r\ndrop(ok): /Users/wittkuhn/Desktop/gin-remote-test/compiling.png (file) [locking gin...]\r\ndrop(ok): /Users/wittkuhn/Desktop/gin-remote-test (directory)\r\nremove(ok): /Users/wittkuhn/Desktop/gin-remote-test (dataset)\r\naction summary:\r\n  drop (ok: 2)\r\n  remove (ok: 1)\r\n```\r\n\r\n10. Now I want to clone the dataset again using `https`:\r\n\r\n```bash\r\nlip-osx-003854:Desktop wittkuhn$ datalad clone https://gin.g-node.org/lnnrtwttkhn/gin-remote-test.git\r\n[INFO   ] Scanning for unlocked files (this may take some time)                                                                   \r\n[INFO   ] Remote origin not usable by git-annex; setting annex-ignore                                                             \r\ninstall(ok): /Users/wittkuhn/Desktop/gin-remote-test (dataset)\r\nlip-osx-003854:Desktop wittkuhn$ cd gin-remote-test/\r\n```\r\n\r\n11. Trying to get the annexed files, fails:\r\n\r\n```bash\r\nlip-osx-003854:gin-remote-test wittkuhn$ datalad get compiling.png \r\n[WARNING] Running get resulted in stderr output: git-annex: get: 1 failed\r\n \r\n[ERROR  ] not available; Try making some of these repositories available:; \t29a79f17-c2cb-4f96-ac46-c219c0dbe5ba -- wittkuhn@lip-osx-003854:~/Desktop/gin-remote-test;  \tf2995656-181f-4406-b4d7-05a3d25072cd -- git@b71abff825ef:/data/repos/lnnrtwttkhn/gin-remote-test.git; ; (Note that these git remotes have annex-ignore set: origin) [get(/Users/wittkuhn/Desktop/gin-remote-test/compiling.png)] \r\nget(error): compiling.png (file) [not available; Try making some of these repositories available:; \t29a79f17-c2cb-4f96-ac46-c219c0dbe5ba -- wittkuhn@lip-osx-003854:~/Desktop/gin-remote-test;  \tf2995656-181f-4406-b4d7-05a3d25072cd -- git@b71abff825ef:/data/repos/lnnrtwttkhn/gin-remote-test.git; ; (Note that these git remotes have annex-ignore set: origin)]\r\nlip-osx-003854:gin-remote-test wittkuhn$ \r\n```\r\n\r\n#### What version of DataLad are you using (run `datalad --version`)? On what operating system (consider running `datalad wtf`)?\r\n\r\n```bash\r\n$ datalad --version\r\ndatalad 0.13.0\r\n```\r\n\r\nI'm on macOS Mojave, 10.14.6\r\n\r\n#### Is there anything else that would be useful to know in this context?\r\n\r\nThe public `gin` sibling is accessible here: https://gin.g-node.org/lnnrtwttkhn/gin-remote-test\r\n\r\n#### Have you had any success using DataLad before? (to assess your expertise/prior luck.  We would welcome your testimonial additions to https://github.com/datalad/datalad/wiki/Testimonials as well)\r\n\r\nYes, datalad is an amazing tool!\r\n", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/5144/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/5144/timeline", "performed_via_github_app": null}