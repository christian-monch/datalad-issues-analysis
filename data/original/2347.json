{"url": "https://api.github.com/repos/datalad/datalad/issues/2347", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/2347/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/2347/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/2347/events", "html_url": "https://github.com/datalad/datalad/pull/2347", "id": 308630396, "node_id": "MDExOlB1bGxSZXF1ZXN0MTgyNDg1MDU5", "number": 2347, "title": "[FROM to TO] in autofield mode syntax is textual, not numeric - how could we force numeric?", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 700886055, "node_id": "MDU6TGFiZWw3MDA4ODYwNTU=", "url": "https://api.github.com/repos/datalad/datalad/labels/metadata", "name": "metadata", "color": "0052cc", "default": false, "description": ""}, {"id": 1453907298, "node_id": "MDU6TGFiZWwxNDUzOTA3Mjk4", "url": "https://api.github.com/repos/datalad/datalad/labels/stale-PR-closed-without-merge", "name": "stale-PR-closed-without-merge", "color": "ffffff", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 13, "created_at": "2018-03-26T15:51:17Z", "updated_at": "2019-07-17T05:36:42Z", "closed_at": "2019-07-17T05:34:47Z", "author_association": "MEMBER", "active_lock_reason": null, "pull_request": {"url": "https://api.github.com/repos/datalad/datalad/pulls/2347", "html_url": "https://github.com/datalad/datalad/pull/2347", "diff_url": "https://github.com/datalad/datalad/pull/2347.diff", "patch_url": "https://github.com/datalad/datalad/pull/2347.patch"}, "body": "#### What is the problem?\r\ndidn't yet check where the culprit (aggregation or metadata), just wanted to  document the disparity I ran into while giving a demo here.  There is 35 subjects in ds000238 and everyone has an anatomical T1w,  but search returns only 18 of them\r\n```shell\r\n$> datalad search --max-nresults 0 --mode autofield bids.participant.age(years):'[1 TO 200]' bids.type:t1w type:file | grep 00238 | sort | nl\r\n[INFO] Query completed in 0.289693117142 sec. Reporting all matches. \r\n     1\tsearch(ok): openfmri/ds000238/sub-01/anat/sub-01_T1w.nii.gz (file)\r\n     2\tsearch(ok): openfmri/ds000238/sub-02/anat/sub-02_T1w.nii.gz (file)\r\n     3\tsearch(ok): openfmri/ds000238/sub-03/anat/sub-03_T1w.nii.gz (file)\r\n     4\tsearch(ok): openfmri/ds000238/sub-05/anat/sub-05_T1w.nii.gz (file)\r\n     5\tsearch(ok): openfmri/ds000238/sub-06/anat/sub-06_T1w.nii.gz (file)\r\n     6\tsearch(ok): openfmri/ds000238/sub-07/anat/sub-07_T1w.nii.gz (file)\r\n     7\tsearch(ok): openfmri/ds000238/sub-08/anat/sub-08_T1w.nii.gz (file)\r\n     8\tsearch(ok): openfmri/ds000238/sub-09/anat/sub-09_T1w.nii.gz (file)\r\n     9\tsearch(ok): openfmri/ds000238/sub-10/anat/sub-10_T1w.nii.gz (file)\r\n    10\tsearch(ok): openfmri/ds000238/sub-12/anat/sub-12_T1w.nii.gz (file)\r\n    11\tsearch(ok): openfmri/ds000238/sub-13/anat/sub-13_T1w.nii.gz (file)\r\n    12\tsearch(ok): openfmri/ds000238/sub-16/anat/sub-16_T1w.nii.gz (file)\r\n    13\tsearch(ok): openfmri/ds000238/sub-21/anat/sub-21_T1w.nii.gz (file)\r\n    14\tsearch(ok): openfmri/ds000238/sub-24/anat/sub-24_T1w.nii.gz (file)\r\n    15\tsearch(ok): openfmri/ds000238/sub-29/anat/sub-29_T1w.nii.gz (file)\r\n    16\tsearch(ok): openfmri/ds000238/sub-30/anat/sub-30_T1w.nii.gz (file)\r\n    17\tsearch(ok): openfmri/ds000238/sub-31/anat/sub-31_T1w.nii.gz (file)\r\n    18\tsearch(ok): openfmri/ds000238/sub-33/anat/sub-33_T1w.nii.gz (file)\r\n(dev) 1 10443.....................................:Mon 26 Mar 2018 11:42:15 AM EDT:.\r\n(git-annex)hopa:~/datalad-meta6-4[master]git\r\n$> nl openfmri/ds000238/participants.tsv   \r\n     1\tparticipant_id\tage\tsex\thandedness\tdesign_order1\tdesign_order2\tdesign_order3\tdesign_order4\tdesign_order5\r\n     2\tsub-01\t20\tM\tRight\tslow12\tmed8\tquick6\tquick4n\tslow10\r\n     3\tsub-02\t19\tF\tRight\tslow10\tslow12\tmed8\tquick6\tquick4n\r\n     4\tsub-03\t19\tF\tRight\tmed8\tquick4n\tslow10\tslow12\tquick6\r\n     5\tsub-04\t21\tM\tRight\tquick4n\tquick6\tslow12\tslow10\tmed8\r\n     6\tsub-05\t19\tM\tRight\tquick6\tslow10\tquick4n\tmed8\tslow12\r\n     7\tsub-06\t19\tM\tRight\tslow12\tmed8\tquick6\tquick4n\tslow10\r\n     8\tsub-07\t19\tM\tRight\tmed8\tquick4n\tslow10\tslow12\tquick6\r\n     9\tsub-08\t18\tF\tRight\tquick4n\tquick6\tslow12\tslow10\tmed8\r\n    10\tsub-09\t19\tF\tRight\tquick6\tslow10\tquick4n\tmed8\tslow12\r\n    11\tsub-10\t20\tF\tRight\tslow12\tmed8\tquick6\tquick4n\tslow10\r\n    12\tsub-11\t21\tM\tRight\tslow10\tslow12\tmed8\tquick6\tquick4n\r\n    13\tsub-12\t19\tF\tRight\tmed8\tquick4n\tslow10\tslow12\tquick6\r\n    14\tsub-13\t19\tM\tRight\tquick4n\tquick6\tslow12\tslow10\tmed8\r\n    15\tsub-14\t27\tM\tRight\tquick6\tslow10\tquick4n\tmed8\tslow12\r\n    16\tsub-15\t22\tF\tRight\tslow12\tmed8\tquick6\tquick4n\tslow10\r\n    17\tsub-16\t19\tM\tRight\tmed8\tquick4n\tslow10\tslow12\tquick6\r\n    18\tsub-17\t32\tM\tRight\tquick4n\tquick6\tslow12\tslow10\tmed8\r\n    19\tsub-18\t35\tF\tRight\tquick6\tslow10\tquick4n\tmed8\tslow12\r\n    20\tsub-19\t25\tM\tRight\tslow12\tmed8\tquick6\tquick4n\tslow10\r\n    21\tsub-20\t27\tM\tRight\tslow10\tslow12\tmed8\tquick6\tquick4n\r\n    22\tsub-21\t20\tM\tRight\tmed8\tquick4n\tslow10\tslow12\tquick6\r\n    23\tsub-22\t26\tM\tRight\tquick4n\tquick6\tslow12\tslow10\tmed8\r\n    24\tsub-23\t21\tM\tRight\tquick6\tslow10\tquick4n\tmed8\tslow12\r\n    25\tsub-24\t19\tF\tRight\tslow12\tmed8\tquick6\tquick4n\tslow10\r\n    26\tsub-25\t22\tM\tRight\tmed8\tquick4n\tslow10\tslow12\tquick6\r\n    27\tsub-26\t21\tF\tRight\tquick4n\tquick6\tslow12\tslow10\tmed8\r\n    28\tsub-27\t23\tM\tRight\tquick6\tslow10\tquick4n\tmed8\tslow12\r\n    29\tsub-28\t21\tF\tRight\tslow12\tmed8\tquick6\tquick4n\tslow10\r\n    30\tsub-29\t18\tF\tRight\tslow10\tslow12\tmed8\tquick6\tquick4n\r\n    31\tsub-30\t19\tF\tRight\tmed8\tquick4n\tslow10\tslow12\tquick6\r\n    32\tsub-31\t20\tF\tRight\tquick4n\tquick6\tslow12\tslow10\tmed8\r\n    33\tsub-32\t21\tF\tRight\tquick6\tslow10\tquick4n\tmed8\tslow12\r\n    34\tsub-33\t20\tF\tRight\tslow12\tmed8\tquick6\tquick4n\tslow10\r\n    35\tsub-34\t21\tF\tRight\tslow10\tslow12\tmed8\tquick6\tquick4n\r\n    36\tsub-35\t24\tM\tRight\tmed8\tquick4n\tslow10\tslow12\tquick6\r\n\r\n$> git describe --always\r\n37d37c3\r\n```\r\neven after I downloaded all those T1ws locally and reaggregated, which caused index rebuild -- the same result:\r\n```shell\r\n$> datalad --report-status failure get sub-*/anat/sub-*T1w*       \r\naction summary:                                            \r\n  get (notneeded: 35)\r\n(dev) 1 10457.....................................:Mon 26 Mar 2018 11:48:03 AM EDT:.\r\n(git-annex)hopa:~/datalad-meta6-4/openfmri/ds000238[master]git\r\n$> datalad search --max-nresults 0 --mode autofield bids.participant.age(years):'[1 TO 200]' bids.type:t1w type:file | nl                                                                                                       [INFO] Query completed in 0.00402283668518 sec. Reporting all matches. \r\n     1\tsearch(ok): sub-08/anat/sub-08_T1w.nii.gz (file)\r\n     2\tsearch(ok): sub-29/anat/sub-29_T1w.nii.gz (file)\r\n     3\tsearch(ok): sub-31/anat/sub-31_T1w.nii.gz (file)\r\n     4\tsearch(ok): sub-10/anat/sub-10_T1w.nii.gz (file)\r\n     5\tsearch(ok): sub-21/anat/sub-21_T1w.nii.gz (file)\r\n     6\tsearch(ok): sub-33/anat/sub-33_T1w.nii.gz (file)\r\n     7\tsearch(ok): sub-01/anat/sub-01_T1w.nii.gz (file)\r\n     8\tsearch(ok): sub-06/anat/sub-06_T1w.nii.gz (file)\r\n     9\tsearch(ok): sub-02/anat/sub-02_T1w.nii.gz (file)\r\n    10\tsearch(ok): sub-13/anat/sub-13_T1w.nii.gz (file)\r\n    11\tsearch(ok): sub-24/anat/sub-24_T1w.nii.gz (file)\r\n    12\tsearch(ok): sub-09/anat/sub-09_T1w.nii.gz (file)\r\n    13\tsearch(ok): sub-05/anat/sub-05_T1w.nii.gz (file)\r\n    14\tsearch(ok): sub-03/anat/sub-03_T1w.nii.gz (file)\r\n    15\tsearch(ok): sub-12/anat/sub-12_T1w.nii.gz (file)\r\n    16\tsearch(ok): sub-30/anat/sub-30_T1w.nii.gz (file)\r\n    17\tsearch(ok): sub-16/anat/sub-16_T1w.nii.gz (file)\r\n    18\tsearch(ok): sub-07/anat/sub-07_T1w.nii.gz (file)\r\n    19\taction summary:\r\n    20\t  search (ok: 18)\r\n(dev) 1 10458.....................................:Mon 26 Mar 2018 11:48:08 AM EDT:.\r\n(git-annex)hopa:~/datalad-meta6-4/openfmri/ds000238[master]git\r\n$> datalad aggregate-metadata\r\n[INFO   ] Aggregate metadata for dataset /home/yoh/datalad-meta6-4/openfmri/ds000238 \r\n[WARNING] 1132 files have no content present, skipped metadata extraction for them \r\n[INFO   ] Engage metadata extractors: ['datalad_core', 'nifti1', 'xmp', 'bids'] \r\n/home/yoh/proj/datalad/datalad-master/venvs/dev/local/lib/python2.7/site-packages/grabbit/core.py:410: UserWarning: No valid root directory found for domain 'derivatives'. Falling back on the Layout's root directory. If this isn't the intended behavior, make sure the config file for this domain includes a 'root' key.\r\n  \"'root' key.\" % config['name'])\r\n[INFO   ] Update aggregate metadata in dataset at: /home/yoh/datalad-meta6-4/openfmri/ds000238 \r\naggregate_metadata(ok): /home/yoh/datalad-meta6-4/openfmri/ds000238 (dataset)                                   \r\n[INFO   ] Attempting to save 6 files/datasets \r\nsave(ok): /home/yoh/datalad-meta6-4/openfmri/ds000238 (dataset)\r\naction summary:\r\n  aggregate_metadata (ok: 1)\r\n  save (ok: 1)\r\n(dev) 1 10459.....................................:Mon 26 Mar 2018 11:48:19 AM EDT:.\r\n(git-annex)hopa:~/datalad-meta6-4/openfmri/ds000238[master]git\r\n$> datalad search --max-nresults 0 --mode autofield bids.participant.age(years):'[1 TO 200]' bids.type:t1w type:file | nl\r\n[INFO] Rebuilding search index \r\n[INFO] Search index contains 39 documents \r\n[INFO] Query completed in 0.00181102752686 sec. Reporting all matches. \r\nsearch(ok): sub-08/anat/sub-08_T1w.nii.gz (file)            \r\n     2\tsearch(ok): sub-29/anat/sub-29_T1w.nii.gz (file)\r\n     3\tsearch(ok): sub-10/anat/sub-10_T1w.nii.gz (file)\r\n     4\tsearch(ok): sub-31/anat/sub-31_T1w.nii.gz (file)\r\n     5\tsearch(ok): sub-21/anat/sub-21_T1w.nii.gz (file)\r\n     6\tsearch(ok): sub-33/anat/sub-33_T1w.nii.gz (file)\r\n     7\tsearch(ok): sub-01/anat/sub-01_T1w.nii.gz (file)\r\n     8\tsearch(ok): sub-09/anat/sub-09_T1w.nii.gz (file)\r\n     9\tsearch(ok): sub-30/anat/sub-30_T1w.nii.gz (file)\r\n    10\tsearch(ok): sub-13/anat/sub-13_T1w.nii.gz (file)\r\n    11\tsearch(ok): sub-05/anat/sub-05_T1w.nii.gz (file)\r\n    12\tsearch(ok): sub-16/anat/sub-16_T1w.nii.gz (file)\r\n    13\tsearch(ok): sub-07/anat/sub-07_T1w.nii.gz (file)\r\n    14\tsearch(ok): sub-02/anat/sub-02_T1w.nii.gz (file)\r\n    15\tsearch(ok): sub-03/anat/sub-03_T1w.nii.gz (file)\r\n    16\tsearch(ok): sub-12/anat/sub-12_T1w.nii.gz (file)\r\n    17\tsearch(ok): sub-06/anat/sub-06_T1w.nii.gz (file)\r\n    18\tsearch(ok): sub-24/anat/sub-24_T1w.nii.gz (file)\r\n    19\taction summary:\r\n    20\t  search (ok: 18)\r\n```\r\n#### What version of DataLad are you using (run `datalad --version`)? On what operating system (consider running `datalad wtf`)?\r\n\r\ndatalad 0.9.3-852-g6dfe3d20  from enh-search of #2346 .  pybids is 0.5.1\r\n", "closed_by": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/2347/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/2347/timeline", "performed_via_github_app": null}