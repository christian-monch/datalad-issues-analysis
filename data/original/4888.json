{"url": "https://api.github.com/repos/datalad/datalad/issues/4888", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/4888/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/4888/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/4888/events", "html_url": "https://github.com/datalad/datalad/issues/4888", "id": 694389408, "node_id": "MDU6SXNzdWU2OTQzODk0MDg=", "number": 4888, "title": "Fail to push git-annex branch", "user": {"login": "adswa", "id": 29738718, "node_id": "MDQ6VXNlcjI5NzM4NzE4", "avatar_url": "https://avatars.githubusercontent.com/u/29738718?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adswa", "html_url": "https://github.com/adswa", "followers_url": "https://api.github.com/users/adswa/followers", "following_url": "https://api.github.com/users/adswa/following{/other_user}", "gists_url": "https://api.github.com/users/adswa/gists{/gist_id}", "starred_url": "https://api.github.com/users/adswa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adswa/subscriptions", "organizations_url": "https://api.github.com/users/adswa/orgs", "repos_url": "https://api.github.com/users/adswa/repos", "events_url": "https://api.github.com/users/adswa/events{/privacy}", "received_events_url": "https://api.github.com/users/adswa/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 12, "created_at": "2020-09-06T13:52:40Z", "updated_at": "2020-09-08T09:29:43Z", "closed_at": "2020-09-08T09:29:43Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "EDIT: The issue also affects more standard workflows, see comments below\r\n\r\nI have a dataset with data from a zipped tarball in a datalad-archives special remote (context is in https://github.com/datalad-handbook/book/pull/569#discussion_r483675080).\r\nThe dataset feels fine overall, but I can't push the git-annex branch anymore:\r\n\r\n```\r\ndatalad create some && cd some\r\n\r\n[INFO   ] Creating a new annex repo at /tmp/some \r\ncreate(ok): /tmp/some (dataset)\r\n(handbook) \u256d\u2500adina@muninn /tmp/some on master\r\n\u2570\u2500\u27a4 datalad download-url --archive 'https://s3.amazonaws.com/fast-ai-imageclas/imagenette2-160.tgz'\r\n[INFO   ] Downloading 'https://s3.amazonaws.com/fast-ai-imageclas/imagenette2-160.tgz' into '/tmp/some/' \r\ndownload_url(ok): /tmp/some/imagenette2-160.tgz (file)                                                             \r\nadd(ok): /tmp/some/imagenette2-160.tgz (file)\r\nsave(ok): /tmp/some (dataset)\r\n[INFO   ] Adding content of the archive /tmp/some/imagenette2-160.tgz into annex AnnexRepo(/tmp/some) \r\n[INFO   ] Initiating special remote datalad-archives \r\n[INFO   ] Finished adding /tmp/some/imagenette2-160.tgz: Files processed: 13394, +annex: 13394 \r\naction summary:\r\n  add (ok: 1)\r\n  download_url (ok: 1)\r\n  save (ok: 1)\r\n(handbook) \u256d\u2500adina@muninn /tmp/some on master\r\n\u2570\u2500\u27a4 datalad create-sibling ../anotherplace\r\n\r\n[INFO   ] Considering to create a target dataset /tmp/some at /tmp/anotherplace of localhost \r\n[INFO   ] Fetching updates for Dataset(/tmp/some) \r\n[INFO   ] Adjusting remote git configuration                                                                       \r\n[INFO   ] Running post-update hooks in all created siblings \r\n(handbook) \u256d\u2500adina@muninn /tmp/some on master\r\n\u2570\u2500\u27a4 datalad push --to local\r\ncopy(ok): /tmp/some/imagenette2-160/train/n01440764/ILSVRC2012_val_00000293.JPEG (file) [to local...]              \r\ncopy(ok): /tmp/some/imagenette2-160/train/n01440764/ILSVRC2012_val_00002138.JPEG (file) [to local...]              \r\ncopy(ok): /tmp/some/imagenette2-160/train/n01440764/ILSVRC2012_val_00003014.JPEG (file) [to local...]              \r\ncopy(ok): /tmp/some/imagenette2-160/train/n01440764/ILSVRC2012_val_00006697.JPEG (file) [to local...]              \r\ncopy(ok): /tmp/some/imagenette2-160/train/n01440764/ILSVRC2012_val_00007197.JPEG (file) [to local...]              \r\ncopy(ok): /tmp/some/imagenette2-160/train/n01440764/ILSVRC2012_val_00009346.JPEG (file) [to local...]              \r\ncopy(ok): /tmp/some/imagenette2-160/train/n01440764/ILSVRC2012_val_00009379.JPEG (file) [to local...]              \r\ncopy(ok): /tmp/some/imagenette2-160/train/n01440764/ILSVRC2012_val_00009396.JPEG (file) [to local...]              \r\ncopy(ok): /tmp/some/imagenette2-160/train/n01440764/ILSVRC2012_val_00010306.JPEG (file) [to local...]              \r\ncopy(ok): /tmp/some/imagenette2-160/train/n01440764/ILSVRC2012_val_00011233.JPEG (file) [to local...]              \r\nUpdate availability for 'local':  75%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258a         | 3.00/4.00 [00:00<00:00, 12.7k Steps/s]CommandError: 'git push --progress --porcelain local refs/heads/git-annex:refs/heads/git-annex git-annex:git-annex' failed with exitcode 1 under /tmp/some\r\nerror: dst ref refs/heads/git-annex receives from more than one src.\r\nerror: failed to push some refs to '/tmp/anotherplace'\r\n\r\n```\r\n\r\nEven though the final push takes quite a while, nothing gets transferred to the sibling - the sibling is a Git repository with no commits yet.\r\n\r\nThe same error also happens without the change in #4877, and also if I push to a sibling that is a dataset clone added with ``datalad siblings add`` instead of one created with ``datalad create -sibling``.\r\n\r\n<details><summary>Same issue without the change from #4877</summary>\r\n\r\n```\r\n(handbook) \u256d\u2500adina@muninn /tmp\r\n\u2570\u2500\u27a4 datalad create some && cd some\r\n[INFO   ] Creating a new annex repo at /tmp/some \r\ncreate(ok): /tmp/some (dataset)\r\n(handbook) \u256d\u2500adina@muninn /tmp/some on master\r\n\u2570\u2500\u27a4 datalad download-url --archive 'https://s3.amazonaws.com/fast-ai-imageclas/imagenette2-160.tgz'\r\n\r\n[INFO   ] Downloading 'https://s3.amazonaws.com/fast-ai-imageclas/imagenette2-160.tgz' into '/tmp/some/' \r\ndownload_url(ok): /tmp/some/imagenette2-160.tgz (file)                                                             \r\nadd(ok): /tmp/some/imagenette2-160.tgz (file)\r\nsave(ok): /tmp/some (dataset)\r\n[INFO   ] Adding content of the archive /tmp/some/imagenette2-160.tgz into annex AnnexRepo(/tmp/some) \r\n[INFO   ] Initiating special remote datalad-archives \r\n[INFO   ] Finished adding /tmp/some/imagenette2-160.tgz: Files processed: 1, +annex: 1 \r\naction summary:\r\n  add (ok: 1)\r\n  download_url (ok: 1)\r\n  save (ok: 1)\r\n(handbook) \u256d\u2500adina@muninn /tmp/some on master\r\n\u2570\u2500\u27a4 datalad create-sibling ../anotherplace\r\n[INFO   ] Considering to create a target dataset /tmp/some at /tmp/anotherplace of localhost \r\n[INFO   ] Fetching updates for Dataset(/tmp/some) \r\n[INFO   ] Adjusting remote git configuration                                                                       \r\n[INFO   ] Running post-update hooks in all created siblings \r\ncreate_sibling(ok): /tmp/some (dataset)\r\n(handbook) \u256d\u2500adina@muninn /tmp/some on master\r\n\u2570\u2500\u27a4 datalad push --to local\r\ncopy(ok): /tmp/some/MD5E-s98948031--0edfc972b5c9817ac36517c0057f3869.tar (file) [to local...]                      \r\nUpdate availability for 'local':  75%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258a         | 3.00/4.00 [00:00<00:00, 16.7k Steps/s]CommandError: 'git push --progress --porcelain local refs/heads/git-annex:refs/heads/git-annex git-annex:git-annex' failed with exitcode 1 under /tmp/some\r\nerror: dst ref refs/heads/git-annex receives from more than one src.\r\nerror: failed to push some refs to '/tmp/anotherplace'\r\n```\r\n</details>\r\n\r\nsee maybe also https://git-annex.branchable.com/forum/refs__47__heads__47__synced__47__git-annex_receives_from_more_than_one_src/", "closed_by": {"login": "adswa", "id": 29738718, "node_id": "MDQ6VXNlcjI5NzM4NzE4", "avatar_url": "https://avatars.githubusercontent.com/u/29738718?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adswa", "html_url": "https://github.com/adswa", "followers_url": "https://api.github.com/users/adswa/followers", "following_url": "https://api.github.com/users/adswa/following{/other_user}", "gists_url": "https://api.github.com/users/adswa/gists{/gist_id}", "starred_url": "https://api.github.com/users/adswa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adswa/subscriptions", "organizations_url": "https://api.github.com/users/adswa/orgs", "repos_url": "https://api.github.com/users/adswa/repos", "events_url": "https://api.github.com/users/adswa/events{/privacy}", "received_events_url": "https://api.github.com/users/adswa/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/4888/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/4888/timeline", "performed_via_github_app": null}