{"url": "https://api.github.com/repos/datalad/datalad/issues/3575", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/3575/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/3575/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/3575/events", "html_url": "https://github.com/datalad/datalad/issues/3575", "id": 475730875, "node_id": "MDU6SXNzdWU0NzU3MzA4NzU=", "number": 3575, "title": "OPT: Something slows down datalad (run) within a dirty source code tree...", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-08-01T14:55:20Z", "updated_at": "2019-08-01T14:59:09Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "Using `datalad run --explicit` left me in suspense for too long when I ran it within my main development repo:\r\n```shell\r\n~datalad/datalad > time DATALAD_LOG_TIMESTAMP=1 datalad run --explicit --input benchmarks echo nothing todo 2>&1 | tools/dtime \r\n 2126 2019-08-01 10:47:11,163 [INFO] Making sure inputs are available (this may take some time) \r\n    - nothing todo\r\n    3 2019-08-01 10:47:13,289 [INFO] == Command start (output follows) ===== \r\n----- 2019-08-01 10:47:13,292 [INFO] == Command exit (modification check follows) ===== \r\nDATALAD_LOG_TIMESTAMP=1 datalad run --explicit --input benchmarks echo nothin  2.70s user 0.20s system 100% cpu 2.890 total\r\n\r\n~datalad/datalad > datalad --version\r\ndatalad 0.11.6.dev3\r\n```\r\nso it took almost 3 sec to \"do nothing\".  It doesn't happen in a clean repo:\r\n```shell\r\n~datalad/datalad-clone > time DATALAD_LOG_TIMESTAMP=1 datalad run --explicit --input benchmarks echo nothing todo 2>&1 | tools/dtime\r\n  231 2019-08-01 10:48:34,657 [INFO] Making sure inputs are available (this may take some time) \r\n    - nothing todo\r\n    3 2019-08-01 10:48:34,888 [INFO] == Command start (output follows) ===== \r\n----- 2019-08-01 10:48:34,891 [INFO] == Command exit (modification check follows) ===== \r\nDATALAD_LOG_TIMESTAMP=1 datalad run --explicit --input benchmarks echo nothin  0.65s user 0.11s system 101% cpu 0.755 total\r\ntools/dtime  0.02s user 0.00s system 2% cpu 0.760 total\r\n```\r\nand I do not think it is just a matter of asserting dirtiness, since \r\n\r\n<details>\r\n<summary>if I run it with high level of debug</summary> \r\n\r\n```shell\r\n~datalad/datalad > time DATALAD_LOG_TIMESTAMP=1 datalad -l 2 run --explicit --input benchmarks echo nothing todo 2>&1 | tools/dtime        \r\n    0 2019-08-01 10:50:04,153 [DEBUG] Command line args 1st pass. Parsed: Namespace() Unparsed: ['run', '--explicit', '--input', 'benchmarks', 'echo', 'nothing', 'todo'] \r\n    0 2019-08-01 10:50:04,153 [DEBUG] Discovering plugins \r\n    1 2019-08-01 10:50:04,153 [Level 5] Importing module datalad.interface.run  \r\n    6 2019-08-01 10:50:04,154 [DEBUG] Building doc for <class 'datalad.interface.run.Run'> \r\n    8 2019-08-01 10:50:04,160 [Level 5] Finished setup_parser \r\n    0 2019-08-01 10:50:04,168 [DEBUG] Parsing known args among ['/home/yoh/proj/datalad/datalad/venvs/dev3/bin/datalad', '-l', '2', 'run', '--explicit', '--input', 'benchmarks', 'echo', 'nothing', 'todo'] \r\n   14 2019-08-01 10:50:04,168 [Level 9] Running: ['git', 'config', '-z', '-l', '--show-origin'] \r\n    4 2019-08-01 10:50:04,182 [Level 8] Finished running ['git', 'config', '-z', '-l', '--show-origin'] with status 0 \r\n    1 2019-08-01 10:50:04,186 [DEBUG] Determined class of decorated function: <class 'datalad.interface.run.Run'> \r\n    0 2019-08-01 10:50:04,187 [Level 5] Parsed ri /home/yoh/proj/datalad/datalad into fields {'path': '/home/yoh/proj/datalad/datalad', 'scheme': '', 'username': '', 'password': '', 'hostname': '', 'port': '', 'query': '', 'fragment': ''} \r\n    0 2019-08-01 10:50:04,187 [Level 5] Detected file ri \r\n    0 2019-08-01 10:50:04,187 [DEBUG] Resolved dataset for tracking outcomes of a command: <Dataset path=/home/yoh/proj/datalad/datalad> \r\n   13 2019-08-01 10:50:04,187 [Level 9] Running: ['git', 'version'] \r\n    0 2019-08-01 10:50:04,200 [Level 8] Finished running ['git', 'version'] with status 0 \r\n   16 2019-08-01 10:50:04,200 [Level 9] Running: ['git', 'config', '-z', '-l', '--show-origin'] \r\n    5 2019-08-01 10:50:04,216 [Level 8] Finished running ['git', 'config', '-z', '-l', '--show-origin'] with status 0 \r\n    1 2019-08-01 10:50:04,221 [Level 5] Found 2 previous connections \r\n   13 2019-08-01 10:50:04,222 [Level 9] Running: ['git', 'config', 'user.name'] \r\n    0 2019-08-01 10:50:04,235 [Level 8] Finished running ['git', 'config', 'user.name'] with status 0 \r\n   14 2019-08-01 10:50:04,235 [Level 9] Running: ['git', 'config', 'user.email'] \r\n    3 2019-08-01 10:50:04,249 [Level 8] Finished running ['git', 'config', 'user.email'] with status 0 \r\n   55 2019-08-01 10:50:04,252 [Level 8] Using existing Git repository at /home/yoh/proj/datalad/datalad \r\n    1 2019-08-01 10:50:04,307 [Level 5] Detected <class 'datalad.support.gitrepo.GitRepo'> at /home/yoh/proj/datalad/datalad \r\n    0 2019-08-01 10:50:04,308 [DEBUG] tracking command output underneath <Dataset path=/home/yoh/proj/datalad/datalad> \r\n    0 2019-08-01 10:50:04,308 [DEBUG] chdir '/home/yoh/proj/datalad/datalad' -> '/home/yoh/proj/datalad/datalad'  \r\n    0 2019-08-01 10:50:04,308 [DEBUG] chdir '/home/yoh/proj/datalad/datalad' -> '/home/yoh/proj/datalad/datalad' (coming back) \r\n    0 2019-08-01 10:50:04,308 [INFO] Making sure inputs are available (this may take some time) \r\n    1 2019-08-01 10:50:04,308 [DEBUG] chdir '/home/yoh/proj/datalad/datalad' -> '/home/yoh/proj/datalad/datalad'  \r\n    0 2019-08-01 10:50:04,309 [DEBUG] chdir '/home/yoh/proj/datalad/datalad' -> '/home/yoh/proj/datalad/datalad' (coming back) \r\n    0 2019-08-01 10:50:04,309 [DEBUG] Discovering plugins \r\n    2 2019-08-01 10:50:04,309 [Level 5] Importing module datalad.distribution.install  \r\n    3 2019-08-01 10:50:04,311 [DEBUG] Building doc for <class 'datalad.interface.annotate_paths.AnnotatePaths'> \r\n    2 2019-08-01 10:50:04,314 [DEBUG] Building doc for <class 'datalad.distribution.clone.Clone'> \r\n    2 2019-08-01 10:50:04,316 [DEBUG] Building doc for <class 'datalad.distribution.get.Get'> \r\n    2 2019-08-01 10:50:04,318 [DEBUG] Building doc for <class 'datalad.distribution.install.Install'> \r\n    0 2019-08-01 10:50:04,320 [DEBUG] Found matching interface ('datalad.distribution.install', 'Install') for install \r\n    2 2019-08-01 10:50:04,320 [DEBUG] Determined class of decorated function: <class 'datalad.distribution.install.Install'> \r\n  154 2019-08-01 10:50:04,322 [Level 8] Using existing Git repository at /home/yoh/proj/datalad/datalad \r\n   14 2019-08-01 10:50:04,476 [Level 9] Running: ['git', 'version'] \r\n    0 2019-08-01 10:50:04,490 [Level 8] Finished running ['git', 'version'] with status 0 \r\n   15 2019-08-01 10:50:04,490 [Level 9] Running: ['git', 'config', '-z', '-l', '--show-origin'] \r\n  156 2019-08-01 10:50:04,505 [Level 8] Finished running ['git', 'config', '-z', '-l', '--show-origin'] with status 0 \r\n   52 2019-08-01 10:50:04,661 [DEBUG] Resolved dataset for installation: <Dataset path=/home/yoh/proj/datalad/datalad> \r\n    0 2019-08-01 10:50:04,713 [Level 5] Parsed ri  into fields {'path': '', 'scheme': '', 'username': '', 'password': '', 'hostname': '', 'port': '', 'query': '', 'fragment': ''} \r\n    1 2019-08-01 10:50:04,713 [Level 5] Detected file ri \r\n    0 2019-08-01 10:50:04,714 [DEBUG] Install passes into get 1 items \r\n  312 2019-08-01 10:50:04,714 [DEBUG] Determined class of decorated function: <class 'datalad.distribution.get.Get'> \r\n  304 2019-08-01 10:50:05,026 [DEBUG] Determined class of decorated function: <class 'datalad.interface.annotate_paths.AnnotatePaths'> \r\n    0 2019-08-01 10:50:05,330 [Level 5] Parsed ri /home/yoh/proj/datalad into fields {'path': '/home/yoh/proj/datalad', 'scheme': '', 'username': '', 'password': '', 'hostname': '', 'port': '', 'query': '', 'fragment': ''} \r\n    0 2019-08-01 10:50:05,330 [Level 5] Detected file ri \r\n    1 2019-08-01 10:50:05,330 [DEBUG] Discovering plugins \r\n    1 2019-08-01 10:50:05,331 [Level 5] Importing module datalad.distribution.subdatasets  \r\n    2 2019-08-01 10:50:05,332 [DEBUG] Building doc for <class 'datalad.distribution.subdatasets.Subdatasets'> \r\n    0 2019-08-01 10:50:05,334 [DEBUG] Found matching interface ('datalad.distribution.subdatasets', 'Subdatasets', 'subdatasets') for subdatasets \r\n    1 2019-08-01 10:50:05,334 [DEBUG] Determined class of decorated function: <class 'datalad.distribution.subdatasets.Subdatasets'> \r\n    0 2019-08-01 10:50:05,335 [Level 8] Using existing Git repository at /home/yoh/proj/datalad \r\n    1 2019-08-01 10:50:05,335 [Level 5] Detected <class 'datalad.support.gitrepo.GitRepo'> at /home/yoh/proj/datalad \r\n    1 2019-08-01 10:50:05,336 [Level 8] Using existing Git repository at /home/yoh/proj/datalad \r\n   13 2019-08-01 10:50:05,337 [Level 9] Running: ['git', 'version'] \r\n    1 2019-08-01 10:50:05,350 [Level 8] Finished running ['git', 'version'] with status 0 \r\n   15 2019-08-01 10:50:05,351 [Level 9] Running: ['git', 'config', '-z', '-l', '--show-origin'] \r\n    6 2019-08-01 10:50:05,366 [Level 8] Finished running ['git', 'config', '-z', '-l', '--show-origin'] with status 0 \r\n    1 2019-08-01 10:50:05,372 [DEBUG] Resolved dataset for subdataset reporting/modification: <Dataset path=/home/yoh/proj/datalad> \r\n    0 2019-08-01 10:50:05,373 [DEBUG] chdir '/home/yoh/proj/datalad/datalad' -> '/home/yoh/proj/datalad/datalad'  \r\n    0 2019-08-01 10:50:05,373 [DEBUG] chdir '/home/yoh/proj/datalad/datalad' -> '/home/yoh/proj/datalad/datalad' (coming back) \r\n  303 2019-08-01 10:50:05,373 [DEBUG] Determined class of decorated function: <class 'datalad.distribution.get.Get'> \r\n  305 2019-08-01 10:50:05,676 [DEBUG] Determined class of decorated function: <class 'datalad.interface.annotate_paths.AnnotatePaths'> \r\n  303 2019-08-01 10:50:05,981 [DEBUG] Determined class of decorated function: <class 'datalad.distribution.subdatasets.Subdatasets'> \r\n    1 2019-08-01 10:50:06,284 [DEBUG] Resolved dataset for subdataset reporting/modification: <Dataset path=/home/yoh/proj/datalad/datalad> \r\n   14 2019-08-01 10:50:06,285 [Level 9] Running: ['git', 'ls-files', '--stage', '-z'] \r\n   55 2019-08-01 10:50:06,299 [Level 8] Finished running ['git', 'ls-files', '--stage', '-z'] with status 0 \r\n  108 2019-08-01 10:50:06,354 [DEBUG] no dataset annex, content already present [get(/home/yoh/proj/datalad/datalad/benchmarks)] \r\n    0 2019-08-01 10:50:06,462 [INFO] == Command start (output follows) ===== \r\n    - nothing todo\r\n    3 2019-08-01 10:50:06,462 [Level 9] Running: echo nothing todo \r\n    1 2019-08-01 10:50:06,465 [Level 8] Finished running 'echo nothing todo' with status 0 \r\n  213 2019-08-01 10:50:06,466 [INFO] == Command exit (modification check follows) ===== \r\n----- 2019-08-01 10:50:06,679 [Level 5] Exiting \r\nDATALAD_LOG_TIMESTAMP=1 datalad -l 2 run --explicit --input benchmarks echo    2.82s user 0.12s system 100% cpu 2.930 total\r\n```\r\n</details>\r\n\r\nyou see that majority of time (>300ms) spent upon/after each of the `\r\nDetermined class of decorated function: ...` log messages, e.g. as in this excerpt from above collapsed full dump:\r\n\r\n```\r\n  303 2019-08-01 10:50:05,373 [DEBUG] Determined class of decorated function: <class 'datalad.distribution.get.Get'> \r\n  305 2019-08-01 10:50:05,676 [DEBUG] Determined class of decorated function: <class 'datalad.interface.annotate_paths.AnnotatePaths'> \r\n  303 2019-08-01 10:50:05,981 [DEBUG] Determined class of decorated function: <class 'datalad.distribution.subdatasets.Subdatasets'> \r\n```\r\n\r\nI wonder -- what is it really doing there? ;)\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/3575/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/3575/timeline", "performed_via_github_app": null}