{"url": "https://api.github.com/repos/datalad/datalad/issues/5810", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/5810/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/5810/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/5810/events", "html_url": "https://github.com/datalad/datalad/issues/5810", "id": 951091001, "node_id": "MDU6SXNzdWU5NTEwOTEwMDE=", "number": 5810, "title": "test_runner_stdin_no_capture errors out while testing master on datalad/git-annex (github actions)", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": {"login": "christian-monch", "id": 17925232, "node_id": "MDQ6VXNlcjE3OTI1MjMy", "avatar_url": "https://avatars.githubusercontent.com/u/17925232?v=4", "gravatar_id": "", "url": "https://api.github.com/users/christian-monch", "html_url": "https://github.com/christian-monch", "followers_url": "https://api.github.com/users/christian-monch/followers", "following_url": "https://api.github.com/users/christian-monch/following{/other_user}", "gists_url": "https://api.github.com/users/christian-monch/gists{/gist_id}", "starred_url": "https://api.github.com/users/christian-monch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/christian-monch/subscriptions", "organizations_url": "https://api.github.com/users/christian-monch/orgs", "repos_url": "https://api.github.com/users/christian-monch/repos", "events_url": "https://api.github.com/users/christian-monch/events{/privacy}", "received_events_url": "https://api.github.com/users/christian-monch/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "christian-monch", "id": 17925232, "node_id": "MDQ6VXNlcjE3OTI1MjMy", "avatar_url": "https://avatars.githubusercontent.com/u/17925232?v=4", "gravatar_id": "", "url": "https://api.github.com/users/christian-monch", "html_url": "https://github.com/christian-monch", "followers_url": "https://api.github.com/users/christian-monch/followers", "following_url": "https://api.github.com/users/christian-monch/following{/other_user}", "gists_url": "https://api.github.com/users/christian-monch/gists{/gist_id}", "starred_url": "https://api.github.com/users/christian-monch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/christian-monch/subscriptions", "organizations_url": "https://api.github.com/users/christian-monch/orgs", "repos_url": "https://api.github.com/users/christian-monch/repos", "events_url": "https://api.github.com/users/christian-monch/events{/privacy}", "received_events_url": "https://api.github.com/users/christian-monch/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 0, "created_at": "2021-07-22T21:56:19Z", "updated_at": "2021-07-22T21:56:19Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "e.g. https://github.com/datalad/git-annex/runs/3130248890?check_suite_focus=true recently added in 0.14.4-477-gcdde06b73\r\nseems to be failing only on ubuntu\r\n\r\n```\r\n======================================================================\r\nERROR: datalad.tests.test_witless_runner.test_runner_stdin_no_capture\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/nose/case.py\", line 198, in runTest\r\n    self.test(*self.arg)\r\n  File \"/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/nose/tools/nontrivial.py\", line 97, in newfunc\r\n    result = func(*arg, **kw)\r\n  File \"/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/datalad/tests/test_witless_runner.py\", line 162, in test_runner_stdin_no_capture\r\n    protocol=None\r\n  File \"/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/datalad/cmd.py\", line 172, in run\r\n    **results,\r\ndatalad.support.exceptions.CommandError: CommandError: '/opt/hostedtoolcache/Python/3.7.11/x64/bin/python -c 'import sys; print(sys.stdin.read())'' failed with exitcode 1\r\n```\r\n\r\nand consistently so\r\n\r\n```shell\r\n(git)smaug:/mnt/btrfs/datasets/datalad/ci/git-annex[master]builds/2021\r\n$> cd 07\r\ncron-20210701/  cron-20210703/  cron-20210705/  cron-20210707/  cron-20210709/  cron-20210711/  cron-20210713/  cron-20210715/  cron-20210717/  cron-20210719/  cron-20210721/  pr-70/  pr-UNK/\r\ncron-20210702/  cron-20210704/  cron-20210706/  cron-20210708/  cron-20210710/  cron-20210712/  cron-20210714/  cron-20210716/  cron-20210718/  cron-20210720/  cron-20210722/  pr-72/\r\n\r\n$> git grep test_runner_stdin_no_capture\r\ncron-20210721/build-macos.yaml-360-69466103-failed/1_test-datalad (master).txt:2021-07-21T05:03:24.6620130Z datalad.tests.test_witless_runner.test_runner_stdin_no_capture ... ok\r\ncron-20210721/build-macos.yaml-360-69466103-failed/test-datalad (master)/11_Run datalad tests.txt:2021-07-21T05:03:24.6620040Z datalad.tests.test_witless_runner.test_runner_stdin_no_capture ... ok\r\ncron-20210721/build-ubuntu.yaml-352-69466103-failed/1_test-datalad (master).txt:2021-07-21T04:07:03.8113230Z datalad.tests.test_witless_runner.test_runner_stdin_no_capture ... Traceback (most recent call last):\r\ncron-20210721/build-ubuntu.yaml-352-69466103-failed/1_test-datalad (master).txt:2021-07-21T04:10:36.3041083Z ERROR: datalad.tests.test_witless_runner.test_runner_stdin_no_capture\r\ncron-20210721/build-ubuntu.yaml-352-69466103-failed/1_test-datalad (master).txt:2021-07-21T04:10:36.3050465Z   File \"/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/datalad/tests/test_witless_runner.py\", line 162, in test_runner_stdin_no_capture\r\ncron-20210721/build-ubuntu.yaml-352-69466103-failed/test-datalad (master)/12_Run datalad tests.txt:2021-07-21T04:07:03.8113207Z datalad.tests.test_witless_runner.test_runner_stdin_no_capture ... Traceback (most recent call last):\r\ncron-20210721/build-ubuntu.yaml-352-69466103-failed/test-datalad (master)/12_Run datalad tests.txt:2021-07-21T04:10:36.3041079Z ERROR: datalad.tests.test_witless_runner.test_runner_stdin_no_capture\r\ncron-20210721/build-ubuntu.yaml-352-69466103-failed/test-datalad (master)/12_Run datalad tests.txt:2021-07-21T04:10:36.3050457Z   File \"/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/datalad/tests/test_witless_runner.py\", line 162, in test_runner_stdin_no_capture\r\ncron-20210721/build-windows.yaml-323-69466103-failed/1_test-datalad (master).txt:2021-07-21T06:12:17.3062736Z datalad.tests.test_witless_runner.test_runner_stdin_no_capture ... ok\r\ncron-20210721/build-windows.yaml-323-69466103-failed/test-datalad (master)/21_Run datalad tests.txt:2021-07-21T06:12:17.3062650Z datalad.tests.test_witless_runner.test_runner_stdin_no_capture ... ok\r\ncron-20210722/build-macos.yaml-361-69466103-success/1_test-datalad (master).txt:2021-07-22T05:04:44.3417940Z datalad.tests.test_witless_runner.test_runner_stdin_no_capture ... ok\r\ncron-20210722/build-macos.yaml-361-69466103-success/test-datalad (master)/11_Run datalad tests.txt:2021-07-22T05:04:44.3417900Z datalad.tests.test_witless_runner.test_runner_stdin_no_capture ... ok\r\ncron-20210722/build-ubuntu.yaml-353-69466103-failed/1_test-datalad (master).txt:2021-07-22T03:53:44.1467324Z datalad.tests.test_witless_runner.test_runner_stdin_no_capture ... Traceback (most recent call last):\r\ncron-20210722/build-ubuntu.yaml-353-69466103-failed/1_test-datalad (master).txt:2021-07-22T03:56:25.4199762Z ERROR: datalad.tests.test_witless_runner.test_runner_stdin_no_capture\r\ncron-20210722/build-ubuntu.yaml-353-69466103-failed/1_test-datalad (master).txt:2021-07-22T03:56:25.4206667Z   File \"/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/datalad/tests/test_witless_runner.py\", line 162, in test_runner_stdin_no_capture\r\ncron-20210722/build-ubuntu.yaml-353-69466103-failed/test-datalad (master)/12_Run datalad tests.txt:2021-07-22T03:53:44.1467304Z datalad.tests.test_witless_runner.test_runner_stdin_no_capture ... Traceback (most recent call last):\r\ncron-20210722/build-ubuntu.yaml-353-69466103-failed/test-datalad (master)/12_Run datalad tests.txt:2021-07-22T03:56:25.4199758Z ERROR: datalad.tests.test_witless_runner.test_runner_stdin_no_capture\r\ncron-20210722/build-ubuntu.yaml-353-69466103-failed/test-datalad (master)/12_Run datalad tests.txt:2021-07-22T03:56:25.4206658Z   File \"/opt/hostedtoolcache/Python/3.7.11/x64/lib/python3.7/site-packages/datalad/tests/test_witless_runner.py\", line 162, in test_runner_stdin_no_capture\r\ncron-20210722/build-windows.yaml-324-69466103-failed/1_test-datalad (master).txt:2021-07-22T06:21:28.4374257Z datalad.tests.test_witless_runner.test_runner_stdin_no_capture ... ok\r\ncron-20210722/build-windows.yaml-324-69466103-failed/test-datalad (master)/21_Run datalad tests.txt:2021-07-22T06:21:28.4374161Z datalad.tests.test_witless_runner.test_runner_stdin_no_capture ... ok\r\n```\r\n\r\nlooking into actual log files for the moment of invocation I see\r\n```\r\n2021-07-21T04:07:03.8113230Z datalad.tests.test_witless_runner.test_runner_stdin_no_capture ... Traceback (most recent call last):\r\n2021-07-21T04:07:03.8115209Z   File \"<string>\", line 1, in <module>\r\n2021-07-21T04:07:03.8116438Z BlockingIOError: [Errno 11] write could not complete without blocking\r\n2021-07-21T04:07:03.8162062Z ERROR\r\n@                                                                                            \r\n```\r\n\r\nany ideas/clues @christian-monch ?  I haven't tried to analyze yet to grasp why fails there and not on travis/appveyor ... but it seems we do not run this test in actions anywhere/how besides in datalad/git-annex\r\n\r\ntested locally [*] for that test alone and was \"suprised\" that it dumps into my face lots of text regardless if I try running nose with -s or without .  \r\n\r\nAlso does it really need `'ABCDEFGHIJKLMNOPQRSTUVWXYZ-' * 10000` that long ? (that explains slow `git grep` I guess ;)) -- those get captured in the log files, makes them large, and also harder to analyze. \r\n\r\n[*] didn't reproduce with  3.9 and custom built 3.8 ... `tools/ci/bisect-python.sh` failed at pip installation stage on 3.7.11 when I tried to initiate such env", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/5810/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/5810/timeline", "performed_via_github_app": null}