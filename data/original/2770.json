{"url": "https://api.github.com/repos/datalad/datalad/issues/2770", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/2770/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/2770/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/2770/events", "html_url": "https://github.com/datalad/datalad/pull/2770", "id": 350537852, "node_id": "MDExOlB1bGxSZXF1ZXN0MjA4MzY1MTE1", "number": 2770, "title": "BFing direct mode:  \"git commit file(s)\" etc", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/datalad/datalad/milestones/54", "html_url": "https://github.com/datalad/datalad/milestone/54", "labels_url": "https://api.github.com/repos/datalad/datalad/milestones/54/labels", "id": 3542067, "node_id": "MDk6TWlsZXN0b25lMzU0MjA2Nw==", "number": 54, "title": "Release 0.10.3", "description": "", "creator": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 50, "state": "closed", "created_at": "2018-08-02T13:36:57Z", "updated_at": "2018-10-22T14:19:15Z", "due_on": "2018-09-13T07:00:00Z", "closed_at": "2018-10-22T14:19:15Z"}, "comments": 12, "created_at": "2018-08-14T18:08:34Z", "updated_at": "2019-02-17T03:54:10Z", "closed_at": "2018-08-27T19:01:57Z", "author_association": "MEMBER", "active_lock_reason": null, "pull_request": {"url": "https://api.github.com/repos/datalad/datalad/pulls/2770", "html_url": "https://github.com/datalad/datalad/pull/2770", "diff_url": "https://github.com/datalad/datalad/pull/2770.diff", "patch_url": "https://github.com/datalad/datalad/pull/2770.patch"}, "body": "Disclaimer - sits on top of #2724 which I intend to merge if tests pass\r\n\r\nThis pull request fixes # ... TODO ... there might be a few\r\n- [x] (nearly all) test decorators now carry identical to their name attributes for nose, so you can easily run only a subset of those decorated tests.  Some are decorated further, e.g. `direct_mode` would point to tests somehow related to direct mode - either explicitly testing in direct mode, known to fail, or ignored. etc\r\n- [x] `git annex` invocations do not get ` -c core.bare=False --work-tree=.` since they shouldn't/mustn't!\r\n- [x] in direct mode:  for `git commit file(s)` under direct mode, we resort to `git commit` while first analyzing `file(s)` given:\r\n   - if any is not staged - we puke\r\n   - if some staged aren't among `file(s)` - we prepare a new index file, where we reset those which aren't to be committed\r\n   - **gotcha/shortcoming** if there is a modified file, which is staged but in some previous shape (so there are newer changes in worktree), they would not get committed.  We could have analyzed index regarding either staged version is annexified or git - and then do `git add` or `git annex add` accordingly, but not sure if worth the hassle ATM.  At least this fix/behavior would get us those 95% of correct functionality in direct mode ;)\r\n    - This current \"index\" trick workaround could later be superseded by git supporting `git commit --cached file(s)` invocation.  but that wouldn't eliminate the need for the analysis if we decide to do regarding files which aren't yet staged (thus might needing `git annex add`)\r\n- [x] redecorate `@skip_direct_mode` into `@known_failure_direct_mode`\r\n- [x] undecorate tests which no longer fail in direct mode (there should be a few)\r\n- [ ] possibly a dedicated test for `git commit file(s)` (`datalad save file(s)`) behavior in the case of some files being staged and some not... but might not do it if coverage would indicate that all possible lines are tested now\r\n\r\nPlease have a look @datalad/developers\r\n", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/2770/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/2770/timeline", "performed_via_github_app": null}