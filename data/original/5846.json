{"url": "https://api.github.com/repos/datalad/datalad/issues/5846", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/5846/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/5846/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/5846/events", "html_url": "https://github.com/datalad/datalad/issues/5846", "id": 956221932, "node_id": "MDU6SXNzdWU5NTYyMjE5MzI=", "number": 5846, "title": "Authenticated access to http EarthData (ecs.nsidc.org) does not work", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 2805377474, "node_id": "MDU6TGFiZWwyODA1Mzc3NDc0", "url": "https://api.github.com/repos/datalad/datalad/labels/cmd-addurls", "name": "cmd-addurls", "color": "FEF2C0", "default": false, "description": ""}, {"id": 2805378594, "node_id": "MDU6TGFiZWwyODA1Mzc4NTk0", "url": "https://api.github.com/repos/datalad/datalad/labels/cmd-download-url", "name": "cmd-download-url", "color": "FEF2C0", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 30, "created_at": "2021-07-29T21:31:04Z", "updated_at": "2021-08-09T22:04:58Z", "closed_at": "2021-08-05T20:24:26Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Fresh user case : https://neurostars.org/t/download-url-from-password-protected-site/19888\r\n\r\n<details>\r\n<summary>wget -S call</summary> \r\n\r\n```shell\r\n$> wget -S https://n5eil01u.ecs.nsidc.org/ICEBRIDGE/IDBMG4.004/1993.01.01/BedMachineGreenland-2021-04-20.nc.xml\r\n--2021-07-29 17:20:16--  https://n5eil01u.ecs.nsidc.org/ICEBRIDGE/IDBMG4.004/1993.01.01/BedMachineGreenland-2021-04-20.nc.xml\r\nResolving n5eil01u.ecs.nsidc.org (n5eil01u.ecs.nsidc.org)... 128.138.97.102\r\nConnecting to n5eil01u.ecs.nsidc.org (n5eil01u.ecs.nsidc.org)|128.138.97.102|:443... connected.\r\nHTTP request sent, awaiting response... \r\n  HTTP/1.1 302 Found\r\n  Date: Thu, 29 Jul 2021 21:20:17 GMT\r\n  Server: Apache\r\n  Location: https://urs.earthdata.nasa.gov/oauth/authorize?app_type=401&client_id=_JLuwMHxb2xX6NwYTb4dRA&response_type=code&redirect_uri=https%3A%2F%2Fn5eil01u.ecs.nsidc.org%2FOPS%2Fredirect&state=aHR0cDovL241ZWlsMDF1LmVjcy5uc2lkYy5vcmcvSUNFQlJJREdFL0lEQk1HNC4wMDQvMTk5My4wMS4wMS9CZWRNYWNoaW5lR3JlZW5sYW5kLTIwMjEtMDQtMjAubmMueG1s\r\n  Content-Length: 517\r\n  Keep-Alive: timeout=15, max=100\r\n  Connection: Keep-Alive\r\n  Content-Type: text/html; charset=iso-8859-1\r\nLocation: https://urs.earthdata.nasa.gov/oauth/authorize?app_type=401&client_id=_JLuwMHxb2xX6NwYTb4dRA&response_type=code&redirect_uri=https%3A%2F%2Fn5eil01u.ecs.nsidc.org%2FOPS%2Fredirect&state=aHR0cDovL241ZWlsMDF1LmVjcy5uc2lkYy5vcmcvSUNFQlJJREdFL0lEQk1HNC4wMDQvMTk5My4wMS4wMS9CZWRNYWNoaW5lR3JlZW5sYW5kLTIwMjEtMDQtMjAubmMueG1s [following]\r\n--2021-07-29 17:20:17--  https://urs.earthdata.nasa.gov/oauth/authorize?app_type=401&client_id=_JLuwMHxb2xX6NwYTb4dRA&response_type=code&redirect_uri=https%3A%2F%2Fn5eil01u.ecs.nsidc.org%2FOPS%2Fredirect&state=aHR0cDovL241ZWlsMDF1LmVjcy5uc2lkYy5vcmcvSUNFQlJJREdFL0lEQk1HNC4wMDQvMTk5My4wMS4wMS9CZWRNYWNoaW5lR3JlZW5sYW5kLTIwMjEtMDQtMjAubmMueG1s\r\nResolving urs.earthdata.nasa.gov (urs.earthdata.nasa.gov)... 198.118.243.33, 2001:4d0:241a:4081::89\r\nConnecting to urs.earthdata.nasa.gov (urs.earthdata.nasa.gov)|198.118.243.33|:443... connected.\r\nHTTP request sent, awaiting response... \r\n  HTTP/1.1 401 Unauthorized\r\n  Server: nginx/1.20.1\r\n  Date: Thu, 29 Jul 2021 21:20:17 GMT\r\n  Content-Type: text/html; charset=utf-8\r\n  Transfer-Encoding: chunked\r\n  Connection: keep-alive\r\n  X-Frame-Options: SAMEORIGIN\r\n  X-XSS-Protection: 1; mode=block\r\n  X-Content-Type-Options: nosniff\r\n  X-Download-Options: noopen\r\n  X-Permitted-Cross-Domain-Policies: none\r\n  Referrer-Policy: strict-origin-when-cross-origin\r\n  Cache-Control: no-store\r\n  Pragma: no-cache\r\n  Expires: Fri, 01 Jan 1990 00:00:00 GMT\r\n  WWW-Authenticate: Basic realm=\"Please enter your Earthdata Login credentials. If you do not have a Earthdata Login, create one at https://urs.earthdata.nasa.gov//users/new\"\r\n  X-Request-Id: d039cec7-255e-422b-b50a-76d623f5e760\r\n  X-Runtime: 0.003665\r\n  Strict-Transport-Security: max-age=31536000\r\n\r\nUsername/Password Authentication Failed.\r\n\r\n```\r\n</details>\r\n\r\nso it \r\n- first responds with `HTTP/1.1 302 Found` and redirects to auth Location\r\n- there responds with `HTTP/1.1 401 Unauthorized` and `WWW-Authenticate: Basic realm=\"Please enter your Earthdata Login credentials. If you do not have a Earthdata Login, create one at https://urs.earthdata.nasa.gov//users/new\"`\r\n\r\nat this point we should have instigated creating a new credential.\r\n\r\n<details>\r\n<summary>but we manage to happily download `authorize` html</summary> \r\n\r\n```shell\r\n$> datalad -l debug download-url https://n5eil01u.ecs.nsidc.org/ICEBRIDGE/IDBMG4.004/1993.01.01/BedMachineGreenland-2021-04-20.nc.xml\r\n[DEBUG  ] Command line args 1st pass for DataLad 0.14.6+502.gee4c809a5. Parsed: Namespace() Unparsed: ['download-url', 'https://n5eil01u.ecs.nsidc.org/ICEBRIDGE/IDBMG4.004/1993.01.01/BedMachineGreenland-2021-04-20.nc.xml'] \r\n[DEBUG  ] Building doc for <class 'datalad.core.local.status.Status'> \r\n[DEBUG  ] Building doc for <class 'datalad.core.local.save.Save'> \r\n[DEBUG  ] Building doc for <class 'datalad.interface.download_url.DownloadURL'> \r\n[DEBUG  ] Parsing known args among ['/home/yoh/proj/datalad/datalad-master/venvs/dev3/bin/datalad', '-l', 'debug', 'download-url', 'https://n5eil01u.ecs.nsidc.org/ICEBRIDGE/IDBMG4.004/1993.01.01/BedMachineGreenland-2021-04-20.nc.xml'] \r\n[DEBUG  ] Run ['git', '--git-dir=', 'config', '-z', '-l', '--show-origin'] (cwd=None) \r\n[DEBUG  ] Finished ['git', '--git-dir=', 'config', '-z', '-l', '--show-origin'] with status 0 \r\n[DEBUG  ] Determined class of decorated function: <class 'datalad.interface.download_url.DownloadURL'> \r\n[DEBUG  ] Failed to import requests_ftp, thus no ftp support:  \r\n[DEBUG  ] parseParameters: Given \"\", we split into [] \r\n[DEBUG  ] parseParameters: Given \"credential: Credential, optional\r\n|   Provides necessary credential fields to be used by authenticator\r\n| authenticator: Authenticator, optional\r\n|   Authenticator to use for authentication.\", we split into [('credential', 'credential: Credential, optional\\n  Provides necessary credential fields to be used by authenticator'), ('authenticator', 'authenticator: Authenticator, optional\\n  Authenticator to use for authentication.')] \r\n[DEBUG  ] parseParameters: Given \"\", we split into [] \r\n[DEBUG  ] parseParameters: Given \"credential: Credential, optional\r\n|   Provides necessary credential fields to be used by authenticator\r\n| authenticator: Authenticator, optional\r\n|   Authenticator to use for authentication.\", we split into [('credential', 'credential: Credential, optional\\n  Provides necessary credential fields to be used by authenticator'), ('authenticator', 'authenticator: Authenticator, optional\\n  Authenticator to use for authentication.')] \r\n[DEBUG  ] parseParameters: Given \"\", we split into [] \r\n[DEBUG  ] parseParameters: Given \"credential: Credential, optional\r\n|   Provides necessary credential fields to be used by authenticator\r\n| authenticator: Authenticator, optional\r\n|   Authenticator to use for authentication.\", we split into [('credential', 'credential: Credential, optional\\n  Provides necessary credential fields to be used by authenticator'), ('authenticator', 'authenticator: Authenticator, optional\\n  Authenticator to use for authentication.')] \r\n[DEBUG  ] parseParameters: Given \"\", we split into [] \r\n[DEBUG  ] parseParameters: Given \"method : callable\r\n|   A callable, usually a method of the same class, which we decorate\r\n|   with access handling, and pass url as the first argument\r\n| url : string\r\n|   URL to access\r\n| *args, **kwargs\r\n|   Passed into the method call\", we split into [('method', 'method : callable\\n  A callable, usually a method of the same class, which we decorate\\n  with access handling, and pass url as the first argument'), ('url', 'url : string\\n  URL to access'), ('*args, **kwargs', '*args, **kwargs\\n  Passed into the method call')] \r\n[DEBUG  ] Assigning credentials into 28 providers \r\n[DEBUG  ] Initializing default provider for https \r\n[DEBUG  ] No dedicated provider, returning default one for https: Provider(authenticator=None, credential=None, name='', url_res=['https://.*']) \r\n[INFO   ] Downloading 'https://n5eil01u.ecs.nsidc.org/ICEBRIDGE/IDBMG4.004/1993.01.01/BedMachineGreenland-2021-04-20.nc.xml' into '/tmp/' \r\n[DEBUG  ] Acquiring a currently existing lock to establish download session. If stalls - check which process holds b'/home/yoh/.cache/datalad/locks/downloader-auth.lck' \r\n[DEBUG  ] Opening cookies DB /home/yoh/.config/datalad/cookies \r\n[DEBUG  ] http session: Creating brand new session \r\n[DEBUG  ] Establishing session for url https://n5eil01u.ecs.nsidc.org/ICEBRIDGE/IDBMG4.004/1993.01.01/BedMachineGreenland-2021-04-20.nc.xml, response headers: {'Server': 'nginx/1.20.1', 'Date': 'Thu, 29 Jul 2021 21:27:07 GMT', 'Content-Type': 'text/html; charset=utf-8', 'Transfer-Encoding': 'chunked', 'Connection': 'keep-alive', 'X-Frame-Options': 'SAMEORIGIN', 'X-XSS-Protection': '1; mode=block', 'X-Content-Type-Options': 'nosniff', 'X-Download-Options': 'noopen', 'X-Permitted-Cross-Domain-Policies': 'none', 'Referrer-Policy': 'strict-origin-when-cross-origin', 'Cache-Control': 'no-store', 'Pragma': 'no-cache', 'Expires': 'Fri, 01 Jan 1990 00:00:00 GMT', 'Vary': 'Accept', 'ETag': 'W/\"9af6a4c3c8ccf37d9e71250648ebb4d3\"', 'Set-Cookie': '_urs-gui_session=73fa7cdffe5533b91973ec429aaf50f3; path=/; expires=Fri, 30 Jul 2021 21:27:07 GMT; HttpOnly, f5_cspm=1234;', 'X-Request-Id': '382db679-cd6d-4e45-ab0b-3bd978d30b7d', 'X-Runtime': '0.016418', 'Strict-Transport-Security': 'max-age=31536000'} \r\n[DEBUG  ] URL https://n5eil01u.ecs.nsidc.org/ICEBRIDGE/IDBMG4.004/1993.01.01/BedMachineGreenland-2021-04-20.nc.xml was redirected to https://urs.earthdata.nasa.gov/oauth/authorize?client_id=_JLuwMHxb2xX6NwYTb4dRA&response_type=code&redirect_uri=https%3A%2F%2Fn5eil01u.ecs.nsidc.org%2FOPS%2Fredirect&state=aHR0cDovL241ZWlsMDF1LmVjcy5uc2lkYy5vcmcvSUNFQlJJREdFL0lEQk1HNC4wMDQvMTk5My4wMS4wMS9CZWRNYWNoaW5lR3JlZW5sYW5kLTIwMjEtMDQtMjAubmMueG1s and thus the later will be used \r\ndownload_url(ok): /tmp/authorize (file)   \r\n\r\n$> file authorize \r\nauthorize: HTML document, ASCII text, with very long lines\r\n\r\n$> datalad --version\r\ndatalad 0.14.6+502.gee4c809a5\r\n```\r\n</details>\r\n\r\nsince realm is provided, probably relates also to not fixed https://github.com/datalad/datalad/issues/2714", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/5846/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/5846/timeline", "performed_via_github_app": null}