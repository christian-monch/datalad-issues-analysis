{"url": "https://api.github.com/repos/datalad/datalad/issues/3319", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/3319/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/3319/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/3319/events", "html_url": "https://github.com/datalad/datalad/pull/3319", "id": 432370638, "node_id": "MDExOlB1bGxSZXF1ZXN0MjY5ODU5MDYw", "number": 3319, "title": "ENH(BM)+OPT: benchmarks to measure overhead from our Runner(s), no sleeping in .poll loop", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2019-04-12T03:24:58Z", "updated_at": "2019-04-12T14:28:16Z", "closed_at": "2019-04-12T14:28:16Z", "author_association": "MEMBER", "active_lock_reason": null, "pull_request": {"url": "https://api.github.com/repos/datalad/datalad/pulls/3319", "html_url": "https://github.com/datalad/datalad/pull/3319", "diff_url": "https://github.com/datalad/datalad/pull/3319.diff", "patch_url": "https://github.com/datalad/datalad/pull/3319.patch"}, "body": "Those track_overhead report percents over the duration via a simple\r\nos.system call where all outputs go to /dev/null.  Here is a result from running\r\non my laptop:\r\n\r\n    $> DATALAD_LOG_LEVEL=2 asv run -j 4 -b core.runner\r\n    \u00b7 Creating environments\r\n    \u00b7 Discovering benchmarks\r\n    \u00b7\u00b7 Uninstalling from virtualenv-py2.7\r\n    \u00b7\u00b7 Installing 6f9ac93e <master> into virtualenv-py2.7.\r\n    \u00b7 Running 28 total benchmarks (2 commits * 2 environments * 7 benchmarks)\r\n    [  0.00%] \u00b7 For DataLad commit 6f9ac93e <master>:\r\n    [  0.00%] \u00b7\u00b7 Building for virtualenv-py2.7, virtualenv-py3.7..\r\n    [  0.00%] \u00b7\u00b7 Benchmarking virtualenv-py2.7\r\n    [  1.79%] \u00b7\u00b7\u00b7 Running (core.runner.time_echo--)..\r\n    [ 14.29%] \u00b7\u00b7\u00b7 core.runner.time_echo                                                           2.26\u00b10.1ms\r\n    [ 16.07%] \u00b7\u00b7\u00b7 core.runner.time_echo_gitrunner                                                2.65\u00b10.08ms\r\n    [ 17.86%] \u00b7\u00b7\u00b7 core.runner.track_overhead_100ms                                                      4.28\r\n    [ 19.64%] \u00b7\u00b7\u00b7 core.runner.track_overhead_echo                                                       98.6\r\n    [ 21.43%] \u00b7\u00b7\u00b7 core.runner.track_overhead_heavyout                                                    2.8\r\n    [ 23.21%] \u00b7\u00b7\u00b7 core.runner.track_overhead_heavyout_online_process                                  146.17\r\n    [ 25.00%] \u00b7\u00b7\u00b7 core.runner.track_overhead_heavyout_online_through                                   39.01\r\n    [ 25.00%] \u00b7\u00b7\u00b7 asv: forkserver:\r\n    [ 25.00%] \u00b7\u00b7\u00b7 [Level 5] Exiting\r\n\r\n    [ 25.00%] \u00b7\u00b7 Benchmarking virtualenv-py3.7\r\n    [ 26.79%] \u00b7\u00b7\u00b7 Running (core.runner.time_echo--)..\r\n    [ 39.29%] \u00b7\u00b7\u00b7 core.runner.time_echo                                                           1.92\u00b10.1ms\r\n    [ 41.07%] \u00b7\u00b7\u00b7 core.runner.time_echo_gitrunner                                                2.17\u00b10.05ms\r\n    [ 42.86%] \u00b7\u00b7\u00b7 core.runner.track_overhead_100ms                                                      3.38\r\n    [ 44.64%] \u00b7\u00b7\u00b7 core.runner.track_overhead_echo                                                      83.94\r\n    [ 46.43%] \u00b7\u00b7\u00b7 core.runner.track_overhead_heavyout                                                   3.25\r\n    [ 48.21%] \u00b7\u00b7\u00b7 core.runner.track_overhead_heavyout_online_process                                  210.61\r\n    [ 50.00%] \u00b7\u00b7\u00b7 core.runner.track_overhead_heavyout_online_through                                   21.88\r\n    [ 50.00%] \u00b7\u00b7\u00b7 asv: forkserver:\r\n    [ 50.00%] \u00b7\u00b7\u00b7 [Level 5] Exiting\r\n\r\n    [ 50.00%] \u00b7 For DataLad commit 39e8e8b8 <0.11.x>:\r\n    [ 50.00%] \u00b7\u00b7 Building for virtualenv-py2.7, virtualenv-py3.7....\r\n    [ 50.00%] \u00b7\u00b7 Benchmarking virtualenv-py2.7\r\n    [ 51.79%] \u00b7\u00b7\u00b7 Running (core.runner.time_echo--)..\r\n    [ 64.29%] \u00b7\u00b7\u00b7 core.runner.time_echo                                                          2.17\u00b10.04ms\r\n    [ 66.07%] \u00b7\u00b7\u00b7 core.runner.time_echo_gitrunner                                                 2.84\u00b10.5ms\r\n    [ 67.86%] \u00b7\u00b7\u00b7 core.runner.track_overhead_100ms                                                       4.1\r\n    [ 69.64%] \u00b7\u00b7\u00b7 core.runner.track_overhead_echo                                                      89.11\r\n    [ 71.43%] \u00b7\u00b7\u00b7 core.runner.track_overhead_heavyout                                                   1.48\r\n    [ 73.21%] \u00b7\u00b7\u00b7 core.runner.track_overhead_heavyout_online_process                                  149.77\r\n    [ 75.00%] \u00b7\u00b7\u00b7 core.runner.track_overhead_heavyout_online_through                                    41.6\r\n    [ 75.00%] \u00b7\u00b7\u00b7 asv: forkserver:\r\n    [ 75.00%] \u00b7\u00b7\u00b7 [Level 5] Exiting\r\n\r\n    [ 75.00%] \u00b7\u00b7 Benchmarking virtualenv-py3.7\r\n    [ 76.79%] \u00b7\u00b7\u00b7 Running (core.runner.time_echo--)..\r\n    [ 89.29%] \u00b7\u00b7\u00b7 core.runner.time_echo                                                          1.88\u00b10.07ms\r\n    [ 91.07%] \u00b7\u00b7\u00b7 core.runner.time_echo_gitrunner                                                2.21\u00b10.03ms\r\n    [ 92.86%] \u00b7\u00b7\u00b7 core.runner.track_overhead_100ms                                                      3.06\r\n    [ 94.64%] \u00b7\u00b7\u00b7 core.runner.track_overhead_echo                                                      80.28\r\n    [ 96.43%] \u00b7\u00b7\u00b7 core.runner.track_overhead_heavyout                                                   4.02\r\n    [ 98.21%] \u00b7\u00b7\u00b7 core.runner.track_overhead_heavyout_online_process                                  234.83\r\n    [100.00%] \u00b7\u00b7\u00b7 core.runner.track_overhead_heavyout_online_through                                   21.47\r\n    [100.00%] \u00b7\u00b7\u00b7 asv: forkserver:\r\n    [100.00%] \u00b7\u00b7\u00b7 [Level 5] Exiting\r\n\r\nSo the interesting one is consistent ~50% extra overhead for python 3.7 over python 2.7\r\nfor cases where we process output line by line. Overall our \"online\" handling is adding\r\nover 100% overhead. So with some \"smart\" nonblocking/async we might possibly speed things\r\nup twice or more (if I got it right ;-))", "closed_by": {"login": "kyleam", "id": 1297788, "node_id": "MDQ6VXNlcjEyOTc3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1297788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kyleam", "html_url": "https://github.com/kyleam", "followers_url": "https://api.github.com/users/kyleam/followers", "following_url": "https://api.github.com/users/kyleam/following{/other_user}", "gists_url": "https://api.github.com/users/kyleam/gists{/gist_id}", "starred_url": "https://api.github.com/users/kyleam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kyleam/subscriptions", "organizations_url": "https://api.github.com/users/kyleam/orgs", "repos_url": "https://api.github.com/users/kyleam/repos", "events_url": "https://api.github.com/users/kyleam/events{/privacy}", "received_events_url": "https://api.github.com/users/kyleam/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/3319/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/3319/timeline", "performed_via_github_app": null}