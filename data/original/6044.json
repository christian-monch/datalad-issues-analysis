{"url": "https://api.github.com/repos/datalad/datalad/issues/6044", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/6044/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/6044/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/6044/events", "html_url": "https://github.com/datalad/datalad/issues/6044", "id": 1018306624, "node_id": "I_kwDOANZqws48siBA", "number": 6044, "title": "Explain the URL-substitution mechanism", "user": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 227904225, "node_id": "MDU6TGFiZWwyMjc5MDQyMjU=", "url": "https://api.github.com/repos/datalad/datalad/labels/documentation", "name": "documentation", "color": "cfd3d7", "default": true, "description": "Changes only affect the documentation"}, {"id": 390153891, "node_id": "MDU6TGFiZWwzOTAxNTM4OTE=", "url": "https://api.github.com/repos/datalad/datalad/labels/UX", "name": "UX", "color": "0052cc", "default": false, "description": "user experience"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-10-06T13:15:54Z", "updated_at": "2021-10-12T05:38:46Z", "closed_at": "2021-10-12T05:38:46Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "With #5489 continuing to be unresolved, there is no way to even discover that this feature exists, without reading the code.\r\n\r\nSpecifically, this is about `datalad.clone.url-substitute.<label>` config variables:\r\n\r\n```\r\nA substitution specification is a string with a match and substitution\r\nexpression, each following Python's regular expression syntax. Both expressions\r\nare concatenated to a single string with an arbitrary delimiter character. The\r\ndelimiter is defined by prefixing the string with the delimiter. Prefix and\r\ndelimiter are stripped from the expressions (Example:\r\n\",^http://(.*)$,https://\\\\1\").  This setting can be defined multiple times.\r\nSubstitutions will be applied incrementally, in order of their definition. The\r\nfirst substitution in such a series must match, otherwise no further\r\nsubstitutions in a series will be considered. However, following the first\r\nmatch all further substitutions in a series are processed, regardless whether\r\nintermediate expressions match or not.\"\"\"\r\n```\r\n\r\nHere are the two applications of this feature that we carry in the config defaults:\r\n\r\n```\r\ndatalad.clone.url-substitute.github = (\r\n            # take any github project URL apart into <org>###<identifier>\r\n            r',https?://github.com/([^/]+)/(.*)$,\\1###\\2',\r\n            # replace any (back)slashes with a single dash\r\n            r',[/\\\\]+,-',\r\n            # replace any whitespace (include urlquoted variant)\r\n            # with a single underscore\r\n            r',\\s+|(%2520)+|(%20)+,_',\r\n            # rebuild functional project URL\r\n            r',([^#]+)###(.*),https://github.com/\\1/\\2',\r\n        )\r\n\r\ndatalad.clone.url-substitute.osf = (\r\n            # accept browser-provided URL and convert to those accepted by\r\n            # the datalad-osf extension\r\n            r',^https://osf.io/([^/]+)[/]*$,osf://\\1',\r\n        )\r\n```\r\n\r\nI think a \"design document\" is the most appropriate form of documentation right now.", "closed_by": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/6044/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/6044/timeline", "performed_via_github_app": null}