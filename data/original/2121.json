{"url": "https://api.github.com/repos/datalad/datalad/issues/2121", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/2121/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/2121/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/2121/events", "html_url": "https://github.com/datalad/datalad/pull/2121", "id": 295167368, "node_id": "MDExOlB1bGxSZXF1ZXN0MTY3NzE0NzMy", "number": 2121, "title": "[WIP] ENH: Add initial implementation of addurls plugin", "user": {"login": "kyleam", "id": 1297788, "node_id": "MDQ6VXNlcjEyOTc3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1297788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kyleam", "html_url": "https://github.com/kyleam", "followers_url": "https://api.github.com/users/kyleam/followers", "following_url": "https://api.github.com/users/kyleam/following{/other_user}", "gists_url": "https://api.github.com/users/kyleam/gists{/gist_id}", "starred_url": "https://api.github.com/users/kyleam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kyleam/subscriptions", "organizations_url": "https://api.github.com/users/kyleam/orgs", "repos_url": "https://api.github.com/users/kyleam/repos", "events_url": "https://api.github.com/users/kyleam/events{/privacy}", "received_events_url": "https://api.github.com/users/kyleam/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 449733138, "node_id": "MDU6TGFiZWw0NDk3MzMxMzg=", "url": "https://api.github.com/repos/datalad/datalad/labels/WIP", "name": "WIP", "color": "fbca04", "default": false, "description": "work in progress"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 11, "created_at": "2018-02-07T14:55:26Z", "updated_at": "2018-03-09T13:51:22Z", "closed_at": "2018-03-07T16:56:29Z", "author_association": "MEMBER", "active_lock_reason": null, "pull_request": {"url": "https://api.github.com/repos/datalad/datalad/pulls/2121", "html_url": "https://github.com/datalad/datalad/pull/2121", "diff_url": "https://github.com/datalad/datalad/pull/2121.diff", "patch_url": "https://github.com/datalad/datalad/pull/2121.patch"}, "body": "This covers some basic features mentioned at gh-1665.\r\n\r\nThe few things it can do:\r\n\r\n  * Data from a CSV or JSON file can be used to construct URLs and file names to be passed to 'git annex addurl'.\r\n\r\n    The field names from the data file (header names for CSV or properties for JSON) can be used as placeholders like \"{participant_id}.mgz\".  However, names with \"!\" or \":\" aren't currently supported because these are interpreted as formatting flags.\r\n\r\n  * Subdatasets can be created by using \"//\" in the filename format string.\r\n\r\n  * fast=True will pass --fast to 'git annex addurl'.\r\n\r\nSome of what it can't do:\r\n\r\n  * ~It doesn't yet have an option for specifying which columns should be used as metadata.~\r\n\r\n  * ~There's no support for the Content-Disposition filename.~\r\n\r\n  * There isn't a jobs flag that's passed --jobs=N to 'git annex addurl'.\r\n\r\n  * There aren't any reserved formatting keys like \"url_filename\" or \"disposition_filename\".\r\n\r\n    Update: Parts of the URL path are now exposed.\r\n\r\n  * There isn't a non-'git annex addurl' download option (e.g., providers.download).\r\n\r\n    And if we want to provide a non-addurl option, perhaps my choice to call this plugin `addurls` wasn't a good one.\r\n\r\n\r\nAnd it of course needs tests.\r\n\r\n### To add\r\n\r\nHere's my current plan for what to add to this PR.\r\n\r\n- [x] tests\r\n\r\n- [x] support for setting metadata based on information in the file\r\n\r\n- [x] add support for metadata\r\n\r\n- [x] ability to provide replace empty strings with another missing value\r\n\r\n- [x] parts of the URL path are now accessible in `filename_format` as `_url_0`, ..., `_url_N`.  There's also `_url_basename` for the rightmost url part.\r\n\r\n- [x] progress bars for `addurl` and metadata actions\r\n\r\n- [ ] batch `git annex metadata --set` calls?\r\n\r\n  ~At the least, I should group the calls so that it calls once per file rather than once per file per metadata field.  (I hadn't realized you could use `--set` multiple times.)~\r\n\r\n  Update: The call is now made once per file.\r\n\r\n- [x] add support for the Content-Disposition filename.\r\n\r\n### Maybe later\r\n\r\nThings that I don't plan to add to this PR\r\n\r\n- [ ] better way to handle the placeholder formatting?\r\n\r\n  Nothing better has occurred to me yet.\r\n\r\n- [ ] jobs flag\r\n\r\n  I'm not sure if this is possible with batch commands.\r\n\r\n\r\n### Changes\r\n\r\n- [X] This is in progress\r\n\r\nPlease have a look @datalad/developers\r\n", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/2121/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/2121/timeline", "performed_via_github_app": null}