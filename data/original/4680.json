{"url": "https://api.github.com/repos/datalad/datalad/issues/4680", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/4680/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/4680/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/4680/events", "html_url": "https://github.com/datalad/datalad/pull/4680", "id": 652621044, "node_id": "MDExOlB1bGxSZXF1ZXN0NDQ1NjU5NTUw", "number": 4680, "title": "Avoid SSH-based stalling with recent git-annex versions", "user": {"login": "kyleam", "id": 1297788, "node_id": "MDQ6VXNlcjEyOTc3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1297788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kyleam", "html_url": "https://github.com/kyleam", "followers_url": "https://api.github.com/users/kyleam/followers", "following_url": "https://api.github.com/users/kyleam/following{/other_user}", "gists_url": "https://api.github.com/users/kyleam/gists{/gist_id}", "starred_url": "https://api.github.com/users/kyleam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kyleam/subscriptions", "organizations_url": "https://api.github.com/users/kyleam/orgs", "repos_url": "https://api.github.com/users/kyleam/repos", "events_url": "https://api.github.com/users/kyleam/events{/privacy}", "received_events_url": "https://api.github.com/users/kyleam/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2020-07-07T20:34:06Z", "updated_at": "2020-07-10T21:56:01Z", "closed_at": "2020-07-07T21:48:08Z", "author_association": "MEMBER", "active_lock_reason": null, "pull_request": {"url": "https://api.github.com/repos/datalad/datalad/pulls/4680", "html_url": "https://github.com/datalad/datalad/pull/4680", "diff_url": "https://github.com/datalad/datalad/pull/4680.diff", "patch_url": "https://github.com/datalad/datalad/pull/4680.patch"}, "body": "Most of the hanging we were seeing with recent git-annex versions was recently fixed by git-annex's [8.20200617-134-gf912f8e5f](https://git.kitenet.net/index.cgi/git-annex.git/commit/?id=f912f8e5f) (refix bug in a better way, 2020-07-02, [bug report][0]).  That affected a good number of SSH tests.  This series should avoid the remaining stalls.\r\n\r\n```\r\n  [1/4] CLN: test_annexrepo: Prune unused imports\r\n  [2/4] CLN: test_annexrepo: Merge a near-duplicate test\r\n  [3/4] TST: annexrepo: Clear repo instances when testing shared connections\r\n  [4/4] TST: with_sameas_remote: Skip on older systems\r\n```\r\n\r\nThe first two commits are test_annex cleanups, followed by a commit that fixes our connection handling in `test_annex_ssh` and removes the skip added in gh-4288.\r\n\r\nThe final commit deals with a remaining [hang][1] exposed by our sameas testing setup.  That is a different source that looks to be an interaction between a recent git-annex change ([8.20200522-77-g1f2e2d15e AKA 8.20200617~99](https://git.kitenet.net/index.cgi/git-annex.git/commit/?id=1f2e2d15e)) and the old openssh or rsync versions on Xenial.  It may be limited to rsync special remotes.  I filed [an issue][2] on git-annex's side.  In terms of openssh/rsync versions, things should be okay for all non-EOL Debian releases (no hanging until we get to the Jessie).  On the other hand, Xenial's EOL isn't until April 2021.\r\n\r\nAnyway, the final commit skips tests that use the rsync/dir sameas setup if it looks like we're on an older system with a new enough git-annex.  Even if we start using a newer git-annex for our regular Travis jobs, these tests will still be executed in our Bionic job.\r\n\r\nOur current Travis setup of course won't test this out.  A run with this PR's tree and git-annex's current master (8.20200618-gc9d0bf0e6) is at <https://travis-ci.org/github/datalad/datalad/builds/705920487>.  None of the jobs stalled.\r\n\r\n[0]: https://git-annex.branchable.com/bugs/annex-ssh-options_dropped_since_8.20200330/\r\n[1]: https://travis-ci.org/github/datalad/datalad/builds/704464417\r\n[2]: https://git-annex.branchable.com/bugs/Recent_hang_with_rsync_remote_with_older_systems___40__Xenial__44___Jessie__41__/\r\n", "closed_by": {"login": "kyleam", "id": 1297788, "node_id": "MDQ6VXNlcjEyOTc3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1297788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kyleam", "html_url": "https://github.com/kyleam", "followers_url": "https://api.github.com/users/kyleam/followers", "following_url": "https://api.github.com/users/kyleam/following{/other_user}", "gists_url": "https://api.github.com/users/kyleam/gists{/gist_id}", "starred_url": "https://api.github.com/users/kyleam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kyleam/subscriptions", "organizations_url": "https://api.github.com/users/kyleam/orgs", "repos_url": "https://api.github.com/users/kyleam/repos", "events_url": "https://api.github.com/users/kyleam/events{/privacy}", "received_events_url": "https://api.github.com/users/kyleam/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/4680/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/4680/timeline", "performed_via_github_app": null}