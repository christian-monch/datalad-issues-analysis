{"url": "https://api.github.com/repos/datalad/datalad/issues/4605", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/4605/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/4605/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/4605/events", "html_url": "https://github.com/datalad/datalad/issues/4605", "id": 630224204, "node_id": "MDU6SXNzdWU2MzAyMjQyMDQ=", "number": 4605, "title": "distribution-restrictions, numcopies, and required content", "user": {"login": "kyleam", "id": 1297788, "node_id": "MDQ6VXNlcjEyOTc3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1297788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kyleam", "html_url": "https://github.com/kyleam", "followers_url": "https://api.github.com/users/kyleam/followers", "following_url": "https://api.github.com/users/kyleam/following{/other_user}", "gists_url": "https://api.github.com/users/kyleam/gists{/gist_id}", "starred_url": "https://api.github.com/users/kyleam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kyleam/subscriptions", "organizations_url": "https://api.github.com/users/kyleam/orgs", "repos_url": "https://api.github.com/users/kyleam/repos", "events_url": "https://api.github.com/users/kyleam/events{/privacy}", "received_events_url": "https://api.github.com/users/kyleam/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-06-03T18:28:02Z", "updated_at": "2020-06-12T20:00:11Z", "closed_at": "2020-06-12T20:00:11Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "The metadata section of the manual [describes](https://docs.datalad.org/en/stable/metadata.html#automating-non-distribution-of-sensitive-files) using the `distribution-restrictions` field to mark files that shouldn't be shared publicly. This is a dedicated issue to track the concern I've mentioned elsewhere. In order to expect `datalad publish` to not transfer marked data, callers need to worry about and monitor the `numcopies` setting.\r\n\r\n<details><summary>example</summary>\r\n\r\n```sh\r\n#!/bin/sh\r\n\r\ncd \"$(mktemp -d ${TMPDIR:-/tmp}/dl-XXXXXXX)\"\r\n\r\ndatalad create a\r\n(\r\n    cd a\r\n    git config receive.denyCurrentBranch updateInstead\r\n    git annex numcopies 2\r\n)\r\n\r\ndatalad clone a b\r\n(\r\n    cd b\r\n    echo foo >foo\r\n    echo bar >bar\r\n    datalad save\r\n    git annex metadata --set distribution-restrictions=sensitive bar\r\n    git annex wanted origin \"not metadata=distribution-restrictions=*\"\r\n    datalad publish --to origin\r\n)\r\n\r\n\r\n(\r\n    cd a\r\n    cat foo\r\n    cat bar\r\n)\r\n```\r\n\r\n</details>\r\n\r\nThis setting is usually shared between clones, so it is also possible for users that are aware of the `numcopies` behavior to accidentally publish sensitive information because they didn't catch an incoming change in the `numcopies` value.\r\n\r\nUpdating `publish` to override `numcopies` in its call to `git annex copy` would be sufficient to prevent the above case, I think. Another option would be to try to detect whether `numcopies` is set above 1 and abort if `--auto` will be used. Yet another possibility would be to update the documentation to suggest setting a file-level `annex.numcopies` value in .gitattributes.\r\n\r\nWhen thinking about how to address this, it is worth considering that very similar concerns apply to required content. (As an example, replace the `git annex numcopies` call in the above script with `git annex required . anything`.)\r\n\r\nIn my view the minimum action needed is an update of the docs to provide a warning that the suggested approach is dangerous if `numcopies` is above the default value of 1 or if required content is configured.", "closed_by": {"login": "kyleam", "id": 1297788, "node_id": "MDQ6VXNlcjEyOTc3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1297788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kyleam", "html_url": "https://github.com/kyleam", "followers_url": "https://api.github.com/users/kyleam/followers", "following_url": "https://api.github.com/users/kyleam/following{/other_user}", "gists_url": "https://api.github.com/users/kyleam/gists{/gist_id}", "starred_url": "https://api.github.com/users/kyleam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kyleam/subscriptions", "organizations_url": "https://api.github.com/users/kyleam/orgs", "repos_url": "https://api.github.com/users/kyleam/repos", "events_url": "https://api.github.com/users/kyleam/events{/privacy}", "received_events_url": "https://api.github.com/users/kyleam/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/4605/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/4605/timeline", "performed_via_github_app": null}