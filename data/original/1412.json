{"url": "https://api.github.com/repos/datalad/datalad/issues/1412", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/1412/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/1412/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/1412/events", "html_url": "https://github.com/datalad/datalad/issues/1412", "id": 216066422, "node_id": "MDU6SXNzdWUyMTYwNjY0MjI=", "number": 1412, "title": "datalad add is obnoxious (runs git/annex add 2 times) and WRONG (adds to annex) in disregarding .gitattributes", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-03-22T13:41:48Z", "updated_at": "2017-03-23T03:29:39Z", "closed_at": "2017-03-23T03:29:39Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "discovered while trying to use 0.5.0\r\n```shell\r\nhopa:/tmp/test2\r\n$> cat .gitattributes; echo 128 > 128.txt; DATALAD_LOG_LEVEL=1 datalad add 128.txt 2>&1 | grep 'Running.*git.*add'\r\n* annex.largefiles=(not(mimetype=text/*))                                                                         \r\n[DEBUG] Running: ['git', '-c', 'receive.autogc=0', '-c', 'gc.auto=0', 'add', '--dry-run', '-N', '--ignore-missing', '--verbose', '128.txt']\r\nTotal:   0%|          | 0.00/4.00 [00:00<?, ?B/s][DEBUG] Running: ['git', '-c', 'receive.autogc=0', '-c', 'gc.auto=0', 'annex', 'add', '--debug', '--json', '-c', 'annex.largefiles=anything', '128.txt']\r\n[DEBUG] Running: ['git', '-c', 'receive.autogc=0', '-c', 'gc.auto=0', 'add', '--dry-run', '-N', '--ignore-missing', '--verbose', '128.txt']\r\n[DEBUG] Running: ['git', '-c', 'receive.autogc=0', '-c', 'gc.auto=0', 'annex', 'add', '--debug', '--json', '128.txt']\r\n(dev) 2 14279 [2].....................................:Wed 22 Mar 2017 09:39:30 AM EDT:.\r\nhopa:/tmp/test2\r\n$> ls -ld 128.txt            \r\nlrwxrwxrwx 1 yoh yoh 116 Mar 22 09:39 128.txt -> .git/annex/objects/X9/77/MD5E-s4--650a1c9c9baa20730b4fcfdbe4cdc135.txt/MD5E-s4--650a1c9c9baa20730b4fcfdbe4cdc135.txt\r\n```\r\n\r\nso you can see that first it 'git add's in dry, then explicitly adds into annex by specifying largefiles=anything, and then again adds it dry, and then again, finally calls what imho should be the correct call to annex", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/1412/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/1412/timeline", "performed_via_github_app": null}