{"url": "https://api.github.com/repos/datalad/datalad/issues/3655", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/3655/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/3655/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/3655/events", "html_url": "https://github.com/datalad/datalad/issues/3655", "id": 490599853, "node_id": "MDU6SXNzdWU0OTA1OTk4NTM=", "number": 3655, "title": "Performance observations with large subdataset numbers", "user": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 289240596, "node_id": "MDU6TGFiZWwyODkyNDA1OTY=", "url": "https://api.github.com/repos/datalad/datalad/labels/performance", "name": "performance", "color": "f4b2d8", "default": false, "description": "Improve performance of an existing feature"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2019-09-07T06:40:15Z", "updated_at": "2019-10-24T12:36:56Z", "closed_at": "2019-10-05T08:36:21Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "I created 1000 datasets (not particular content). That takes about 500ms per dataset on my laptop. I used this code (yeah, lazy, I know)\r\n\r\n```python\r\n [dl.create('/'.join((str(uuid.uuid4())[:2], str(uuid.uuid4())))) for i in range(1000)]  \r\n```\r\n\r\nAdding them to a superdataset worked without issues. However the results have the wrong type (`file`).\r\n\r\nA superdataset with 1000 empty subdatasets weighs 315 MB on the filesystem.\r\n\r\n```\r\n% datalad save \r\n...\r\nadd(ok): ff/b143ff42-85c4-4d6f-bcc7-c4d9c6fd50cc (file)\r\nadd(ok): ff/e4287631-3e94-4183-9a68-e7f84d87c99d (file)\r\nadd(ok): .gitmodules (file)\r\nsave(ok): . (dataset)\r\naction summary:\r\n  add (ok: 1001)\r\n  save (ok: 1)\r\ndatalad save  132.18s user 59.01s system 100% cpu 3:11.04 total\r\n```\r\n\r\nSubdataset reporting seems to be speedy and working fine.\r\n\r\n```\r\n% datalad subdatasets\r\n...\r\nsubdataset(ok): ff/e4287631-3e94-4183-9a68-e7f84d87c99d (dataset)\r\naction summary:\r\n  subdataset (ok: 1000)\r\ndatalad subdatasets  0.72s user 0.18s system 96% cpu 0.933 total\r\n```\r\n\r\nA save attempt on the (clean) superdataset is a bit sluggish though\r\n\r\n```\r\n% time dl save\r\ndatalad save  35.30s user 18.30s system 100% cpu 53.371 total\r\n```\r\n\r\nUninstall is a problem:\r\n\r\n```\r\n% datalad uninstall -r --nocheck */*\r\nuninstall(ok): /tmp/alot/ff/e4287631-3e94-4183-9a68-e7f84d87c99d (dataset)\r\nuninstall(ok): /tmp/alot/ff/b143ff42-85c4-4d6f-bcc7-c4d9c6fd50cc (dataset)\r\n...\r\naction summary:\r\n  uninstall (ok: 1000)\r\ndatalad uninstall -r --nocheck */*  301.58s user 131.57s system 99% cpu 7:15.19 total\r\n```\r\n\r\nThe superdataset's `.git` weighs ~25MB, and it has\r\n\r\n```\r\n% git count-objects \r\n1002 objects, 23436 kilobytes\r\n```\r\n\r\nroughly 25KB per subdataset.\r\n\r\n", "closed_by": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/3655/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/3655/timeline", "performed_via_github_app": null}