{"url": "https://api.github.com/repos/datalad/datalad/issues/2417", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/2417/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/2417/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/2417/events", "html_url": "https://github.com/datalad/datalad/pull/2417", "id": 313726224, "node_id": "MDExOlB1bGxSZXF1ZXN0MTgyMzg1OTIx", "number": 2417, "title": "Kill *Repo.add(commit=True)", "user": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 526935563, "node_id": "MDU6TGFiZWw1MjY5MzU1NjM=", "url": "https://api.github.com/repos/datalad/datalad/labels/feedback-desired", "name": "feedback-desired", "color": "fbca04", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-04-12T13:26:00Z", "updated_at": "2018-07-15T06:08:29Z", "closed_at": "2018-05-12T07:34:51Z", "author_association": "MEMBER", "active_lock_reason": null, "pull_request": {"url": "https://api.github.com/repos/datalad/datalad/pulls/2417", "html_url": "https://github.com/datalad/datalad/pull/2417", "diff_url": "https://github.com/datalad/datalad/pull/2417.diff", "patch_url": "https://github.com/datalad/datalad/pull/2417.patch"}, "body": "I am debugging in the context of #1921 and get to see the code layer again after months/years. I really think these functions should do much less than they do now. In particular, I would like to RF away the ability to `commit=True`. It makes the structure of those functions needlessly complicated, it prevents them from being usable as a generator, and (I hope) we don't need this functionality anywhere.\r\n\r\nTo be precise: we need it in oldish test code, but no real functionality uses it:\r\n```\r\ndatalad/customremotes/tests/test_archives.py:    annex.add(fn_archive, commit=True, msg=\"Added tarball\")\r\ndatalad/customremotes/tests/test_archives.py:    annex.add(fn_extracted, commit=True, msg=\"Added the load file\")\r\ndatalad/customremotes/tests/test_archives.py:    annex.add('a.tar.gz', commit=True)\r\ndatalad/distribution/create_test_dataset.py:    repo.add(fn, git=True, commit=True, msg=\"Added %s\" % fn, _datalad_msg=True)\r\ndatalad/distribution/tests/test_install.py:    repo.add('file.txt', commit=True, git=not annex)\r\ndatalad/distribution/tests/test_publish.py:                    commit=True, msg=\"Modified.\")\r\ndatalad/distribution/tests/test_publish.py:                    commit=True, msg=\"Modified.\")\r\ndatalad/distribution/tests/test_update.py:    rmt1.add(\"first.txt\", commit=True)\r\ndatalad/distribution/tests/test_update.py:    rmt2.add(\"second.txt\", git=True, commit=True, msg=\"Add file to git.\")\r\ndatalad/interface/tests/test_ls_webui.py:    annex.add(opj(topdir, 'dir'), commit=True)\r\ndatalad/interface/tests/test_ls_webui.py:    git.add(opj(topdir, 'dir', 'subgit', 'fgit.txt'), commit=True)              # commit to git to init git repo\r\ndatalad/interface/tests/test_ls_webui.py:    annex.add(opj(topdir, 'dir', 'subgit'), commit=True)                        # add the non-dataset git repo to annex\r\ndatalad/interface/tests/test_ls_webui.py:    annex.add(opj(topdir, 'dir'), commit=True)                                  # add to annex (links)\r\ndatalad/interface/tests/test_run.py:    ds.repo.add(\".\", commit=True)\r\ndatalad/interface/tests/test_run.py:    ds.repo.add([\"to_add\"], commit=True)\r\ndatalad/interface/tests/test_run.py:    ds.repo.add([\"to_modify\", \"d/to_modify\"], commit=True)\r\ndatalad/support/tests/test_annexrepo.py:    annex.add(files, commit=True)\r\ndatalad/support/tests/test_annexrepo.py:    annex.add(files, commit=True)\r\ndatalad/support/tests/test_annexrepo.py:    repo.add(filename, commit=True, msg=\"Added another file to annex.\")\r\ndatalad/support/tests/test_annexrepo.py:    repo.add(filename, git=True, commit=True,\r\ndatalad/support/tests/test_annexrepo.py:    sync_wrapper(pull=False, push=False, commit=True)\r\ndatalad/support/tests/test_annexrepo.py:    sub.add('fourth', commit=True, msg=\"birther mod init'ed\")\r\ndatalad/support/tests/test_gitrepo.py:    added2 = gr.add(filename, commit=True, msg=\"Add two files.\")\r\ndatalad/support/tests/test_gitrepo.py:    repo.add('.', commit=True)\r\ndatalad/support/tests/utils.py:    repo.add(\"testfile.txt\", commit=True, msg=\"some load\")\r\ndatalad/tests/utils.py:        repo.add(file_repo_path, commit=True, _datalad_msg=True)\r\n```", "closed_by": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/2417/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/2417/timeline", "performed_via_github_app": null}