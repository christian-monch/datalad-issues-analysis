{"url": "https://api.github.com/repos/datalad/datalad/issues/1319", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/1319/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/1319/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/1319/events", "html_url": "https://github.com/datalad/datalad/issues/1319", "id": 208996667, "node_id": "MDU6SXNzdWUyMDg5OTY2Njc=", "number": 1319, "title": "\"new\" behavior of git-annex 6.20170220+gitgbfb38eece - upon publish new commit on remote git-annex", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2017-02-20T22:35:00Z", "updated_at": "2017-02-24T07:01:08Z", "closed_at": "2017-02-22T16:06:44Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Was checking new version and one test (only) started to fail:\r\n```\r\n$> DATALAD_TESTS_SSH=1 nosetests -s -v datalad/distribution/tests/test_publish.py:test_publish_simple\r\n                                                                                                                                              \r\nFAIL\r\nVersions: cmd:annex=6.20170220+gitgbfb38eece-1~ndall+1 cmd:git=2.11.0 cmd:system-git=2.11.0 tqdm=4.11.2\r\n\r\n======================================================================\r\nFAIL: datalad.distribution.tests.test_publish.test_publish_simple\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python2.7/dist-packages/nose/case.py\", line 197, in runTest\r\n    self.test(*self.arg)\r\n  File \"/home/yoh/proj/datalad/datalad/datalad/tests/utils.py\", line 734, in newfunc\r\n    t(*(arg + (uri,)), **kw)\r\n  File \"/home/yoh/proj/datalad/datalad/datalad/tests/utils.py\", line 564, in newfunc\r\n    return t(*(arg + (filename,)), **kw)\r\n  File \"/home/yoh/proj/datalad/datalad/datalad/tests/utils.py\", line 564, in newfunc\r\n    return t(*(arg + (filename,)), **kw)\r\n  File \"/home/yoh/proj/datalad/datalad/datalad/distribution/tests/test_publish.py\", line 99, in test_publish_simple\r\n    list(source.repo.get_branch_commits(\"git-annex\")))\r\nAssertionError: [<git.Commit \"2c3b83d1e068ad5df9ed38068b0babb8ae07e363\">, <git.Commit \"754322640238eeb5245f648efedc1aa907d56f33\">, <git.Commit \"31c5239a5b50aa1afe3d2f0c9cf2c88240ce7d7e\">, <git.Commit \"8dddd0901575a723b2452532d559bf0c3165bad1\">, <git.Commit \"7431e40519e765c12796a1e967c14a1ae20ff271\">, <git.Commit \"dfe848b0ca52af62f5c2e2e497674f6d632adaab\">, <git.Commit \"96d7e23796be713e2056cfd56d25deb2fc4d44ad\">, <git.Commit \"013d4cff32e12e9b57a79944fd2c63da03ac8d30\">] != [<git.Commit \"754322640238eeb5245f648efedc1aa907d56f33\">, <git.Commit \"31c5239a5b50aa1afe3d2f0c9cf2c88240ce7d7e\">, <git.Commit \"8dddd0901575a723b2452532d559bf0c3165bad1\">, <git.Commit \"7431e40519e765c12796a1e967c14a1ae20ff271\">, <git.Commit \"dfe848b0ca52af62f5c2e2e497674f6d632adaab\">, <git.Commit \"96d7e23796be713e2056cfd56d25deb2fc4d44ad\">, <git.Commit \"013d4cff32e12e9b57a79944fd2c63da03ac8d30\">]\r\n--------------------- >> end captured logging << ---------------------\r\n\r\n----------------------------------------------------------------------\r\nRan 1 test in 14.781s\r\n\r\nFAILED (failures=1)\r\nDATALAD_TESTS_SSH=1 nosetests -s -v   5.50s user 2.14s system 47% cpu 15.986 total\r\n```\r\n\r\nthe reason is that upon last publish, annex manages to update on remote end uuid.log to finally list that repository within it (which is kinda sensible), making remote 'git-annex' branch ahead of the local one (which is minor but imho not desired if we really want to keep them in 'sync').  It is not clear to me why git-annex decided to do that only then, after all the previous pushes (may be hook was not triggered for it at all or smth like that)?\r\n\r\nFWIW -- I uploaded that new git-annex into the '-devel' of neurodebian for now if you want to give it a shot (here is a direct link to the directory: http://neuro.debian.net/debian-devel/pool/main/g/git-annex/ . but if you feel that we should just allow git-annex to do that and do nothing about it, we could workaround in the test for that new (and keeping compatibility with old I guess) behavior and upload new git-annex.\r\n\r\nalternative would be to merge remote git-annex after each publish I guess.... heh", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/1319/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/1319/timeline", "performed_via_github_app": null}