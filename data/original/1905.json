{"url": "https://api.github.com/repos/datalad/datalad/issues/1905", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/1905/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/1905/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/1905/events", "html_url": "https://github.com/datalad/datalad/issues/1905", "id": 266628574, "node_id": "MDU6SXNzdWUyNjY2Mjg1NzQ=", "number": 1905, "title": "install (and update for that purpose) should be able to install from non-origin", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-10-18T20:20:14Z", "updated_at": "2017-10-27T09:08:39Z", "closed_at": "2017-10-27T09:08:39Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "#### What is the problem?\r\n\r\n`install` considers only the origin (and current dataset) to deduce full URL for a sub-dataset, although origin might be not the one having that submodule\r\n\r\n#### What steps will reproduce the problem?\r\n```python\r\n#!/usr/bin/python\r\n\r\nimport datalad.api as dl\r\nfrom datalad.utils import chpwd, getpwd, rmtree\r\nfrom os import mkdir\r\nfrom os.path import exists\r\n\r\ntopdir = 'test-update'\r\norigin_ = 'origin'\r\nclone1_ = 'clone1'\r\nclone2_ = 'clone2'\r\n\r\nif exists(topdir):\r\n   rmtree(topdir)\r\nmkdir(topdir)\r\nchpwd(topdir)\r\n\r\norigin = dl.create(origin_, no_annex=True)\r\nclone1 = dl.install(source=origin_, path=clone1_)\r\nprint(\"Initial clone\")\r\nclone1.create_sibling('ssh://localhost%s/%s' % (getpwd(), clone2_), name=clone2_)\r\n\r\nprint(\"Creating clone2\")\r\nclone1.publish(to=clone2_)\r\nclone2 = dl.Dataset(clone2_)\r\nprint(\"Initiating subdataset\")\r\nclone2.create('subds1')\r\n\r\nprint(\"Updating\")\r\nclone1.update(merge=True, sibling=clone2_)\r\nprint(\"Installing within updated dataset -- should be able to install from clone2\")\r\nclone1.install('subds1')\r\n```\r\nwould result at the end at\r\n```\r\n\r\ndatala[INFO   ] Cloning /home/yoh/trash/test-update/origin/subds1 to '/home/yoh/trash/test-update/clone1/subds1' \r\n[ERROR  ] Failed to clone data from any candidate source URL: ['/home/yoh/trash/test-update/origin/subds1'] [install(/home/yoh/trash/test-update/clone1/subds1)] \r\n[ERROR  ] Installation of subdatasets /home/yoh/trash/test-update/clone1/subds1 failed with exception: InstallFailedError: \r\nFailed to install dataset from: ['/home/yoh/trash/test-update/origin/subds1'] [get.py:_install_subds_from_flexible_source:150] [install(/home/yoh/trash/test-update/clone1/subds1)]\r\n.... \r\ndatalad.support.exceptions.IncompleteResultsError: Command did not complete successfully [{'status': 'error', 'message': ('Installation of subdatasets %s failed with exception: %s', '/home/yoh/trash/test-update/clone1/subds1', \"InstallFailedError: \\nFailed to install dataset from: ['/home/yoh/trash/test-update/origin/subds1'] [get.py:_install_subds_from_flexible_source:150]\"), 'action': 'install', 'path': '/home/yoh/trash/test-update/clone1/subds1', 'type': 'dataset', 'refds': '/home/yoh/trash/test-update/clone1'}]\r\n```\r\nso it didn't even try to get it from clone2 (did try for origin and itself clone1 though ;))\r\n\r\n# Resolution?\r\n\r\nif to be done in a smart way, we could check for the most recent commit which dealt with the subdataset path, check which remote(s) have that commit, sweep through those remotes as possible candidates for the installation of that submodule", "closed_by": {"login": "bpoldrack", "id": 10498301, "node_id": "MDQ6VXNlcjEwNDk4MzAx", "avatar_url": "https://avatars.githubusercontent.com/u/10498301?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bpoldrack", "html_url": "https://github.com/bpoldrack", "followers_url": "https://api.github.com/users/bpoldrack/followers", "following_url": "https://api.github.com/users/bpoldrack/following{/other_user}", "gists_url": "https://api.github.com/users/bpoldrack/gists{/gist_id}", "starred_url": "https://api.github.com/users/bpoldrack/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bpoldrack/subscriptions", "organizations_url": "https://api.github.com/users/bpoldrack/orgs", "repos_url": "https://api.github.com/users/bpoldrack/repos", "events_url": "https://api.github.com/users/bpoldrack/events{/privacy}", "received_events_url": "https://api.github.com/users/bpoldrack/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/1905/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/1905/timeline", "performed_via_github_app": null}