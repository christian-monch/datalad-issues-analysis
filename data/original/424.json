{"url": "https://api.github.com/repos/datalad/datalad/issues/424", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/424/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/424/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/424/events", "html_url": "https://github.com/datalad/datalad/issues/424", "id": 153185006, "node_id": "MDU6SXNzdWUxNTMxODUwMDY=", "number": 424, "title": "Be more clever wrt to \"install from submodule checkout\"", "user": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 63778592, "node_id": "MDU6TGFiZWw2Mzc3ODU5Mg==", "url": "https://api.github.com/repos/datalad/datalad/labels/enhancement", "name": "enhancement", "color": "0052cc", "default": true, "description": ""}, {"id": 135267875, "node_id": "MDU6TGFiZWwxMzUyNjc4NzU=", "url": "https://api.github.com/repos/datalad/datalad/labels/do-in-datalad", "name": "do-in-datalad", "color": "ffda63", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": {"login": "bpoldrack", "id": 10498301, "node_id": "MDQ6VXNlcjEwNDk4MzAx", "avatar_url": "https://avatars.githubusercontent.com/u/10498301?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bpoldrack", "html_url": "https://github.com/bpoldrack", "followers_url": "https://api.github.com/users/bpoldrack/followers", "following_url": "https://api.github.com/users/bpoldrack/following{/other_user}", "gists_url": "https://api.github.com/users/bpoldrack/gists{/gist_id}", "starred_url": "https://api.github.com/users/bpoldrack/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bpoldrack/subscriptions", "organizations_url": "https://api.github.com/users/bpoldrack/orgs", "repos_url": "https://api.github.com/users/bpoldrack/repos", "events_url": "https://api.github.com/users/bpoldrack/events{/privacy}", "received_events_url": "https://api.github.com/users/bpoldrack/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "bpoldrack", "id": 10498301, "node_id": "MDQ6VXNlcjEwNDk4MzAx", "avatar_url": "https://avatars.githubusercontent.com/u/10498301?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bpoldrack", "html_url": "https://github.com/bpoldrack", "followers_url": "https://api.github.com/users/bpoldrack/followers", "following_url": "https://api.github.com/users/bpoldrack/following{/other_user}", "gists_url": "https://api.github.com/users/bpoldrack/gists{/gist_id}", "starred_url": "https://api.github.com/users/bpoldrack/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bpoldrack/subscriptions", "organizations_url": "https://api.github.com/users/bpoldrack/orgs", "repos_url": "https://api.github.com/users/bpoldrack/repos", "events_url": "https://api.github.com/users/bpoldrack/events{/privacy}", "received_events_url": "https://api.github.com/users/bpoldrack/received_events", "type": "User", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/datalad/datalad/milestones/22", "html_url": "https://github.com/datalad/datalad/milestone/22", "labels_url": "https://api.github.com/repos/datalad/datalad/milestones/22/labels", "id": 1482873, "node_id": "MDk6TWlsZXN0b25lMTQ4Mjg3Mw==", "number": 22, "title": "Publication (tracking)", "description": "This milestone is being abused by Michael for his education. It collects issues regarding the publication of collections and handles.", "creator": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 18, "state": "closed", "created_at": "2016-01-04T17:02:49Z", "updated_at": "2017-02-10T13:06:38Z", "due_on": null, "closed_at": "2017-02-10T13:06:38Z"}, "comments": 7, "created_at": "2016-05-05T07:48:40Z", "updated_at": "2016-05-11T11:02:50Z", "closed_at": "2016-05-11T11:02:50Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Apologies for a possible duplication, but I couldn't find the original discussion anymore.\n\nSynopsis: Git's submodule implementation is not as clever as it could be with respect to figuring out from which location to clone a submodule. Here is a demo of the core issue:\n\n```\n% datalad install -s http://psydata.ovgu.de/studyforrest/templatetransforms/.git tnt\n% cd tnt\n% grep -A2 '^\\[submodule \"raw/structural\"\\]' .gitmodules\n[submodule \"raw/structural\"]\n    path = raw/structural\n    url = ../structural\n```\n\nThe location of the respective submodule is this: http://psydata.ovgu.de/studyforrest/structural/\n\nGiven that it isn't a bare repository the actual source URL is: http://psydata.ovgu.de/studyforrest/structural/.git/\n\nCurrent Git is not able to figure this out.\n\nAFAICS we can work around this problem, by detecting a failure and make an educated second guess. First the failure:\n\n```\n% datalad install raw/structural\n....\n2016-05-05 09:22:07,575 [ERROR  ] CommandError: command '['git', 'submodule', 'update', '--init', 'raw/structural']' failed with exitcode 128.\n| Failed to run ['git', 'submodule', 'update', '--init', 'raw/structural'] under '/tmp/tnt'. Exit code=128. out=Submodule 'raw/structural' (http://psydata.ovgu.de/studyforrest/templatetransforms/structural) registered for path 'raw/structural'\n|  err=Cloning into 'raw/structural'...\n| fatal: repository 'http://psydata.ovgu.de/studyforrest/templatetransforms/structural/' not found\n| fatal: clone of 'http://psydata.ovgu.de/studyforrest/templatetransforms/structural' into submodule path 'raw/structural' failed\n|  [cmd.py:run:296] (CommandError) (main.py:235)\n```\n\nThis leaves us without an initialized submodule, but a misconfigured submodule URL remains:\n\n```\n% git submodule status raw/structural\n-54e555acea857acdb2a8b713cc4c7c7b09607b3d raw/structural\n% git config submodule.raw/structural.url\nhttp://psydata.ovgu.de/studyforrest/templatetransforms/structural\n```\n\nWe can fix this by looking at \n\n```\n% git config remote.origin.url\nhttp://psydata.ovgu.de/studyforrest/templatetransforms/.git\n% grep -A2 '^\\[submodule \"raw/structural\"\\]' .gitmodules |grep url | cut -d '=' -f 2\n ../structural\n```\n\nRemove `.git` from the origin URL, and resolve the relative path from the submodule URL. For increased flexibility we could try first with the resulting http://psydata.ovgu.de/studyforrest/structural and fail again in this case, and subsequently append `/.git/` and try one last time. However, it seems unlikely that git repositories at a close-by location mix different setup (bare, non-bare, ...).\n\nAnyway, after fixing up the git config setting things start working:\n\n```\n% git config submodule.raw/structural.url http://psydata.ovgu.de/studyforrest/structural/.git/\n% mkdir raw/structural\n% datalad install raw/structural\n2016-05-05 09:40:47,548 [ERROR  ] stderr| Cloning into 'raw/structural'... (cmd.py:351)\n1 installed item is available at\n<Dataset path=/tmp/tnt/raw/structural>\n% git -C raw/structural status\nHEAD detached at 54e555a\nnothing to commit, working directory clean\n```\n\nFew notes:\n- this workaround doesn't require a modification of any content checked into Git, hence no useless cruft is generated in the history\n- appart from an initial failing clone attempt it doesn't waste bandwidth or storage with useless intermediate results\n- the `mkdir` above is required as the initial install attempt kills the submodule mount point for some reason. If datalad doesn't find this mountpoint the second install attempt will happily create a new empty submodule -- this is likely a bug on its own\n- for reasons not 100% clear to me the trailing `/` of the fixed submodule URL is critical\n", "closed_by": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/424/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/424/timeline", "performed_via_github_app": null}