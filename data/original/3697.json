{"url": "https://api.github.com/repos/datalad/datalad/issues/3697", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/3697/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/3697/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/3697/events", "html_url": "https://github.com/datalad/datalad/issues/3697", "id": 496650838, "node_id": "MDU6SXNzdWU0OTY2NTA4Mzg=", "number": 3697, "title": "`datalad run` on Windows silent when something goes wrong", "user": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 188141023, "node_id": "MDU6TGFiZWwxODgxNDEwMjM=", "url": "https://api.github.com/repos/datalad/datalad/labels/platform-windows", "name": "platform-windows", "color": "0052cc", "default": false, "description": "Issue concerned with Windows"}, {"id": 2767259861, "node_id": "MDU6TGFiZWwyNzY3MjU5ODYx", "url": "https://api.github.com/repos/datalad/datalad/labels/cmd-run/rerun", "name": "cmd-run/rerun", "color": "FEF2C0", "default": false, "description": "Issues about the favorite command of ReproPeople"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2019-09-21T12:28:30Z", "updated_at": "2021-03-08T16:23:03Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "Following up from https://github.com/datalad/datalad/issues/3116\r\n\r\n```\r\n(base) C:\\Users\\mih\\quote>datalad run 'nib-ls -s nifti.nimh.nih.gov_nifti_1_data_avg152T1_LR_nifti.nii.gz > INFO.txt'\r\n\r\n(base) C:\\Users\\mih\\quote>ls\r\n\"INFO.txt'\"   nifti.nimh.nih.gov_nifti_1_data_avg152T1_LR_nifti.nii.gz   test\r\n\r\n(base) C:\\Users\\mih\\quote>datalad status OR datalad diff\r\nuntracked: INFO.txt' (file)\r\n```\r\n\r\nA file is being created (albeit with an undesired filename), but `run` doesn't \"see\" it and leaves the dataset dirty with no message whatsoever.\r\n\r\nThe debug log (starting from a clean dataset suggests that something strange is happening):\r\n\r\n```\r\n(base) C:\\Users\\mih\\quote>datalad -l 1 run 'nib-ls -s nifti.nimh.nih.gov_nifti_1_data_avg152T1_LR_nifti.nii.gz > INFO.txt'\r\n[DEBUG] Command line args 1st pass. Parsed: Namespace() Unparsed: ['run', \"'nib-ls\", '-s', 'nifti.nimh.nih.gov_nifti_1_data_avg152T1_LR_nifti.nii.gz']\r\n[DEBUG] Discovering plugins\r\n[Level 5] Importing module datalad.core.local.run\r\n[DEBUG] Building doc for <class 'datalad.core.local.status.Status'>\r\n[DEBUG] Building doc for <class 'datalad.core.local.save.Save'>\r\n[DEBUG] Building doc for <class 'datalad.core.local.run.Run'>\r\n[Level 5] Finished setup_parser\r\n[DEBUG] Parsing known args among ['C:\\\\Users\\\\mih\\\\Miniconda3\\\\Scripts\\\\datalad', '-l', '1', 'run', \"'nib-ls\", '-s', 'nifti.nimh.nih.gov_nifti_1_data_avg152T1_LR_nifti.nii.gz']\r\n[Level 9] Running: ['git', 'config', '-z', '-l', '--show-origin']\r\n[Level 8] Finished running ['git', 'config', '-z', '-l', '--show-origin'] with status 0\r\n[Level 2] Entered eval_func for <function Run.__call__ at 0x000001FA364D5A60>\r\n[DEBUG] Determined class of decorated function: <class 'datalad.core.local.run.Run'>\r\n[Level 2] Getting procedure specs for proc_pre of None\r\n[Level 2] Getting procedure specs for proc_post of None\r\n[Level 2] Returning generator_func from eval_func for <class 'datalad.core.local.run.Run'>\r\n[Level 5] Detected file ri\r\n[DEBUG] Resolved dataset for tracking outcomes of a command: C:\\Users\\mih\\quote\r\n[Level 5] Detected <class 'datalad.support.annexrepo.AnnexRepo'> at C:\\Users\\mih\\quote\r\n[Level 9] Running: ['git', 'version']\r\n[Level 8] Finished running ['git', 'version'] with status 0\r\n[Level 9] Running: ['git', 'config', '-z', '-l', '--show-origin']\r\n[Level 8] Finished running ['git', 'config', '-z', '-l', '--show-origin'] with status 0\r\n[Level 5] Found 0 previous connections\r\n[Level 9] Running: ['git', 'config', 'user.name']\r\n[Level 8] Finished running ['git', 'config', 'user.name'] with status 0\r\n[Level 9] Running: ['git', 'config', 'user.email']\r\n[Level 8] Finished running ['git', 'config', 'user.email'] with status 0\r\n[Level 9] Running: ['git', 'version']\r\n[Level 8] Finished running ['git', 'version'] with status 0\r\n[Level 9] Running: ['git', 'config', '-z', '-l', '--show-origin', '--file', 'C:\\\\Users\\\\mih\\\\quote\\\\.datalad\\\\config']\r\n[Level 8] Finished running ['git', 'config', '-z', '-l', '--show-origin', '--file', 'C:\\\\Users\\\\mih\\\\quote\\\\.datalad\\\\config'] with status 0\r\n[Level 9] Running: ['git', 'config', '-z', '-l', '--show-origin']\r\n[Level 8] Finished running ['git', 'config', '-z', '-l', '--show-origin'] with status 0\r\n[DEBUG] tracking command output underneath <Dataset path=C:\\Users\\mih\\quote>\r\n[Level 9] Running: ['git', 'status', '--porcelain', '--untracked-files=normal', '--ignore-submodules=none']\r\n[Level 8] Finished running ['git', 'status', '--porcelain', '--untracked-files=normal', '--ignore-submodules=none'] with status 0\r\n[DEBUG] could not perform all requested actions: Command did not complete successfully [{'action': 'run', 'path': 'C:\\\\Users\\\\mih\\\\quote', 'type': 'dataset', 'status': 'impossible', 'message': 'clean dataset required to detect changes from command; use `datalad status` to inspect unsaved changes'}] [utils.py:generator_func:474]\r\n[Level 5] Exiting\r\n```\r\n\r\nIt finds the dataset dirty, as if the command in single quotes is executed prior to the actual `datalad run` call. While this might be a Windows \"feature\", we are only reporting it on DEBUG level. Don't see yet why and how...", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/3697/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/3697/timeline", "performed_via_github_app": null}