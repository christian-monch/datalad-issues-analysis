{"url": "https://api.github.com/repos/datalad/datalad/issues/3570", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/3570/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/3570/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/3570/events", "html_url": "https://github.com/datalad/datalad/pull/3570", "id": 474756439, "node_id": "MDExOlB1bGxSZXF1ZXN0MzAyNjQwNzQ5", "number": 3570, "title": "OPT: maintain cache of discovered subdatasets in the loop of annotate_paths", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/datalad/datalad/milestones/63", "html_url": "https://github.com/datalad/datalad/milestone/63", "labels_url": "https://api.github.com/repos/datalad/datalad/milestones/63/labels", "id": 4525220, "node_id": "MDk6TWlsZXN0b25lNDUyNTIyMA==", "number": 63, "title": "Release 0.11.7", "description": "", "creator": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 16, "state": "closed", "created_at": "2019-07-26T18:31:57Z", "updated_at": "2020-01-12T11:22:31Z", "due_on": null, "closed_at": "2020-01-12T11:22:31Z"}, "comments": 5, "created_at": "2019-07-30T18:55:24Z", "updated_at": "2019-08-25T00:27:35Z", "closed_at": "2019-08-01T16:38:33Z", "author_association": "MEMBER", "active_lock_reason": null, "pull_request": {"url": "https://api.github.com/repos/datalad/datalad/pulls/3570", "html_url": "https://github.com/datalad/datalad/pull/3570", "diff_url": "https://github.com/datalad/datalad/pull/3570.diff", "patch_url": "https://github.com/datalad/datalad/pull/3570.patch"}, "body": "Otherwise there is a rediscovery of subdatasets for EVERY path provided to annotate_paths even when they all belong to the same parent dataset.\r\n\r\nCloses: #3567 \r\n\r\nTODOs:\r\n- [x] verify that nothing is broken at least according to the tests.  As is mentioned in the code comment, because of its \"generator\" nature, if annotate_path is called from within some loop altering the list of submodules, cache could get invalidated.  If there is such a usage case we should probably add some kind of sensing of mtime for .gitmodules of the parent or add an explicit argument to not retain this cache, but then things will get slow again whenever not needed\r\n- [x] see and report if any notable effect on benchmarks\r\n- [x] verify that it helps in a real use case which \"inspired\" this fix\r\n- (not here) we really should add a benchmark suite operating on a set of paths within a bigger dataset across a variety of commands\r\n", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/3570/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/3570/timeline", "performed_via_github_app": null}