{"url": "https://api.github.com/repos/datalad/datalad/issues/4706", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/4706/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/4706/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/4706/events", "html_url": "https://github.com/datalad/datalad/issues/4706", "id": 656785479, "node_id": "MDU6SXNzdWU2NTY3ODU0Nzk=", "number": 4706, "title": "push: should `git annex merge` git-annex branch whenever needed", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 390153891, "node_id": "MDU6TGFiZWwzOTAxNTM4OTE=", "url": "https://api.github.com/repos/datalad/datalad/labels/UX", "name": "UX", "color": "0052cc", "default": false, "description": "user experience"}, {"id": 2767220159, "node_id": "MDU6TGFiZWwyNzY3MjIwMTU5", "url": "https://api.github.com/repos/datalad/datalad/labels/cmd-push", "name": "cmd-push", "color": "FEF2C0", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-07-14T17:42:05Z", "updated_at": "2021-08-17T11:57:20Z", "closed_at": "2021-08-17T11:57:20Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "`git annex copy` was ran manually first due to #4704.  Then `push` fails since `git-annex` branch on remote end is ahead.  Failure message is \"nice\" in that it provides instructions on how to mitigate.  But IMHO since we know what has failed (according to the log) ideally we should mitigate \"automagically\" by fetching/git annex merge'ing and pushing again\r\n\r\n```shell\r\n$> time datalad push --to=datalad-public -r -J4\r\nPush to 'datalad-public':  25%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588                                                                                                                     | 1.00/4.00 [00:00<00:00, 14.6k Steps/s][ERROR  ] refs/heads/git-annex->datalad-public:refs/heads/git-annex [rejected] (fetch first) [publish(/mnt/btrfs/datasets/datalad/crawl/naturalistic-data/Paranoia/preprocessed)]\r\npublish(error): Paranoia/preprocessed (dataset) [refs/heads/git-annex->datalad-public:refs/heads/git-annex [rejected] (fetch first)]\r\nPush to 'datalad-public':  25%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588                                                                                                                     | 1.00/4.00 [00:00<00:00, 8.61k Steps/s][ERROR  ] refs/heads/git-annex->datalad-public:refs/heads/git-annex [rejected] (fetch first) [publish(/mnt/btrfs/datasets/datalad/crawl/naturalistic-data/Sherlock/preprocessed)]\r\npublish(error): Sherlock/preprocessed (dataset) [refs/heads/git-annex->datalad-public:refs/heads/git-annex [rejected] (fetch first)]\r\nPotential hints to solve encountered errors: \r\n1: Updates were rejected because the remote contains work that you do not have locally. This is usually caused by another repository pushing to the same ref. You may want to first integrate the remote changes (e.g., 'git pull ...') before pushing again. See the 'Note about fast-forwards' in 'git push --help' for details.\r\ndatalad push --to=datalad-public -r -J4  2.49s user 0.95s system 80% cpu 4.268 total\r\n\r\n$> datalad --version\r\ndatalad 0.13.0\r\n```", "closed_by": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/4706/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/4706/timeline", "performed_via_github_app": null}