{"url": "https://api.github.com/repos/datalad/datalad/issues/5015", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/5015/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/5015/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/5015/events", "html_url": "https://github.com/datalad/datalad/issues/5015", "id": 718901910, "node_id": "MDU6SXNzdWU3MTg5MDE5MTA=", "number": 5015, "title": "Windows: datalad-archives special remote issues", "user": {"login": "adswa", "id": 29738718, "node_id": "MDQ6VXNlcjI5NzM4NzE4", "avatar_url": "https://avatars.githubusercontent.com/u/29738718?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adswa", "html_url": "https://github.com/adswa", "followers_url": "https://api.github.com/users/adswa/followers", "following_url": "https://api.github.com/users/adswa/following{/other_user}", "gists_url": "https://api.github.com/users/adswa/gists{/gist_id}", "starred_url": "https://api.github.com/users/adswa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adswa/subscriptions", "organizations_url": "https://api.github.com/users/adswa/orgs", "repos_url": "https://api.github.com/users/adswa/repos", "events_url": "https://api.github.com/users/adswa/events{/privacy}", "received_events_url": "https://api.github.com/users/adswa/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 188141023, "node_id": "MDU6TGFiZWwxODgxNDEwMjM=", "url": "https://api.github.com/repos/datalad/datalad/labels/platform-windows", "name": "platform-windows", "color": "0052cc", "default": false, "description": "Issue concerned with Windows"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 24, "created_at": "2020-10-11T18:49:37Z", "updated_at": "2020-11-04T06:13:38Z", "closed_at": "2020-11-04T00:22:49Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "When adding content to a datalad-archives special remote, the process hangs for hours (so far, without any outcome). ~The debug output also displays some funkily messed up paths~:\r\n\r\n```bash\r\n# create a dataset\r\n(base) C:\\Users\\datalad\\testing>datalad create anotherone\r\n[INFO] Creating a new annex repo at C:\\Users\\datalad\\testing\\anotherone\r\n[INFO] Detected a filesystem without fifo support.\r\n[INFO] Disabling ssh connection caching.\r\n[INFO] Detected a crippled filesystem.\r\n[INFO] Scanning for unlocked files (this may take some time)\r\n[INFO] Entering an adjusted branch where files are unlocked as this filesystem does not support locked files.\r\n[INFO] Switched to branch 'adjusted/master(unlocked)'\r\ncreate(ok): C:\\Users\\datalad\\testing\\anotherone (dataset)\r\n\r\n(base) C:\\Users\\datalad\\testing>cd anotherone\r\n# create a zip archive\r\n(base) C:\\Users\\datalad\\testing\\anotherone>7z a -tzip files.zip ../file1 ../file2\r\n7-Zip 19.00 (x64) : Copyright (c) 1999-2018 Igor Pavlov : 2019-02-21\r\nScanning the drive:\r\n2 files, 31 bytes (1 KiB)\r\nCreating archive: files.zip\r\nAdd new data to archive: 2 files, 31 bytes (1 KiB)\r\nFiles read from disk: 2\r\nArchive size: 297 bytes (1 KiB)\r\nEverything is Ok\r\n\r\n# save the archive\r\n(base) C:\\Users\\datalad\\testing\\anotherone>datalad save\r\nadd(ok): C:\\Users\\datalad\\testing\\anotherone\\files.zip (file)\r\nsave(ok): C:\\Users\\datalad\\testing\\anotherone (dataset)\r\naction summary:\r\n  add (ok: 1)\r\n  save (ok: 1)\r\n\r\n# call add-archive-content\r\n(base) C:\\Users\\datalad\\testing\\anotherone>datalad -l debug add-archive-content files.zip\r\n[DEBUG] Command line args 1st pass. Parsed: Namespace() Unparsed: ['add-archive-content', 'files.zip']\r\n[DEBUG] Discovering plugins\r\n[DEBUG] Building doc for <class 'datalad.interface.add_archive_content.AddArchiveContent'>\r\n[DEBUG] Parsing known args among ['C:\\\\Users\\\\datalad\\\\miniconda3\\\\Scripts\\\\datalad', '-l', 'debug', 'add-archive-content', 'files.zip']\r\n[DEBUG] Query status of AnnexRepo('C:\\\\Users\\\\datalad\\\\testing\\\\anotherone') for all paths\r\n[DEBUG] AnnexRepo(\"C:\\Users\\datalad\\testing\\anotherone\").get_content_info(...)\r\n[DEBUG] Query repo: ['git', 'ls-files', '--stage', '-z', '-d', '-m', '--exclude-standard', '-o']\r\n[DEBUG] Done query repo: ['git', 'ls-files', '--stage', '-z', '-d', '-m', '--exclude-standard', '-o']\r\n[DEBUG] Done AnnexRepo(\"C:\\Users\\datalad\\testing\\anotherone\").get_content_info(...)\r\n[DEBUG] AnnexRepo(\"C:\\Users\\datalad\\testing\\anotherone\").get_content_info(...)\r\n[DEBUG] Query repo: ['git', 'ls-tree', 'HEAD', '-z', '-r', '--full-tree', '-l']\r\n[DEBUG] Done query repo: ['git', 'ls-tree', 'HEAD', '-z', '-r', '--full-tree', '-l']\r\n[DEBUG] Done AnnexRepo(\"C:\\Users\\datalad\\testing\\anotherone\").get_content_info(...)\r\n[DEBUG] Process file list chunk 0 (length 1)\r\n[DEBUG] Async run ['git', 'annex', 'lookupkey', '-c', 'annex.dotfiles=true', '-c', 'annex.retry=3', '--', 'files.zip']\r\n[DEBUG] Launching process ['git', 'annex', 'lookupkey', '-c', 'annex.dotfiles=true', '-c', 'annex.retry=3', '--', 'files.zip']\r\n[DEBUG] Process 7632 started\r\n[DEBUG] Waiting for process 7632 to complete\r\n[DEBUG] Process 7632 exited with return code 0\r\n[DEBUG] Async run ['git', 'annex', 'contentlocation', '-c', 'annex.dotfiles=true', '-c', 'annex.retry=3', 'MD5E-s297--d13aea6f91275a01cd774e750889c075.zip']\r\n[DEBUG] Launching process ['git', 'annex', 'contentlocation', '-c', 'annex.dotfiles=true', '-c', 'annex.retry=3', 'MD5E-s297--d13aea6f91275a01cd774e750889c075.zip']\r\n[DEBUG] Process 5088 started\r\n[DEBUG] Waiting for process 5088 to complete\r\n[DEBUG] Process 5088 exited with return code 0\r\n[INFO] Adding content of the archive files.zip into annex AnnexRepo(\"C:\\Users\\datalad\\testing\\anotherone\")\r\n[DEBUG] Initiating clean cache for the archives under C:\\Users\\datalad\\testing\\anotherone\\.git\\datalad\\tmp\\archives\r\n[DEBUG] Cache initialized\r\n[DEBUG] Cached directory for archive C:\\Users\\datalad\\testing\\anotherone\\.git\\annex\\objects\\100\\188\\MD5E-s297--d13aea6f91275a01cd774e750889c075.zip\\MD5E-s297--d13aea6f91275a01cd774e750889c075.zip is 22f0104991\r\n[INFO] Initiating special remote datalad-archives\r\n[DEBUG] Async run ['git', 'annex', 'initremote', '-c', 'annex.dotfiles=true', '-c', 'annex.retry=3', 'datalad-archives', 'encryption=none', 'type=external', 'autoenable=true', 'externaltype=datalad-archives', 'uuid=c04eb54b-4b4e-5755-8436-866b043170fa']\r\n[DEBUG] Launching process ['git', 'annex', 'initremote', '-c', 'annex.dotfiles=true', '-c', 'annex.retry=3', 'datalad-archives', 'encryption=none', 'type=external', 'autoenable=true', 'externaltype=datalad-archives', 'uuid=c04eb54b-4b4e-5755-8436-866b043170fa']\r\n[DEBUG] Process 11220 started\r\n[DEBUG] Waiting for process 11220 to complete\r\n[DEBUG] Process 11220 exited with return code 0\r\n[DEBUG] Acquiring a lock C:\\Users\\datalad\\testing\\anotherone\\.git\\datalad\\tmp\\archives\\22f0104991.extract-lck\r\n[DEBUG] Acquired? lock C:\\Users\\datalad\\testing\\anotherone\\.git\\datalad\\tmp\\archives\\22f0104991.extract-lck: True\r\n[DEBUG] Extracting C:\\Users\\datalad\\testing\\anotherone\\.git\\annex\\objects\\100\\188\\MD5E-s297--d13aea6f91275a01cd774e750889c075.zip\\MD5E-s297--d13aea6f91275a01cd774e750889c075.zip under C:\\Users\\datalad\\testing\\anotherone\\.git\\datalad\\tmp\\archives\\22f0104991\r\n[DEBUG] Releasing lock C:\\Users\\datalad\\testing\\anotherone\\.git\\datalad\\tmp\\archives\\22f0104991.extract-lck\r\n[DEBUG] Adding C:\\Users\\datalad\\testing\\anotherone\\file1 to annex pointing to dl+archive:MD5E-s297--d13aea6f91275a01cd774e750889c075.zip#path=file1&size=9 and with options None\r\n##### this one is messed up ########\r\n[DEBUG] Initiating a new process for BatchedAnnex(cmd=<<['git', 'annex++70 chars++ch']>>, output_proc=<function>, path=<<'C:\\\\Users\\\\da++23 chars++one'>>)\r\n[DEBUG] Adding C:\\Users\\datalad\\testing\\anotherone\\file2 to annex pointing to dl+archive:MD5E-s297--d13aea6f91275a01cd774e750889c075.zip#path=file2&size=22 and with options None\r\n[INFO] Finished adding files.zip: Files processed: 2, +annex: 2\r\n[DEBUG] Closing stderr of <subprocess.Popen object at 0x00000159BFD47C40>\r\n[DEBUG] Closing stdin of <subprocess.Popen object at 0x00000159BFD47C40> and waiting process to finish\r\n```\r\n\r\nit is stuck here, for as long as 4 hours so far.", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/5015/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/5015/timeline", "performed_via_github_app": null}