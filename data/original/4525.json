{"url": "https://api.github.com/repos/datalad/datalad/issues/4525", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/4525/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/4525/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/4525/events", "html_url": "https://github.com/datalad/datalad/issues/4525", "id": 617785831, "node_id": "MDU6SXNzdWU2MTc3ODU4MzE=", "number": 4525, "title": "download_url(zip_link, archive=True) leads to AnnexBatchCommandError", "user": {"login": "joeyzhou98", "id": 35869923, "node_id": "MDQ6VXNlcjM1ODY5OTIz", "avatar_url": "https://avatars.githubusercontent.com/u/35869923?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joeyzhou98", "html_url": "https://github.com/joeyzhou98", "followers_url": "https://api.github.com/users/joeyzhou98/followers", "following_url": "https://api.github.com/users/joeyzhou98/following{/other_user}", "gists_url": "https://api.github.com/users/joeyzhou98/gists{/gist_id}", "starred_url": "https://api.github.com/users/joeyzhou98/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joeyzhou98/subscriptions", "organizations_url": "https://api.github.com/users/joeyzhou98/orgs", "repos_url": "https://api.github.com/users/joeyzhou98/repos", "events_url": "https://api.github.com/users/joeyzhou98/events{/privacy}", "received_events_url": "https://api.github.com/users/joeyzhou98/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-05-13T22:07:25Z", "updated_at": "2020-05-20T13:43:10Z", "closed_at": "2020-05-20T13:43:10Z", "author_association": "NONE", "active_lock_reason": null, "body": "#### What is the problem?\r\nWhen using the datalad Python API via datalad.api.Dataset.download_url(zip_link, archive=True), the command ends up with the following error:\r\n```d.download_url(\"https://zenodo.org/api/files/ba88b736-95bd-492a-be83-5f16d0f38ba5/data.zip?access_token=w4M00bgKOLzWDCHdFGeXc2wzaE9ftmedZAcneqTQEO9qQK4G3A7ez7CfOS7Y\", archive=True)\r\n[INFO   ] Downloading <zip_link> into '/home/users/jzhou/test/dataset/' \r\n[INFO   ] Adding content of the archive /home/users/jzhou/test/dataset/data.zip into annex <AnnexRepo path=/home/users/jzhou/test/dataset (<class 'datalad.support.annexrepo.AnnexRepo'>)> \r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/home/users/jzhou/miniconda3/lib/python3.7/site-packages/datalad/distribution/dataset.py\", line 500, in apply_func\r\n    return f(**kwargs)\r\n  File \"/home/users/jzhou/miniconda3/lib/python3.7/site-packages/datalad/interface/utils.py\", line 492, in eval_func\r\n    return return_func(generator_func)(*args, **kwargs)\r\n  File \"/home/users/jzhou/miniconda3/lib/python3.7/site-packages/datalad/interface/utils.py\", line 480, in return_func\r\n    results = list(results)\r\n  File \"/home/users/jzhou/miniconda3/lib/python3.7/site-packages/datalad/interface/utils.py\", line 411, in generator_func\r\n    allkwargs):\r\n  File \"/home/users/jzhou/miniconda3/lib/python3.7/site-packages/datalad/interface/utils.py\", line 527, in _process_results\r\n    for res in results:\r\n  File \"/home/users/jzhou/miniconda3/lib/python3.7/site-packages/datalad/interface/download_url.py\", line 247, in __call__\r\n    add_archive_content(path, annex=ds.repo, delete=True)\r\n  File \"/home/users/jzhou/miniconda3/lib/python3.7/site-packages/datalad/interface/add_archive_content.py\", line 456, in __call__\r\n    batch=True)\r\n  File \"/home/users/jzhou/miniconda3/lib/python3.7/site-packages/datalad/support/gitrepo.py\", line 230, in newfunc\r\n    return func(self, file_new, *args, **kwargs)\r\n  File \"/home/users/jzhou/miniconda3/lib/python3.7/site-packages/datalad/support/annexrepo.py\", line 1940, in add_url_to_file\r\n    % (url, str(out_json)))\r\ndatalad.support.exceptions.AnnexBatchCommandError: AnnexBatchCommandError: command 'addurl'\r\nError, annex reported failure for addurl (url='dl+archive:MD5E-s195581928--c6b084b6435d4c3d51f8c7221903e366.zip#path=candidates/913174/V1/images/loris_913174_V1_fMRI_009.mnc&size=8034497'): {'command': 'addurl', 'note': 'from datalad-archives\\nto candidates/913174/V1/images/loris_913174_V1_fMRI_009.mnc', 'success': False, 'error-messages': [], 'file': 'candidates/913174/V1/images/loris_913174_V1_fMRI_009.mnc'}\r\n```\r\nI can't share the link for the zip file publicly but if this error is new and no solution works, then I can share the link and zip file used to reproduce the problem in private\r\n#### What steps will reproduce the problem?\r\n```from datalad import api\r\nd = api.Dataset(\"dataset\")\r\nd.create()\r\nd.download_url(zip_link, archive=True)\r\n```\r\n#### What version of DataLad are you using (run `datalad --version`)? On what operating system (consider running `datalad wtf`)?\r\ndatalad 0.12.6\r\ndatalad wtf output:\r\n```# WTF\r\n## configuration <SENSITIVE, report disabled by configuration>\r\n## datalad \r\n  - full_version: 0.12.6\r\n  - version: 0.12.6\r\n## dependencies \r\n  - appdirs: 1.4.3\r\n  - boto: 2.49.0\r\n  - cmd:7z: 16.02\r\n  - cmd:annex: 8.20200309-g07fcace\r\n  - cmd:bundled-git: 2.23.0\r\n  - cmd:git: 2.23.0\r\n  - cmd:system-git: 2.23.0\r\n  - cmd:system-ssh: 7.9p1\r\n  - git: 3.1.1\r\n  - gitdb: 4.0.4\r\n  - humanize: 2.4.0\r\n  - iso8601: 0.1.12\r\n  - keyring: 21.2.0\r\n  - keyrings.alt: 3.4.0\r\n  - msgpack: 1.0.0\r\n  - requests: 2.23.0\r\n  - wrapt: 1.12.1\r\n## environment \r\n  - GIT_PYTHON_GIT_EXECUTABLE: /home/users/jzhou/miniconda3/bin/git\r\n  - LANG: en_CA.UTF-8\r\n  - LANGUAGE: en_CA:en\r\n  - PATH: /home/users/jzhou/.local/bin:/home/users/jzhou/miniconda3/bin:/home/users/jzhou/miniconda3/condabin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin\r\n## extensions \r\n## git-annex \r\n  - build flags: \r\n    - Assistant\r\n    - Webapp\r\n    - Pairing\r\n    - S3\r\n    - WebDAV\r\n    - Inotify\r\n    - DBus\r\n    - DesktopNotify\r\n    - TorrentParser\r\n    - MagicMime\r\n    - Feeds\r\n    - Testsuite\r\n  - dependency versions: \r\n    - aws-0.21.1\r\n    - bloomfilter-2.0.1.0\r\n    - cryptonite-0.25\r\n    - DAV-1.3.4\r\n    - feed-1.2.0.1\r\n    - ghc-8.6.5\r\n    - http-client-0.6.4\r\n    - persistent-sqlite-2.9.3\r\n    - torrent-10000.1.1\r\n    - uuid-1.3.13\r\n    - yesod-1.6.0.1\r\n  - key/value backends: \r\n    - SHA256E\r\n    - SHA256\r\n    - SHA512E\r\n    - SHA512\r\n    - SHA224E\r\n    - SHA224\r\n    - SHA384E\r\n    - SHA384\r\n    - SHA3_256E\r\n    - SHA3_256\r\n    - SHA3_512E\r\n    - SHA3_512\r\n    - SHA3_224E\r\n    - SHA3_224\r\n    - SHA3_384E\r\n    - SHA3_384\r\n    - SKEIN256E\r\n    - SKEIN256\r\n    - SKEIN512E\r\n    - SKEIN512\r\n    - BLAKE2B256E\r\n    - BLAKE2B256\r\n    - BLAKE2B512E\r\n    - BLAKE2B512\r\n    - BLAKE2B160E\r\n    - BLAKE2B160\r\n    - BLAKE2B224E\r\n    - BLAKE2B224\r\n    - BLAKE2B384E\r\n    - BLAKE2B384\r\n    - BLAKE2BP512E\r\n    - BLAKE2BP512\r\n    - BLAKE2S256E\r\n    - BLAKE2S256\r\n    - BLAKE2S160E\r\n    - BLAKE2S160\r\n    - BLAKE2S224E\r\n    - BLAKE2S224\r\n    - BLAKE2SP256E\r\n    - BLAKE2SP256\r\n    - BLAKE2SP224E\r\n    - BLAKE2SP224\r\n    - SHA1E\r\n    - SHA1\r\n    - MD5E\r\n    - MD5\r\n    - WORM\r\n    - URL\r\n  - operating system: linux x86_64\r\n  - remote types: \r\n    - git\r\n    - gcrypt\r\n    - p2p\r\n    - S3\r\n    - bup\r\n    - directory\r\n    - rsync\r\n    - web\r\n    - bittorrent\r\n    - webdav\r\n    - adb\r\n    - tahoe\r\n    - glacier\r\n    - ddar\r\n    - git-lfs\r\n    - hook\r\n    - external\r\n  - supported repository versions: \r\n    - 8\r\n  - upgrade supported from repository versions: \r\n    - 0\r\n    - 1\r\n    - 2\r\n    - 3\r\n    - 4\r\n    - 5\r\n    - 6\r\n    - 7\r\n  - version: 8.20200309-g07fcace\r\n## location \r\n  - path: /home/users/jzhou/test\r\n  - type: directory\r\n## metadata_extractors \r\n  - annex: \r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.annex\r\n    - version: None\r\n  - audio: \r\n    - load_error: No module named 'mutagen' [audio.py:<module>:17]\r\n    - module: datalad.metadata.extractors.audio\r\n  - datacite: \r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.datacite\r\n    - version: None\r\n  - datalad_core: \r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.datalad_core\r\n    - version: None\r\n  - datalad_rfc822: \r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.datalad_rfc822\r\n    - version: None\r\n  - exif: \r\n    - load_error: No module named 'exifread' [exif.py:<module>:16]\r\n    - module: datalad.metadata.extractors.exif\r\n  - frictionless_datapackage: \r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.frictionless_datapackage\r\n    - version: None\r\n  - image: \r\n    - load_error: No module named 'PIL' [image.py:<module>:16]\r\n    - module: datalad.metadata.extractors.image\r\n  - xmp: \r\n    - load_error: No module named 'libxmp' [xmp.py:<module>:20]\r\n    - module: datalad.metadata.extractors.xmp\r\n## python \r\n  - implementation: CPython\r\n  - version: 3.6.9\r\n## system \r\n  - distribution: Ubuntu/18.04/bionic\r\n  - encoding: \r\n    - default: utf-8\r\n    - filesystem: utf-8\r\n    - locale.prefered: UTF-8\r\n  - max_path_length: 278\r\n  - name: Linux\r\n  - release: 4.15.0-99-generic\r\n  - type: posix\r\n  - version: #100-Ubuntu SMP Wed Apr 22 20:32:56 UTC 2020\r\n```\r\n", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/4525/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/4525/timeline", "performed_via_github_app": null}