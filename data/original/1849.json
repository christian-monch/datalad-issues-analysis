{"url": "https://api.github.com/repos/datalad/datalad/issues/1849", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/1849/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/1849/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/1849/events", "html_url": "https://github.com/datalad/datalad/issues/1849", "id": 259480507, "node_id": "MDU6SXNzdWUyNTk0ODA1MDc=", "number": 1849, "title": "annex v6 madness when cloning ", "user": {"login": "bpoldrack", "id": 10498301, "node_id": "MDQ6VXNlcjEwNDk4MzAx", "avatar_url": "https://avatars.githubusercontent.com/u/10498301?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bpoldrack", "html_url": "https://github.com/bpoldrack", "followers_url": "https://api.github.com/users/bpoldrack/followers", "following_url": "https://api.github.com/users/bpoldrack/following{/other_user}", "gists_url": "https://api.github.com/users/bpoldrack/gists{/gist_id}", "starred_url": "https://api.github.com/users/bpoldrack/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bpoldrack/subscriptions", "organizations_url": "https://api.github.com/users/bpoldrack/orgs", "repos_url": "https://api.github.com/users/bpoldrack/repos", "events_url": "https://api.github.com/users/bpoldrack/events{/privacy}", "received_events_url": "https://api.github.com/users/bpoldrack/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 132485920, "node_id": "MDU6TGFiZWwxMzI0ODU5MjA=", "url": "https://api.github.com/repos/datalad/datalad/labels/annex", "name": "annex", "color": "0052cc", "default": false, "description": "Git-annex related issue"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2017-09-21T12:35:40Z", "updated_at": "2018-09-19T13:47:58Z", "closed_at": "2018-09-19T13:47:58Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Relates to #1798 \r\n\r\nA little different but basically the same is my last comment here:\r\nhttp://git-annex.branchable.com/bugs/Too_difficult_if_not_impossible_to_explicitly_add__47__keep_file_under_git___40__not_annex__41___in_v6_without_employing_.gitattributes/\r\n\r\n\r\nLet's have a v5 repository with a file in git and a file in annex:\r\n```\r\nben@tree /tmp % mkdir test\r\nben@tree /tmp % cd test\r\nben@tree /tmp/test % git init\r\nInitialized empty Git repository in /tmp/test/.git/\r\nben@tree /tmp/test % git annex init\r\ninit  ok\r\n(recording state in git...)\r\nben@tree /tmp/test % echo 123 > test-git.dat  \r\nben@tree /tmp/test % echo 456 > test-annex.dat\r\nben@tree /tmp/test % git add test-git.dat \r\nben@tree /tmp/test % git commit -m \"add to git\"\r\n[master (root-commit) 6440f0c] add to git\r\n 1 file changed, 1 insertion(+)\r\n create mode 100644 test-git.dat\r\nben@tree /tmp/test % git annex add test-annex.dat \r\nadd test-annex.dat ok\r\n(recording state in git...)\r\nben@tree /tmp/test % git commit -m \"add to annex\"\r\n[master 33cd061] add to annex\r\n 1 file changed, 1 insertion(+)\r\n create mode 120000 test-annex.dat\r\nben@tree /tmp/test % ll     \r\ntotal 376\r\ndrwxr-xr-x  3 ben  ben    4096 Sep 21 14:13 .\r\ndrwxrwxrwt 49 root root 364544 Sep 21 14:11 ..\r\ndrwxr-xr-x  9 ben  ben    4096 Sep 21 14:14 .git\r\nlrwxrwxrwx  1 ben  ben     186 Sep 21 14:13 test-annex.dat -> .git/annex/objects/5w/PV/SHA256E-s4--cdfba543ee8ef7fdb3d8b587648cc22dd792bbd6272cc5447307c7c106c2374c.dat/SHA256E-s4--cdfba543ee8ef7fdb3d8b587648cc22dd792bbd6272cc5447307c7c106c2374c.dat\r\n-rw-r--r--  1 ben  ben       4 Sep 21 14:13 test-git.dat\r\n```\r\nNow, clone it and make the clone a v6 repository:\r\n```\r\nben@tree /tmp % git clone test test-clone1\r\nCloning into 'test-clone1'...\r\ndone.\r\nben@tree /tmp % cd test-clone1\r\nben@tree /tmp/test-clone1 % git annex init --version=6\r\ninit  (merging origin/git-annex into git-annex...)\r\n(recording state in git...)\r\n(scanning for unlocked files...)\r\nok\r\n(recording state in git...)\r\nben@tree /tmp/test-clone1 % git status\r\nOn branch master\r\nYour branch is up-to-date with 'origin/master'.\r\n\r\nChanges not staged for commit:\r\n  (use \"git add <file>...\" to update what will be committed)\r\n  (use \"git checkout -- <file>...\" to discard changes in working directory)\r\n\r\n\tmodified:   test-git.dat\r\n\r\nno changes added to commit (use \"git add\" and/or \"git commit -a\")\r\n\r\nben@tree /tmp/test-clone1 % git diff\r\ndiff --git a/test-git.dat b/test-git.dat\r\nindex 190a180..b41979c 100644\r\n--- a/test-git.dat\r\n+++ b/test-git.dat\r\n@@ -1 +1 @@\r\n-123\r\n+/annex/objects/SHA256E-s4--181210f8f9c779c26da1d9b2075bde0127302ee0e3fca38c9a83f5b1dd8e5d3b.dat\r\nben@tree /tmp/test-clone1 % cat test-git.dat \r\n123\r\n```\r\nStrange enough, right? Now do the very same thing, but call `git status` before annex-initializing the clone:\r\n```\r\nben@tree /tmp/test-clone1 % cd ..\r\nben@tree /tmp % git clone test test-clone2\r\nCloning into 'test-clone2'...\r\ndone.\r\nben@tree /tmp % cd test-clone2\r\nben@tree /tmp/test-clone2 % git status\r\nOn branch master\r\nYour branch is up-to-date with 'origin/master'.\r\n\r\nnothing to commit, working tree clean\r\nben@tree /tmp/test-clone2 % git annex init --version=6\r\ninit  (merging origin/git-annex into git-annex...)\r\n(recording state in git...)\r\n(scanning for unlocked files...)\r\nok\r\n(recording state in git...)\r\nben@tree /tmp/test-clone2 % git status\r\nOn branch master\r\nYour branch is up-to-date with 'origin/master'.\r\n\r\nnothing to commit, working tree clean\r\n```\r\nWTF? ;-)\r\n\r\nCalling `git annex upgrade` in `test` before has no apparent side-effects and doesn't change anything regarding the clones.\r\nWhat do you think of this, @mih, @yarikoptic , @joeyh ?\r\nWhat could we possibly do about it? If we want to be able to use V6 we have to able to clone from datasets that were created using V5. Especially when not even upgrading the original repository prior to cloning provides a solution.\r\n\r\nEdit:\r\n```\r\nben@tree /tmp % git annex version\r\ngit-annex version: 6.20170815+gitg22da64d0f-1~ndall+1\r\nbuild flags: Assistant Webapp Pairing Testsuite S3(multipartupload)(storageclasses) WebDAV Inotify DBus DesktopNotify ConcurrentOutput TorrentParser MagicMime Feeds Quvi\r\ndependency versions: aws-0.14.1 bloomfilter-2.0.1.0 cryptonite-0.20 DAV-1.3.1 feed-0.3.11.1 ghc-8.0.1 http-client-0.4.31.1 persistent-sqlite-2.6 torrent-10000.0.0 uuid-1.3.12 yesod-1.4.3\r\nkey/value backends: SHA256E SHA256 SHA512E SHA512 SHA224E SHA224 SHA384E SHA384 SHA3_256E SHA3_256 SHA3_512E SHA3_512 SHA3_224E SHA3_224 SHA3_384E SHA3_384 SKEIN256E SKEIN256 SKEIN512E SKEIN512 SHA1E SHA1 MD5E MD5 WORM URL\r\nremote types: git gcrypt p2p S3 bup directory rsync web bittorrent webdav tahoe glacier ddar hook external\r\n```\r\nCan you guys reproduce this?", "closed_by": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/1849/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/1849/timeline", "performed_via_github_app": null}