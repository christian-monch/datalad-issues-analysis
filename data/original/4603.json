{"url": "https://api.github.com/repos/datalad/datalad/issues/4603", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/4603/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/4603/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/4603/events", "html_url": "https://github.com/datalad/datalad/issues/4603", "id": 630118184, "node_id": "MDU6SXNzdWU2MzAxMTgxODQ=", "number": 4603, "title": "push: --force=datatransfer -> --force=no-annexfast", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 390153891, "node_id": "MDU6TGFiZWwzOTAxNTM4OTE=", "url": "https://api.github.com/repos/datalad/datalad/labels/UX", "name": "UX", "color": "0052cc", "default": false, "description": "user experience"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 14, "created_at": "2020-06-03T15:52:22Z", "updated_at": "2020-06-23T11:02:56Z", "closed_at": "2020-06-23T11:02:56Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "#### What is the problem?\r\n\r\nAbsence of `--fast` does not actually force any data transfer if content is already available on the remote.  \r\n\r\n<details>\r\n<summary>It just causes annex to check explicitly remote if it contains the key</summary> \r\n\r\n```shell\r\n$> time git annex copy --to neurosmaug --force freesurfer-extlibs-sloppy_201* --debug\r\n[2020-06-03 11:49:06.135276985] read: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"show-ref\",\"git-annex\"]\r\n[2020-06-03 11:49:06.15099345] process done ExitSuccess\r\n[2020-06-03 11:49:06.151612786] read: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"show-ref\",\"--hash\",\"refs/heads/git-annex\"]\r\n[2020-06-03 11:49:06.16968624] process done ExitSuccess\r\n[2020-06-03 11:49:06.171218456] read: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"log\",\"refs/heads/git-annex..91f750b383c1bae79d831a204a942b82d42f966d\",\"--pretty=%H\",\"-n1\"]\r\n[2020-06-03 11:49:06.185886773] process done ExitSuccess\r\n[2020-06-03 11:49:06.186056453] read: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"log\",\"refs/heads/git-annex..03d545ae03f864c862e5e0846ad1ddfbb95ca5b7\",\"--pretty=%H\",\"-n1\"]\r\n[2020-06-03 11:49:06.205074385] process done ExitSuccess\r\n[2020-06-03 11:49:06.239273514] chat: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"cat-file\",\"--batch\"]\r\n[2020-06-03 11:49:06.241931433] chat: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"cat-file\",\"--batch-check=%(objectname) %(objecttype) %(objectsize)\"]\r\n[2020-06-03 11:49:06.266777301] read: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"symbolic-ref\",\"-q\",\"HEAD\"]\r\n[2020-06-03 11:49:06.287075158] process done ExitSuccess\r\n[2020-06-03 11:49:06.287590555] read: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"show-ref\",\"refs/heads/master\"]\r\n[2020-06-03 11:49:06.304955359] process done ExitSuccess\r\n[2020-06-03 11:49:06.306021498] read: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"ls-files\",\"--cached\",\"-z\",\"--\",\"freesurfer-extlibs-sloppy_20160908.orig.tar.gz\",\"freesurfer-extlibs-sloppy_20180917.orig.tar.gz\"]\r\ncopy freesurfer-extlibs-sloppy_20160908.orig.tar.gz [2020-06-03 11:49:06.323629099] chat: ssh [\"neurosmaug\",\"-S\",\".git/annex/ssh/neurosmaug\",\"-o\",\"ControlMaster=auto\",\"-o\",\"ControlPersist=yes\",\"-o\",\"ControlMaster=auto\",\"-S\",\"/home/yoh/.config/datalad/neurosmaug\",\"-T\",\"git-annex-shell 'p2pstdio' '/~/deb/tarballs' '--debug' 'b8e253ac-6612-11e0-bab6-b3cc258b7ba2' --uuid 9b49e014-65ed-11e0-af7a-f7428466115a\"]\r\n[2020-06-03 11:49:06.421561299] [ssh connection 1] [ThreadId 4] P2P < AUTH-SUCCESS 9b49e014-65ed-11e0-af7a-f7428466115a\r\n[2020-06-03 11:49:06.421979074] [ssh connection 1] [ThreadId 4] P2P > VERSION 1\r\n[2020-06-03 11:49:06.445732611] [ssh connection 1] [ThreadId 4] P2P < VERSION 1\r\n[2020-06-03 11:49:06.446496622] [ssh connection 1] [ThreadId 4] P2P > CHECKPRESENT SHA256E-s362575955--0a322a937d5ed1314d331cbf6bf760e4bce2b0cc59e642d25b8ea5b97fbd8e3d.tar.gz\r\n[2020-06-03 11:49:06.432505233] [ThreadId 4] P2P < VERSION 1[2020-06-03 11:49:06.432708744] [ThreadId 4] P2P > VERSION 1[2020-06-03 11:49:06.455380867] [ThreadId 4] P2P < CHECKPRESENT SHA256E-s362575955--0a322a937d5ed1314d331cbf6bf760e4bce2b0cc59e642d25b8ea5b97fbd8e3d.tar.gz[2020-06-03 11:49:06.468464896] [ssh connection 1] [ThreadId 4] P2P < SUCCESS\r\n[2020-06-03 11:49:06.456677252] [ThreadId 4] P2P > SUCCESSok\r\ncopy freesurfer-extlibs-sloppy_20180917.orig.tar.gz [2020-06-03 11:49:06.472954707] [ssh connection 1] [ThreadId 4] P2P > CHECKPRESENT SHA256E-s335050843--4d97a6b51ac2dbc9b4a3e64700aebae954e250033fc394f104c5079ef2c29c13.tar.gz\r\n[2020-06-03 11:49:06.476913577] [ThreadId 4] P2P < CHECKPRESENT SHA256E-s335050843--4d97a6b51ac2dbc9b4a3e64700aebae954e250033fc394f104c5079ef2c29c13.tar.gz[2020-06-03 11:49:06.477221749] [ThreadId 4] P2P > SUCCESS[2020-06-03 11:49:06.49077453] [ssh connection 1] [ThreadId 4] P2P < SUCCESS\r\nok\r\n[2020-06-03 11:49:06.499921703] process done ExitSuccess\r\n[2020-06-03 11:49:06.503645896] process done ExitSuccess\r\ngit annex copy --to neurosmaug --force freesurfer-extlibs-sloppy_201* --debug  0.18s user 0.17s system 70% cpu 0.503 total\r\n```\r\n</details>\r\n\r\nAs such, name of the \"force\" is IMHO misleading even if described in the doc that it is actually not that but just not passing `--fast` to git-annex copy call.  I think `no-annexfast` would align better with another force of `gitpush`.  Note that `annex copy` also has `--force` option although I am not certain about its purpose/effects.", "closed_by": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/4603/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/4603/timeline", "performed_via_github_app": null}