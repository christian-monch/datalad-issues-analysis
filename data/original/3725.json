{"url": "https://api.github.com/repos/datalad/datalad/issues/3725", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/3725/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/3725/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/3725/events", "html_url": "https://github.com/datalad/datalad/issues/3725", "id": 498900636, "node_id": "MDU6SXNzdWU0OTg5MDA2MzY=", "number": 3725, "title": "`diff` reports annexed file to be in git", "user": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 188141023, "node_id": "MDU6TGFiZWwxODgxNDEwMjM=", "url": "https://api.github.com/repos/datalad/datalad/labels/platform-windows", "name": "platform-windows", "color": "0052cc", "default": false, "description": "Issue concerned with Windows"}, {"id": 2803341545, "node_id": "MDU6TGFiZWwyODAzMzQxNTQ1", "url": "https://api.github.com/repos/datalad/datalad/labels/cmd-diff", "name": "cmd-diff", "color": "FEF2C0", "default": false, "description": ""}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-09-26T13:54:11Z", "updated_at": "2021-03-08T16:22:57Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "Here is the test failure:\r\n\r\nhttps://github.com/mih/datalad/commit/396864502cedebc214d9dd0a48e44d0797d82d10/checks#step:8:275\r\n\r\nIt essentially compares the output of\r\n\r\n`ds.diff(recursive=True, annex='all')`\r\n```\r\n{'action': 'diff',\r\n 'backend': 'MD5E',\r\n 'bytesize': 5,\r\n 'gitshasum': 'e90d4b712a53d0af1707d83a8a727d610cf4b41c',\r\n 'has_content': True,\r\n 'humansize': '5 B',\r\n 'key': 'MD5E-s5--275876e34cf609db118f3d84b799a790.txt',\r\n 'keyname': '275876e34cf609db118f3d84b799a790.txt',\r\n 'mtime': 'unknown',\r\n 'objloc': 'C:\\\\Users\\\\RUNNER~1\\\\AppData\\\\Local\\\\Temp\\\\datalad_temp_pi1jh5dh\\\\.git\\\\annex\\\\objects\\\\f33\\\\94b\\\\MD5E-s5--275876e34cf609db118f3d84b799a790.txt\\\\MD5E-s5--275876e34cf609db118f3d84b799a790.txt',\r\n 'parentds': 'C:\\\\Users\\\\RUNNER~1\\\\AppData\\\\Local\\\\Temp\\\\datalad_temp_pi1jh5dh',\r\n 'path': 'C:\\\\Users\\\\RUNNER~1\\\\AppData\\\\Local\\\\Temp\\\\datalad_temp_pi1jh5dh\\\\subdir\\\\annexed_file.txt',\r\n 'prev_backend': 'MD5E',\r\n 'prev_bytesize': '5',\r\n 'prev_gitshasum': 'e90d4b712a53d0af1707d83a8a727d610cf4b41c',\r\n 'prev_hashdirlower': 'f33\\\\94b\\\\',\r\n 'prev_hashdirmixed': '7p\\\\gp\\\\',\r\n 'prev_humansize': '5 B',\r\n 'prev_key': 'MD5E-s5--275876e34cf609db118f3d84b799a790.txt',\r\n 'prev_keyname': '275876e34cf609db118f3d84b799a790.txt',\r\n 'prev_mtime': 'unknown',\r\n 'refds': 'C:\\\\Users\\\\RUNNER~1\\\\AppData\\\\Local\\\\Temp\\\\datalad_temp_pi1jh5dh',\r\n 'state': 'clean',\r\n 'status': 'ok',\r\n 'type': 'file'}\r\n```\r\n\r\nwith that of `ds.diff(path='.', recursive=True, annex='all')`\r\n```\r\n{'action': 'diff',\r\n 'bytesize': 61,\r\n 'gitshasum': 'e90d4b712a53d0af1707d83a8a727d610cf4b41c',\r\n 'parentds': 'C:\\\\Users\\\\RUNNER~1\\\\AppData\\\\Local\\\\Temp\\\\datalad_temp_pi1jh5dh',\r\n 'path': 'C:\\\\Users\\\\RUNNER~1\\\\AppData\\\\Local\\\\Temp\\\\datalad_temp_pi1jh5dh\\\\subdir\\\\annexed_file.txt',\r\n 'prev_backend': 'MD5E',\r\n 'prev_bytesize': '5',\r\n 'prev_gitshasum': 'e90d4b712a53d0af1707d83a8a727d610cf4b41c',\r\n 'prev_hashdirlower': 'f33\\\\94b\\\\',\r\n 'prev_hashdirmixed': '7p\\\\gp\\\\',\r\n 'prev_humansize': '5 B',\r\n 'prev_key': 'MD5E-s5--275876e34cf609db118f3d84b799a790.txt',\r\n 'prev_keyname': '275876e34cf609db118f3d84b799a790.txt',\r\n 'prev_mtime': 'unknown',\r\n 'refds': 'C:\\\\Users\\\\RUNNER~1\\\\AppData\\\\Local\\\\Temp\\\\datalad_temp_pi1jh5dh',\r\n 'state': 'clean',\r\n 'status': 'ok',\r\n 'type': 'file'}\r\n```\r\n\r\nthe latter reports that the present state of the file is to be checked into git. Which is nonsense, as the two diff commands run right after each other. Also:\r\n\r\n```\r\n>>> len('/annex/objects/MD5E-s5--275876e34cf609db118f3d84b799a790.txt\\n')\r\n61\r\n```\r\n\r\nmakes me think that it misinterprets an annex pointer file.\r\n\r\nThe whole thing is happening on windows, but I cannot replicate it on a real win10 box.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/3725/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/3725/timeline", "performed_via_github_app": null}