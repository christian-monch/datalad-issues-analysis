{"url": "https://api.github.com/repos/datalad/datalad/issues/4293", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/4293/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/4293/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/4293/events", "html_url": "https://github.com/datalad/datalad/pull/4293", "id": 580767464, "node_id": "MDExOlB1bGxSZXF1ZXN0Mzg3OTE1MTU1", "number": 4293, "title": "ENH: gitrepo: Use matched line as message for log_progress()", "user": {"login": "kyleam", "id": 1297788, "node_id": "MDQ6VXNlcjEyOTc3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1297788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kyleam", "html_url": "https://github.com/kyleam", "followers_url": "https://api.github.com/users/kyleam/followers", "following_url": "https://api.github.com/users/kyleam/following{/other_user}", "gists_url": "https://api.github.com/users/kyleam/gists{/gist_id}", "starred_url": "https://api.github.com/users/kyleam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kyleam/subscriptions", "organizations_url": "https://api.github.com/users/kyleam/orgs", "repos_url": "https://api.github.com/users/kyleam/repos", "events_url": "https://api.github.com/users/kyleam/events{/privacy}", "received_events_url": "https://api.github.com/users/kyleam/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-03-13T18:19:03Z", "updated_at": "2020-03-14T14:56:23Z", "closed_at": "2020-03-14T08:07:27Z", "author_association": "MEMBER", "active_lock_reason": null, "pull_request": {"url": "https://api.github.com/repos/datalad/datalad/pulls/4293", "html_url": "https://github.com/datalad/datalad/pull/4293", "diff_url": "https://github.com/datalad/datalad/pull/4293.diff", "patch_url": "https://github.com/datalad/datalad/pull/4293.patch"}, "body": "When the GitProgress protocol receives a line like\r\n\r\n    Receiving objects:  32% (22269/69588), 7.98 MiB | 7.98 MiB/s\r\n\r\nit extracts anything after (M/N) as the message.  This message is used\r\nto detect when a particular action is done, but it's also used as the\r\n\"message\" parameter to log_progress().\r\n\r\nThe latter is problematic when running non-interactively---where the\r\nmessages are shown with standard logging rather than progress\r\nbars---because many lines have an empty message, leading to many lines\r\nof uninformative output (as in this example [0]).\r\n\r\nPrevent this by using the entire matched line as the message.  This\r\nleads to the non-interactive logging closely matching what the caller\r\nwould see from the command line.\r\n\r\n[0]: https://github.com/datalad-handbook/book/issues/390\r\n\r\n---\r\n\r\nThis changes non-interactive output like\r\n\r\n```\r\n[INFO] Attempting to clone from https://github.com/datalad/datalad.git to /tmp/dl-Qcqewf2/c \r\n[INFO] Start enumerating objects \r\n[INFO] Finished enumerating objects \r\n[INFO] Start counting objects \r\n[INFO]  \r\n[INFO]  \r\n[... many more ...]\r\n```\r\n\r\nto\r\n\r\n```\r\n[INFO] Attempting to clone from https://github.com/datalad/datalad.git to /tmp/dl-FGiAQa2/c \r\n[INFO] Start enumerating objects \r\n[INFO] Finished enumerating objects \r\n[INFO] Start counting objects \r\n[INFO] remote: Counting objects:   0% (1/307) \r\n[INFO] remote: Counting objects:   1% (4/307)\r\n[...]\r\n```\r\n\r\nWhile it matches what you'd see from Git, it's perhaps still a bit noisy for the `info` level.  However, I don't see a clean solution for that, at least within `GitProgress`, because it feels like a core issue with `log_progress`/`ProgressHandler`: a logging level that is good to decide \"show a progress bar\" doesn't necessarily align with the level that would be appropriate if all those progress bar ticks are mapped to regular log messages.  I'm thinking about how to extend the log handling to account for that.\r\n\r\nattn: @adswa ", "closed_by": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/4293/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/4293/timeline", "performed_via_github_app": null}