{"url": "https://api.github.com/repos/datalad/datalad/issues/2187", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/2187/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/2187/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/2187/events", "html_url": "https://github.com/datalad/datalad/pull/2187", "id": 297856645, "node_id": "MDExOlB1bGxSZXF1ZXN0MTY5Nzg1MjA5", "number": 2187, "title": "Use lsfiles to obtain list of submodules (and maybe other info)", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/datalad/datalad/milestones/48", "html_url": "https://github.com/datalad/datalad/milestone/48", "labels_url": "https://api.github.com/repos/datalad/datalad/milestones/48/labels", "id": 3040617, "node_id": "MDk6TWlsZXN0b25lMzA0MDYxNw==", "number": 48, "title": "Release 0.10.0", "description": "The release with new metadata aggregation/search support.\r\n\r\nShould include 0.9.2 fixes etc, i.e. have 0.9.x branch merged", "creator": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 51, "state": "closed", "created_at": "2018-01-16T22:43:30Z", "updated_at": "2018-06-13T16:50:07Z", "due_on": null, "closed_at": "2018-06-13T16:50:07Z"}, "comments": 19, "created_at": "2018-02-16T17:09:34Z", "updated_at": "2018-07-15T04:26:39Z", "closed_at": "2018-02-19T06:02:49Z", "author_association": "MEMBER", "active_lock_reason": null, "pull_request": {"url": "https://api.github.com/repos/datalad/datalad/pulls/2187", "html_url": "https://github.com/datalad/datalad/pull/2187", "diff_url": "https://github.com/datalad/datalad/pull/2187.diff", "patch_url": "https://github.com/datalad/datalad/pull/2187.patch"}, "body": "#### What is the problem?\r\n\r\nwe had discussion on possible other ways to get a list of submodules without invoking `git submodule status` which does additional stuff.\r\n\r\nmagit uses `git ls-files --stage` and then submodules have a leading magical tag `160000`.  There is also `--recurse-submodules` but that one is not compatible with `--stage` which directs to output those tags\r\n\r\n# Timing\r\n\r\nthe fun part is that surprisingly `ls-files` although lists all the files in the repo, still comes out as a winner even with grep attached even when there is no submodules\r\n\r\n```shell\r\nfalkor:/srv/datasets.datalad.org/www/openfmri/ds000115\r\n$> time bash -c 'git ls-files --stage | grep ^160000'\r\nbash -c 'git ls-files --stage | grep ^160000'  0.00s user 0.00s system 0% cpu 0.007 total\r\n\r\n$> time git submodule status                         \r\ngit submodule status  0.00s user 0.00s system 12% cpu 0.033 total\r\n```\r\n\r\nmore fun whenever we actually go to a repo with submodules:\r\n```shell\r\n(git)falkor:/srv/datasets.datalad.org/www/openfmri[master]\r\n$> time git submodule status\r\n f47099a5124e8f619f763f44f70e1faf5154d41a ds000001 (2.0.4+3-2-gf47099a5)\r\n e1b7df06da8dd8f1d8802d699d9ad7781fad8bb6 ds000002 (2.0.5+3-1-ge1b7df06)\r\n  ...\r\n git submodule status  0.02s user 0.08s system 7% cpu 1.324 total\r\n\r\n$> time bash -c 'git ls-files --stage | grep ^160000'\r\n160000 f47099a5124e8f619f763f44f70e1faf5154d41a 0\tds000001\r\n160000 e1b7df06da8dd8f1d8802d699d9ad7781fad8bb6 0\tds000002\r\n...\r\n160000 58882ccf9e03f445beb39ae624934e49fba63bf6 0\tds000258\r\nbash -c 'git ls-files --stage | grep ^160000'  0.00s user 0.00s system 0% cpu 0.008 total\r\n```\r\n\r\nso if we were after just a list of submodules -- this might be the way to get speeds up!\r\n\r\n## Timing on our full hierarchy\r\n\r\n```\r\n   508   5ebf32dcf9068be18ee8403346957d3d6aee96c1 workshops/repronim-sfn-2017/challenge (0.0.20171111+1-1-g5ebf32d)\r\ngit submodule status --recursive  8.37s user 4.36s system 101% cpu 12.520 total\r\n```\r\n\r\n```\r\n   508  ./workshops/repronim-sfn-2017/challenge\r\n~/trash/subm.sh .  4.00s user 2.09s system 174% cpu 3.493 total\r\n```\r\nwhere the subm.sh is ls-files based script doing it recursively:\r\n```bash\r\n#!/bin/bash\r\n\r\ngit -C $1 ls-files --stage | grep '^160' | awk '{print $4;}' | while read d; do echo $1/$d; $0 $1/$d; done; \r\n```\r\n", "closed_by": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/2187/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/2187/timeline", "performed_via_github_app": null}