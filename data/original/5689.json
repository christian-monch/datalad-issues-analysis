{"url": "https://api.github.com/repos/datalad/datalad/issues/5689", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/5689/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/5689/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/5689/events", "html_url": "https://github.com/datalad/datalad/pull/5689", "id": 897601751, "node_id": "MDExOlB1bGxSZXF1ZXN0NjQ5NTkwNDA3", "number": 5689, "title": "addurls: Improve result displayed for subdataset creation", "user": {"login": "kyleam", "id": 1297788, "node_id": "MDQ6VXNlcjEyOTc3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1297788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kyleam", "html_url": "https://github.com/kyleam", "followers_url": "https://api.github.com/users/kyleam/followers", "following_url": "https://api.github.com/users/kyleam/following{/other_user}", "gists_url": "https://api.github.com/users/kyleam/gists{/gist_id}", "starred_url": "https://api.github.com/users/kyleam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kyleam/subscriptions", "organizations_url": "https://api.github.com/users/kyleam/orgs", "repos_url": "https://api.github.com/users/kyleam/repos", "events_url": "https://api.github.com/users/kyleam/events{/privacy}", "received_events_url": "https://api.github.com/users/kyleam/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 2805377474, "node_id": "MDU6TGFiZWwyODA1Mzc3NDc0", "url": "https://api.github.com/repos/datalad/datalad/labels/cmd-addurls", "name": "cmd-addurls", "color": "FEF2C0", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/datalad/datalad/milestones/86", "html_url": "https://github.com/datalad/datalad/milestone/86", "labels_url": "https://api.github.com/repos/datalad/datalad/milestones/86/labels", "id": 6382960, "node_id": "MDk6TWlsZXN0b25lNjM4Mjk2MA==", "number": 86, "title": "0.15.0", "description": "", "creator": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 22, "state": "open", "created_at": "2021-02-02T14:46:01Z", "updated_at": "2021-09-10T17:50:04Z", "due_on": null, "closed_at": null}, "comments": 4, "created_at": "2021-05-21T01:40:11Z", "updated_at": "2021-08-05T20:36:50Z", "closed_at": "2021-08-05T20:36:49Z", "author_association": "MEMBER", "active_lock_reason": null, "pull_request": {"url": "https://api.github.com/repos/datalad/datalad/pulls/5689", "html_url": "https://github.com/datalad/datalad/pull/5689", "diff_url": "https://github.com/datalad/datalad/pull/5689.diff", "patch_url": "https://github.com/datalad/datalad/pull/5689.patch"}, "body": "When `addurls` creates a subdataset, the `create` result, as shown by the default renderer, doesn't make it clear which subdataset was created:\r\n\r\n<details>\r\n<summary>script</summary>\r\n\r\n```sh\r\nset -eu\r\n\r\ncd \"$(mktemp -d \"${TMPDIR:-/tmp}\"/dl-XXXXXXX)\"\r\ndatalad create >/dev/null 2>&1\r\n\r\ndatalad -lwarning \\\r\n        addurls -x '' --key='{key}' -t csv \\\r\n        - '{url}' '{_url_basename:.2}//{_url_basename}' <<EOF\r\nkey,url\r\nSHA256E-s8669--a1954d14daa74af097d5cb1c65efaadb781f1924f42e31ac6dc5af57e4a8e955.svg,http://handbook.datalad.org/en/0.12/_images/install.svg\r\nSHA256E-s49162--13c1bcb98945af4c51082b7431de291f509d2e25edf9e14631a27bc548d9eaa1.svg,http://handbook.datalad.org/en/0.12/_images/student.svg\r\nEOF\r\n```\r\n\r\n</details>\r\n\r\n```\r\ncreate(ok): . (dataset)\r\nfromkey(ok): /tmp/dl-JhgrkS0/in/install.svg (file) [registered URL]\r\ncreate(ok): . (dataset)\r\nfromkey(ok): /tmp/dl-JhgrkS0/st/student.svg (file) [registered URL]\r\nsave(ok): st (dataset)\r\nsave(ok): in (dataset)\r\nadd(ok): in (file)\r\nadd(ok): st (file)\r\nadd(ok): .gitmodules (file)\r\nsave(ok): . (dataset)\r\naction summary:\r\n  add (ok: 3)\r\n  create (ok: 2)\r\n  fromkey (ok: 2)\r\n  save (ok: 3)\r\n```\r\n\r\nThis series, in particular the last commit, defines a custom result renderer that changes that to\r\n\r\n```\r\ncreate(ok): in (dataset)\r\nfromkey(ok): /tmp/dl-TF8m3S7/in/install.svg (file) [registered URL]\r\ncreate(ok): st (dataset)\r\nfromkey(ok): /tmp/dl-TF8m3S7/st/student.svg (file) [registered URL]\r\nsave(ok): st (dataset)\r\nsave(ok): in (dataset)\r\nadd(ok): in (file)\r\nadd(ok): st (file)\r\nadd(ok): .gitmodules (file)\r\nsave(ok): . (dataset)\r\naction summary:\r\n  add (ok: 3)\r\n  create (ok: 2)\r\n  fromkey (ok: 2)\r\n  save (ok: 3)\r\n```\r\n\r\nMost of the other commits leading up to the last commit make it possible to easily display the default summary despite defining a `custom_result_renderer` method.\r\n\r\n---\r\n\r\nI think this at least partially addresses gh-4989, though the request there might be for more progress than just result records.  (And I suspect no `create` results are shown in the output there because `addurls` was called from the Python API where `result_renderer=None` would be the default.)\r\n\r\n---\r\n\r\n- [x] Wait for PR gh-5688 (against maint)\r\n- [x] PR gh-5696 uses the same first three commits.  Wait for those be reviewed over there.\r\n       First three commits have landed in master as is, so this PR is okay to merge without a rebase.\r\n", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/5689/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/5689/timeline", "performed_via_github_app": null}