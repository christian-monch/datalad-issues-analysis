{"url": "https://api.github.com/repos/datalad/datalad/issues/5422", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/5422/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/5422/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/5422/events", "html_url": "https://github.com/datalad/datalad/issues/5422", "id": 810970746, "node_id": "MDU6SXNzdWU4MTA5NzA3NDY=", "number": 5422, "title": "NotImplementedError: nest_asyncio.apply() for datalad.api not sufficient", "user": {"login": "man8k", "id": 79251544, "node_id": "MDQ6VXNlcjc5MjUxNTQ0", "avatar_url": "https://avatars.githubusercontent.com/u/79251544?v=4", "gravatar_id": "", "url": "https://api.github.com/users/man8k", "html_url": "https://github.com/man8k", "followers_url": "https://api.github.com/users/man8k/followers", "following_url": "https://api.github.com/users/man8k/following{/other_user}", "gists_url": "https://api.github.com/users/man8k/gists{/gist_id}", "starred_url": "https://api.github.com/users/man8k/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/man8k/subscriptions", "organizations_url": "https://api.github.com/users/man8k/orgs", "repos_url": "https://api.github.com/users/man8k/repos", "events_url": "https://api.github.com/users/man8k/events{/privacy}", "received_events_url": "https://api.github.com/users/man8k/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 188141023, "node_id": "MDU6TGFiZWwxODgxNDEwMjM=", "url": "https://api.github.com/repos/datalad/datalad/labels/platform-windows", "name": "platform-windows", "color": "0052cc", "default": false, "description": "Issue concerned with Windows"}, {"id": 191508346, "node_id": "MDU6TGFiZWwxOTE1MDgzNDY=", "url": "https://api.github.com/repos/datalad/datalad/labels/platform-osx", "name": "platform-osx", "color": "0052cc", "default": false, "description": "Issue concerned with MacOSX"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 18, "created_at": "2021-02-18T10:33:02Z", "updated_at": "2021-05-21T13:24:55Z", "closed_at": "2021-05-21T13:24:55Z", "author_association": "NONE", "active_lock_reason": null, "body": "Continuation of issue #5409 \r\n\r\nSuggested workaround:\r\n```python\r\nimport nest_asyncio\r\nnest_asyncio.apply()\r\nimport datalad.api as dl\r\n```\r\n...did not work (in this case on Windows 10)\r\n\r\n```\r\nNotImplementedError\r\n<ipython-input-3-4f86fa9c5d49> in <module>\r\n      3 import nest_asyncio\r\n      4 nest_asyncio.apply()\r\n----> 5 import datalad.api as dl\r\n```\r\n\r\n<details>\r\n<summary>file from the link below</summary> \r\n\r\n```shell\r\n\r\n----------------------------------------------------------------------\r\n!pip install nest_asyncio\r\n----------------------------------------------------------------------\r\nRequirement already satisfied: nest_asyncio in c:\\programdata\\anaconda3\\lib\\site-packages (1.4.2)\r\n\r\n\r\n----------------------------------------------------------------------\r\nimport os\r\nimport glob\r\nimport nest_asyncio\r\nnest_asyncio.apply()\r\nimport datalad.api as dl\r\n----------------------------------------------------------------------\r\n\r\nNotImplementedError                       Traceback (most recent call last)\r\n<ipython-input-3-4f86fa9c5d49> in <module>\r\n      3 import nest_asyncio\r\n      4 nest_asyncio.apply()\r\n----> 5 import datalad.api as dl\r\n\r\nC:\\ProgramData\\Anaconda3\\lib\\site-packages\\datalad\\__init__.py in <module>\r\n     45 \r\n     46 from .config import ConfigManager\r\n---> 47 cfg = ConfigManager()\r\n     48 \r\n     49 from .log import lgr\r\n\r\nC:\\ProgramData\\Anaconda3\\lib\\site-packages\\datalad\\config.py in __init__(self, dataset, overrides, source)\r\n    272             self._runner = GitWitlessRunner(**run_kwargs)\r\n    273 \r\n--> 274         self.reload(force=True)\r\n    275 \r\n    276         if not ConfigManager._checked_git_identity:\r\n\r\nC:\\ProgramData\\Anaconda3\\lib\\site-packages\\datalad\\config.py in reload(self, force)\r\n    325         while to_run:\r\n    326             store_id, runargs = to_run.popitem()\r\n--> 327             self._stores[store_id] = self._reload(runargs)\r\n    328 \r\n    329         # always update the merged representation, even if we did not reload\r\n\r\nC:\\ProgramData\\Anaconda3\\lib\\site-packages\\datalad\\config.py in _reload(self, run_args)\r\n    353     def _reload(self, run_args):\r\n    354         # query git-config\r\n--> 355         stdout, stderr = self._run(\r\n    356             run_args,\r\n    357             protocol=StdOutErrCapture,\r\n\r\nC:\\ProgramData\\Anaconda3\\lib\\site-packages\\datalad\\config.py in _run(self, args, where, reload, **kwargs)\r\n    715         if '-l' in args:\r\n    716             # we are just reading, no need to reload, no need to lock\r\n--> 717             out = self._runner.run(self._config_cmd + args, **kwargs)\r\n    718             return out['stdout'], out['stderr']\r\n    719 \r\n\r\nC:\\ProgramData\\Anaconda3\\lib\\site-packages\\datalad\\cmd.py in run(self, cmd, protocol, stdin, cwd, env, **kwargs)\r\n    378         try:\r\n    379             # include the subprocess manager in the asyncio event loop\r\n--> 380             results = event_loop.run_until_complete(\r\n    381                 run_async_cmd(\r\n    382                     event_loop,\r\n\r\nC:\\ProgramData\\Anaconda3\\lib\\site-packages\\nest_asyncio.py in run_until_complete(self, future)\r\n     94                 raise RuntimeError(\r\n     95                     'Event loop stopped before Future completed.')\r\n---> 96             return f.result()\r\n     97         finally:\r\n     98             events._set_running_loop(old_running_loop)\r\n\r\nC:\\ProgramData\\Anaconda3\\lib\\asyncio\\futures.py in result(self)\r\n    176         self.__log_traceback = False\r\n    177         if self._exception is not None:\r\n--> 178             raise self._exception\r\n    179         return self._result\r\n    180 \r\n\r\nC:\\ProgramData\\Anaconda3\\lib\\asyncio\\tasks.py in __step(***failed resolving arguments***)\r\n    278                 # We use the `send` method directly, because coroutines\r\n    279                 # don't have `__iter__` and `__next__` methods.\r\n--> 280                 result = coro.send(None)\r\n    281             else:\r\n    282                 result = coro.throw(exc)\r\n\r\nC:\\ProgramData\\Anaconda3\\lib\\site-packages\\datalad\\cmd.py in run_async_cmd(loop, cmd, protocol, stdin, protocol_kwargs, **kwargs)\r\n    102     try:\r\n    103         lgr.debug('Launching process %s', cmd)\r\n--> 104         transport, protocol = await proc\r\n    105         lgr.debug('Waiting for process %i to complete', transport.get_pid())\r\n    106         # The next wait is a workaround that avoids losing the output of\r\n\r\nC:\\ProgramData\\Anaconda3\\lib\\asyncio\\base_events.py in subprocess_exec(self, protocol_factory, program, stdin, stdout, stderr, universal_newlines, shell, bufsize, encoding, errors, text, *args, **kwargs)\r\n   1628             debug_log = f'execute program {program!r}'\r\n   1629             self._log_subprocess(debug_log, stdin, stdout, stderr)\r\n-> 1630         transport = await self._make_subprocess_transport(\r\n   1631             protocol, popen_args, False, stdin, stdout, stderr,\r\n   1632             bufsize, **kwargs)\r\n\r\nC:\\ProgramData\\Anaconda3\\lib\\asyncio\\base_events.py in _make_subprocess_transport(self, protocol, args, shell, stdin, stdout, stderr, bufsize, extra, **kwargs)\r\n    489                                          extra=None, **kwargs):\r\n    490         \"\"\"Create subprocess transport.\"\"\"\r\n--> 491         raise NotImplementedError\r\n    492 \r\n    493     def _write_to_self(self):\r\n\r\nNotImplementedError: \r\n\r\n```\r\n</details>\r\n\r\n[Datalad_Asyncio_NotImplemented_20210216.txt](https://github.com/datalad/datalad/files/6002091/Datalad_Asyncio_NotImplemented_20210216.txt)\r\n", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/5422/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/5422/timeline", "performed_via_github_app": null}