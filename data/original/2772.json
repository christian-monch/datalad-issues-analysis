{"url": "https://api.github.com/repos/datalad/datalad/issues/2772", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/2772/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/2772/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/2772/events", "html_url": "https://github.com/datalad/datalad/issues/2772", "id": 351279828, "node_id": "MDU6SXNzdWUzNTEyNzk4Mjg=", "number": 2772, "title": "--incremental -- should not be needed to update a single subdataset metadata", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 700886055, "node_id": "MDU6TGFiZWw3MDA4ODYwNTU=", "url": "https://api.github.com/repos/datalad/datalad/labels/metadata", "name": "metadata", "color": "0052cc", "default": false, "description": ""}, {"id": 1361506618, "node_id": "MDU6TGFiZWwxMzYxNTA2NjE4", "url": "https://api.github.com/repos/datalad/datalad/labels/fixed-in-metalad", "name": "fixed-in-metalad", "color": "0e8a16", "default": false, "description": ""}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-08-16T16:29:57Z", "updated_at": "2020-01-12T09:17:50Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "#### What is the problem?\r\noriginally mentioned while recrawling datasets - without incremental=True, upon\r\n```python\r\naggregate_metadata(\r\n                    dataset='^',\r\n                    path=self.repo.path,\r\n                    update_mode='all')\r\n```\r\nall \"neighboring\" subdatasets in the super datasets woul loose their metadata.  So I've added `incremental=True` (see https://github.com/datalad/datalad-crawler/pull/10) but that leads to another side-effect -- datalad then doesn't remove those metadata object files which get replaced with the new ones:\r\n\r\n```\r\ncommit 4f1a2bfab5406f74ba79943ca88bb4f5c324d8ec (HEAD -> master, tag: 1.0.1)\r\nAuthor: DataLad Tester <test@example.com>\r\nDate:   Thu Aug 16 12:16:48 2018 -0400\r\n\r\n    [DATALAD] Dataset aggregate metadata update\r\n\r\n .datalad/metadata/aggregate_v1.json                               |   6 +++---\r\n .datalad/metadata/objects/b2/cn-71b6e379ea7b8a6f74d54e6718f448.xz | Bin 0 -> 32 bytes\r\n .datalad/metadata/objects/b2/ds-71b6e379ea7b8a6f74d54e6718f448    |  14 ++++++++++++++\r\n 3 files changed, 17 insertions(+), 3 deletions(-)\r\n\r\ncommit 15aa34542c780c7a73e3c6ba8735af1961154c53\r\nMerge: a47dd82 a7f04af\r\nAuthor: DataLad Tester <test@example.com>\r\nDate:   Thu Aug 16 12:16:47 2018 -0400\r\n\r\n    Merge branch 'incoming-processed'\r\n```\r\nwhich causes tests to fail since we expected the \"pruning\" commit first (shouldn't ideally two of those be just a single commit?).\r\n\r\nSo the question to @mih \r\n- do you see a real need for having `incremental` mode of operation for that aggregate-metadata call?\r\n- nothing in `--incremental` docs mentions keeping previous objects for the dataset.\r\n\r\nI wonder also\r\n- if pruning of \"old\" metadata files could be done within the same commit as an update?", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/2772/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/2772/timeline", "performed_via_github_app": null}