{"url": "https://api.github.com/repos/datalad/datalad/issues/383", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/383/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/383/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/383/events", "html_url": "https://github.com/datalad/datalad/issues/383", "id": 143352974, "node_id": "MDU6SXNzdWUxNDMzNTI5NzQ=", "number": 383, "title": "install(soure==path) fails if module was already \"installed\" before", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2016-03-24T20:38:26Z", "updated_at": "2016-03-29T15:02:37Z", "closed_at": "2016-03-29T15:02:37Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "I have in annex.py  `initiate_handle` following use of install\n\n``` python\n                # Also \"register\" as a sub-handle\n                out = install(\n                        dataset=Dataset(self.repo.path),\n                        path=data_['handle_path'],\n                        source=data_['handle_path'],\n                        )\n```\n\nand it was previously initiated already but then manually 'rm'ed -- so it is present in  the `.gitmodules`.  While running crawler it then attempts to \"install\" it again but it leads to install puking (see below).  IMHO should be fixed at the level of install.  I.e. if submodule already was registered and points to the same location -- all kosher, just proceed.  If was registered but points to another location (`source` differs) -- might as well puke.  Alternatively (and how I guess I will do now as a workaround) I can skip \"install\" if already known to the repo submodules\n\n```\n(git)smaug:/mnt/btrfs/datasets/datalad/crawl/openfmri[master]git\n$> datalad --dbg -l info crawl\n2016-03-24 16:31:07,970 [INFO   ] Loading pipeline specification from ./.datalad/crawl/crawl.cfg (crawl.py:89)\n2016-03-24 16:31:11,695 [INFO   ] Creating a pipeline with kwargs {} (openfmri_collection.py:33)\n2016-03-24 16:31:11,696 [INFO   ] Running pipeline [<datalad.crawler.nodes.crawl_url.crawl_url object at 0x7fbed8282390>, <datalad.crawler.nodes.matches.a_href_match object at 0x7fbed8282410>, assign(assignments={'handle_name': '%(dataset)s'}, interpolate=True), <function _initiate_handle at 0x7fbed82607d0>] (crawl.py:92)\n2016-03-24 16:31:11,697 [INFO   ] Fetching 'https://openfmri.org/dataset/' (base.py:429)\n2016-03-24 16:31:13,464 [INFO   ] Skipping handle ds000011 since already exists (annex.py:196)\n2016-03-24 16:31:13,867 [INFO   ] Skipping handle ds000051 since already exists (annex.py:196)\n2016-03-24 16:31:14,138 [INFO   ] Skipping handle ds000052 since already exists (annex.py:196)\n2016-03-24 16:31:14,364 [INFO   ] Skipping handle ds000005 since already exists (annex.py:196)\n2016-03-24 16:31:14,574 [INFO   ] Skipping handle ds000003 since already exists (annex.py:196)\n2016-03-24 16:31:14,821 [INFO   ] Skipping handle ds000009 since already exists (annex.py:196)\n2016-03-24 16:31:15,071 [INFO   ] Skipping handle ds000006 since already exists (annex.py:196)\n2016-03-24 16:31:15,387 [INFO   ] Initiating handle ds000017 (annex.py:115)\n2016-03-24 16:31:16,747 [INFO   ] Skipping handle ds000001 since already exists (annex.py:196)\n2016-03-24 16:31:17,119 [INFO   ] Skipping handle ds000007 since already exists (annex.py:196)\n2016-03-24 16:31:17,513 [INFO   ] Skipping handle ds000101 since already exists (annex.py:196)\n2016-03-24 16:31:17,882 [INFO   ] Skipping handle ds000102 since already exists (annex.py:196)\n2016-03-24 16:31:18,251 [INFO   ] Skipping handle ds000105 since already exists (annex.py:196)\n2016-03-24 16:31:18,640 [INFO   ] Initiating handle ds000107 (annex.py:115)\n2016-03-24 16:31:20,038 [INFO   ] Skipping handle ds000109 since already exists (annex.py:196)\n2016-03-24 16:31:20,429 [INFO   ] Skipping handle ds000110 since already exists (annex.py:196)\n2016-03-24 16:31:20,770 [INFO   ] Initiating handle ds000113 (annex.py:115)\n2016-03-24 16:31:22,351 [ERROR  ] stderr| '' already exists in the index (cmd.py:351)\n2016-03-24 16:31:22,351 [ERROR  ] Failed to run ['git', 'submodule', 'add', u'./ds000113', '.'] under u'/mnt/btrfs/datasets/datalad/crawl/openfmri/ds000113'. Exit code=1. out= err='' already exists in the index\n|  (cmd.py:295)\nTraceback (most recent call last):\n  File \"/home/yoh/proj/datalad/datalad/venv-tests/bin/datalad\", line 9, in <module>\n    load_entry_point('datalad==0.1.dev0', 'console_scripts', 'datalad')()\n  File \"/home/yoh/proj/datalad/datalad/datalad/cmdline/main.py\", line 216, in main\n    ret = cmdlineargs.func(cmdlineargs)\n  File \"/home/yoh/proj/datalad/datalad/datalad/interface/base.py\", line 153, in call_from_parser\n    return cls.__call__(**kwargs)\n  File \"/home/yoh/proj/datalad/datalad/datalad/interface/crawl.py\", line 96, in __call__\n    run_pipeline(pipeline)\n  File \"/home/yoh/proj/datalad/datalad/datalad/crawler/pipeline.py\", line 100, in run_pipeline\n    output = list(xrun_pipeline(*args, **kwargs))\n  File \"/home/yoh/proj/datalad/datalad/datalad/crawler/pipeline.py\", line 180, in xrun_pipeline\n    for idata_out, data_out in enumerate(xrun_pipeline_steps(pipeline, data_in, output=output_sub)):\n  File \"/home/yoh/proj/datalad/datalad/datalad/crawler/pipeline.py\", line 268, in xrun_pipeline_steps\n    for data_out in xrun_pipeline_steps(pipeline_tail, data_, output=output):\n  File \"/home/yoh/proj/datalad/datalad/datalad/crawler/pipeline.py\", line 268, in xrun_pipeline_steps\n    for data_out in xrun_pipeline_steps(pipeline_tail, data_, output=output):\n  File \"/home/yoh/proj/datalad/datalad/datalad/crawler/pipeline.py\", line 268, in xrun_pipeline_steps\n    for data_out in xrun_pipeline_steps(pipeline_tail, data_, output=output):\n  File \"/home/yoh/proj/datalad/datalad/datalad/crawler/pipeline.py\", line 252, in xrun_pipeline_steps\n    for data_ in data_in_to_loop:\n  File \"/home/yoh/proj/datalad/datalad/datalad/crawler/nodes/annex.py\", line 1121, in _initiate_handle\n    source=data_['handle_path'],\n  File \"/home/yoh/proj/datalad/datalad/datalad/distribution/install.py\", line 215, in __call__\n    recursive=recursive)\n  File \"/home/yoh/proj/datalad/datalad/datalad/distribution/install.py\", line 226, in __call__\n    runner.run(cmd_list, cwd=ds.path)\n  File \"/home/yoh/proj/datalad/datalad/datalad/cmd.py\", line 296, in run\n    raise CommandError(str(cmd), msg, status, out[0], out[1])\nCommandError: CommandError: command '['git', 'submodule', 'add', u'./ds000113', '.']' failed with exitcode 1.\nFailed to run ['git', 'submodule', 'add', u'./ds000113', '.'] under u'/mnt/btrfs/datasets/datalad/crawl/openfmri/ds000113'. Exit code=1. out= err='' already exists in the index\n\n()\n> /home/yoh/proj/datalad/datalad/datalad/cmd.py(296)run()\n-> raise CommandError(str(cmd), msg, status, out[0], out[1])\n(Pdb) \n\n\n$> grep ds000113 .gitmodules \n[submodule \"ds000113\"]\n    path = ds000113\n    url = /mnt/datasets/datalad/crawl/openfmri/ds000113\n[submodule \"ds000113b\"]\n    path = ds000113b\n    url = /mnt/datasets/datalad/crawl/openfmri/ds000113b\n```\n", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/383/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/383/timeline", "performed_via_github_app": null}