{"url": "https://api.github.com/repos/datalad/datalad/issues/3459", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/3459/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/3459/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/3459/events", "html_url": "https://github.com/datalad/datalad/pull/3459", "id": 448508445, "node_id": "MDExOlB1bGxSZXF1ZXN0MjgyMjU4NjYx", "number": 3459, "title": "BF+RF: unlock: Rewrite using status()", "user": {"login": "kyleam", "id": 1297788, "node_id": "MDQ6VXNlcjEyOTc3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1297788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kyleam", "html_url": "https://github.com/kyleam", "followers_url": "https://api.github.com/users/kyleam/followers", "following_url": "https://api.github.com/users/kyleam/following{/other_user}", "gists_url": "https://api.github.com/users/kyleam/gists{/gist_id}", "starred_url": "https://api.github.com/users/kyleam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kyleam/subscriptions", "organizations_url": "https://api.github.com/users/kyleam/orgs", "repos_url": "https://api.github.com/users/kyleam/repos", "events_url": "https://api.github.com/users/kyleam/events{/privacy}", "received_events_url": "https://api.github.com/users/kyleam/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2019-05-25T22:31:13Z", "updated_at": "2019-06-03T12:07:57Z", "closed_at": "2019-06-01T07:50:12Z", "author_association": "MEMBER", "active_lock_reason": null, "pull_request": {"url": "https://api.github.com/repos/datalad/datalad/pulls/3459", "html_url": "https://github.com/datalad/datalad/pull/3459", "diff_url": "https://github.com/datalad/datalad/pull/3459.diff", "patch_url": "https://github.com/datalad/datalad/pull/3459.patch"}, "body": "```\r\nIf a file without content is passed to unlock(), it yields a\r\nresult (with a status of \"impossible\") saying that the file doesn't\r\nhave content.  But if the files without content weren't explicitly\r\nprovided as paths (e.g., no path was given or a directory containing\r\nthe files was given as the path), then files without content lead to a\r\nCommandError from the underlying 'git annex unlock' call.  (Or in v6+,\r\nthey lead to the pointer being unlocked which is inconsistent with the\r\nerror given when a file is explicitly specified in v6+ and also\r\npotentially confusing to callers.)\r\n\r\nTo fix the \"no paths specified, missing content\" behavior, rely on the\r\ninformation provided by status() to restrict the unlock calls to files\r\nwith content.  This fix raises the question of how to report files\r\nwithout content when the path isn't explicitly given.  Because\r\n'datalad unlock' at the dataset or a directory level could potentially\r\nlead to a lot of results, avoid reporting \"can't unlock\" results when\r\nexplicit paths aren't given.  Doing this at the __call__ level rather\r\nthan as a result filter means we can do the faster status(...,\r\nuntracked=no\") query unless explicit, non-directory paths are given.\r\n\r\nAside from the fix above, this tries to match the behavior of the\r\nprevious unlock().  The main behavioral change, shown by the test\r\nupdates, is that unlock() no longer infers the dataset from a path\r\nwhen the current working directory is outside a dataset and no dataset\r\nis explicitly given.  This behavioral change is consistent with, for\r\nexample, distribution.add vs core.local.save.\r\n\r\nThis nudges annotate_paths() closer to retirement (gh-3368).\r\n```", "closed_by": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/3459/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/3459/timeline", "performed_via_github_app": null}