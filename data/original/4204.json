{"url": "https://api.github.com/repos/datalad/datalad/issues/4204", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/4204/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/4204/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/4204/events", "html_url": "https://github.com/datalad/datalad/issues/4204", "id": 571284337, "node_id": "MDU6SXNzdWU1NzEyODQzMzc=", "number": 4204, "title": "Broken special remote lets whereis fail completely", "user": {"login": "bpoldrack", "id": 10498301, "node_id": "MDQ6VXNlcjEwNDk4MzAx", "avatar_url": "https://avatars.githubusercontent.com/u/10498301?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bpoldrack", "html_url": "https://github.com/bpoldrack", "followers_url": "https://api.github.com/users/bpoldrack/followers", "following_url": "https://api.github.com/users/bpoldrack/following{/other_user}", "gists_url": "https://api.github.com/users/bpoldrack/gists{/gist_id}", "starred_url": "https://api.github.com/users/bpoldrack/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bpoldrack/subscriptions", "organizations_url": "https://api.github.com/users/bpoldrack/orgs", "repos_url": "https://api.github.com/users/bpoldrack/repos", "events_url": "https://api.github.com/users/bpoldrack/events{/privacy}", "received_events_url": "https://api.github.com/users/bpoldrack/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 63778590, "node_id": "MDU6TGFiZWw2Mzc3ODU5MA==", "url": "https://api.github.com/repos/datalad/datalad/labels/severity-normal", "name": "severity-normal", "color": "ff8888", "default": false, "description": "standard severity"}, {"id": 132485920, "node_id": "MDU6TGFiZWwxMzI0ODU5MjA=", "url": "https://api.github.com/repos/datalad/datalad/labels/annex", "name": "annex", "color": "0052cc", "default": false, "description": "Git-annex related issue"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-02-26T11:52:57Z", "updated_at": "2020-10-06T00:15:48Z", "closed_at": "2020-10-06T00:15:48Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Scenario: We have a repo with a file locally available and (according to current knowledge) available from that special remote. Now we break the special remote, so that it responds to PREPARE by PREPAIRE-FAILURE. Effect: `git-annex-fsck` as well as `git-annex-whereis` fail. While the former is fine, the latter isn't, since due its failure we don't get *any* response from `whereis` anymore. Not even the local availability:\r\n\r\n```\r\n\u2771 git annex --debug whereis one.txt --json                                                                                                                                               1 !\r\n[2020-02-26 12:26:59.771530846] read: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"show-ref\",\"git-annex\"]\r\n[2020-02-26 12:26:59.780514055] process done ExitSuccess\r\n[2020-02-26 12:26:59.780884245] read: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"show-ref\",\"--hash\",\"refs/heads/git-annex\"]\r\n[2020-02-26 12:26:59.788015914] process done ExitSuccess\r\n[2020-02-26 12:26:59.788589443] read: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"log\",\"refs/heads/git-annex..d4d0c919ff3a0bf7e604b1c94ea98feefeb1b684\",\"--pretty=%H\",\"-n1\"]\r\n[2020-02-26 12:26:59.795904432] process done ExitSuccess\r\n[2020-02-26 12:26:59.796823695] chat: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"cat-file\",\"--batch\"]\r\n[2020-02-26 12:26:59.812617559] chat: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"cat-file\",\"--batch-check=%(objectname) %(objecttype) %(objectsize)\"]\r\n[2020-02-26 12:26:59.819050683] read: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"symbolic-ref\",\"-q\",\"HEAD\"]\r\n[2020-02-26 12:26:59.825218144] process done ExitSuccess\r\n[2020-02-26 12:26:59.825441474] read: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"show-ref\",\"refs/heads/master\"]\r\n[2020-02-26 12:26:59.83136621] process done ExitSuccess\r\n[2020-02-26 12:26:59.831736442] read: git [\"--git-dir=.git\",\"--work-tree=.\",\"--literal-pathspecs\",\"ls-files\",\"--cached\",\"-z\",\"--\",\"one.txt\"]\r\n[2020-02-26 12:26:59.838333917] chat: /home/ben/venvs/datalad-dev/bin/git-annex-remote-ria []\r\n[2020-02-26 12:26:59.972062944] git-annex-remote-ria[1] --> VERSION 1\r\n[2020-02-26 12:26:59.972170997] git-annex-remote-ria[1] <-- EXTENSIONS INFO\r\n[2020-02-26 12:26:59.972385856] git-annex-remote-ria[1] --> EXTENSIONS\r\n[2020-02-26 12:26:59.972435141] git-annex-remote-ria[1] <-- PREPARE\r\n[2020-02-26 12:26:59.972654264] git-annex-remote-ria[1] --> GETGITDIR\r\n[2020-02-26 12:26:59.972700314] git-annex-remote-ria[1] <-- VALUE .git\r\n[2020-02-26 12:26:59.972801147] git-annex-remote-ria[1] --> GETUUID\r\n[2020-02-26 12:26:59.972851531] git-annex-remote-ria[1] <-- VALUE e1ee313a-1f2b-4ab9-b10d-c35407c85072\r\n[2020-02-26 12:26:59.972967572] git-annex-remote-ria[1] --> GETCONFIG name\r\n[2020-02-26 12:26:59.973021609] git-annex-remote-ria[1] <-- VALUE archive\r\n[2020-02-26 12:26:59.973087917] git-annex-remote-ria[1] --> GETCONFIG url\r\n[2020-02-26 12:26:59.973125401] git-annex-remote-ria[1] <-- VALUE ria+file:///tmp/datalad_temp_test_backup_archive4p_w2fdc\r\n[2020-02-26 12:27:00.001862614] git-annex-remote-ria[1] --> GETCONFIG archive-id\r\n[2020-02-26 12:27:00.002125072] git-annex-remote-ria[1] <-- VALUE c516c60c-588a-11ea-9596-e11c00cb83c9\r\n[2020-02-26 12:27:00.002445627] git-annex-remote-ria[1] --> GETCONFIG force-write\r\n[2020-02-26 12:27:00.002551097] git-annex-remote-ria[1] <-- VALUE \r\n[2020-02-26 12:27:00.003791357] git-annex-remote-ria[1] --> PREPARE-FAILURE \r\ngit-annex: \r\n{\"command\":\"whereis\",\"success\":false,\"key\":\"MD5E-s8--7e55db001d319a94b0b713529a756623.txt\",\"file\":\"one.txt\"}\r\n[2020-02-26 12:27:00.037076997] process done ExitSuccess\r\n[2020-02-26 12:27:00.03794719] process done ExitSuccess\r\n[2020-02-26 12:27:00.03875555] process done ExitSuccess\r\ngit-annex: whereis: 1 failed\r\n```\r\n```\r\ngit-annex version: 7.20190819+git2-g908476a9b-1~ndall+1\r\n```\r\n\r\nNote, that this looks the same after a failed `fsck`. I'd consider this a bug. What do you think, @datalad/developers ?\r\n", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/4204/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/4204/timeline", "performed_via_github_app": null}