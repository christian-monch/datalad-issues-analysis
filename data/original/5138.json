{"url": "https://api.github.com/repos/datalad/datalad/issues/5138", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/5138/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/5138/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/5138/events", "html_url": "https://github.com/datalad/datalad/issues/5138", "id": 739051157, "node_id": "MDU6SXNzdWU3MzkwNTExNTc=", "number": 5138, "title": "Some explorations with Docker on Windows 10", "user": {"login": "adswa", "id": 29738718, "node_id": "MDQ6VXNlcjI5NzM4NzE4", "avatar_url": "https://avatars.githubusercontent.com/u/29738718?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adswa", "html_url": "https://github.com/adswa", "followers_url": "https://api.github.com/users/adswa/followers", "following_url": "https://api.github.com/users/adswa/following{/other_user}", "gists_url": "https://api.github.com/users/adswa/gists{/gist_id}", "starred_url": "https://api.github.com/users/adswa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adswa/subscriptions", "organizations_url": "https://api.github.com/users/adswa/orgs", "repos_url": "https://api.github.com/users/adswa/repos", "events_url": "https://api.github.com/users/adswa/events{/privacy}", "received_events_url": "https://api.github.com/users/adswa/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-11-09T13:57:55Z", "updated_at": "2020-11-12T15:04:05Z", "closed_at": "2020-11-12T15:04:04Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "I felt reckless and installed Docker on my Windows 10 Pro box.\r\nDocker seems to work ok.\r\nIt tempers a bit with Git Bash, though, unless opened \"as administrator\". Typically, a Git Bash is opened in `~` (which turns out to be ``/c/Users/datalad``), but as soon as Docker has started, the terminal opens in ``/`` (which turns out to be ``C:\\Program Files\\Git``. The Anaconda prompt is unchanged.\r\n\r\nI have only played around with it a bit. So far, adding a container from a Dockerhub URL doesn't seem to work for me. It fails when trying to rename a temporary download, regardless of whether I execute the command in a terminal I run as an unprivileged user or in Administrator mode.\r\n\r\n```\r\n$ datalad -l 1 containers-add neurodocker --url dhub://repronim/neurodocker\r\n[DEBUG] Command line args 1st pass for DataLad 0.13.5.dev423-gdd8521. Parsed: Namespace() Unparsed: ['containers-add', 'neurodocker', '--url', 'dhub://repronim/neurodocker']\r\n[DEBUG] Discovering plugins\r\n[DEBUG] Loading entrypoints\r\n[DEBUG] Loading entrypoint container from datalad.extensions for docs building\r\n[DEBUG] Loaded entrypoint container\r\n[Level 5] Importing module datalad_container.containers_add\r\n[DEBUG] parseParameters: Given \"\", we split into []\r\n[DEBUG] parseParameters: Given \"credential: Credential, optional\r\n|   Provides necessary credential fields to be used by authenticator\r\n| authenticator: Authenticator, optional\r\n|   Authenticator to use for authentication.\", we split into [('credential', 'credential: Credential, optional\\n  Provides necessary credential fields to be used by authenticator'), ('authenticator', 'authenticator: Authenticator, optional\\n  Authenticator to use for authentication.')]\r\n[DEBUG] parseParameters: Given \"\", we split into []\r\n[DEBUG] parseParameters: Given \"credential: Credential, optional\r\n|   Provides necessary credential fields to be used by authenticator\r\n| authenticator: Authenticator, optional\r\n|   Authenticator to use for authentication.\", we split into [('credential', 'credential: Credential, optional\\n  Provides necessary credential fields to be used by authenticator'), ('authenticator', 'authenticator: Authenticator, optional\\n  Authenticator to use for authentication.')]\r\n[DEBUG] parseParameters: Given \"\", we split into []\r\n[DEBUG] parseParameters: Given \"method : callable\r\n|   A callable, usually a method of the same class, which we decorate\r\n|   with access handling, and pass url as the first argument\r\n| url : string\r\n|   URL to access\r\n| *args, **kwargs\r\n|   Passed into the method call\", we split into [('method', 'method : callable\\n  A callable, usually a method of the same class, which we decorate\\n  with access handling, and pass url as the first argument'), ('url', 'url : string\\n  URL to access'), ('*args, **kwargs', '*args, **kwargs\\n  Passed into the method call')]\r\n[DEBUG] Building doc for <class 'datalad_container.containers_add.ContainersAdd'>\r\n[Level 5] Finished setup_parser\r\n[DEBUG] Parsing known args among ['C:\\\\Users\\\\datalad\\\\miniconda3\\\\Scripts\\\\datalad', '-l', '1', 'containers-add', 'neurodocker', '--url', 'dhub://repronim/neurodocker']\r\n[DEBUG] Async run ['git', '--git-dir=', 'config', '-z', '-l', '--show-origin']\r\n[DEBUG] Launching process ['git', '--git-dir=', 'config', '-z', '-l', '--show-origin']\r\n[DEBUG] Process 1924 started\r\n[DEBUG] Waiting for process 1924 to complete\r\n[Level 5] Read 1366 bytes from 1924[stdout]\r\n[DEBUG] Process 1924 exited with return code 0\r\n[Level 8] Finished running ['git', '--git-dir=', 'config', '-z', '-l', '--show-origin'] with status 0\r\n[Level 2] Entered eval_func for <function ContainersAdd.__call__ at 0x000001F1632E3940>\r\n[DEBUG] Determined class of decorated function: <class 'datalad_container.containers_add.ContainersAdd'>\r\n[Level 2] Returning generator_func from eval_func for <class 'datalad_container.containers_add.ContainersAdd'>\r\n[Level 5] Detected file ri\r\n[DEBUG] Resolved dataset for add container: C:\\Users\\datalad\\testing\\containerdataset\r\n[Level 5] Detected <class 'datalad.support.annexrepo.AnnexRepo'> at C:\\Users\\datalad\\testing\\containerdataset\r\n[Level 5] Detected file ri\r\n[Level 5] Requested to provide version for cmd:git\r\n[Level 5] Requested to provide version for cmd:git\r\n[DEBUG] Async run ['git', 'config', '-z', '-l', '--show-origin']\r\n[DEBUG] Launching process ['git', 'config', '-z', '-l', '--show-origin']\r\n[DEBUG] Process 5660 started\r\n[DEBUG] Waiting for process 5660 to complete\r\n[Level 5] Read 1952 bytes from 5660[stdout]\r\n[DEBUG] Process 5660 exited with return code 0\r\n[Level 8] Finished running ['git', 'config', '-z', '-l', '--show-origin'] with status 0\r\n[DEBUG] Async run ['git', 'config', '-z', '-l', '--show-origin', '--file', 'C:\\\\Users\\\\datalad\\\\testing\\\\containerdataset\\\\.datalad\\\\config']\r\n[DEBUG] Launching process ['git', 'config', '-z', '-l', '--show-origin', '--file', 'C:\\\\Users\\\\datalad\\\\testing\\\\containerdataset\\\\.datalad\\\\config']\r\n[DEBUG] Process 8264 started\r\n[DEBUG] Waiting for process 8264 to complete\r\n[Level 5] Read 119 bytes from 8264[stdout]\r\n[DEBUG] Process 8264 exited with return code 0\r\n[Level 8] Finished running ['git', 'config', '-z', '-l', '--show-origin', '--file', 'C:\\\\Users\\\\datalad\\\\testing\\\\containerdataset\\\\.datalad\\\\config'] with status 0\r\n[DEBUG] Attempt to obtain container image from: dhub://repronim/neurodocker\r\n[DEBUG] Running 'docker pull repronim/neurodocker and saving image to C:\\Users\\datalad\\testing\\containerdataset\\.datalad\\environments\\neurodocker\\image\r\n[Level 5] Running: ['docker', 'pull', 'repronim/neurodocker']\r\n[Level 8] Finished running ['docker', 'pull', 'repronim/neurodocker'] with status 0\r\nrename C:\\Users\\datalad\\AppData\\Local\\Temp\\.docker_temp_144306631 C:\\Users\\datalad\\AppData\\Local\\Temp\\tmpmmc7tiox: Access is denied.\r\n[ERROR] Command '['docker', 'save', '-o', 'C:\\\\Users\\\\datalad\\\\AppData\\\\Local\\\\Temp\\\\tmpmmc7tiox', 'repronim/neurodocker']' returned non-zero exit status 1. [subprocess.py:check_call:364] (CalledProcessError)\r\n[Level 1] Finalizer called on: AnnexRepo(C:\\Users\\datalad\\testing\\containerdataset)\r\n[Level 1] Finalizer called on: GitRepo(C:\\Users\\datalad\\testing\\containerdataset)\r\n[Level 5] Exiting\r\n```\r\nSadly, there is no trace of the file in ``TEMP`` afterwards.\r\n\r\nThe Docker pull command internally finishes, and Docker lists the image I attempted to add:\r\n\r\n```\r\n$ docker images\r\nREPOSITORY             TAG                 IMAGE ID            CREATED             SIZE\r\npoldracklab/fmriprep   latest              e4e545e60c90        6 weeks ago         13.4 GB\r\nrepronim/neurodocker   latest              84b9023f0019        6 months ago        81.5 MB\r\nhello-world            latest              bf756fb1ae65        10 months ago       13.3 kB\r\n```\r\n\r\n<details><summary>datalad wtf</summary>\r\n\r\n```\r\n$ datalad wtf\r\n# WTF\r\n## configuration <SENSITIVE, report disabled by configuration>\r\n## credentials\r\n  - keyring:\r\n    - active_backends:\r\n      - Windows WinVaultKeyring\r\n      - Windows RegistryKeyring\r\n      - EncryptedKeyring with not defined v.1.0 at C:\\Users\\datalad\\AppData\\Local\\Python Keyring\\wincrypto_pass.cfg\r\n      - PlaintextKeyring with no encyption v.1.0 at C:\\Users\\datalad\\AppData\\Local\\Python Keyring\\keyring_pass.cfg\r\n    - config_file: C:\\Users\\datalad\\.config\\python_keyring\\keyringrc.cfg\r\n    - data_root: C:\\Users\\datalad\\AppData\\Local\\Python Keyring\r\n## datalad\r\n  - full_version: 0.13.5.dev423-gdd8521\r\n  - version: 0.13.5.dev423\r\n## dataset\r\n  - id: a2cae56b-44fd-41a8-bd90-369b7767bfc3\r\n  - metadata: <SENSITIVE, report disabled by configuration>\r\n  - path: C:\\Users\\datalad\\testing\\containerdataset\r\n  - repo: AnnexRepo\r\n## dependencies\r\n  - annexremote: 1.2.1\r\n  - appdirs: 1.4.4\r\n  - boto: 2.49.0\r\n  - cmd:7z: 19.00\r\n  - cmd:annex: 8.20201008-g65c1687\r\n  - cmd:bundled-git: UNKNOWN\r\n  - cmd:git: 2.29.2.windows.2\r\n  - cmd:system-git: 2.29.2.windows.2\r\n  - cmd:system-ssh: 8.4p1\r\n  - exifread: 2.1.2\r\n  - humanize: 3.1.0\r\n  - iso8601: 0.1.13\r\n  - keyring: 21.4.0\r\n  - keyrings.alt: 4.0.0\r\n  - msgpack: 1.0.0\r\n  - mutagen: 1.41.1\r\n  - requests: 2.24.0\r\n  - tqdm: 4.50.2\r\n  - wrapt: 1.12.1\r\n## environment\r\n  - LC_CTYPE: C.UTF-8\r\n  - PATH: C:\\Users\\datalad\\bin;C:\\Program Files\\Git\\mingw64\\bin;C:\\Program Files\\Git\\usr\\local\\bin;C:\\Program Files\\Git\\usr\\bin;C:\\Program Files\\Git\\usr\\bin;C:\\Program Files\\Git\\mingw64\\bin;C:\\Program Files\\Git\\usr\\bin;C:\\Users\\datalad\\bin;C:\\Program Files\\Docker\\Docker\\Resources\\bin;C:\\Users\\datalad\\miniconda3\\Library\\ImageMagick-7.0.10-Q16-HDRI;C:\\WINDOWS\\system32;C:\\WINDOWS;C:\\WINDOWS\\System32\\Wbem;C:\\WINDOWS\\System32\\WindowsPowerShell\\v1.0;C:\\WINDOWS\\System32\\OpenSSH;C:\\Program Files\\Git\\cmd;C:\\Users\\datalad\\miniconda3;C:\\Users\\datalad\\miniconda3\\Library\\mingw-w64\\bin;C:\\Users\\datalad\\miniconda3\\Library\\usr\\bin;C:\\Users\\datalad\\miniconda3\\Library\\bin;C:\\Users\\datalad\\miniconda3\\Scripts;C:\\Users\\datalad\\AppData\\Roaming\\local\\bin;C:\\Users\\datalad\\AppData\\Local\\Microsoft\\WindowsApps;C:\\ProgramFiles\\7-Zip;C:\\Program Files\\Git\\usr\\bin\\vendor_perl;C:\\Program Files\\Git\\usr\\bin\\core_perl\r\n## extensions\r\n  - container:\r\n    - description: Containerized environments\r\n    - entrypoints:\r\n      - datalad_container.containers_add.ContainersAdd:\r\n        - class: ContainersAdd\r\n        - load_error: None\r\n        - module: datalad_container.containers_add\r\n        - names:\r\n          - containers-add\r\n          - containers_add\r\n      - datalad_container.containers_list.ContainersList:\r\n        - class: ContainersList\r\n        - load_error: None\r\n        - module: datalad_container.containers_list\r\n        - names:\r\n          - containers-list\r\n          - containers_list\r\n      - datalad_container.containers_remove.ContainersRemove:\r\n        - class: ContainersRemove\r\n        - load_error: None\r\n        - module: datalad_container.containers_remove\r\n        - names:\r\n          - containers-remove\r\n          - containers_remove\r\n      - datalad_container.containers_run.ContainersRun:\r\n        - class: ContainersRun\r\n        - load_error: None\r\n        - module: datalad_container.containers_run\r\n        - names:\r\n          - containers-run\r\n          - containers_run\r\n    - load_error: None\r\n    - module: datalad_container\r\n    - version: 1.1.0\r\n## git-annex\r\n  - build flags:\r\n    - Assistant\r\n    - Webapp\r\n    - Pairing\r\n    - TorrentParser\r\n    - MagicMime\r\n    - Feeds\r\n    - Testsuite\r\n    - S3\r\n    - WebDAV\r\n  - dependency versions:\r\n    - aws-0.22\r\n    - bloomfilter-2.0.1.0\r\n    - cryptonite-0.26\r\n    - DAV-1.3.4\r\n    - feed-1.3.0.1\r\n    - ghc-8.8.4\r\n    - http-client-0.6.4.1\r\n    - persistent-sqlite-2.10.6.2\r\n    - torrent-10000.1.1\r\n    - uuid-1.3.13\r\n    - yesod-1.6.1.0\r\n  - key/value backends:\r\n    - SHA256E\r\n    - SHA256\r\n    - SHA512E\r\n    - SHA512\r\n    - SHA224E\r\n    - SHA224\r\n    - SHA384E\r\n    - SHA384\r\n    - SHA3_256E\r\n    - SHA3_256\r\n    - SHA3_512E\r\n    - SHA3_512\r\n    - SHA3_224E\r\n    - SHA3_224\r\n    - SHA3_384E\r\n    - SHA3_384\r\n    - SKEIN256E\r\n    - SKEIN256\r\n    - SKEIN512E\r\n    - SKEIN512\r\n    - BLAKE2B256E\r\n    - BLAKE2B256\r\n    - BLAKE2B512E\r\n    - BLAKE2B512\r\n    - BLAKE2B160E\r\n    - BLAKE2B160\r\n    - BLAKE2B224E\r\n    - BLAKE2B224\r\n    - BLAKE2B384E\r\n    - BLAKE2B384\r\n    - BLAKE2BP512E\r\n    - BLAKE2BP512\r\n    - BLAKE2S256E\r\n    - BLAKE2S256\r\n    - BLAKE2S160E\r\n    - BLAKE2S160\r\n    - BLAKE2S224E\r\n    - BLAKE2S224\r\n    - BLAKE2SP256E\r\n    - BLAKE2SP256\r\n    - BLAKE2SP224E\r\n    - BLAKE2SP224\r\n    - SHA1E\r\n    - SHA1\r\n    - MD5E\r\n    - MD5\r\n    - WORM\r\n    - URL\r\n    - X*\r\n  - local repository version: 8\r\n  - operating system: mingw32 x86_64\r\n  - remote types:\r\n    - git\r\n    - gcrypt\r\n    - p2p\r\n    - S3\r\n    - bup\r\n    - directory\r\n    - rsync\r\n    - web\r\n    - bittorrent\r\n    - webdav\r\n    - adb\r\n    - tahoe\r\n    - glacier\r\n    - ddar\r\n    - git-lfs\r\n    - httpalso\r\n    - hook\r\n    - external\r\n  - supported repository versions:\r\n    - 8\r\n  - upgrade supported from repository versions:\r\n    - 2\r\n    - 3\r\n    - 4\r\n    - 5\r\n    - 6\r\n    - 7\r\n  - version: 8.20201008-g65c1687\r\n## location\r\n  - path: C:\\Users\\datalad\\testing\\containerdataset\r\n  - type: dataset\r\n## metadata_extractors\r\n  - annex (datalad 0.13.5):\r\n    - distribution: datalad 0.13.5\r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.annex\r\n    - version: None\r\n  - audio (datalad 0.13.5):\r\n    - distribution: datalad 0.13.5\r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.audio\r\n    - version: None\r\n  - datacite (datalad 0.13.5):\r\n    - distribution: datalad 0.13.5\r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.datacite\r\n    - version: None\r\n  - datalad_core (datalad 0.13.5):\r\n    - distribution: datalad 0.13.5\r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.datalad_core\r\n    - version: None\r\n  - datalad_rfc822 (datalad 0.13.5):\r\n    - distribution: datalad 0.13.5\r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.datalad_rfc822\r\n    - version: None\r\n  - exif (datalad 0.13.5):\r\n    - distribution: datalad 0.13.5\r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.exif\r\n    - version: None\r\n  - frictionless_datapackage (datalad 0.13.5):\r\n    - distribution: datalad 0.13.5\r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.frictionless_datapackage\r\n    - version: None\r\n  - image (datalad 0.13.5):\r\n    - distribution: datalad 0.13.5\r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.image\r\n    - version: None\r\n  - xmp (datalad 0.13.5):\r\n    - distribution: datalad 0.13.5\r\n    - load_error: No module named 'libxmp' [xmp.py:<module>:20]\r\n    - module: datalad.metadata.extractors.xmp\r\n## metadata_indexers\r\n## python\r\n  - implementation: CPython\r\n  - version: 3.8.3\r\n## system\r\n  - distribution: mingw64_nt-10.0-19041/3.1.7  10/10.0.19041/SP0/Multiprocessor Free\r\n  - encoding:\r\n    - default: utf-8\r\n    - filesystem: utf-8\r\n    - locale.prefered: cp1252\r\n  - max_path_length: 259\r\n  - name: Windows\r\n  - release: 10\r\n  - type: nt\r\n  - version: 10.0.19041\r\n\r\n```\r\n</details>", "closed_by": {"login": "kyleam", "id": 1297788, "node_id": "MDQ6VXNlcjEyOTc3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1297788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kyleam", "html_url": "https://github.com/kyleam", "followers_url": "https://api.github.com/users/kyleam/followers", "following_url": "https://api.github.com/users/kyleam/following{/other_user}", "gists_url": "https://api.github.com/users/kyleam/gists{/gist_id}", "starred_url": "https://api.github.com/users/kyleam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kyleam/subscriptions", "organizations_url": "https://api.github.com/users/kyleam/orgs", "repos_url": "https://api.github.com/users/kyleam/repos", "events_url": "https://api.github.com/users/kyleam/events{/privacy}", "received_events_url": "https://api.github.com/users/kyleam/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/5138/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/5138/timeline", "performed_via_github_app": null}