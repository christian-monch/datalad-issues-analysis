{"url": "https://api.github.com/repos/datalad/datalad/issues/5013", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/5013/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/5013/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/5013/events", "html_url": "https://github.com/datalad/datalad/pull/5013", "id": 718844994, "node_id": "MDExOlB1bGxSZXF1ZXN0NTAxMTQ0MzE0", "number": 5013, "title": "Revert \"ENH: When closing batched processes avoid waiting forever\"", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1746781627, "node_id": "MDU6TGFiZWwxNzQ2NzgxNjI3", "url": "https://api.github.com/repos/datalad/datalad/labels/merge-if-ok", "name": "merge-if-ok", "color": "fbca04", "default": false, "description": "OP considers this work done, and requests review/merge"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 12, "created_at": "2020-10-11T14:14:39Z", "updated_at": "2021-04-29T21:58:21Z", "closed_at": "2020-10-30T21:00:33Z", "author_association": "MEMBER", "active_lock_reason": null, "pull_request": {"url": "https://api.github.com/repos/datalad/datalad/pulls/5013", "html_url": "https://github.com/datalad/datalad/pull/5013", "diff_url": "https://github.com/datalad/datalad/pull/5013.diff", "patch_url": "https://github.com/datalad/datalad/pull/5013.patch"}, "body": "This reverts commit 383819eafc77e604c9cea2977820dcd299ea2902.\r\n\r\nThat workaround, introduced in #4829, just hides away the problem, possibly\r\nleading to data loss (e.g. batched process would not finish its processing by\r\nthen and we proceed to eg save or alike), and makes it hard to impossible to\r\nspot/debug in real life cases where it manifests itself.\r\n\r\nThis is unlikely to fix the issue, but I want to see if it still\r\nreproduces (I failed to reproduce it in the past 2 days).\r\n\r\nMore references:\r\n\r\n- datalad issue https://github.com/datalad/datalad/issues/4998\r\n- git-annex report https://git-annex.branchable.com/bugs/some_annex_addurl_--fast_--with-files_--json_--json-error-messages_--batch__do_not_quit/\r\n\r\nI do not think of any reasonable \"timeout\" we could specify and be \"correct\", since in some cases (very large index) it could take awhile for e.g. `addurl --batch` to complete and I do not know how long exactly.  What we could do is to add some \"activity indication\", e.g. if it did not complete within X seconds, we bring up \"progress bar like\" information bar which would report PID of the batched child process, and may be its tree with CPU/IO  information. That would allow to ease troubleshooting, alert user about still ongoing (or stalled?) activity.  In interactive mode we could may be even add some shortcut (e.g. if Ctrl-C is pressed and thus we get an exception) to jump into pdb... just ideas\r\n\r\nConflicts:\r\n\tdatalad/cmd.py - melded with added later logging of stderr\r\n", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/5013/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/5013/timeline", "performed_via_github_app": null}