{"url": "https://api.github.com/repos/datalad/datalad/issues/3686", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/3686/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/3686/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/3686/events", "html_url": "https://github.com/datalad/datalad/issues/3686", "id": 495388594, "node_id": "MDU6SXNzdWU0OTUzODg1OTQ=", "number": 3686, "title": "\"save\" does not trigger symlink paths fixups for \"git mv\"ed files", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 63778590, "node_id": "MDU6TGFiZWw2Mzc3ODU5MA==", "url": "https://api.github.com/repos/datalad/datalad/labels/severity-normal", "name": "severity-normal", "color": "ff8888", "default": false, "description": "standard severity"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 13, "created_at": "2019-09-18T18:33:49Z", "updated_at": "2020-09-25T22:10:13Z", "closed_at": "2020-03-12T16:52:13Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "```shell\r\n$> datalad create /tmp/dsrename; cd /tmp/dsrename; mkdir subdir; cd subdir; touch 123; datalad add 123; git mv 123 ..; cd ..; datalad save; cat 123\r\n[INFO   ] Creating a new annex repo at /tmp/dsrename \r\ncreate(ok): /tmp/dsrename (dataset)                                                                                                                               \r\nadd(ok): /tmp/dsrename/subdir/123 (file)\r\nsave(ok): /tmp/dsrename (dataset)\r\naction summary:\r\n  add (ok: 1)\r\n  save (ok: 1)\r\n123@  subdir/\r\nsave(ok): . (dataset)\r\ncat: 123: No such file or directory\r\n\r\n$> ls -l 123\r\nlrwxrwxrwx 1 yoh yoh 111 Sep 18 14:26 123 -> ../.git/annex/objects/2W/kW/MD5E-s0--d41d8cd98f00b204e9800998ecf8427e/MD5E-s0--d41d8cd98f00b204e9800998ecf8427e\r\n\r\n$> datalad --version\r\ndatalad 0.12.0rc5.dev27\r\n```\r\n\r\nso the symlink is not fixed up to reflect the move!\r\n\r\n<details>\r\n<summary>and everything seems to work ok if `git commit` is used directly </summary> \r\n\r\n```shell\r\nhopa:/tmp\r\n$> datalad create /tmp/dsrename; cd /tmp/dsrename; mkdir subdir; cd subdir; touch 123; datalad add 123; git mv 123 ..; cd ..; git commit -m 'Saving using git'; cat 123                                                                                                                                                         \r\n[INFO   ] Creating a new annex repo at /tmp/dsrename \r\ncreate(ok): /tmp/dsrename (dataset)                                                                                                                               \r\nadd(ok): /tmp/dsrename/subdir/123 (file)\r\nsave(ok): /tmp/dsrename (dataset)\r\naction summary:\r\n  add (ok: 1)\r\n  save (ok: 1)\r\n123@  subdir/\r\nfix 123 ok\r\n(recording state in git...)\r\n[master 0bad398] Saving using git\r\n 2 files changed, 1 insertion(+), 1 deletion(-)\r\n create mode 120000 123\r\n delete mode 120000 subdir/123\r\n\r\n$> ls -l 123\r\nlrwxrwxrwx 1 yoh yoh 108 Sep 18 14:28 123 -> .git/annex/objects/2W/kW/MD5E-s0--d41d8cd98f00b204e9800998ecf8427e/MD5E-s0--d41d8cd98f00b204e9800998ecf8427e\r\n```\r\n</details>\r\n\r\nI remembered reviewing @adswa 's [chapter on similar operations in the handbook](http://handbook.datalad.org/en/latest/basics/101-140-filesystem.html), so was curious how come she didn't run into it.\r\n\r\n<details>\r\n<summary> And apparently the difference is between her using pure `mv` and me `git mv`.</summary> \r\n\r\n```shell\r\nhopa:/tmp\r\n$> datalad create /tmp/dsrename; cd /tmp/dsrename; mkdir subdir; cd subdir; touch 123; datalad add 123; mv 123 ..; cd ..; datalad save; cat 123    \r\n[INFO   ] Creating a new annex repo at /tmp/dsrename                                                    \r\ncreate(ok): /tmp/dsrename (dataset)                                                                                                                               \r\nadd(ok): /tmp/dsrename/subdir/123 (file)\r\nsave(ok): /tmp/dsrename (dataset)\r\naction summary:\r\n  add (ok: 1)\r\n  save (ok: 1)\r\n123@  subdir/\r\ndelete(ok): subdir/123 (file)\r\nadd(ok): 123 (file)\r\nsave(ok): . (dataset)\r\naction summary:\r\n  add (ok: 1)\r\n  delete (ok: 1)\r\n  save (ok: 1)\r\n\r\n$> ls -l 123\r\nlrwxrwxrwx 1 yoh yoh 108 Sep 18 14:32 123 -> .git/annex/objects/2W/kW/MD5E-s0--d41d8cd98f00b204e9800998ecf8427e/MD5E-s0--d41d8cd98f00b204e9800998ecf8427e\r\n\r\n```\r\n</details>", "closed_by": {"login": "kyleam", "id": 1297788, "node_id": "MDQ6VXNlcjEyOTc3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1297788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kyleam", "html_url": "https://github.com/kyleam", "followers_url": "https://api.github.com/users/kyleam/followers", "following_url": "https://api.github.com/users/kyleam/following{/other_user}", "gists_url": "https://api.github.com/users/kyleam/gists{/gist_id}", "starred_url": "https://api.github.com/users/kyleam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kyleam/subscriptions", "organizations_url": "https://api.github.com/users/kyleam/orgs", "repos_url": "https://api.github.com/users/kyleam/repos", "events_url": "https://api.github.com/users/kyleam/events{/privacy}", "received_events_url": "https://api.github.com/users/kyleam/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/3686/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/3686/timeline", "performed_via_github_app": null}