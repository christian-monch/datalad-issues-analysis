{"url": "https://api.github.com/repos/datalad/datalad/issues/1727", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/1727/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/1727/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/1727/events", "html_url": "https://github.com/datalad/datalad/issues/1727", "id": 251072577, "node_id": "MDU6SXNzdWUyNTEwNzI1Nzc=", "number": 1727, "title": "git-annex protocol field splitting breaks TRANSFER command parsing in some cases", "user": {"login": "joeyh", "id": 16392, "node_id": "MDQ6VXNlcjE2Mzky", "avatar_url": "https://avatars.githubusercontent.com/u/16392?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joeyh", "html_url": "https://github.com/joeyh", "followers_url": "https://api.github.com/users/joeyh/followers", "following_url": "https://api.github.com/users/joeyh/following{/other_user}", "gists_url": "https://api.github.com/users/joeyh/gists{/gist_id}", "starred_url": "https://api.github.com/users/joeyh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joeyh/subscriptions", "organizations_url": "https://api.github.com/users/joeyh/orgs", "repos_url": "https://api.github.com/users/joeyh/repos", "events_url": "https://api.github.com/users/joeyh/events{/privacy}", "received_events_url": "https://api.github.com/users/joeyh/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2017-08-17T21:06:58Z", "updated_at": "2017-09-06T15:19:26Z", "closed_at": "2017-09-06T04:54:34Z", "author_association": "NONE", "active_lock_reason": null, "body": "The git-annex special remote protocol is somewhat unusual in that the last field of a line can contain whitespace, while all previous fields cannot. So, simply splitting by whitespace can result in more fields than expected, when there is in fact whitespace in the last field.\r\n\r\nThis is particularly a problem for TRANSFER, since the filename passed as its last field does contain whitespace in some edge cases. Note that the external special remote documentation used to incorrectly say it never contained whitespace.\r\n\r\ndatalad/customremotes/base.py appears to have this problem. In _loop, it calls self.read(n=-1). I believe that splits each word into a separate string. If the command was \"TRANSFER SEND somekey multi word file\", it will probably blow up in some way.\r\n\r\nOne way to test for the problem is to make a git-annex repository in direct mode that contains an annexed file with a space in its name. Transferrring the file to the special remote will pass the filename to the TRANSFER command. That may also happen when transferring the file from the special remote, but I've not checked.\r\n\r\n(Also, there'a a TODO in read() asking how git-annex deals with filenames starting/ending with spaces. The answer is that it simply puts the space there, so it's possible to have eg, \"TRANSFER SEND key  \" where the filename part is \" \". I don't know if your current code handles this case when read() is called with the correct number of words to split into. Depends on how python's string splitting works..)", "closed_by": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/1727/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/1727/timeline", "performed_via_github_app": null}