{"url": "https://api.github.com/repos/datalad/datalad/issues/3230", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/3230/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/3230/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/3230/events", "html_url": "https://github.com/datalad/datalad/issues/3230", "id": 421685792, "node_id": "MDU6SXNzdWU0MjE2ODU3OTI=", "number": 3230, "title": "Should we disambiguate semantic of having `-d PATH` specification?", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 374318336, "node_id": "MDU6TGFiZWwzNzQzMTgzMzY=", "url": "https://api.github.com/repos/datalad/datalad/labels/conference%20agenda%20item", "name": "conference agenda item", "color": "fbca04", "default": false, "description": "Scheduled to be discussed in a developer meeting"}, {"id": 519289523, "node_id": "MDU6TGFiZWw1MTkyODk1MjM=", "url": "https://api.github.com/repos/datalad/datalad/labels/on%20hold%20-%20input%20required", "name": "on hold - input required", "color": "fbca04", "default": false, "description": "Work on this issue cannot proceed until critical feedback was given"}, {"id": 1576438293, "node_id": "MDU6TGFiZWwxNTc2NDM4Mjkz", "url": "https://api.github.com/repos/datalad/datalad/labels/relative%20paths", "name": "relative paths", "color": "f990a0", "default": false, "description": "Issue related to the treatment of relative path specifications"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/datalad/datalad/milestones/56", "html_url": "https://github.com/datalad/datalad/milestone/56", "labels_url": "https://api.github.com/repos/datalad/datalad/milestones/56/labels", "id": 3796173, "node_id": "MDk6TWlsZXN0b25lMzc5NjE3Mw==", "number": 56, "title": "Release 0.12.0", "description": "- drop support of direct mode\r\n- potentially bring revolution home fully or in parts", "creator": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 61, "state": "closed", "created_at": "2018-11-05T14:12:45Z", "updated_at": "2020-03-12T15:47:48Z", "due_on": "2020-01-11T08:00:00Z", "closed_at": "2020-01-11T16:10:25Z"}, "comments": 16, "created_at": "2019-03-15T20:10:08Z", "updated_at": "2019-10-01T14:36:57Z", "closed_at": "2019-10-01T14:36:56Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "With revolution upon/within us, I wondered if we could simplify the semantic of having `-d` specification of the dataset in the commands.  At the moment I see it mixing-in at least 2 possible semantics:\r\n\r\n### `#1`. How to treat relative paths relative to the top of the specified dataset\r\n\r\nThe rationale for this is the consistency with Python use of all those as methods of a dataset instance.\r\n\r\n<details>\r\n<summary>peculiarity of `-d .`</summary>\r\n\r\nNote that `-d` should point to the top directory of the dataset, so `-d .` does not mean \"this dataset\", and thus all of the following commands fail, even if we prepend relative path with `./` (which I apparently incorrectly) thought we coded for to describe that it is relative to cwd, not top of the dataset:\r\n\r\n```shell\r\n(git-annex)hopa:/tmp/superds[master]\r\n$> git status\r\nOn branch master\r\nnothing to commit, working tree clean\r\n\r\n$> mkdir subdir\r\n\r\n$> cd subdir\r\n\r\n$> touch 123\r\n\r\n$> datalad add -d . 123\r\n[WARNING] path not part of the reference dataset at /tmp/superds/subdir [add(/tmp/superds/subdir/123)] \r\nadd(impossible): 123 (file) [path not part of the reference dataset at /tmp/superds/subdir]\r\n\r\n$> datalad add -d . ./123\r\n[WARNING] path not part of the reference dataset at /tmp/superds/subdir [add(/tmp/superds/subdir/123)] \r\nadd(impossible): 123 (file) [path not part of the reference dataset at /tmp/superds/subdir]\r\n\r\n$> datalad rev-save -d . ./123   \r\n[ERROR  ] No installed dataset found at /tmp/superds/subdir. [dataset.py:require_dataset:612] (ValueError)\r\n```\r\n</details>\r\n\r\nBut then many commands also add additional semantic beyond \"how to treat relative paths\":\r\n\r\n### `#2`. either to consider (only new?) paths to be a part of the dataset\r\n\r\nSo `install -d . URL` adds installed dataset, and `install URL` doesn't. \r\nSimilarly `create` and even `rev-create` (https://github.com/datalad/datalad-revolution/issues/97) would not add new subdataset.\r\nI no longer remember what was (if any) the rationale for not adding installed or created subdatasets (without -d) right away.  Note that with aforementioned `-d .` gotcha it is actually quite inconvenient to add subdatasets in deep subdirectories within subdatasets.\r\n\r\nBecause of this confusion I didn't even reply right away to @kyleam suggestion for a fix in \r\nhttps://github.com/datalad/datalad-container/issues/72#issuecomment-472925070 since I am not sure what effect that would have, e.g. may be then making behavior different in the top directory of the dataset from how it would behave in subdirectory.\r\n\r\nI am not sure if there is yet another specific to command semantic encoded, as I have summarized the 2nd one based on my short-term memory and there might be more?\r\n\r\n### Suggestion\r\n\r\nBut I wonder if we could get rid of the `#2`, command specific behavior, always figure out the dataset we are in, and behave as it was specified, besides the `#1` aspect of how to treat the provided paths?", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/3230/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/3230/timeline", "performed_via_github_app": null}