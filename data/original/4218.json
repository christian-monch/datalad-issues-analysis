{"url": "https://api.github.com/repos/datalad/datalad/issues/4218", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/4218/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/4218/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/4218/events", "html_url": "https://github.com/datalad/datalad/issues/4218", "id": 573551057, "node_id": "MDU6SXNzdWU1NzM1NTEwNTc=", "number": 4218, "title": "Recover from not invoked clean filter? (or file half-jumps into annex)", "user": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-03-01T13:56:38Z", "updated_at": "2020-03-02T17:08:46Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "From https://git-annex.branchable.com/todo/git_smudge_clean_interface_suboptiomal/\r\n\r\n> In a rare situation, git-annex would like to get git to run the clean filter, but it cannot because git has the index locked. So, git-annex has to print an ugly warning message saying that git status will show modifications to files that are not really modified, and giving a command to fix the git status display.\r\n\r\nIt seems that our test battery routinely suffers from this problem (same test ran multiple times immediately in succession fails ~1/10 times). I suspect that the referenced command is `git update-index -q --refresh <file>` as stated [here](https://git-annex.branchable.com/bugs/Windows__58___The_process_cannot_access_the_file_because_it_is_being_used_by_another_process/).\r\n\r\nIt would be good to (at minimum) make the test suite robust re this behavior, even if the fix would be an expensive one (at present the Heisenberg nature of this issue is eating a lot of human time as well).\r\n\r\nI have not yet been able to come up with a plain git-annex demo that shows the behavior. The narrative is this:\r\n\r\n- commit a file to git (`test_mod_file`)\r\n- afterwards commit a different file to the annex\r\n- this is (sometimes the result):\r\n\r\n```\r\n(base) C:\\Users\\mih\\AppData\\Local\\Temp\\datalad_temp_2sobv8vm>git status                                                      \r\nOn branch adjusted/master(unlocked)                                                                                          \r\nChanges not staged for commit:                                                                                                 \r\n(use \"git add <file>...\" to update what will be committed)                                                                   \r\n(use \"git restore <file>...\" to discard changes in working directory)                                                              \r\nmodified:   test_mod_file                                                                                                                                                                                                                         \r\nno changes added to commit (use \"git add\" and/or \"git commit -a\")                                                                                                                                                                                         \r\n\r\n(base) C:\\Users\\mih\\AppData\\Local\\Temp\\datalad_temp_2sobv8vm>git update-index -q --refresh \r\ntest_mod_file                     \r\nwarning: LF will be replaced by CRLF in test_mod_file.                                                                       \r\nThe file will have its original line endings in your working directory      \r\n                                                                                                                                                                              \r\n(base) C:\\Users\\mih\\AppData\\Local\\Temp\\datalad_temp_2sobv8vm>git status                                                      \r\nOn branch adjusted/master(unlocked)                                                                                          \r\nChanges to be committed:                                                                                                       \r\n(use \"git restore --staged <file>...\" to unstage)                                                                                  \r\nmodified:   test_mod_file        \r\n\r\n(base) C:\\Users\\mih\\AppData\\Local\\Temp\\datalad_temp_2sobv8vm>git diff HEAD                                                   diff --git a/test_mod_file b/test_mod_file                                                                                   \r\nindex 135e695..585758a 100644                                                                                                \r\n--- a/test_mod_file                                                                                                          \r\n+++ b/test_mod_file                                                                                                          \r\n@@ -1 +1 @@                                                                                                                  \r\n-Some additional stuff.                                                                                                      \r\n\\ No newline at end of file                                                                                                  \r\n+/annex/objects/MD5E-s22--186f59cc17a0bf9f121057d3cd935e3f                                                                                                                                                                                                                                                                         \r\n```\r\n\r\nSo it seems as if the file was unintentionally annexed, and left in limbo.\r\n\r\nIf you have any insight @datalad/developers please let me know. Thx!", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/4218/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/4218/timeline", "performed_via_github_app": null}