{"url": "https://api.github.com/repos/datalad/datalad/issues/4153", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/4153/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/4153/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/4153/events", "html_url": "https://github.com/datalad/datalad/issues/4153", "id": 565393855, "node_id": "MDU6SXNzdWU1NjUzOTM4NTU=", "number": 4153, "title": "temp. $HOME in test setup conflicts with datalad.cfg", "user": {"login": "bpoldrack", "id": 10498301, "node_id": "MDQ6VXNlcjEwNDk4MzAx", "avatar_url": "https://avatars.githubusercontent.com/u/10498301?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bpoldrack", "html_url": "https://github.com/bpoldrack", "followers_url": "https://api.github.com/users/bpoldrack/followers", "following_url": "https://api.github.com/users/bpoldrack/following{/other_user}", "gists_url": "https://api.github.com/users/bpoldrack/gists{/gist_id}", "starred_url": "https://api.github.com/users/bpoldrack/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bpoldrack/subscriptions", "organizations_url": "https://api.github.com/users/bpoldrack/orgs", "repos_url": "https://api.github.com/users/bpoldrack/repos", "events_url": "https://api.github.com/users/bpoldrack/events{/privacy}", "received_events_url": "https://api.github.com/users/bpoldrack/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-02-14T15:24:43Z", "updated_at": "2020-02-19T21:32:54Z", "closed_at": "2020-02-19T21:32:54Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Stumbeld upon this in PR #4124 :\r\n\r\nWe shoot our feet with the fake $HOME we set up for tests:\r\n```\r\n(Pdb) cfg.__dict__\r\n{'_store': {'user.name': 'Benjamin Poldrack', 'user.email': 'benjaminpoldrack@gmail.com', 'url.ria+file:///tmp/datalad_temp__test_create_storele6bc8ij.insteadof': 'ria+ssh://test-store:', 'datalad.datasets.topurl': 'http://datasets-tests.datalad.org/', 'datalad.log.level': '100'}, '_cfgfiles': {'/home/ben/.gitconfig'}, '_cfgmtimes': {'/home/ben/.gitconfig': 1581683659.070651}, '_dataset_path': None, '_dataset_cfgfname': None, '_repo_cfgfname': None, '_config_cmd': ['git', '--git-dir=', 'config'], 'overrides': {}, '_src_mode': 'any', '_runner': <datalad.cmd.GitRunner object at 0x7f86b2795520>, '_gitconfig_has_showorgin': True}\r\n```\r\n\r\nNote, that it reads `/home/ben/.gitconfig`.\r\nBut:\r\n\r\n```\r\n(Pdb) os.environ['HOME']\r\n'/tmp/datalad_temp_ft_s2hz0'\r\n```\r\n\r\nSince `datalad.cfg` is instantiated on import, it doesn't consider what `setup_package` does to $HOME and won't reconsider what global config to read from. This leads to inconsistencies in test configs.\r\n\r\nI'd suggest to\r\n\r\n```python\r\nglobal cfg\r\ncfg.reload(force=True)\r\n```\r\nin `setup_package` after changing home dir. What do you think, @datalad/developers ? Anything I miss here?", "closed_by": {"login": "kyleam", "id": 1297788, "node_id": "MDQ6VXNlcjEyOTc3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1297788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kyleam", "html_url": "https://github.com/kyleam", "followers_url": "https://api.github.com/users/kyleam/followers", "following_url": "https://api.github.com/users/kyleam/following{/other_user}", "gists_url": "https://api.github.com/users/kyleam/gists{/gist_id}", "starred_url": "https://api.github.com/users/kyleam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kyleam/subscriptions", "organizations_url": "https://api.github.com/users/kyleam/orgs", "repos_url": "https://api.github.com/users/kyleam/repos", "events_url": "https://api.github.com/users/kyleam/events{/privacy}", "received_events_url": "https://api.github.com/users/kyleam/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/4153/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/4153/timeline", "performed_via_github_app": null}