{"url": "https://api.github.com/repos/datalad/datalad/issues/2938", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/2938/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/2938/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/2938/events", "html_url": "https://github.com/datalad/datalad/issues/2938", "id": 372788343, "node_id": "MDU6SXNzdWUzNzI3ODgzNDM=", "number": 2938, "title": "datalad get exits silently whenever disk is out of space", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-10-23T03:11:33Z", "updated_at": "2018-10-29T12:46:22Z", "closed_at": "2018-10-29T12:46:22Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "#### What is the problem?\r\n```shell\r\n$> datalad --version\r\ndatalad 0.10.3.1.dev166\r\n\r\n(git)smaug:/tmp/ds001512[master]\r\n$> datalad get sub-01 \r\n\r\n$> git annex get sub-01 2>&1 | head -n 30\r\nget sub-01/EEG/EEG_data_sub-01_run-01.mat \r\n  not enough free space, need 754.38 MB more (use --force to override this check or adjust annex.diskreserve)\r\n\r\n  not enough free space, need 754.38 MB more (use --force to override this check or adjust annex.diskreserve)\r\n\r\n  Unable to access these remotes: s3-PRIVATE, s3-PUBLIC\r\n\r\n  Try making some of these repositories available:\r\n  \t0b54afc2-7365-419c-b7dc-12ec2c6aea4b -- [s3-PUBLIC]\r\n   \t1eee2426-c0c5-4e47-bf69-bf658e7f2375 -- [s3-PRIVATE]\r\n   \t901e9c4f-a2c9-444c-bf2a-1573542f7327 -- root@ce121a6e7e2c:/datalad/ds001512\r\n\r\n```\r\n\r\nexception is raised as it should but then swallowed somewhere upstairs without reporting:\r\n```\r\n$> datalad get sub-01              \r\nTotal (0 ok, 7 failed out of 7)  0%|                                                                                                                                                       | 0.00/1.88G [00:00<?, ?B/s]> /home/yoh/proj/datalad/datalad-master/datalad/support/annexrepo.py(2389)_run_annex_command_json()\r\n-> out_of_space_re = re.search(\r\n(Pdb) l\r\n2384 \t            # OutOfSpaceError:\r\n2385 \t            # Note:\r\n2386 \t            # doesn't depend on anything in stdout. Therefore check this before\r\n2387 \t            # dealing with stdout\r\n2388 \t\t\t\timport pdb; pdb.set_trace()\r\n2389 ->\t            out_of_space_re = re.search(\r\n2390 \t                \"not enough free space, need (.*) more\", e.stderr\r\n2391 \t            )\r\n2392 \t            if out_of_space_re:\r\n2393 \t                raise OutOfSpaceError(cmd=\"annex %s\" % command,\r\n2394 \t                                      sizemore_msg=out_of_space_re.groups()[0])\r\n(Pdb) p e.stderr\r\n'  not enough free space, need 118.33 MB more (use --force to override this check or adjust annex.diskreserve)\\n  not enough free space, need 118.34 MB more (use --force to override this check or adjust annex.diskreserve)\\n  not enough free space, need 754.38 MB more (use --force to override this check or adjust annex.diskreserve)\\n  not enough free space, need 754.38 MB more (use --force to override this check or adjust annex.diskreserve)\\n  not enough free space, need 776.25 MB more (use --force to override this check or adjust annex.diskreserve)\\n  not enough free space, need 763.15 MB more (use --force to override this check or adjust annex.diskreserve)\\n  not enough free space, need 130.76 MB more (use --force to override this check or adjust annex.diskreserve)\\n  not enough free space, need 130.76 MB more (use --force to override this check or adjust annex.diskreserve)\\ndownload failed: invalid url\\ndownload failed: invalid url\\ndownload failed: invalid url\\ndownload failed: invalid url\\ngit-annex: get: 7 failed\\n'\r\n(Pdb) n\r\n> /home/yoh/proj/datalad/datalad-master/datalad/support/annexrepo.py(2390)_run_annex_command_json()\r\n-> \"not enough free space, need (.*) more\", e.stderr\r\n(Pdb) n\r\n> /home/yoh/proj/datalad/datalad-master/datalad/support/annexrepo.py(2392)_run_annex_command_json()\r\n-> if out_of_space_re:\r\n(Pdb) \r\n> /home/yoh/proj/datalad/datalad-master/datalad/support/annexrepo.py(2393)_run_annex_command_json()\r\n-> raise OutOfSpaceError(cmd=\"annex %s\" % command,\r\n(Pdb) \r\n> /home/yoh/proj/datalad/datalad-master/datalad/support/annexrepo.py(2394)_run_annex_command_json()\r\n-> sizemore_msg=out_of_space_re.groups()[0])\r\n(Pdb) \r\nOutOfSpaceError: OutOfSpaceError('',)\r\n> /home/yoh/proj/datalad/datalad-master/datalad/support/annexrepo.py(2394)_run_annex_command_json()\r\n-> sizemore_msg=out_of_space_re.groups()[0])\r\n(Pdb) \r\n> /home/yoh/proj/datalad/datalad-master/datalad/support/annexrepo.py(2476)_run_annex_command_json()\r\n-> if progress_indicators:\r\n(Pdb) \r\n> /home/yoh/proj/datalad/datalad-master/datalad/support/annexrepo.py(2477)_run_annex_command_json()\r\n-> progress_indicators.finish()\r\n(Pdb) \r\n--Return--                                                                                                                                                                                                                        \r\n> /home/yoh/proj/datalad/datalad-master/datalad/support/annexrepo.py(2477)_run_annex_command_json()->None\r\n-> progress_indicators.finish()\r\n(Pdb) \r\nOutOfSpaceError: OutOfSpaceError('',)\r\n> /home/yoh/proj/datalad/datalad-master/datalad/support/annexrepo.py(1363)get()\r\n-> **kwargs\r\n(Pdb) \r\n--Return--\r\n> /home/yoh/proj/datalad/datalad-master/datalad/support/annexrepo.py(1363)get()->None\r\n-> **kwargs\r\n(Pdb) \r\nOutOfSpaceError: OutOfSpaceError('',)\r\n> /home/yoh/proj/datalad/datalad-master/datalad/support/gitrepo.py(313)newfunc()\r\n-> result = func(self, files_new, *args, **kwargs)\r\n(Pdb) \r\n--Return--\r\n> /home/yoh/proj/datalad/datalad-master/datalad/support/gitrepo.py(313)newfunc()->None\r\n-> result = func(self, files_new, *args, **kwargs)\r\n(Pdb) \r\nOutOfSpaceError: OutOfSpaceError('',)\r\n> /home/yoh/proj/datalad/datalad-master/datalad/distribution/get.py(623)__call__()\r\n-> jobs=jobs):\r\n(Pdb) \r\n--Return--\r\n> /home/yoh/proj/datalad/datalad-master/datalad/distribution/get.py(623)__call__()->None\r\n-> jobs=jobs):\r\n(Pdb) \r\nOutOfSpaceError: OutOfSpaceError('',)\r\n> /home/yoh/proj/datalad/datalad-master/datalad/interface/utils.py(491)_process_results()\r\n-> for res in results:\r\n(Pdb) \r\n--Return--\r\n> /home/yoh/proj/datalad/datalad-master/datalad/interface/utils.py(491)_process_results()->None\r\n-> for res in results:\r\n(Pdb) \r\nOutOfSpaceError: OutOfSpaceError('',)\r\n> /home/yoh/proj/datalad/datalad-master/datalad/interface/utils.py(422)generator_func()\r\n-> result_renderer, result_xfm, _result_filter, **_kwargs):\r\n(Pdb) \r\n--Return--\r\n> /home/yoh/proj/datalad/datalad-master/datalad/interface/utils.py(422)generator_func()->None\r\n-> result_renderer, result_xfm, _result_filter, **_kwargs):\r\n(Pdb) \r\nOutOfSpaceError: OutOfSpaceError('',)\r\n> /home/yoh/proj/datalad/datalad-master/datalad/interface/base.py(628)call_from_parser()\r\n-> ret = list(ret)\r\n(Pdb) \r\n> /home/yoh/proj/datalad/datalad-master/datalad/interface/base.py(633)call_from_parser()\r\n-> except KeyboardInterrupt as exc:\r\n(Pdb) \r\n--Return--\r\n> /home/yoh/proj/datalad/datalad-master/datalad/interface/base.py(633)call_from_parser()->None\r\n-> except KeyboardInterrupt as exc:\r\n(Pdb) \r\nOutOfSpaceError: OutOfSpaceError('',)\r\n> /home/yoh/proj/datalad/datalad-master/datalad/cmdline/main.py(500)main()\r\n-> ret = cmdlineargs.func(cmdlineargs)\r\n(Pdb) \r\n> /home/yoh/proj/datalad/datalad-master/datalad/cmdline/main.py(501)main()\r\n-> except InsufficientArgumentsError as exc:\r\n(Pdb) \r\n> /home/yoh/proj/datalad/datalad-master/datalad/cmdline/main.py(506)main()\r\n-> except IncompleteResultsError as exc:\r\n(Pdb) \r\n> /home/yoh/proj/datalad/datalad-master/datalad/cmdline/main.py(517)main()\r\n-> except CommandError as exc:\r\n(Pdb) \r\n> /home/yoh/proj/datalad/datalad-master/datalad/cmdline/main.py(520)main()\r\n-> if exc.msg:\r\n(Pdb) \r\n> /home/yoh/proj/datalad/datalad-master/datalad/cmdline/main.py(523)main()\r\n-> if exc.stdout:\r\n(Pdb) \r\n> /home/yoh/proj/datalad/datalad-master/datalad/cmdline/main.py(525)main()\r\n-> if exc.stderr:\r\n(Pdb) \r\n> /home/yoh/proj/datalad/datalad-master/datalad/cmdline/main.py(529)main()\r\n-> sys.exit(exc.code if exc.code is not None else 1)\r\n(Pdb) \r\nSystemExit: 1\r\n> /home/yoh/proj/datalad/datalad-master/datalad/cmdline/main.py(529)main()\r\n-> sys.exit(exc.code if exc.code is not None else 1)\r\n(Pdb) \r\n--Return--\r\n> /home/yoh/proj/datalad/datalad-master/datalad/cmdline/main.py(529)main()->None\r\n-> sys.exit(exc.code if exc.code is not None else 1)\r\n(Pdb) \r\nSystemExit: 1\r\n> /home/yoh/proj/datalad/datalad-master/venvs/dev/bin/datalad(8)<module>()\r\n-> main()\r\n```", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/2938/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/2938/timeline", "performed_via_github_app": null}