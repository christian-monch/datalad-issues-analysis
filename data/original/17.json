{"url": "https://api.github.com/repos/datalad/datalad/issues/17", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/17/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/17/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/17/events", "html_url": "https://github.com/datalad/datalad/issues/17", "id": 47322555, "node_id": "MDU6SXNzdWU0NzMyMjU1NQ==", "number": 17, "title": "git-annex add (git ls-files) etc performance on laaarge datasets", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 132485920, "node_id": "MDU6TGFiZWwxMzI0ODU5MjA=", "url": "https://api.github.com/repos/datalad/datalad/labels/annex", "name": "annex", "color": "0052cc", "default": false, "description": "Git-annex related issue"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/datalad/datalad/milestones/17", "html_url": "https://github.com/datalad/datalad/milestone/17", "labels_url": "https://api.github.com/repos/datalad/datalad/milestones/17/labels", "id": 1082708, "node_id": "MDk6TWlsZXN0b25lMTA4MjcwOA==", "number": 17, "title": "Git-annex: Further enhancements", "description": "Continue with enhancements to git-annex following our initial evaluation", "creator": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "open_issues": 1, "closed_issues": 8, "state": "closed", "created_at": "2015-04-24T18:36:10Z", "updated_at": "2020-10-06T00:25:35Z", "due_on": null, "closed_at": "2020-02-10T19:57:17Z"}, "comments": 14, "created_at": "2014-10-30T20:27:51Z", "updated_at": "2018-10-12T13:35:51Z", "closed_at": "2018-10-12T13:35:51Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Just a topic for possible discussion etc\n\nJust for the sake of seeing how big would get a really big dataset, I am \"simulating\" an annex repository with all the files distributed by HCP 500 subjects release, which, as deposited to S3, has >5,600,000 files.  It seems to be running for a while now ;) \nSome of the initial bottlenecks I have detected:\n- git-annex add invokes 'git ls-files --others --exclude-standard -z' which is apparently CPU-hungry (not bound by IO) and does quite a bit of exploration (e.g. for .git in every subdirectory).  Might be worth profiling and getting some stats on what it spends time on. or if 'annex add' had option '--initial'  or '--plain-ls' which would avoid using ls-files (but might have side-effects etc)\n- further in the process, when actually files get annexed, git-annex itself uses some locking mechanism so is quite busy opening/closing(?, just looking at fds) journal.lck .  I wonder if the process of 'annex add'ing could somehow be parallelized if not made more efficient for such obnoxious cases\n\nThe script I am using is here: https://github.com/datalad/datalad/blob/master/tools/mimic_repo (really not sure why I did it in python instead of a simple bash script). and here are the corresponding 's3cmd ls' outputs I am running on:\nhttp://www.onerussian.com/tmp/hcp-ls.20141020-500subject-only.txt.gz\nor only just a 1000 (to give a try)\nhttp://www.onerussian.com/tmp/hcp-ls.20141020-500subject-only1000.txt.gz\n\nso you could run e.g. with\n\n```\n./mimic_repo hcp-ls.20141020-500subject-only1000.txt.gz /tmp/testtt\n```\n", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/17/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/17/timeline", "performed_via_github_app": null}