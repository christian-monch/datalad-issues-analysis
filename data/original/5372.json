{"url": "https://api.github.com/repos/datalad/datalad/issues/5372", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/5372/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/5372/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/5372/events", "html_url": "https://github.com/datalad/datalad/issues/5372", "id": 793426737, "node_id": "MDU6SXNzdWU3OTM0MjY3Mzc=", "number": 5372, "title": "datalad push --data anything doesn't push all annexed content", "user": {"login": "loj", "id": 15157717, "node_id": "MDQ6VXNlcjE1MTU3NzE3", "avatar_url": "https://avatars.githubusercontent.com/u/15157717?v=4", "gravatar_id": "", "url": "https://api.github.com/users/loj", "html_url": "https://github.com/loj", "followers_url": "https://api.github.com/users/loj/followers", "following_url": "https://api.github.com/users/loj/following{/other_user}", "gists_url": "https://api.github.com/users/loj/gists{/gist_id}", "starred_url": "https://api.github.com/users/loj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/loj/subscriptions", "organizations_url": "https://api.github.com/users/loj/orgs", "repos_url": "https://api.github.com/users/loj/repos", "events_url": "https://api.github.com/users/loj/events{/privacy}", "received_events_url": "https://api.github.com/users/loj/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-01-25T14:25:58Z", "updated_at": "2021-01-25T16:05:17Z", "closed_at": "2021-01-25T16:05:17Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "#### What is the problem?\r\n\r\nIf I understand correctly from the docs, `datalad push --data anything` should push all annexed content. However, I found that I need to use `git annex copy` to ensure that all annexed content is pushed. \r\n\r\n#### What steps will reproduce the problem?\r\n\r\n```\r\n\u2771 mkdir -p ds/mydsstore\r\n\r\n\u2771 datalad create test\r\n\u2771 cd test\r\n\r\n\u2771 wget https://github.com/datalad/example-dicom-structural/archive/master.tar.gz ./\r\n\u2771 datalad save -m \"add content\"\r\n\u2771 datalad add-archive-content --delete master.tar.gz\r\n\u2771 datalad drop .\r\n\r\n\u2771 datalad create-sibling-ria -d ./ -s inm7 --trust-level trust 'ria+file:///home/loj/tmp/ds/mydsstore'\r\n\r\n\u2771 datalad push --to inm7 --data anything\r\npublish(ok): . (dataset) [refs/heads/master->inm7:refs/heads/master [new branch]]                                                                                                                                   \r\npublish(ok): . (dataset) [refs/heads/git-annex->inm7:refs/heads/git-annex [new branch]] \r\n```\r\n\r\nTry to access data that was pushed, but fails\r\n```\r\n\u2771 cd ../\r\n\u2771 datalad clone 'ria+file:///home/loj/tmp/ds/mydsstore#<dsid>' test2\r\n\u2771 cd test2\r\n\u2771 datalad get example-dicom-structural-master/dicoms/N2D_0001.dcm\r\n[INFO   ] To obtain some keys we need to fetch an archive of size 16.2 MB \r\n[INFO   ] To obtain some keys we need to fetch an archive of size 16.2 MB \r\n[INFO   ] To obtain some keys we need to fetch an archive of size 16.2 MB \r\n[WARNING] Running get resulted in stderr output: [INFO] To obtain some keys we need to fetch an archive of size 16.2 MB \r\n[INFO] PROGRESS-JSON: {\"command\":\"get\",\"wanted\":[{\"here\":false,\"uuid\":\"913ca1d0-9d11-4a3b-8287-ff635a94da80\",\"description\":\"loj@juseless:~/tmp/test\"}],\"note\":\"not available\\nTry making some of these repositories available:\\n\\t913ca1d0-9d11-4a3b-8287-ff635a94da80 -- loj@juseless:~/tmp/test\\n\\n(Note that these git remotes have annex-ignore set: origin)\",\"skipped\":[],\"success\":false,\"key\":\"MD5E-s16207276--3821afacc3ed917f3ec8fbdaab40dbcb.tar.gz\",\"file\":null} \r\n[INFO] To obtain some keys we need to fetch an archive of size 16.2 MB \r\n[INFO] PROGRESS-JSON: {\"command\":\"get\",\"wanted\":[{\"here\":false,\"uuid\":\"913ca1d0-9d11-4a3b-8287-ff635a94da80\",\"description\":\"loj@juseless:~/tmp/test\"}],\"note\":\"not available\\nTry making some of these repositories available:\\n\\t913ca1d0-9d11-4a3b-8287-ff635a94da80 -- loj@juseless:~/tmp/test\\n\\n(Note that these git remotes have annex-ignore set: origin)\",\"skipped\":[],\"success\":false,\"key\":\"MD5E-... \r\n[INFO   ] PROGRESS-JSON: {\"command\":\"get\",\"wanted\":[{\"here\":false,\"uuid\":\"913ca1d0-9d11-4a3b-8287-ff635a94da80\",\"description\":\"loj@juseless:~/tmp/test\"}],\"note\":\"not available\\nTry making some of these repositories available:\\n\\t913ca1d0-9d11-4a3b-8287-ff635a94da80 -- loj@juseless:~/tmp/test\\n\\n(Note that these git remotes have annex-ignore set: origin)\",\"skipped\":[],\"success\":false,\"key\":\"MD5E-s16207276--3821afacc3ed917f3ec8fbdaab40dbcb.tar.gz\",\"file\":null} \r\n[INFO   ] PROGRESS-JSON: {\"command\":\"get\",\"wanted\":[{\"here\":false,\"uuid\":\"913ca1d0-9d11-4a3b-8287-ff635a94da80\",\"description\":\"loj@juseless:~/tmp/test\"}],\"note\":\"not available\\nTry making some of these repositories available:\\n\\t913ca1d0-9d11-4a3b-8287-ff635a94da80 -- loj@juseless:~/tmp/test\\n\\n(Note that these git remotes have annex-ignore set: origin)\",\"skipped\":[],\"success\":false,\"key\":\"MD5E-s16207276--3821afacc3ed917f3ec8fbdaab40dbcb.tar.gz\",\"file\":null} \r\n[INFO   ] PROGRESS-JSON: {\"command\":\"get\",\"wanted\":[{\"here\":false,\"uuid\":\"913ca1d0-9d11-4a3b-8287-ff635a94da80\",\"description\":\"loj@juseless:~/tmp/test\"}],\"note\":\"not available\\nTry making some of these repositories available:\\n\\t913ca1d0-9d11-4a3b-8287-ff635a94da80 -- loj@juseless:~/tmp/test\\n\\n(Note that these git remotes have annex-ignore set: origin)\",\"skipped\":[],\"success\":false,\"key\":\"MD5E-s16207276--3821afacc3ed917f3ec8fbdaab40dbcb.tar.gz\",\"file\":null} \r\n[ERROR  ] from datalad-archives...; from datalad-archives...; from datalad-archives...; Unable to access these remotes: datalad-archives; Try making some of these repositories available:;     c04eb54b-4b4e-5755-8436-866b043170fa -- [datalad-archives]; ; (Note that these git remotes have annex-ignore set: origin) [get(/home/loj/tmp/test2/example-dicom-structural-master/dicoms/N2D_0001.dcm)] \r\nget(error): example-dicom-structural-master/dicoms/N2D_0001.dcm (file) [from datalad-archives...; from datalad-archives...; from datalad-archives...; Unable to access these remotes: datalad-archives; Try making some of these repositories available:;   c04eb54b-4b4e-5755-8436-866b043170fa -- [datalad-archives]; ; (Note that these git remotes have annex-ignore set: origin)]\r\n```\r\n\r\nNow back in original dataset, use git annex copy\r\n```\r\n\u2771 cd ../test\r\n\u2771 git annex copy --to inm7-storage --all\r\ncopy MD5E-s16207276--3821afacc3ed917f3ec8fbdaab40dbcb.tar.gz (to inm7-storage...) \r\nok\r\n(recording state in git...)\r\n\u2771 datalad push --to inm7 --data anything\r\npublish(ok): . (dataset) [refs/heads/git-annex->inm7:refs/heads/git-annex 9ac344c..25a53a5] \r\n```\r\n\r\nTry again to access data, this time successfully.\r\n```\r\n\u2771 cd ../\r\n\u2771 datalad clone 'ria+file:///path/to/datastore/ds/mydsstore#<dsid>' test3\r\n\u2771 cd test3\r\n\u2771 datalad get example-dicom-structural-master/dicoms/N2D_0001.dcm\r\n[INFO   ] To obtain some keys we need to fetch an archive of size 16.2 MB \r\n[INFO   ] PROGRESS-JSON: {\"command\":\"get\",\"note\":\"from inm7-storage...\\nchecksum...\",\"success\":true,\"key\":\"MD5E-s16207276--3821afacc3ed917f3ec8fbdaab40dbcb.tar.gz\",\"file\":null} \r\nget(ok): example-dicom-structural-master/dicoms/N2D_0001.dcm (file) [from datalad-archives...]\r\n```\r\n\r\n#### What version of DataLad are you using ?\r\n\r\n<details><summary>datalad wtf</summary>\r\n<p>\r\n\r\n```\r\n# WTF\r\n## configuration <SENSITIVE, report disabled by configuration>\r\n## datalad \r\n  - full_version: 0.13.7\r\n  - version: 0.13.7\r\n## dataset \r\n  - id: c33ff952-a3a9-42c5-97b9-31ff5212bfe1\r\n  - metadata: <SENSITIVE, report disabled by configuration>\r\n  - path: /home/loj/tmp/test3\r\n  - repo: AnnexRepo\r\n## dependencies \r\n  - annexremote: 1.4.3\r\n  - appdirs: 1.4.3\r\n  - boto: 2.44.0\r\n  - cmd:7z: 16.02\r\n  - cmd:annex: 8.20200330\r\n  - cmd:bundled-git: UNKNOWN\r\n  - cmd:git: 2.24.0\r\n  - cmd:system-git: 2.24.0\r\n  - cmd:system-ssh: 7.9p1\r\n  - exifread: 2.1.2\r\n  - humanize: 0.5.1\r\n  - iso8601: 0.1.11\r\n  - keyring: 17.1.1\r\n  - keyrings.alt: 3.1.1\r\n  - msgpack: 0.5.6\r\n  - mutagen: 1.40.0\r\n  - requests: 2.21.0\r\n  - tqdm: 4.28.1\r\n  - wrapt: 1.10.11\r\n## environment \r\n  - LANG: en_US.UTF-8\r\n  - LANGUAGE: en_US.UTF-8\r\n  - LC_ALL: en_US.UTF-8\r\n  - LC_CTYPE: en_US.UTF-8\r\n  - PATH: /home/loj/.dotfiles/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/X11R6/bin:/usr/local/games:/usr/games\r\n## extensions \r\n  - container: \r\n    - description: Containerized environments\r\n    - entrypoints: \r\n      - datalad_container.containers_add.ContainersAdd: \r\n        - class: ContainersAdd\r\n        - load_error: None\r\n        - module: datalad_container.containers_add\r\n        - names: \r\n          - containers-add\r\n          - containers_add\r\n      - datalad_container.containers_list.ContainersList: \r\n        - class: ContainersList\r\n        - load_error: None\r\n        - module: datalad_container.containers_list\r\n        - names: \r\n          - containers-list\r\n          - containers_list\r\n      - datalad_container.containers_remove.ContainersRemove: \r\n        - class: ContainersRemove\r\n        - load_error: None\r\n        - module: datalad_container.containers_remove\r\n        - names: \r\n          - containers-remove\r\n          - containers_remove\r\n      - datalad_container.containers_run.ContainersRun: \r\n        - class: ContainersRun\r\n        - load_error: None\r\n        - module: datalad_container.containers_run\r\n        - names: \r\n          - containers-run\r\n          - containers_run\r\n    - load_error: None\r\n    - module: datalad_container\r\n    - version: 1.1.0\r\n  - inm7: \r\n    - description: INM7 utilities\r\n    - entrypoints: \r\n    - load_error: None\r\n    - module: inm7_datalad\r\n    - version: 0.5+10.g5f93ec5\r\n  - ria: \r\n    - description: Helper for the remote indexed archive (RIA) special remote\r\n    - entrypoints: \r\n      - ria_remote.export_archive.ExportArchive: \r\n        - class: ExportArchive\r\n        - load_error: None\r\n        - module: ria_remote.export_archive\r\n        - names: \r\n          - ria-export-archive\r\n          - ria_export_archive\r\n    - load_error: None\r\n    - module: ria_remote\r\n    - version: 0.6+6.ge755961\r\n## git-annex \r\n  - build flags: \r\n    - Assistant\r\n    - Webapp\r\n    - Pairing\r\n    - S3\r\n    - WebDAV\r\n    - Inotify\r\n    - DBus\r\n    - DesktopNotify\r\n    - TorrentParser\r\n    - MagicMime\r\n    - Feeds\r\n    - Testsuite\r\n  - dependency versions: \r\n    - aws-0.20\r\n    - bloomfilter-2.0.1.0\r\n    - cryptonite-0.25\r\n    - DAV-1.3.3\r\n    - feed-1.0.0.0\r\n    - ghc-8.4.4\r\n    - http-client-0.5.13.1\r\n    - persistent-sqlite-2.8.2\r\n    - torrent-10000.1.1\r\n    - uuid-1.3.13\r\n    - yesod-1.6.0\r\n  - key/value backends: \r\n    - SHA256E\r\n    - SHA256\r\n    - SHA512E\r\n    - SHA512\r\n    - SHA224E\r\n    - SHA224\r\n    - SHA384E\r\n    - SHA384\r\n    - SHA3_256E\r\n    - SHA3_256\r\n    - SHA3_512E\r\n    - SHA3_512\r\n    - SHA3_224E\r\n    - SHA3_224\r\n    - SHA3_384E\r\n    - SHA3_384\r\n    - SKEIN256E\r\n    - SKEIN256\r\n    - SKEIN512E\r\n    - SKEIN512\r\n    - BLAKE2B256E\r\n    - BLAKE2B256\r\n    - BLAKE2B512E\r\n    - BLAKE2B512\r\n    - BLAKE2B160E\r\n    - BLAKE2B160\r\n    - BLAKE2B224E\r\n    - BLAKE2B224\r\n    - BLAKE2B384E\r\n    - BLAKE2B384\r\n    - BLAKE2BP512E\r\n    - BLAKE2BP512\r\n    - BLAKE2S256E\r\n    - BLAKE2S256\r\n    - BLAKE2S160E\r\n    - BLAKE2S160\r\n    - BLAKE2S224E\r\n    - BLAKE2S224\r\n    - BLAKE2SP256E\r\n    - BLAKE2SP256\r\n    - BLAKE2SP224E\r\n    - BLAKE2SP224\r\n    - SHA1E\r\n    - SHA1\r\n    - MD5E\r\n    - MD5\r\n    - WORM\r\n    - URL\r\n  - local repository version: 8\r\n  - operating system: linux x86_64\r\n  - remote types: \r\n    - git\r\n    - gcrypt\r\n    - p2p\r\n    - S3\r\n    - bup\r\n    - directory\r\n    - rsync\r\n    - web\r\n    - bittorrent\r\n    - webdav\r\n    - adb\r\n    - tahoe\r\n    - glacier\r\n    - ddar\r\n    - git-lfs\r\n    - hook\r\n    - external\r\n  - supported repository versions: \r\n    - 8\r\n  - upgrade supported from repository versions: \r\n    - 0\r\n    - 1\r\n    - 2\r\n    - 3\r\n    - 4\r\n    - 5\r\n    - 6\r\n    - 7\r\n  - version: 8.20200330\r\n## location \r\n  - path: /home/loj/tmp/test3\r\n  - type: dataset\r\n## metadata_extractors \r\n  - annex: \r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.annex\r\n    - version: None\r\n  - audio: \r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.audio\r\n    - version: None\r\n  - datacite: \r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.datacite\r\n    - version: None\r\n  - datalad_core: \r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.datalad_core\r\n    - version: None\r\n  - datalad_rfc822: \r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.datalad_rfc822\r\n    - version: None\r\n  - exif: \r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.exif\r\n    - version: None\r\n  - frictionless_datapackage: \r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.frictionless_datapackage\r\n    - version: None\r\n  - image: \r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.image\r\n    - version: None\r\n  - xmp: \r\n    - load_error: No module named 'libxmp' [xmp.py:<module>:20]\r\n    - module: datalad.metadata.extractors.xmp\r\n## python \r\n  - implementation: CPython\r\n  - version: 3.7.3\r\n## system \r\n  - distribution: debian/10.7\r\n  - encoding: \r\n    - default: utf-8\r\n    - filesystem: utf-8\r\n    - locale.prefered: UTF-8\r\n  - max_path_length: 275\r\n  - name: Linux\r\n  - release: 4.19.0-6-amd64\r\n  - type: posix\r\n  - version: #1 SMP Debian 4.19.67-2+deb10u2 (2019-11-11)\r\n```\r\n</p>\r\n</details>", "closed_by": {"login": "loj", "id": 15157717, "node_id": "MDQ6VXNlcjE1MTU3NzE3", "avatar_url": "https://avatars.githubusercontent.com/u/15157717?v=4", "gravatar_id": "", "url": "https://api.github.com/users/loj", "html_url": "https://github.com/loj", "followers_url": "https://api.github.com/users/loj/followers", "following_url": "https://api.github.com/users/loj/following{/other_user}", "gists_url": "https://api.github.com/users/loj/gists{/gist_id}", "starred_url": "https://api.github.com/users/loj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/loj/subscriptions", "organizations_url": "https://api.github.com/users/loj/orgs", "repos_url": "https://api.github.com/users/loj/repos", "events_url": "https://api.github.com/users/loj/events{/privacy}", "received_events_url": "https://api.github.com/users/loj/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/5372/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/5372/timeline", "performed_via_github_app": null}