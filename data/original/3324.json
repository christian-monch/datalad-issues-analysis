{"url": "https://api.github.com/repos/datalad/datalad/issues/3324", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/3324/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/3324/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/3324/events", "html_url": "https://github.com/datalad/datalad/pull/3324", "id": 432617442, "node_id": "MDExOlB1bGxSZXF1ZXN0MjcwMDUyNjQ5", "number": 3324, "title": "NF: status(eval_subdataset_state={'no'|'commit'|'full'}", "user": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 289240596, "node_id": "MDU6TGFiZWwyODkyNDA1OTY=", "url": "https://api.github.com/repos/datalad/datalad/labels/performance", "name": "performance", "color": "f4b2d8", "default": false, "description": "Improve performance of an existing feature"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-04-12T15:16:17Z", "updated_at": "2019-04-13T09:35:42Z", "closed_at": "2019-04-13T09:35:38Z", "author_association": "MEMBER", "active_lock_reason": null, "pull_request": {"url": "https://api.github.com/repos/datalad/datalad/pulls/3324", "html_url": "https://github.com/datalad/datalad/pull/3324", "diff_url": "https://github.com/datalad/datalad/pull/3324.diff", "patch_url": "https://github.com/datalad/datalad/pull/3324.patch"}, "body": "New mode to fully or partially disable subdataset state evaluation (which involves recursion into all present subdatasets to find potential uncommited changes), without disabling subdataset discovery and\r\nreporting.\r\n\r\nThis addition allows for using status() unconditionally for (fast(er)) discovery operation.\r\n\r\nThis also replaces the (undocumented) argument and behavior switch 'ignore_submodules' that wasn't used in any sensible way, because it didn't actually provide sensible switching. It could only distinguish\r\n\"clever\" operation and \"needlessly wasteful\" operation.\r\n\r\n- [x] final docs\r\n\r\nPerformance info on the `///` dataset:\r\n\r\n`datalad status --eval-subdataset-state commit -r  744.29s user 601.62s system 102% cpu 21:47.48 total`\r\n\r\nLooks ridiculous, but a plain `git status` at the top-level already takes 7min. In contrast this is a recursion across all datasets, with reporting on all datasets. Interestingly, the difference to \"full\" on the present state of that dataset's working tree (mixture of all kinds of things) is only 2min (~24min total runtime).\r\n\r\nSo here is an artificial \"worst case\" example with a deep and clean hierarchy that show maximum performance difference between the modes \"commit\" and \"full\":\r\n\r\n```\r\nimport datalad.api as dl\r\nds = dl.rev_create('deep')\r\npath = ds.pathobj  \r\nfor i in range(20):       \r\n     path = path / 'down'\r\n     ds.rev_create(path)\r\n```\r\n```\r\n%timeit ds.status(eval_subdataset_state='no', result_renderer='disabled')\r\n10 loops, best of 3: 51.8 ms per loop                                                    \r\n\r\n%timeit ds.status(eval_subdataset_state='commit', result_renderer='disabled')\r\n10 loops, best of 3: 66.6 ms per loop\r\n\r\n%timeit ds.status(eval_subdataset_state='full', result_renderer='disabled')\r\n1 loop, best of 3: 1.07 s per loop\r\n```", "closed_by": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/3324/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/3324/timeline", "performed_via_github_app": null}