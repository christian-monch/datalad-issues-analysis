{"url": "https://api.github.com/repos/datalad/datalad/issues/4868", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/4868/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/4868/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/4868/events", "html_url": "https://github.com/datalad/datalad/pull/4868", "id": 692918878, "node_id": "MDExOlB1bGxSZXF1ZXN0NDc5NDY0NDU2", "number": 4868, "title": "OPT: Speedup of per-subdataset \"contains?\" matching", "user": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 289240596, "node_id": "MDU6TGFiZWwyODkyNDA1OTY=", "url": "https://api.github.com/repos/datalad/datalad/labels/performance", "name": "performance", "color": "f4b2d8", "default": false, "description": "Improve performance of an existing feature"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 12, "created_at": "2020-09-04T08:51:35Z", "updated_at": "2020-10-22T09:11:54Z", "closed_at": "2020-10-22T09:11:50Z", "author_association": "MEMBER", "active_lock_reason": null, "pull_request": {"url": "https://api.github.com/repos/datalad/datalad/pulls/4868", "html_url": "https://github.com/datalad/datalad/pull/4868", "diff_url": "https://github.com/datalad/datalad/pull/4868.diff", "patch_url": "https://github.com/datalad/datalad/pull/4868.patch"}, "body": "Speeds up the rejection of non-containing subdatasets. For the UKB dataset with 42k subdatasets, this shaves of 1s of the previous total runtime of 2.5s.\r\n\r\nRelated to gh-4859\r\n\r\nThis also removes a backward compatibility kludge that we put in place over a year ago (`revision` instead of the present `gitshasum` property in the submodule records).\r\n\r\nEdit: This also ups the plain reporting performance (same 42k subdatasets):\r\n\r\nBefore: `datalad subdatasets  9.49s user 3.41s system 57% cpu 22.284 total`\r\nAfter: `datalad subdatasets  9.81s user 2.49s system 74% cpu 16.399 total`\r\nand with a twist: `datalad subdatasets -d .  6.95s user 2.14s system 66% cpu 13.622 total` (see TODO)\r\n\r\nTODO:\r\n\r\n- [x] `GitRepo.get_submodules_()` calls `GitRepo.get_content_info()`. This might be made faster, by filtering the path-contraints with the `contains` parameter before calling any of this stack. Right now `contains` is considered last and all info is requested without any path constraint in the context of #4859 -> #5063 \r\n- [x] Suprise differences with or without `--dataset`\r\n    ```\r\n    datalad subdatasets -r --contains sub-3507513  2.76s user 0.33s system 103% cpu 2.973 total                                           \r\n    datalad subdatasets -d . -r --contains sub-3507513  1.36s user 0.21s system 104% cpu 1.507 total                                      \r\n    ```\r\n- [x] `update` is broken by the second commit, not clear why yet (likely it is still using the `revision` property)\r\n", "closed_by": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/4868/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/4868/timeline", "performed_via_github_app": null}