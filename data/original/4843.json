{"url": "https://api.github.com/repos/datalad/datalad/issues/4843", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/4843/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/4843/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/4843/events", "html_url": "https://github.com/datalad/datalad/pull/4843", "id": 688210957, "node_id": "MDExOlB1bGxSZXF1ZXN0NDc1NTE5Njcy", "number": 4843, "title": "ENH: add exception_traceback (\"unlimited\") to the status dict if exception is passed into get_status_dict", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 545918236, "node_id": "MDU6TGFiZWw1NDU5MTgyMzY=", "url": "https://api.github.com/repos/datalad/datalad/labels/DX", "name": "DX", "color": "0052cc", "default": false, "description": "developer experience"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2020-08-28T16:46:00Z", "updated_at": "2021-04-29T21:56:37Z", "closed_at": "2020-11-02T14:56:31Z", "author_association": "MEMBER", "active_lock_reason": null, "pull_request": {"url": "https://api.github.com/repos/datalad/datalad/pulls/4843", "html_url": "https://github.com/datalad/datalad/pull/4843", "diff_url": "https://github.com/datalad/datalad/pull/4843.diff", "patch_url": "https://github.com/datalad/datalad/pull/4843.patch"}, "body": "And for demonstration of utility - added to a single sample invocation within download_url.\r\nOne of the main use cases is to be able to troubleshoot failed travis runs, where\r\nat most we see only the last location in the traceback due to exc_str being used.\r\nLike\r\n\r\n    'message': \"'ConsoleLog' object has no attribute 'yesno' \"\r\n             '[__init__.py:__getattribute__:101]',\r\n\r\nDue to all the generators for results status messages processing etc, there is no\r\nidea about original stack which lead to the failure :\r\n\r\n      File \"/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/nose/case.py\", line 198, in runTest\r\n        self.test(*self.arg)\r\n      File \"/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/datalad/tests/utils.py\", line 271, in _wrap_skip_ssh\r\n        return func(*args, **kwargs)\r\n      File \"/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/datalad/tests/utils.py\", line 731, in _wrap_with_tempfile\r\n        return t(*(arg + (filename,)), **kw)\r\n      File \"/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/datalad/tests/utils.py\", line 731, in _wrap_with_tempfile\r\n        return t(*(arg + (filename,)), **kw)\r\n      File \"/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/datalad/distributed/tests/test_ria_basics.py\", line 468, in _test_binary_data\r\n        ds.download_url(url, path=file, message=\"Add DICOM file from github\")\r\n      File \"/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/datalad/distribution/dataset.py\", line 503, in apply_func\r\n        return f(**kwargs)\r\n      File \"/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/datalad/interface/utils.py\", line 494, in eval_func\r\n        return return_func(generator_func)(*args, **kwargs)\r\n      File \"/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/datalad/interface/utils.py\", line 482, in return_func\r\n        results = list(results)\r\n      File \"/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/datalad/interface/utils.py\", line 469, in generator_func\r\n        msg=\"Command did not complete successfully\")\r\n    datalad.support.exceptions.IncompleteResultsError: Command did not complete successfully. 1 failed:\r\n    [{'action': 'download_url',\r\n      'message': \"'ConsoleLog' object has no attribute 'yesno' \"\r\n                 '[__init__.py:__getattribute__:101]',\r\n      'path': '/tmp/datalad_temp__test_binary_datajhq0ejj_/dicomfile',\r\n      'status': 'error',\r\n      'type': 'file'}]\r\n\r\nIf we add that exception_traceback into the record, it would not be\r\ndisplayed to the user in their invocation, e.g:\r\n\r\n    $> datalad download-url s3://NDAR_Central_4/submission_XXX/dataset_description.json\r\n    [INFO   ] Downloading 's3://NDAR_Central_4/submission_XXX/dataset_description.json' into '/tmp/'\r\n    INFO:datalad.ui.dialog:Clear progress bars\r\n    download_url(error): /tmp/ (file) [__init__() missing 4 required positional arguments: 'access_key', 'secret_key', 'session', and 'expiration' [nda_aws_token_generator.py:__parse_response:95]]\r\n    INFO:datalad.ui.dialog:Refresh progress bars\r\n\r\nbut would be visible in cases where we dump entire record (tests?) or\r\nexplicitly requested:\r\n\r\n    $> datalad -f json_pp download-url s3://NDAR_Central_4/submission_XXX/dataset_description.json\r\n    [INFO   ] Downloading 's3://NDAR_Central_4/submission_XXX/dataset_description.json' into '/tmp/'\r\n    INFO:datalad.ui.dialog:Clear progress bars\r\n    {\r\n      \"action\": \"download_url\",\r\n      \"exception_traceback\": \"[download_url.py:__call__:178,providers.py:download:478,base.py:download:503,base.py:access:159,s3.py:_establish_session:210,s3.py:authenticate:92,credentials.py:__call__:287,credentials.py:_nda_adapter:296,nda_aws_token_generator.py:generate_token:34,nda_aws_token_generator.py:__make_request:82,nda_aws_token_generator.py:__parse_response:95]\",\r\n      \"path\": \"/tmp/\",\r\n      \"status\": \"error\",\r\n      \"type\": \"file\"\r\n    }\r\n    INFO:datalad.ui.dialog:Refresh progress bars\r\n\r\nthus making it easier to troubleshoot.\r\n\r\nTODOs:\r\n- [x] see if there is a better name (than `exception_traceback`)  -- nope, it seems to be perfect\r\n- Add passing exception in other relevant spots -- later", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/4843/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/4843/timeline", "performed_via_github_app": null}