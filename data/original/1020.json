{"url": "https://api.github.com/repos/datalad/datalad/issues/1020", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/1020/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/1020/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/1020/events", "html_url": "https://github.com/datalad/datalad/issues/1020", "id": 183211094, "node_id": "MDU6SXNzdWUxODMyMTEwOTQ=", "number": 1020, "title": "create-sibling should match local repo annex version on the remote ?", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 63778590, "node_id": "MDU6TGFiZWw2Mzc3ODU5MA==", "url": "https://api.github.com/repos/datalad/datalad/labels/severity-normal", "name": "severity-normal", "color": "ff8888", "default": false, "description": "standard severity"}, {"id": 192403870, "node_id": "MDU6TGFiZWwxOTI0MDM4NzA=", "url": "https://api.github.com/repos/datalad/datalad/labels/external-tools", "name": "external-tools", "color": "0052cc", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": {"login": "joeyh", "id": 16392, "node_id": "MDQ6VXNlcjE2Mzky", "avatar_url": "https://avatars.githubusercontent.com/u/16392?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joeyh", "html_url": "https://github.com/joeyh", "followers_url": "https://api.github.com/users/joeyh/followers", "following_url": "https://api.github.com/users/joeyh/following{/other_user}", "gists_url": "https://api.github.com/users/joeyh/gists{/gist_id}", "starred_url": "https://api.github.com/users/joeyh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joeyh/subscriptions", "organizations_url": "https://api.github.com/users/joeyh/orgs", "repos_url": "https://api.github.com/users/joeyh/repos", "events_url": "https://api.github.com/users/joeyh/events{/privacy}", "received_events_url": "https://api.github.com/users/joeyh/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "joeyh", "id": 16392, "node_id": "MDQ6VXNlcjE2Mzky", "avatar_url": "https://avatars.githubusercontent.com/u/16392?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joeyh", "html_url": "https://github.com/joeyh", "followers_url": "https://api.github.com/users/joeyh/followers", "following_url": "https://api.github.com/users/joeyh/following{/other_user}", "gists_url": "https://api.github.com/users/joeyh/gists{/gist_id}", "starred_url": "https://api.github.com/users/joeyh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joeyh/subscriptions", "organizations_url": "https://api.github.com/users/joeyh/orgs", "repos_url": "https://api.github.com/users/joeyh/repos", "events_url": "https://api.github.com/users/joeyh/events{/privacy}", "received_events_url": "https://api.github.com/users/joeyh/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2016-10-15T13:58:53Z", "updated_at": "2016-10-17T20:34:42Z", "closed_at": "2016-10-17T19:20:53Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "so was trying v6 of annex repo  (git-annex 6.20160923+gitgd1dabb3-1~ndall+1), created remote sibling (repository) which made it v5, published (pushed/copied) to it, and then due to #1019 found .datalad/config not available at all, and trying to do \"annex upgrade; annex unlock; annex lock\" dance caused that file to be completely lost:\n\n``` shell\n$> cat .git/config \n[core]\n    repositoryformatversion = 0\n    filemode = true\n    bare = false\n    logallrefupdates = true\n[annex]\n    uuid = def29798-e86c-4479-9434-b0102befd711\n    version = 5\n[receive]\n    denyCurrentBranch = updateInstead\n(venv-tests)1 10349.....................................:Sat 15 Oct 2016 09:49:40 AM EDT:.\n(git)smaug:\u2026crawl/dicoms/dartmouth-phantoms/bids_test4-20161014/bids-output[master]git\n$> git annex upgrade\nupgrade . (v5 to v6...) (scanning for unlocked files...)\nok\n(venv-tests)1 10350.....................................:Sat 15 Oct 2016 09:50:39 AM EDT:.\n(git)smaug:\u2026crawl/dicoms/dartmouth-phantoms/bids_test4-20161014/bids-output[master]git\n$> git log -p .datalad/config\ncommit 3c8c614cf24a9d02534ddcdb8ce879e3ff501723\nAuthor: Yaroslav Halchenko <debian@onerussian.com>\nDate:   Fri Oct 14 16:03:44 2016 -0400\n\n    [DATALAD] new dataset\n\ndiff --git a/.datalad/config b/.datalad/config\nnew file mode 100644\nindex 0000000..c9dce61\n--- /dev/null\n+++ b/.datalad/config\n@@ -0,0 +1 @@\n+/annex/objects/MD5E-s63--6c651a912b39c90ba19405e501bd951c\n(venv-tests)1 10351.....................................:Sat 15 Oct 2016 09:50:41 AM EDT:.\n(git)smaug:\u2026crawl/dicoms/dartmouth-phantoms/bids_test4-20161014/bids-output[master]git\n$> git annex get .           \n(venv-tests)1 10352.....................................:Sat 15 Oct 2016 09:50:44 AM EDT:.\n(git)smaug:\u2026crawl/dicoms/dartmouth-phantoms/bids_test4-20161014/bids-output[master]git\n$> find .git/annex\n.git/annex\n.git/annex/index.lck\n.git/annex/misctmp\n.git/annex/mergedrefs\n.git/annex/sentinal\n.git/annex/sentinal.cache\n.git/annex/journal.lck\n.git/annex/journal\n.git/annex/transfer\n.git/annex/transfer/download\n.git/annex/transfer/download/a98db545-d2f6-4f9f-822a-43ec88d886f6\n.git/annex/tmp\n.git/annex/objects\n.git/annex/objects/Qf\n.git/annex/objects/Qf/zw\n.git/annex/objects/Qf/zw/MD5E-s63--6c651a912b39c90ba19405e501bd951c\n.git/annex/objects/Qf/zw/MD5E-s63--6c651a912b39c90ba19405e501bd951c/MD5E-s63--6c651a912b39c90ba19405e501bd951c\n.git/annex/index\n.git/annex/daemon.pid\n.git/annex/keys.lck\n.git/annex/keys\n.git/annex/keys/db\n.git/annex/keys/db-wal\n.git/annex/keys/db-shm\n(venv-tests)1 10353.....................................:Sat 15 Oct 2016 09:50:50 AM EDT:.\n(git)smaug:\u2026crawl/dicoms/dartmouth-phantoms/bids_test4-20161014/bids-output[master]git\n$> cat .git/config           \n[core]\n    repositoryformatversion = 0\n    filemode = true\n    bare = false\n    logallrefupdates = true\n[annex]\n    uuid = def29798-e86c-4479-9434-b0102befd711\n    version = 6\n[receive]\n    denyCurrentBranch = updateInstead\n[filter \"annex\"]\n    smudge = git-annex smudge %f\n    clean = git-annex smudge --clean %f\n(venv-tests)1 10354.....................................:Sat 15 Oct 2016 09:50:57 AM EDT:.\n(git)smaug:\u2026crawl/dicoms/dartmouth-phantoms/bids_test4-20161014/bids-output[master]git\n$> cat .datalad/config\n/annex/objects/MD5E-s63--6c651a912b39c90ba19405e501bd951c\n(venv-tests)1 10355.....................................:Sat 15 Oct 2016 09:51:02 AM EDT:.\n(git)smaug:\u2026crawl/dicoms/dartmouth-phantoms/bids_test4-20161014/bids-output[master]git\n$> ls -ld .datalad/config\n-rw-r--r-- 1 yoh datalad 58 Oct 15 01:09 .datalad/config\n(venv-tests)1 10356.....................................:Sat 15 Oct 2016 09:51:07 AM EDT:.\n(git)smaug:\u2026crawl/dicoms/dartmouth-phantoms/bids_test4-20161014/bids-output[master]git\n$> cat .git/annex/objects/Qf/zw/MD5E-s63--6c651a912b39c90ba19405e501bd951c/MD5E-s63--6c651a912b39c90ba19405e501bd951c\n[datalad \"dataset\"]\n    id = 4f59e03a-9249-11e6-a8b3-8019340ce7f2\n(venv-tests)1 10357.....................................:Sat 15 Oct 2016 09:51:14 AM EDT:.\n(git)smaug:\u2026crawl/dicoms/dartmouth-phantoms/bids_test4-20161014/bids-output[master]git\n$> git annex unlock\n(venv-tests)1 10358.....................................:Sat 15 Oct 2016 09:51:32 AM EDT:.\n(git)smaug:\u2026crawl/dicoms/dartmouth-phantoms/bids_test4-20161014/bids-output[master]git\n$> cat .datalad/config                                                                                            \n/annex/objects/MD5E-s63--6c651a912b39c90ba19405e501bd951c\n(venv-tests)1 10359.....................................:Sat 15 Oct 2016 09:51:35 AM EDT:.\n(git)smaug:\u2026crawl/dicoms/dartmouth-phantoms/bids_test4-20161014/bids-output[master]git\n$> git annex lock     \nlock .datalad/config ok\n(recording state in git...)\ncached/staged changes:                                                                                                                                                                                                            \n .datalad/config | 2 +-\n(venv-tests)1 10360.....................................:Sat 15 Oct 2016 09:51:39 AM EDT:.\n(git)smaug:\u2026crawl/dicoms/dartmouth-phantoms/bids_test4-20161014/bids-output[master]git\n$> cat .datalad/config\ncat: .datalad/config: No such file or directory\n(venv-tests)1 10361 ->1.....................................:Sat 15 Oct 2016 09:51:40 AM EDT:.\n(git)smaug:\u2026crawl/dicoms/dartmouth-phantoms/bids_test4-20161014/bids-output[master]git\n$> ls -ld .datalad/config\nlrwxrwxrwx 1 yoh datalad 113 Oct 15 01:09 .datalad/config -> ../.git/annex/objects/Qf/zw/MD5E-s63--6c651a912b39c90ba19405e501bd951c/MD5E-s63--6c651a912b39c90ba19405e501bd951c\n```\n\nand that file was no longer under objects (its R/O directory remained there though).\n\n@joeyh  --- is that something you might have observed?  would making remote clones v6 right from start remedy this problem?\n", "closed_by": {"login": "joeyh", "id": 16392, "node_id": "MDQ6VXNlcjE2Mzky", "avatar_url": "https://avatars.githubusercontent.com/u/16392?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joeyh", "html_url": "https://github.com/joeyh", "followers_url": "https://api.github.com/users/joeyh/followers", "following_url": "https://api.github.com/users/joeyh/following{/other_user}", "gists_url": "https://api.github.com/users/joeyh/gists{/gist_id}", "starred_url": "https://api.github.com/users/joeyh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joeyh/subscriptions", "organizations_url": "https://api.github.com/users/joeyh/orgs", "repos_url": "https://api.github.com/users/joeyh/repos", "events_url": "https://api.github.com/users/joeyh/events{/privacy}", "received_events_url": "https://api.github.com/users/joeyh/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/1020/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/1020/timeline", "performed_via_github_app": null}