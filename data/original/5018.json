{"url": "https://api.github.com/repos/datalad/datalad/issues/5018", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/5018/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/5018/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/5018/events", "html_url": "https://github.com/datalad/datalad/issues/5018", "id": 719319866, "node_id": "MDU6SXNzdWU3MTkzMTk4NjY=", "number": 5018, "title": "python api create: cfg_proc results in exception", "user": {"login": "SteffenBrinckmann", "id": 39419674, "node_id": "MDQ6VXNlcjM5NDE5Njc0", "avatar_url": "https://avatars.githubusercontent.com/u/39419674?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SteffenBrinckmann", "html_url": "https://github.com/SteffenBrinckmann", "followers_url": "https://api.github.com/users/SteffenBrinckmann/followers", "following_url": "https://api.github.com/users/SteffenBrinckmann/following{/other_user}", "gists_url": "https://api.github.com/users/SteffenBrinckmann/gists{/gist_id}", "starred_url": "https://api.github.com/users/SteffenBrinckmann/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SteffenBrinckmann/subscriptions", "organizations_url": "https://api.github.com/users/SteffenBrinckmann/orgs", "repos_url": "https://api.github.com/users/SteffenBrinckmann/repos", "events_url": "https://api.github.com/users/SteffenBrinckmann/events{/privacy}", "received_events_url": "https://api.github.com/users/SteffenBrinckmann/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-10-12T11:55:13Z", "updated_at": "2020-10-12T12:32:09Z", "closed_at": "2020-10-12T12:32:08Z", "author_association": "NONE", "active_lock_reason": null, "body": "#### What is the problem?\r\nIf I run in python  datalad.api.create(path='mydataset', cfg_proc='text2git')\r\nI get an exception\r\nUnsupportedOperation: fileno\r\n\r\n#### What steps will reproduce the problem?\r\nimport datalad\r\ndatalad.api.create(path='mydataset', cfg_proc='text2git')\r\n#### What version of DataLad are you using (run `datalad --version`)? On what operating system (consider running `datalad wtf`)?\r\ndatalad 0.13.4\r\n# WTF\r\n## configuration <SENSITIVE, report disabled by configuration>\r\n## datalad \r\n  - full_version: 0.13.4\r\n  - version: 0.13.4\r\n## dataset \r\n  - id: 11382775-849a-4f4d-a52d-925952941270\r\n  - metadata: <SENSITIVE, report disabled by configuration>\r\n  - path: /home/sbrinckm/temporary_test0/NewProject\r\n  - repo: AnnexRepo\r\n## dependencies \r\n  - annexremote: 1.4.3\r\n  - appdirs: 1.4.4\r\n  - boto: 2.49.0\r\n  - cmd:7z: 16.02\r\n  - cmd:annex: 7.20190819+git2-g908476a9b-1~ndall+1\r\n  - cmd:bundled-git: 2.20.1\r\n  - cmd:git: 2.20.1\r\n  - cmd:system-git: 2.17.1\r\n  - cmd:system-ssh: 7.6p1\r\n  - exifread: 2.1.2\r\n  - git: 3.0.5\r\n  - gitdb: 2.0.6\r\n  - humanize: 3.0.1\r\n  - iso8601: 0.1.13\r\n  - keyring: 10.6.0\r\n  - keyrings.alt: 3.0\r\n  - msgpack: 1.0.0\r\n  - mutagen: 1.38\r\n  - requests: 2.18.4\r\n  - tqdm: 4.50.0\r\n  - wrapt: 1.12.1\r\n## environment \r\n  - LANG: en_US.UTF-8\r\n  - LANGUAGE: en_US\r\n  - LC_ADDRESS: en_US.UTF-8\r\n  - LC_IDENTIFICATION: en_US.UTF-8\r\n  - LC_MEASUREMENT: en_US.UTF-8\r\n  - LC_MONETARY: en_US.UTF-8\r\n  - LC_NAME: en_US.UTF-8\r\n  - LC_NUMERIC: en_US.UTF-8\r\n  - LC_PAPER: en_US.UTF-8\r\n  - LC_TELEPHONE: en_US.UTF-8\r\n  - LC_TIME: en_US.UTF-8\r\n  - PATH: /home/sbrinckm/.local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/home/sbrinckm/FZJ/JamDB/Python:/home/sbrinckm/Android/Sdk/emulator:/home/sbrinckm/Android/Sdk/tools:/home/sbrinckm/Android/Sdk/tools/bin:/home/sbrinckm/Android/Sdk/platform-tools\r\n  - PYTHONPATH: :/home/sbrinckm/MPIE/zz_Code/FEM_Abaqus/:/home/sbrinckm/FZJ/SourceCode/EBSD:/home/sbrinckm/FZJ/SourceCode/Nanotribology:/home/sbrinckm/FZJ/SourceCode/Micromechanics/src:/home/sbrinckm/FZJ/SourceCode/orix\r\n## extensions \r\n## git-annex \r\n  - build flags: \r\n    - Assistant\r\n    - Webapp\r\n    - Pairing\r\n    - S3\r\n    - WebDAV\r\n    - Inotify\r\n    - DBus\r\n    - DesktopNotify\r\n    - TorrentParser\r\n    - MagicMime\r\n    - Feeds\r\n    - Testsuite\r\n  - dependency versions: \r\n    - aws-0.20\r\n    - bloomfilter-2.0.1.0\r\n    - cryptonite-0.25\r\n    - DAV-1.3.3\r\n    - feed-1.0.0.0\r\n    - ghc-8.4.4\r\n    - http-client-0.5.13.1\r\n    - persistent-sqlite-2.8.2\r\n    - torrent-10000.1.1\r\n    - uuid-1.3.13\r\n    - yesod-1.6.0\r\n  - key/value backends: \r\n    - SHA256E\r\n    - SHA256\r\n    - SHA512E\r\n    - SHA512\r\n    - SHA224E\r\n    - SHA224\r\n    - SHA384E\r\n    - SHA384\r\n    - SHA3_256E\r\n    - SHA3_256\r\n    - SHA3_512E\r\n    - SHA3_512\r\n    - SHA3_224E\r\n    - SHA3_224\r\n    - SHA3_384E\r\n    - SHA3_384\r\n    - SKEIN256E\r\n    - SKEIN256\r\n    - SKEIN512E\r\n    - SKEIN512\r\n    - BLAKE2B256E\r\n    - BLAKE2B256\r\n    - BLAKE2B512E\r\n    - BLAKE2B512\r\n    - BLAKE2B160E\r\n    - BLAKE2B160\r\n    - BLAKE2B224E\r\n    - BLAKE2B224\r\n    - BLAKE2B384E\r\n    - BLAKE2B384\r\n    - BLAKE2BP512E\r\n    - BLAKE2BP512\r\n    - BLAKE2S256E\r\n    - BLAKE2S256\r\n    - BLAKE2S160E\r\n    - BLAKE2S160\r\n    - BLAKE2S224E\r\n    - BLAKE2S224\r\n    - BLAKE2SP256E\r\n    - BLAKE2SP256\r\n    - BLAKE2SP224E\r\n    - BLAKE2SP224\r\n    - SHA1E\r\n    - SHA1\r\n    - MD5E\r\n    - MD5\r\n    - WORM\r\n    - URL\r\n  - local repository version: 5\r\n  - operating system: linux x86_64\r\n  - remote types: \r\n    - git\r\n    - gcrypt\r\n    - p2p\r\n    - S3\r\n    - bup\r\n    - directory\r\n    - rsync\r\n    - web\r\n    - bittorrent\r\n    - webdav\r\n    - adb\r\n    - tahoe\r\n    - glacier\r\n    - ddar\r\n    - git-lfs\r\n    - hook\r\n    - external\r\n  - supported repository versions: \r\n    - 5\r\n    - 7\r\n  - upgrade supported from repository versions: \r\n    - 0\r\n    - 1\r\n    - 2\r\n    - 3\r\n    - 4\r\n    - 5\r\n    - 6\r\n  - version: 7.20190819+git2-g908476a9b-1~ndall+1\r\n## location \r\n  - path: /home/sbrinckm/temporary_test0/NewProject\r\n  - type: dataset\r\n## metadata_extractors \r\n  - annex: \r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.annex\r\n    - version: None\r\n  - audio: \r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.audio\r\n    - version: None\r\n  - datacite: \r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.datacite\r\n    - version: None\r\n  - datalad_core: \r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.datalad_core\r\n    - version: None\r\n  - datalad_rfc822: \r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.datalad_rfc822\r\n    - version: None\r\n  - exif: \r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.exif\r\n    - version: None\r\n  - frictionless_datapackage: \r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.frictionless_datapackage\r\n    - version: None\r\n  - image: \r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.image\r\n    - version: None\r\n  - xmp: \r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.xmp\r\n    - version: None\r\n## python \r\n  - implementation: CPython\r\n  - version: 3.6.9\r\n## system \r\n  - distribution: Ubuntu/18.04/bionic\r\n  - encoding: \r\n    - default: utf-8\r\n    - filesystem: utf-8\r\n    - locale.prefered: UTF-8\r\n  - max_path_length: 297\r\n  - name: Linux\r\n  - release: 5.4.0-42-generic\r\n  - type: posix\r\n  - version: #46~18.04.1-Ubuntu SMP Fri Jul 10 07:21:24 UTC 2020\r\n\r\n#### Is there anything else that would be useful to know in this context?\r\nThe exception log:\r\n[INFO] Creating a new annex repo at /home/sbrinckm/temporary_test0/mydataset \r\n[INFO] Running procedure cfg_text2git \r\n[INFO] == Command start (output follows) ===== \r\n---------------------------------------------------------------------------\r\nUnsupportedOperation                      Traceback (most recent call last)\r\n<ipython-input-9-88a66abe531b> in <module>\r\n----> 1 datalad.api.create(path='mydataset', cfg_proc='text2git')\r\n\r\n/usr/local/lib/python3.6/dist-packages/datalad/interface/utils.py in eval_func(wrapped, instance, args, kwargs)\r\n    492                     return results\r\n    493             lgr.log(2, \"Returning return_func from eval_func for %s\", wrapped_class)\r\n--> 494             return return_func(generator_func)(*args, **kwargs)\r\n    495 \r\n    496     return eval_func(func)\r\n\r\n/usr/local/lib/python3.6/dist-packages/datalad/interface/utils.py in return_func(wrapped_, instance_, args_, kwargs_)\r\n    480                     # unwind generator if there is one, this actually runs\r\n    481                     # any processing\r\n--> 482                     results = list(results)\r\n    483                 # render summaries\r\n    484                 if not result_xfm and result_renderer in ('tailored', 'default'):\r\n\r\n/usr/local/lib/python3.6/dist-packages/datalad/interface/utils.py in generator_func(*_args, **_kwargs)\r\n    411                     result_log_level,\r\n    412                     # let renderers get to see how a command was called\r\n--> 413                     allkwargs):\r\n    414                 for hook, spec in hooks.items():\r\n    415                     # run the hooks before we yield the result\r\n\r\n/usr/local/lib/python3.6/dist-packages/datalad/interface/utils.py in _process_results(results, cmd_class, on_failure, action_summary, incomplete_results, result_renderer, result_log_level, allkwargs)\r\n    550     render_n_repetitions = 10 if sys.stdout.isatty() else float(\"inf\")\r\n    551 \r\n--> 552     for res in results:\r\n    553         if not res or 'action' not in res:\r\n    554             # XXX Yarik has to no clue on how to track the origin of the\r\n\r\n/usr/local/lib/python3.6/dist-packages/datalad/core/local/create.py in __call__(path, initopts, force, description, dataset, no_annex, annex, fake_dates, cfg_proc)\r\n    501 \r\n    502         for cfg_proc_ in cfg_proc:\r\n--> 503             for r in tbds.run_procedure('cfg_' + cfg_proc_):\r\n    504                 yield r\r\n    505 \r\n\r\n/usr/local/lib/python3.6/dist-packages/datalad/distribution/dataset.py in apply_func(wrapped, instance, args, kwargs)\r\n    501             elif i >= ds_index:\r\n    502                 kwargs[orig_pos[i+1]] = args[i]\r\n--> 503         return f(**kwargs)\r\n    504 \r\n    505     setattr(Dataset, name, apply_func(f))\r\n\r\n/usr/local/lib/python3.6/dist-packages/datalad/interface/utils.py in eval_func(wrapped, instance, args, kwargs)\r\n    492                     return results\r\n    493             lgr.log(2, \"Returning return_func from eval_func for %s\", wrapped_class)\r\n--> 494             return return_func(generator_func)(*args, **kwargs)\r\n    495 \r\n    496     return eval_func(func)\r\n\r\n/usr/local/lib/python3.6/dist-packages/datalad/interface/utils.py in return_func(wrapped_, instance_, args_, kwargs_)\r\n    480                     # unwind generator if there is one, this actually runs\r\n    481                     # any processing\r\n--> 482                     results = list(results)\r\n    483                 # render summaries\r\n    484                 if not result_xfm and result_renderer in ('tailored', 'default'):\r\n\r\n/usr/local/lib/python3.6/dist-packages/datalad/interface/utils.py in generator_func(*_args, **_kwargs)\r\n    411                     result_log_level,\r\n    412                     # let renderers get to see how a command was called\r\n--> 413                     allkwargs):\r\n    414                 for hook, spec in hooks.items():\r\n    415                     # run the hooks before we yield the result\r\n\r\n/usr/local/lib/python3.6/dist-packages/datalad/interface/utils.py in _process_results(results, cmd_class, on_failure, action_summary, incomplete_results, result_renderer, result_log_level, allkwargs)\r\n    550     render_n_repetitions = 10 if sys.stdout.isatty() else float(\"inf\")\r\n    551 \r\n--> 552     for res in results:\r\n    553         if not res or 'action' not in res:\r\n    554             # XXX Yarik has to no clue on how to track the origin of the\r\n\r\n/usr/local/lib/python3.6/dist-packages/datalad/interface/run_procedure.py in __call__(spec, dataset, discover, help_proc)\r\n    450                 # pass through here\r\n    451                 on_failure='ignore',\r\n--> 452                 return_type='generator'\r\n    453         ):\r\n    454             yield r\r\n\r\n/usr/local/lib/python3.6/dist-packages/datalad/interface/utils.py in generator_func(*_args, **_kwargs)\r\n    411                     result_log_level,\r\n    412                     # let renderers get to see how a command was called\r\n--> 413                     allkwargs):\r\n    414                 for hook, spec in hooks.items():\r\n    415                     # run the hooks before we yield the result\r\n\r\n/usr/local/lib/python3.6/dist-packages/datalad/interface/utils.py in _process_results(results, cmd_class, on_failure, action_summary, incomplete_results, result_renderer, result_log_level, allkwargs)\r\n    550     render_n_repetitions = 10 if sys.stdout.isatty() else float(\"inf\")\r\n    551 \r\n--> 552     for res in results:\r\n    553         if not res or 'action' not in res:\r\n    554             # XXX Yarik has to no clue on how to track the origin of the\r\n\r\n/usr/local/lib/python3.6/dist-packages/datalad/core/local/run.py in __call__(cmd, dataset, inputs, outputs, expand, explicit, message, sidecar)\r\n    237                              explicit=explicit,\r\n    238                              message=message,\r\n--> 239                              sidecar=sidecar):\r\n    240             yield r\r\n    241 \r\n\r\n/usr/local/lib/python3.6/dist-packages/datalad/core/local/run.py in run_command(cmd, dataset, inputs, outputs, expand, explicit, message, sidecar, extra_info, rerun_info, extra_inputs, rerun_outputs, inject, saver)\r\n    626         cmd_exitcode, exc = _execute_command(\r\n    627             cmd_expanded, pwd,\r\n--> 628             expected_exit=rerun_info.get(\"exit\", 0) if rerun_info else None)\r\n    629 \r\n    630 \r\n\r\n/usr/local/lib/python3.6/dist-packages/datalad/core/local/run.py in _execute_command(command, pwd, expected_exit)\r\n    468             log_stderr=False,\r\n    469             expect_stderr=True,\r\n--> 470             expect_fail=True,\r\n    471             # TODO stdin\r\n    472         )\r\n\r\n/usr/local/lib/python3.6/dist-packages/datalad/cmd.py in run(self, cmd, log_stdout, log_stderr, log_online, expect_stderr, expect_fail, cwd, env, shell, stdin)\r\n    913                                         cwd=popen_cwd,\r\n    914                                         env=popen_env,\r\n--> 915                                         stdin=stdin)\r\n    916 \r\n    917             except Exception as e:\r\n\r\n/usr/lib/python3.6/subprocess.py in __init__(self, args, bufsize, executable, stdin, stdout, stderr, preexec_fn, close_fds, shell, cwd, env, universal_newlines, startupinfo, creationflags, restore_signals, start_new_session, pass_fds, encoding, errors)\r\n    685         (p2cread, p2cwrite,\r\n    686          c2pread, c2pwrite,\r\n--> 687          errread, errwrite) = self._get_handles(stdin, stdout, stderr)\r\n    688 \r\n    689         # We wrap OS handles *before* launching the child, otherwise a\r\n\r\n/usr/lib/python3.6/subprocess.py in _get_handles(self, stdin, stdout, stderr)\r\n   1202             else:\r\n   1203                 # Assuming file-like object\r\n-> 1204                 c2pwrite = stdout.fileno()\r\n   1205 \r\n   1206             if stderr is None:\r\n\r\nUnsupportedOperation: fileno\r\n\r\n\r\n\r\n\r\n#### Have you had any success using DataLad before? (to assess your expertise/prior luck.  We would welcome your testimonial additions to https://github.com/datalad/datalad/wiki/Testimonials as well)\r\nNon python-api version works fine\r\n", "closed_by": {"login": "SteffenBrinckmann", "id": 39419674, "node_id": "MDQ6VXNlcjM5NDE5Njc0", "avatar_url": "https://avatars.githubusercontent.com/u/39419674?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SteffenBrinckmann", "html_url": "https://github.com/SteffenBrinckmann", "followers_url": "https://api.github.com/users/SteffenBrinckmann/followers", "following_url": "https://api.github.com/users/SteffenBrinckmann/following{/other_user}", "gists_url": "https://api.github.com/users/SteffenBrinckmann/gists{/gist_id}", "starred_url": "https://api.github.com/users/SteffenBrinckmann/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SteffenBrinckmann/subscriptions", "organizations_url": "https://api.github.com/users/SteffenBrinckmann/orgs", "repos_url": "https://api.github.com/users/SteffenBrinckmann/repos", "events_url": "https://api.github.com/users/SteffenBrinckmann/events{/privacy}", "received_events_url": "https://api.github.com/users/SteffenBrinckmann/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/5018/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/5018/timeline", "performed_via_github_app": null}