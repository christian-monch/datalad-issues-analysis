{"url": "https://api.github.com/repos/datalad/datalad/issues/1908", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/1908/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/1908/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/1908/events", "html_url": "https://github.com/datalad/datalad/issues/1908", "id": 266708807, "node_id": "MDU6SXNzdWUyNjY3MDg4MDc=", "number": 1908, "title": "Catch a moment: some tests fail for Yarik", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-10-19T03:23:22Z", "updated_at": "2017-10-25T01:03:02Z", "closed_at": "2017-10-25T01:03:02Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "#### What is the problem?\r\n```shell\r\n$> WRAPT_DISABLE_EXTENSIONS=1 DATALAD_TESTS_SSH=1 python -m nose -s -v datalad/interface/tests/test_utils.py:test_save_hierarchy datalad/distribution/tests/test_clone.py:test_failed_clone datalad/distribution/tests/test_install.py:test_failed_install datalad/metadata/tests/test_base.py:test_aggregation\r\ndatalad.interface.tests.test_utils.test_save_hierarchy ... ERROR\r\ndatalad.distribution.tests.test_clone.test_failed_clone ... FAIL\r\ndatalad.distribution.tests.test_install.test_failed_install ... FAIL\r\ndatalad.metadata.tests.test_base.test_aggregation ... FAIL\r\nVersions: appdirs=1.4.0 boto=2.44.0 cmd:annex=6.20170815+gitg22da64d0f-1~ndall+1 cmd:git=2.11.0 cmd:system-git=2.14.1 cmd:system-ssh=7.4p1 git=2.1.6 gitdb=2.0.0 humanize=0.5.1 iso8601=0.1.11 msgpack=0.4.8 requests=2.12.4 scrapy=1.4.0 six=1.10.0 tqdm=4.11.2 wrapt=1.10.11\r\n\r\n======================================================================\r\nERROR: datalad.interface.tests.test_utils.test_save_hierarchy\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python2.7/dist-packages/nose/case.py\", line 197, in runTest\r\n    self.test(*self.arg)\r\n  File \"/home/yoh/proj/datalad/datalad/datalad/tests/utils.py\", line 458, in newfunc\r\n    return t(*(arg + (d,)), **kw)\r\n  File \"/home/yoh/proj/datalad/datalad/datalad/interface/tests/test_utils.py\", line 194, in test_save_hierarchy\r\n    super_datasets=True)\r\n  File \"/home/yoh/proj/datalad/datalad/venvs/dev/local/lib/python2.7/site-packages/wrapt/wrappers.py\", line 562, in __call__\r\n    args, kwargs)\r\n  File \"/home/yoh/proj/datalad/datalad/datalad/distribution/dataset.py\", line 437, in apply_func\r\n    return f(**kwargs)\r\n  File \"/home/yoh/proj/datalad/datalad/venvs/dev/local/lib/python2.7/site-packages/wrapt/wrappers.py\", line 523, in __call__\r\n    args, kwargs)\r\n  File \"/home/yoh/proj/datalad/datalad/datalad/interface/utils.py\", line 437, in eval_func\r\n    return return_func(generator_func)(*args, **kwargs)\r\n  File \"/home/yoh/proj/datalad/datalad/venvs/dev/local/lib/python2.7/site-packages/wrapt/wrappers.py\", line 523, in __call__\r\n    args, kwargs)\r\n  File \"/home/yoh/proj/datalad/datalad/datalad/interface/utils.py\", line 425, in return_func\r\n    results = list(results)\r\n  File \"/home/yoh/proj/datalad/datalad/datalad/interface/utils.py\", line 382, in generator_func\r\n    result_renderer, result_xfm, _result_filter, **_kwargs):\r\n  File \"/home/yoh/proj/datalad/datalad/datalad/interface/utils.py\", line 449, in _process_results\r\n    for res in results:\r\n  File \"/home/yoh/proj/datalad/datalad/datalad/interface/save.py\", line 367, in __call__\r\n    message=message)\r\n  File \"/home/yoh/proj/datalad/datalad/datalad/interface/save.py\", line 112, in save_dataset\r\n    update=save_entire_ds)\r\n  File \"/home/yoh/proj/datalad/datalad/datalad/support/gitrepo.py\", line 270, in newfunc\r\n    files_new = [normalize(self.path, path) for path in files]\r\n  File \"/home/yoh/proj/datalad/datalad/datalad/support/gitrepo.py\", line 190, in _normalize_path\r\n    % path, filename=path)\r\nFileNotInRepositoryError: FileNotInRepositoryError: \r\nPath outside repository: /tmp/datalad_temp_tree_test_save_hierarchyES2q4T\r\n[Errno None] : Path outside repository: /tmp/datalad_temp_tree_test_save_hierarchyES2q4T: '/tmp/datalad_temp_tree_test_save_hierarchyES2q4T'\r\n-------------------- >> begin captured logging << --------------------\r\ndatalad.utils: Level 5: Importing datalad.utils\r\ndatalad.utils: Level 5: Done importing datalad.utils\r\ndatalad.cmd: Level 9: Will use git under '/usr/lib/git-annex.linux' (no adjustments to PATH if empty string)\r\ndatalad.cmd: Level 9: Running: ['git', 'version']\r\ndatalad.cmd: Level 8: Finished running ['git', 'version'] with status 0\r\ndatalad.cmd: Level 9: Running: ['git', 'config', '-z', '-l', '--show-origin']\r\ndatalad.cmd: Level 8: Finished running ['git', 'config', '-z', '-l', '--show-origin'] with status 0\r\ndatalad.ui: Level 5: Starting importing ui\r\ndatalad.ui.dialog: Level 5: Starting importing ui.dialog\r\ndatalad.ui.dialog: Level 5: Done importing ui.dialog\r\ndatalad.ui: Level 5: Initiating UI switcher\r\ndatalad.ui: DEBUG: UI set to DialogUI(out=<file>)\r\ndatalad.ui: Level 5: Done importing ui\r\n--------------------- >> end captured logging << ---------------------\r\n\r\n======================================================================\r\nFAIL: datalad.distribution.tests.test_clone.test_failed_clone\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python2.7/dist-packages/nose/case.py\", line 197, in runTest\r\n    self.test(*self.arg)\r\n  File \"/home/yoh/proj/datalad/datalad/datalad/tests/utils.py\", line 593, in newfunc\r\n    return t(*(arg + (filename,)), **kw)\r\n  File \"/home/yoh/proj/datalad/datalad/datalad/distribution/tests/test_clone.py\", line 286, in test_failed_clone\r\n    assert_status('error', res)\r\n  File \"/home/yoh/proj/datalad/datalad/datalad/tests/utils.py\", line 1120, in assert_status\r\n    dumps(results, indent=1, default=lambda x: \"<not serializable>\")))\r\nAssertionError: Test 1/1: expected status ['error'] not found in:\r\n[\r\n {\r\n  \"status\": \"ok\", \r\n  \"source_url\": \"http://nonexistingreallyanything.somewhere/bla\", \r\n  \"action\": \"install\", \r\n  \"path\": \"/tmp/datalad_temp_test_failed_cloneIFFnNw/sub\", \r\n  \"type\": \"dataset\", \r\n  \"refds\": \"/tmp/datalad_temp_test_failed_cloneIFFnNw\"\r\n }\r\n]\r\n\r\n======================================================================\r\nFAIL: datalad.distribution.tests.test_install.test_failed_install\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python2.7/dist-packages/nose/case.py\", line 197, in runTest\r\n    self.test(*self.arg)\r\n  File \"/home/yoh/proj/datalad/datalad/datalad/tests/utils.py\", line 593, in newfunc\r\n    return t(*(arg + (filename,)), **kw)\r\n  File \"/home/yoh/proj/datalad/datalad/datalad/distribution/tests/test_install.py\", line 582, in test_failed_install\r\n    source=\"http://nonexistingreallyanything.somewhere/bla\")\r\nAssertionError: IncompleteResultsError not raised\r\n\r\n======================================================================\r\nFAIL: datalad.metadata.tests.test_base.test_aggregation\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python2.7/dist-packages/nose/case.py\", line 197, in runTest\r\n    self.test(*self.arg)\r\n  File \"/home/yoh/proj/datalad/datalad/datalad/tests/utils.py\", line 806, in newfunc\r\n    return func(*args, **kwargs)\r\n  File \"/home/yoh/proj/datalad/datalad/datalad/tests/utils.py\", line 458, in newfunc\r\n    return t(*(arg + (d,)), **kw)\r\n  File \"/home/yoh/proj/datalad/datalad/datalad/metadata/tests/test_base.py\", line 143, in test_aggregation\r\n    assert_raises(InsufficientArgumentsError, aggregate_metadata, None)\r\nAssertionError: InsufficientArgumentsError not raised\r\n\r\n----------------------------------------------------------------------\r\nRan 4 tests in 38.003s\r\n\r\nFAILED (errors=1, failures=3)\r\nWRAPT_DISABLE_EXTENSIONS=1 DATALAD_TESTS_SSH=1 python -m nose -s -v      14.67s user 6.75s system 54% cpu 39.360 total\r\n```\r\nWas testing bleeding edge annex, but got the same errors even when downgraded... I guess they need to become a bit more robust (unlikely to be my git/annex configuration issue, but could be)", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/1908/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/1908/timeline", "performed_via_github_app": null}