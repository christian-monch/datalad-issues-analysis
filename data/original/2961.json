{"url": "https://api.github.com/repos/datalad/datalad/issues/2961", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/2961/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/2961/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/2961/events", "html_url": "https://github.com/datalad/datalad/issues/2961", "id": 375276219, "node_id": "MDU6SXNzdWUzNzUyNzYyMTk=", "number": 2961, "title": "realpath'ing Repo path -vs- ok_file_under_git", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-10-30T00:59:38Z", "updated_at": "2018-11-08T14:08:42Z", "closed_at": "2018-11-08T14:08:42Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Originally ran into within https://github.com/datalad/datalad/pull/2898 ([failed travis run](https://travis-ci.org/datalad/datalad/jobs/442291459)), not sure how it didn't float up before (at least for me):  \r\nin [GitRepo._flyweight_id_from_args](https://github.com/datalad/datalad/blob/master/datalad/support/gitrepo.py#L576) we realpath'ing every path so any repository's path is the realpath (although we do have `.realpath` for that purpose).  But in other spots (like `ok_file_under_git`) we seems to not do that at causes incorrect assessment.  Here are examples in both DataLad proper and the -revolution one:\r\n\r\n```shell\r\n$> python -c 'from datalad.support.gitrepo import GitRepo; p=\"/var/tmp/sym link/datalad_temp_tree_wrappedVlKRSJ/ds-clone\"; print(GitRepo(p)); from datalad.tests.utils import ok_file_under_git; ok_file_under_git(p + \"/in-annex\", annexed=True)' \r\n<GitRepo path=/tmp/datalad_temp_tree_wrappedVlKRSJ/ds-clone (<class 'datalad.support.gitrepo.GitRepo'>)>\r\nTraceback (most recent call last):\r\n  File \"<string>\", line 1, in <module>\r\n  File \"/home/yoh/proj/datalad/datalad-master/datalad/tests/utils.py\", line 226, in ok_file_under_git\r\n    assert_in(file_repo_path, repo.get_indexed_files())  # file is known to Git\r\n  File \"/usr/lib/python2.7/unittest/case.py\", line 804, in assertIn\r\n    self.fail(self._formatMessage(msg, standardMsg))\r\n  File \"/usr/lib/python2.7/unittest/case.py\", line 410, in fail\r\n    raise self.failureException(msg)\r\nAssertionError: '../../../var/tmp/sym link/datalad_temp_tree_wrappedVlKRSJ/ds-clone/in-annex' not found in [u'.gitattributes', u'.datalad/.gitattributes', u'in-annex', u'.datalad/config', u'in-git']\r\n(dev) 1 14949 ->1.....................................:Mon 29 Oct 2018 08:35:53 PM EDT:.\r\n(git)hopa:~datalad/datalad-revolution[master]git\r\n$> python -c 'from datalad_revolution.gitrepo import RevolutionGitRepo as GitRepo; p=\"/var/tmp/sym link/datalad_temp_tree_wrappedVlKRSJ/ds-clone\"; print(GitRepo(p)); from datalad.tests.utils import ok_file_under_git; ok_file_under_git(p + \"/in-annex\", annexed=True)'             \r\n<GitRepo path=/tmp/datalad_temp_tree_wrappedVlKRSJ/ds-clone (<class 'datalad_revolution.gitrepo.RevolutionGitRepo'>)>\r\nTraceback (most recent call last):\r\n  File \"<string>\", line 1, in <module>\r\n  File \"/home/yoh/proj/datalad/datalad-master/datalad/tests/utils.py\", line 226, in ok_file_under_git\r\n    assert_in(file_repo_path, repo.get_indexed_files())  # file is known to Git\r\n  File \"/usr/lib/python2.7/unittest/case.py\", line 804, in assertIn\r\n    self.fail(self._formatMessage(msg, standardMsg))\r\n  File \"/usr/lib/python2.7/unittest/case.py\", line 410, in fail\r\n    raise self.failureException(msg)\r\nAssertionError: '../../../var/tmp/sym link/datalad_temp_tree_wrappedVlKRSJ/ds-clone/in-annex' not found in [u'.gitattributes', u'.datalad/.gitattributes', u'in-annex', u'.datalad/config', u'in-git']\r\n```\r\n\r\nQuick solution of ok_file_under_git adjustment would be ok, but I am not sure if that would be the \"correct\" one...", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/2961/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/2961/timeline", "performed_via_github_app": null}