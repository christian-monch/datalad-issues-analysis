{"url": "https://api.github.com/repos/datalad/datalad/issues/2855", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/2855/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/2855/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/2855/events", "html_url": "https://github.com/datalad/datalad/issues/2855", "id": 362247343, "node_id": "MDU6SXNzdWUzNjIyNDczNDM=", "number": 2855, "title": "publish crashes with confusing exception when does not find remote branch name", "user": {"login": "chrispycheng", "id": 27905281, "node_id": "MDQ6VXNlcjI3OTA1Mjgx", "avatar_url": "https://avatars.githubusercontent.com/u/27905281?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chrispycheng", "html_url": "https://github.com/chrispycheng", "followers_url": "https://api.github.com/users/chrispycheng/followers", "following_url": "https://api.github.com/users/chrispycheng/following{/other_user}", "gists_url": "https://api.github.com/users/chrispycheng/gists{/gist_id}", "starred_url": "https://api.github.com/users/chrispycheng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chrispycheng/subscriptions", "organizations_url": "https://api.github.com/users/chrispycheng/orgs", "repos_url": "https://api.github.com/users/chrispycheng/repos", "events_url": "https://api.github.com/users/chrispycheng/events{/privacy}", "received_events_url": "https://api.github.com/users/chrispycheng/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-09-20T15:40:08Z", "updated_at": "2020-03-11T14:46:44Z", "closed_at": "2020-03-11T14:46:44Z", "author_association": "NONE", "active_lock_reason": null, "body": "#### What is the problem?\r\n\r\n```shell\r\nChriss-MacBook:nuisance chrischeng$ datalad publish -r --to=origin\r\n[INFO   ] Publishing <Dataset path=/Users/chrischeng/nuisance/data/extractions> to origin \r\npublish(ok): data/extractions (dataset) [pushed to origin: ['b145a90..9f9a005', 'a3bcdd1..3ac0a6c']]\r\npublish(notneeded): data/QA/derivatives/mriqc (dataset)\r\n[ERROR  ] sequence item 1: expected str instance, NoneType found [publish.py:has_diff:93] (TypeError) \r\nChriss-MacBook:nuisance chrischeng$ datalad --dbg publish -r --to=origin\r\npublish(notneeded): data/extractions (dataset)\r\npublish(notneeded): data/QA/derivatives/mriqc (dataset)\r\nTraceback (most recent call last):\r\n  File \"/anaconda3/bin/datalad\", line 8, in <module>\r\n    main()\r\n  File \"/anaconda3/lib/python3.6/site-packages/datalad/cmdline/main.py\", line 495, in main\r\n    ret = cmdlineargs.func(cmdlineargs)\r\n  File \"/anaconda3/lib/python3.6/site-packages/datalad/interface/base.py\", line 628, in call_from_parser\r\n    ret = list(ret)\r\n  File \"/anaconda3/lib/python3.6/site-packages/datalad/interface/utils.py\", line 422, in generator_func\r\n    result_renderer, result_xfm, _result_filter, **_kwargs):\r\n  File \"/anaconda3/lib/python3.6/site-packages/datalad/interface/utils.py\", line 491, in _process_results\r\n    for res in results:\r\n  File \"/anaconda3/lib/python3.6/site-packages/datalad/distribution/publish.py\", line 824, in __call__\r\n    **res_kwargs):\r\n  File \"/anaconda3/lib/python3.6/site-packages/datalad/distribution/publish.py\", line 313, in _publish_dataset\r\n    diff = True if force else has_diff(ds, refspec, remote, paths)\r\n  File \"/anaconda3/lib/python3.6/site-packages/datalad/distribution/publish.py\", line 93, in has_diff\r\n    remote_ref = '/'.join((remote, remote_branch_name))\r\nTypeError: sequence item 1: expected str instance, NoneType found\r\n\r\n> /anaconda3/lib/python3.6/site-packages/datalad/distribution/publish.py(93)has_diff()\r\n-> remote_ref = '/'.join((remote, remote_branch_name))\r\n(Pdb) p remote\r\n'origin'\r\n(Pdb) p remote_branch_name\r\nNone\r\n(Pdb) ups # some number of them\r\n(Pdb) p ds\r\n<Dataset path=/Users/chrischeng/nuisance/data/QA>\r\n(Pdb) p remote_info\r\n{'remote': 'origin'}\r\n[1]+  Stopped                 datalad --dbg publish -r --to=origin\r\n```\r\nbut cannot see the difference between super and that sub dataset config which should matter\r\n```shell\r\nChriss-MacBook:nuisance chrischeng$ cat .git/config \r\n[core]\r\n\trepositoryformatversion = 0\r\n\tfilemode = true\r\n\tbare = false\r\n\tlogallrefupdates = true\r\n\tignorecase = true\r\n\tprecomposeunicode = true\r\n[remote \"origin\"]\r\n\turl = chrispycheng@smaug:proj/nuisance\r\n\tfetch = +refs/heads/*:refs/remotes/origin/*\r\n\tannex-uuid = eadaaee6-cf06-4f29-b8e7-2c80ff44d5d4\r\n[branch \"master\"]\r\n\tremote = origin\r\n\tmerge = refs/heads/master\r\n[annex]\r\n\tuuid = 185654ce-4e1d-4cad-bac0-952734113227\r\n\tversion = 5\r\n[submodule \"data/QA\"]\r\n\tactive = true\r\n\turl = http://datasets.datalad.org/dbic/QA/.git\r\n[submodule \"data/extractions\"]\r\n\turl = chrispycheng@smaug:proj/nuisance/data/extractions\r\n\tactive = true\r\nChriss-MacBook:nuisance chrischeng$ cat data/QA/.git/config \r\n[core]\r\n\trepositoryformatversion = 0\r\n\tfilemode = true\r\n\tbare = false\r\n\tlogallrefupdates = true\r\n\tignorecase = true\r\n\tprecomposeunicode = true\r\n[remote \"origin\"]\r\n\turl = chrispycheng@smaug:proj/nuisance/data/QA\r\n\tfetch = +refs/heads/*:refs/remotes/origin/*\r\n\tannex-uuid = 12c6c7d9-ca30-4d63-b7d2-8a52b740f64e\r\n[branch \"master\"]\r\n\tremote = origin\r\n\tmerge = refs/heads/master\r\n[annex]\r\n\tuuid = f4ebf7b1-8f28-471e-a052-d714e0bac946\r\n\tversion = 5\r\n[submodule \"derivatives/mriqc\"]\r\n\tactive = true\r\n\turl = chrispycheng@smaug:proj/nuisance/data/QA/derivatives/mriqc\r\n[remote \"datasets.datalad.org\"]\r\n\turl = http://datasets.datalad.org/dbic/QA/.git\r\n\tfetch = +refs/heads/*:refs/remotes/datasets.datalad.org/*\r\n\tannex-bare = false\r\n\tannex-uuid = 7d9ed214-3e5f-4cc8-ac88-f397145b2d4c\r\n```\r\n\r\ndatalad 0.10.3.1 with wtf\r\n```\r\n# WTF\r\n- path: /Users/chrischeng/nuisance\r\n- type: dataset\r\n- logger: <Logger datalad.plugin.wtf (INFO)>\r\n## configuration <SENSITIVE, report disabled by configuration>\r\n## datalad \r\n  - full_version: 0.10.3.1\r\n  - version: 0.10.3.1\r\n## dataset \r\n  - metadata: <SENSITIVE, report disabled by configuration>\r\n  - path: /Users/chrischeng/nuisance\r\n  - repo: AnnexRepo\r\n## dependencies \r\n  - appdirs: 1.4.3\r\n  - boto: 2.48.0\r\n  - cmd:annex: 6.20180427\r\n  - cmd:git: 2.16.3\r\n  - cmd:system-git: 2.16.3\r\n  - cmd:system-ssh: 7.4p1\r\n  - git: 2.1.11\r\n  - gitdb: 2.0.4\r\n  - humanize: 0.5.1\r\n  - iso8601: 0.1.12\r\n  - msgpack: 0.5.6\r\n  - requests: 2.18.4\r\n  - six: 1.10.0\r\n  - tqdm: 4.26.0\r\n  - wrapt: 1.10.11\r\n## environment \r\n  - LANG: en_US.UTF-8\r\n  - PATH: /anaconda3/bin:/opt/local/bin:/opt/local/sbin:/Library/Frameworks/Python.framework/Versions/3.6/bin:/anaconda/bin:/Library/Frameworks/Python.framework/Versions/3.6/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/opt/X11/bin:/usr/local/MacGPG2/bin\r\n## extentions \r\n## metadata_extractors \r\n  - annex: \r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.annex\r\n    - version: None\r\n  - audio: \r\n    - load_error: No module named 'mutagen' [audio.py:<module>:17]\r\n    - module: datalad.metadata.extractors.audio\r\n  - datacite: \r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.datacite\r\n    - version: None\r\n  - datalad_core: \r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.datalad_core\r\n    - version: None\r\n  - datalad_rfc822: \r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.datalad_rfc822\r\n    - version: None\r\n  - exif: \r\n    - load_error: No module named 'exifread' [exif.py:<module>:16]\r\n    - module: datalad.metadata.extractors.exif\r\n  - frictionless_datapackage: \r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.frictionless_datapackage\r\n    - version: None\r\n  - image: \r\n    - load_error: None\r\n    - module: datalad.metadata.extractors.image\r\n    - version: None\r\n  - xmp: \r\n    - load_error: No module named 'libxmp' [xmp.py:<module>:20]\r\n    - module: datalad.metadata.extractors.xmp\r\n## system \r\n  - distribution:  10.12.6/x86_64\r\n  - encoding: \r\n    - default: utf-8\r\n    - filesystem: utf-8\r\n    - locale.prefered: UTF-8\r\n  - max_path_length: 282\r\n  - name: Darwin\r\n  - release: 16.7.0\r\n  - type: posix\r\n  - version: Darwin Kernel Version 16.7.0: Thu Jun 15 17:36:27 PDT 2017; root:xnu-3789.70.16~2/RELEASE_X86_64\r\n```", "closed_by": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/2855/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/2855/timeline", "performed_via_github_app": null}