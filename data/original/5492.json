{"url": "https://api.github.com/repos/datalad/datalad/issues/5492", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/5492/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/5492/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/5492/events", "html_url": "https://github.com/datalad/datalad/pull/5492", "id": 830595683, "node_id": "MDExOlB1bGxSZXF1ZXN0NTkyMDk3NzA1", "number": 5492, "title": "run: Don't remove leading empty directory when removing outputs", "user": {"login": "kyleam", "id": 1297788, "node_id": "MDQ6VXNlcjEyOTc3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1297788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kyleam", "html_url": "https://github.com/kyleam", "followers_url": "https://api.github.com/users/kyleam/followers", "following_url": "https://api.github.com/users/kyleam/following{/other_user}", "gists_url": "https://api.github.com/users/kyleam/gists{/gist_id}", "starred_url": "https://api.github.com/users/kyleam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kyleam/subscriptions", "organizations_url": "https://api.github.com/users/kyleam/orgs", "repos_url": "https://api.github.com/users/kyleam/repos", "events_url": "https://api.github.com/users/kyleam/events{/privacy}", "received_events_url": "https://api.github.com/users/kyleam/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-03-12T22:41:43Z", "updated_at": "2021-03-16T18:05:26Z", "closed_at": "2021-03-16T18:04:56Z", "author_association": "MEMBER", "active_lock_reason": null, "pull_request": {"url": "https://api.github.com/repos/datalad/datalad/pulls/5492", "html_url": "https://github.com/datalad/datalad/pull/5492", "diff_url": "https://github.com/datalad/datalad/pull/5492.diff", "patch_url": "https://github.com/datalad/datalad/pull/5492.patch"}, "body": "If outputs aren't present (and thus can't be unlocked), run() removes\r\nthem so that the command doesn't need to provide special handling of\r\nannex links.  This is done with `datalad remove`, which calls git-rm\r\nunderneath. `git rm path/to/file` deletes the leading directories when\r\nthey are otherwise empty.\r\n\r\nThat behavior can be surprising for commands that don't ensure\r\noutputs' directories exist.  Instead unlink the file directly so\r\nleading empty directories stick around.  Unlike git-rm, this doesn't\r\nremove the file from the index, but the end result is the same after\r\nthe save (even if the command ends up not recreating the output).\r\n\r\nNote, however, that ideally commands should be written to not assume\r\nthat the output directory exists in HEAD's tree.  This makes them\r\nbetter suited to be used outside the context of the current tree\r\n(e.g., `rerun --onto`), where an output's directory of course may be\r\npruned because the checked out tree doesn't include any tracked files\r\nunder an output's directory.\r\n\r\nCloses #5486.\r\n\r\n---\r\n\r\nOpened against master due to the result record changes.\r\n", "closed_by": {"login": "kyleam", "id": 1297788, "node_id": "MDQ6VXNlcjEyOTc3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1297788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kyleam", "html_url": "https://github.com/kyleam", "followers_url": "https://api.github.com/users/kyleam/followers", "following_url": "https://api.github.com/users/kyleam/following{/other_user}", "gists_url": "https://api.github.com/users/kyleam/gists{/gist_id}", "starred_url": "https://api.github.com/users/kyleam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kyleam/subscriptions", "organizations_url": "https://api.github.com/users/kyleam/orgs", "repos_url": "https://api.github.com/users/kyleam/repos", "events_url": "https://api.github.com/users/kyleam/events{/privacy}", "received_events_url": "https://api.github.com/users/kyleam/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/5492/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/5492/timeline", "performed_via_github_app": null}