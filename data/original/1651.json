{"url": "https://api.github.com/repos/datalad/datalad/issues/1651", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/1651/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/1651/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/1651/events", "html_url": "https://github.com/datalad/datalad/issues/1651", "id": 244767692, "node_id": "MDU6SXNzdWUyNDQ3Njc2OTI=", "number": 1651, "title": "add fails to add unlocked file which now would need to go to git if was added anew", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 63778590, "node_id": "MDU6TGFiZWw2Mzc3ODU5MA==", "url": "https://api.github.com/repos/datalad/datalad/labels/severity-normal", "name": "severity-normal", "color": "ff8888", "default": false, "description": "standard severity"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2017-07-21T19:55:14Z", "updated_at": "2018-11-27T03:26:35Z", "closed_at": "2018-11-27T03:26:35Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "so there is a change of .gitattributes interim:\r\n```\r\nyoh@hopa:~> datalad create /tmp/testunlock\r\n[INFO   ] Creating a new annex repo at /tmp/testunlock \r\ncreate(ok): /tmp/testunlock (dataset)                                                                           \r\n\r\nyoh@hopa:~> cd /tmp/testunlock\r\n\r\nyoh@hopa:/tmp/testunlock> echo 123 > 123\r\n\r\nyoh@hopa:/tmp/testunlock> datalad add 123\r\nadd(ok): /tmp/testunlock/123 (file)                                                                             \r\nsave(ok): /tmp/testunlock (dataset)\r\naction summary:\r\n  add (ok: 1)\r\n  save (ok: 1)\r\n\r\nyoh@hopa:/tmp/testunlock> datalad unlock 123\r\nunlock(ok): 123 (file)\r\n\r\nyoh@hopa:/tmp/testunlock> datalad add 123\r\nadd(ok): /tmp/testunlock/123 (file)                                                                             \r\nsave(notneeded): /tmp/testunlock (dataset)\r\naction summary:\r\n  add (ok: 1)\r\n  save (notneeded: 1)\r\n\r\nyoh@hopa:/tmp/testunlock> datalad unlock 123\r\nunlock(ok): 123 (file)\r\n\r\nyoh@hopa:/tmp/testunlock> cat .gitattributes\r\n* annex.backend=MD5E\r\n\r\n*yoh@hopa:/tmp/testunlock> echo '* annex.largefiles=(not(mimetype=text/*' >> .gitattributes\r\n\r\nyoh@hopa:/tmp/testunlock> datalad save -m 'all text files go to git' .gitattributes\r\nsave(ok): /tmp/testunlock (dataset)                                                                             \r\n\r\nyoh@hopa:/tmp/testunlock> datalad unlock 123\r\n\r\nyoh@hopa:/tmp/testunlock> datalad add 123\r\nadd(ok): /tmp/testunlock/123 (file) [non-large file; adding content to git repository]                          \r\nadd(ok): /tmp/testunlock/123 (file) [non-large file; adding content to git repository]\r\nFailed to run ['git', '-c', 'receive.autogc=0', '-c', 'gc.auto=0', 'commit', '-m', '[DATALAD] added content', u'123'] under '/tmp/testunlock'. Exit code=1. out= err=git-annex: Cannot make a partial commit with unlocked annexed files. You should `git annex add` the files you want to commit, and then run git commit.\r\ngit-annex: Cannot make a partial commit with unlocked annexed files. You should `git annex add` the files you want to commit, and then run git commit.\r\n\r\nyoh@hopa:/tmp/testunlock> datalad add 123\r\nadd(notneeded): /tmp/testunlock/123 (file) [already included in the dataset]\r\nsave(ok): /tmp/testunlock (dataset)\r\naction summary:\r\n  add (notneeded: 1)\r\n  save (ok: 1)\r\n\r\nyoh@hopa:/tmp/testunlock> git status\r\nOn branch master\r\nnothing to commit, working tree clean\r\n\r\nyoh@hopa:/tmp/testunlock> ls -l 123\r\n4 lrwxrwxrwx 1 yoh yoh 108 Jul 21 15:52 123 -> .git/annex/objects/pF/Zf/MD5E-s4--ba1f2511fc30423bdbb183fe33f3dd0f/MD5E-s4--ba1f2511fc30423bdbb183fe33f3dd0f\r\n```", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/1651/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/1651/timeline", "performed_via_github_app": null}