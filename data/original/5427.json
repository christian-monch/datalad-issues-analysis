{"url": "https://api.github.com/repos/datalad/datalad/issues/5427", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/5427/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/5427/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/5427/events", "html_url": "https://github.com/datalad/datalad/issues/5427", "id": 811946698, "node_id": "MDU6SXNzdWU4MTE5NDY2OTg=", "number": 5427, "title": "Crawling with datalad on public s3 bucket point to `addurl` error", "user": {"login": "htwangtw", "id": 13743617, "node_id": "MDQ6VXNlcjEzNzQzNjE3", "avatar_url": "https://avatars.githubusercontent.com/u/13743617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/htwangtw", "html_url": "https://github.com/htwangtw", "followers_url": "https://api.github.com/users/htwangtw/followers", "following_url": "https://api.github.com/users/htwangtw/following{/other_user}", "gists_url": "https://api.github.com/users/htwangtw/gists{/gist_id}", "starred_url": "https://api.github.com/users/htwangtw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/htwangtw/subscriptions", "organizations_url": "https://api.github.com/users/htwangtw/orgs", "repos_url": "https://api.github.com/users/htwangtw/repos", "events_url": "https://api.github.com/users/htwangtw/events{/privacy}", "received_events_url": "https://api.github.com/users/htwangtw/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 22, "created_at": "2021-02-19T11:31:26Z", "updated_at": "2021-10-01T21:48:49Z", "closed_at": "2021-02-26T15:08:11Z", "author_association": "NONE", "active_lock_reason": null, "body": "Datalad version: 0.14.0\r\nSystem distribution: debian/10.8\r\nPython version: 3.7.3\r\n\r\nI tried to crawl the enhanced NKI-Rockland sample with the instructions in [this post on Neurostars] (https://neurostars.org/t/how-to-crawl-with-datalad/2754) but it was unsuccessful. I also tried two other option.\r\nThe successful one isn't really doing what I want.\r\n\r\nI was stuck with the following warning: \r\n```\r\n$ datalad crawl-init --save --template=simple_s3 bucket=fcp-indi prefix=data/Projects/RocklandSample/RawDataBIDSLatest/ exclude=derivatives\r\n$ datalad crawl\r\n[WARNING] Caught AnnexBatchCommandError: 'addurl' [Error, annex reported failure for addurl (url='s3://fcp-indi/data/Projects/RocklandSample/RawDataBIDSLatest/.bidsignore?versionId=U2ydFcRBZRBGbEPlqI_LvizDj50Syp7j'): {'command': 'addurl', 'success': False, 'error-messages': [''], 'file': '.bidsignore'}] [annexrepo.py:add_url_to_file:2117] on trial #1. Sleeping 3.000000 and retrying \r\n```\r\nIf I use `add-urls`, I encounter the same `AnnexBatchCommandError`. The difference is that, instead of stuck with rerun attempts and labeled as __Warning__, it's just an error and the operation fails. \r\n\r\nContent of my `URL-FILE`:\r\n```\r\nbidsroot   subject   filename   ext\r\ns3://fcp-indi/data/Projects/RocklandSample/RawDataBIDSLatest   sub-A00010893   sub-A00010893_sessions   tsv\r\n```\r\nCommand and trimmed output:\r\n```\r\n$ datalad -l debug addurls ../sub-A00010893_table.tsv '{bidsroot}' '{subject}/{filename}.{ext}'\r\n...\r\n[DEBUG  ] Adding URLs to sub-A00010893/ses-BAS1/func/sub-A00010893_ses-BAS1_task-CHECKERBOARD_acq-1400RR_bold.json in /home/user/projects/testds                                                                                                                                                  \r\n[DEBUG  ] Initiating a new process for BatchedAnnex(cmd=<<['git', 'annex++70 chars++ch']>>, output_proc=<function>, path='/home/user/projects/testds')                                                                                                                                            \r\naddurls(error): /home/user/projects/testds/sub-A00010893/ses-BAS1/func/sub-A00010893_ses-BAS1_task-CHECKERBOARD_acq-1400RR_bold.json (file) [AnnexBatchCommandError: 'addurl' [Error, annex reported failure for addurl (url='s3://fcp-indi/data/Projects/RocklandSample/RawDataBIDSLatest'): {'command': 'addurl', 'success': False, 'error-messages': [''], 'file': 'sub-A00010893/ses-BAS1/func/sub-A00010893_ses-BAS1_task-CHECKERBOARD_acq-1400RR_bold.json'}] [annexrepo.py:add_url_to_file:2117]]\r\n```\r\n\r\nHowever, if I use `download-url` command on some files in the same bucket, I can download the file along with a confusing error message _after_ a successful download. Most important of all, I don't want to download all the files for data curation.\r\n```\r\n$ datalad -l debug download-url s3://fcp-indi/data/Projects/RocklandSample/RawDataBIDSLatest/sub-A00010893/sub-A00010893_sessions.tsv .\r\n...\r\n[INFO   ] S3 session: Connecting to the bucket fcp-indi anonymously \r\ndownload_url(ok): /home/user/projects/testds/sub-A00010893_sessions.tsv (file)                                                                  \r\n[DEBUG  ] Initializing default provider for  \r\n[DEBUG  ] No dedicated provider, returning default one for : Provider(authenticator=None, credential=None, name='', url_res=['://.*']) \r\ndownload_url(error): /home/user/projects/testds/ (file) [Do not know how to handle url . for scheme . Known: dict_keys(['http', 'https', 'shub', 'ftp', 's3']) [providers.py:_get_downloader_class:125]]\r\n```\r\n\r\nIf similar probelm has been addressed, please feel free to point me to the related discussion.\r\nThank you.", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/5427/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/5427/timeline", "performed_via_github_app": null}