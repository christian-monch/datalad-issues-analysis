{"url": "https://api.github.com/repos/datalad/datalad/issues/3825", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/3825/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/3825/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/3825/events", "html_url": "https://github.com/datalad/datalad/issues/3825", "id": 510664659, "node_id": "MDU6SXNzdWU1MTA2NjQ2NTk=", "number": 3825, "title": "addurls from S3 with multiple subdatasets", "user": {"login": "TobiasKadelka", "id": 49553687, "node_id": "MDQ6VXNlcjQ5NTUzNjg3", "avatar_url": "https://avatars.githubusercontent.com/u/49553687?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TobiasKadelka", "html_url": "https://github.com/TobiasKadelka", "followers_url": "https://api.github.com/users/TobiasKadelka/followers", "following_url": "https://api.github.com/users/TobiasKadelka/following{/other_user}", "gists_url": "https://api.github.com/users/TobiasKadelka/gists{/gist_id}", "starred_url": "https://api.github.com/users/TobiasKadelka/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TobiasKadelka/subscriptions", "organizations_url": "https://api.github.com/users/TobiasKadelka/orgs", "repos_url": "https://api.github.com/users/TobiasKadelka/repos", "events_url": "https://api.github.com/users/TobiasKadelka/events{/privacy}", "received_events_url": "https://api.github.com/users/TobiasKadelka/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 440544386, "node_id": "MDU6TGFiZWw0NDA1NDQzODY=", "url": "https://api.github.com/repos/datalad/datalad/labels/fix-implemented", "name": "fix-implemented", "color": "0e8a16", "default": false, "description": "A fix is available, but has not been merged or released, yet."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-10-22T13:41:18Z", "updated_at": "2020-10-07T13:45:21Z", "closed_at": "2020-10-07T13:45:21Z", "author_association": "NONE", "active_lock_reason": null, "body": "The objective is to turn an S3 bucket into a hierarchy of datasets. The concrete use case is the HCP dataset. We have a complete table of the entire S3 bucket in the format that `addurls` needs. Example:\r\n\r\n```\r\noriginal_url,subject,filename,version\r\ns3://hcp-openaccess/HCP_1200/100206/.xdlm/100206_3T_Diffusion_unproc.json,100206,.xdlm/100206_3T_Diffusion_unproc.json,uh5tsBjch2PHXfhjMv_V.uYo2VkIdFIu\r\n```\r\n\r\nThe corresponding `addurls` call would be:\r\n\r\n```\r\ndatalad addurls $2 '{original_url}' '{subject}//{filename}'\r\n```\r\n\r\nwhen executed like this, the command fails with:\r\n\r\n```\r\naddurls(error): /data/BnB_USER/Kadelka/next_HCP/HCP/100206/.xdlm/100206_3T_Diffusion_unproc.json (file) [AnnexBatchCommandError: command 'addurl'\r\nError, annex reported failure for addurl (url='s3://hcp-openaccess/HCP_1200/100206/.xdlm/100206_3T_Diffusion_unproc.json'): {'file': '.xdlm/100206_3T_Diffusion_unproc.json', 'error-messages': [], 'command': 'addurl', 'success': False} [annexrepo.py:add_url_to_file:1857]]\r\n```\r\n\r\nThis is not informative, as it does not actually communicate the error (maybe `--json-errors` is missing in the annex call. This was done using 0.12rc6).\r\n\r\nWhen the underlying `annex addurl` call is performed by hand, the error is becomes clear:\r\n\r\n```\r\n\u2771 git annex addurl s3://hcp-openaccess/HCP_1200/100206/.xdlm/100206_3T_Diffusion_unproc.json\r\naddurl s3://hcp-openaccess/HCP_1200/100206/.xdlm/100206_3T_Diffusion_unproc.json Configuration does not allow accessing s3://hcp-openaccess/HCP_1200/100206/.xdlm/100206_3T_Diffusion_unproc.json\r\n\r\ndownload failed: Configuration does not allow accessing s3://hcp-openaccess/HCP_1200/100206/.xdlm/100206_3T_Diffusion_unproc.json\r\nfailed\r\ngit-annex: addurl: 1 failed\r\n```\r\n\r\nWhat is missing is the `datalad` special remote. It would be good, if this would be clear from DataLad's original error message.\r\n\r\nThanks", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/3825/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/3825/timeline", "performed_via_github_app": null}