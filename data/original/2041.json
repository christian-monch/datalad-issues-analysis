{"url": "https://api.github.com/repos/datalad/datalad/issues/2041", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/2041/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/2041/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/2041/events", "html_url": "https://github.com/datalad/datalad/issues/2041", "id": 282666510, "node_id": "MDU6SXNzdWUyODI2NjY1MTA=", "number": 2041, "title": "attemp to kill datalad process results in breeding git <defunct> processes", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-12-17T03:12:59Z", "updated_at": "2020-11-11T07:16:41Z", "closed_at": "2020-11-11T07:16:40Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "#### What is the problem?\r\nAs reported in #2036 aggregate-metadata got stuck, decided to Ctrl-C it but it keeps \"resisting\" -- doesn't quit:\r\n\r\n```\r\nException ignored in: <bound method AnnexRepo.__del__ of <AnnexRepo path=/etc (<class 'datalad.support.annexrepo.AnnexRepo'>)>>\r\nTraceback (most recent call last):\r\n  File \"/home/yoh/proj/datalad/datalad-master/datalad/support/annexrepo.py\", line 323, in __del__\r\n\r\n\r\n\r\n^C^CException ignored in: <bound method GitRepo.__del__ of <GitRepo path=/home/yoh/proj/datalad/datalad-master (<class 'datalad.support.gitrepo.GitRepo'>)>>\r\nTraceback (most recent call last):\r\n  File \"/home/yoh/proj/datalad/datalad-master/datalad/support/gitrepo.py\", line 732, in __del__\r\n    if hasattr(self, 'repo') and exists(self.path) \\\r\n  File \"/home/yoh/proj/datalad/datalad-master/datalad/support/gitrepo.py\", line 618, in repo\r\n    self._repo = self.cmd_call_wrapper(Repo, self.path)\r\n  File \"/home/yoh/proj/datalad/datalad-master/datalad/cmd.py\", line 134, in __call__\r\n    return self.call(cmd, *args, **kwargs)\r\n  File \"/home/yoh/proj/datalad/datalad-master/datalad/cmd.py\", line 492, in call\r\n    return f(*args, **kwargs)\r\n  File \"/home/yoh/proj/datalad/datalad-master/datalad/support/gitrepo.py\", line 387, in Repo\r\n    return gitpy.Repo(*args, **kwargs)\r\n  File \"/home/yoh/proj/datalad/datalad-master/venvs/dev3/lib/python3.5/site-packages/git/repo/base.py\", line 165, in __init__\r\n    self._bare = self.config_reader(\"repository\").getboolean('core', 'bare')\r\n  File \"/home/yoh/proj/datalad/datalad-master/venvs/dev3/lib/python3.5/site-packages/git/config.py\", line 78, in assure_data_present\r\n    self.read()\r\n  File \"/home/yoh/proj/datalad/datalad-master/venvs/dev3/lib/python3.5/site-packages/git/config.py\", line 404, in read\r\n    with open(file_path, 'rb') as fp:\r\n  File \"/home/yoh/proj/datalad/datalad-master/datalad/auto.py\", line 165, in _proxy_open\r\n    *args, **kwargs)\r\n  File \"/home/yoh/proj/datalad/datalad-master/datalad/auto.py\", line 149, in _proxy_open_name_mode\r\n    self._dataset_auto_get(file)\r\n  File \"/home/yoh/proj/datalad/datalad-master/datalad/auto.py\", line 205, in _dataset_auto_get\r\n    annex = get_repo_instance(filedir)\r\n  File \"/home/yoh/proj/datalad/datalad-master/datalad/cmdline/helpers.py\", line 229, in get_repo_instance\r\n    return AnnexRepo(dir_, create=False)\r\n  File \"/home/yoh/proj/datalad/datalad-master/datalad/support/repo.py\", line 146, in __call__\r\n    instance = type.__call__(cls, *new_args, **new_kwargs)\r\n  File \"/home/yoh/proj/datalad/datalad-master/datalad/support/annexrepo.py\", line 190, in __init__\r\n    for r in self.get_remotes():\r\n  File \"/home/yoh/proj/datalad/datalad-master/datalad/support/annexrepo.py\", line 933, in get_remotes\r\n    remotes = super(AnnexRepo, self).get_remotes(with_urls_only=with_urls_only)\r\n  File \"/home/yoh/proj/datalad/datalad-master/datalad/support/gitrepo.py\", line 1248, in get_remotes\r\n    self.config.reload()\r\n  File \"/home/yoh/proj/datalad/datalad-master/datalad/support/gitrepo.py\", line 773, in config\r\n    self._cfg = ConfigManager(dataset=self, dataset_only=False)\r\n  File \"/home/yoh/proj/datalad/datalad-master/datalad/config.py\", line 198, in __init__\r\n    self.reload(force=True)\r\n  File \"/home/yoh/proj/datalad/datalad-master/datalad/config.py\", line 252, in reload\r\n    stdout, stderr = self._run(run_args, log_stderr=True)\r\n  File \"/home/yoh/proj/datalad/datalad-master/datalad/config.py\", line 520, in _run\r\n    out = self._runner.run(['git', 'config'] + args, **kwargs)\r\n  File \"/home/yoh/proj/datalad/datalad-master/datalad/cmd.py\", line 588, in run\r\n    cmd, env=self.get_git_environ_adjusted(env), *args, **kwargs)\r\n  File \"/home/yoh/proj/datalad/datalad-master/datalad/cmd.py\", line 412, in run\r\n    stdin=stdin)\r\n  File \"/usr/lib/python3.5/subprocess.py\", line 676, in __init__\r\n    restore_signals, start_new_session)\r\n  File \"/usr/lib/python3.5/subprocess.py\", line 1244, in _execute_child\r\n    part = os.read(errpipe_read, 50000)\r\nKeyboardInterrupt:\r\n^C^CException ignored in: <bound method AnnexRepo.__del__ of <AnnexRepo path=/home/yoh/proj/datalad/datalad-master (<class 'datalad.support.annexrepo.AnnexRepo'>)>>\r\nTraceback (most recent call last):\r\n  File \"/home/yoh/proj/datalad/datalad-master/datalad/support/annexrepo.py\", line 323, in __del__\r\n    super(AnnexRepo, self).__del__()\r\n  File \"/home/yoh/proj/datalad/datalad-master/datalad/support/gitrepo.py\", line 739, in __del__\r\n    self.repo.index.write()\r\n  File \"/home/yoh/proj/datalad/datalad-master/venvs/dev3/lib/python3.5/site-packages/git/index/base.py\", line 216, in write\r\n    self._serialize(stream, ignore_extension_data)\r\n  File \"/home/yoh/proj/datalad/datalad-master/venvs/dev3/lib/python3.5/site-packages/git/index/base.py\", line 181, in _serialize\r\n    write_cache(entries, stream, extension_data)\r\n  File \"/home/yoh/proj/datalad/datalad-master/venvs/dev3/lib/python3.5/site-packages/git/index/fun.py\", line 146, in write_cache\r\n    write(path)\r\n  File \"/home/yoh/proj/datalad/datalad-master/venvs/dev3/lib/python3.5/site-packages/git/util.py\", line 708, in write\r\n    return self.f.write(data)\r\n  File \"/home/yoh/proj/datalad/datalad-master/venvs/dev3/lib/python3.5/site-packages/gitdb/stream.py\", line 695, in write\r\n    os.write(self._fd, data)\r\nKeyboardInterrupt:\r\n^C^C^C^CException ignored in: <bound method AnnexRepo.__del__ of <AnnexRepo path=/home/yoh/proj/datalad/datalad-master (<class 'datalad.support.annexrepo.AnnexRepo'>)>>\r\nTraceback (most recent call last):\r\n  File \"/home/yoh/proj/datalad/datalad-master/datalad/su....\r\n```\r\nchecking list of processes showed that there is a growing number of git processes started by this process:\r\n```shell\r\n$> ps --ppid 1323230 -p 1323230 c -f\r\nUID          PID    PPID  C STIME TTY      STAT   TIME CMD\r\nyoh      1323230 2235280 44 Dec15 pts/10   R+   785:39 datalad\r\nyoh      3232720 1323230  0 21:56 pts/10   Z+     0:00 git <defunct>\r\nyoh      3233169 1323230  0 21:56 pts/10   Z+     0:00 git <defunct>\r\nyoh      3233238 1323230  0 21:56 pts/10   Z+     0:00 git <defunct>\r\nyoh      3239231 1323230  0 21:58 pts/10   Z+     0:00 git <defunct>\r\nyoh      3239257 1323230  0 21:58 pts/10   Z+     0:00 git <defunct>\r\nyoh      3239329 1323230  0 21:58 pts/10   Z+     0:00 git <defunct>\r\nyoh      3239377 1323230  0 21:58 pts/10   Z+     0:00 git <defunct>\r\nyoh      3239478 1323230  0 21:58 pts/10   Z+     0:00 git <defunct>\r\nyoh      3265998 1323230  0 22:05 pts/10   Z+     0:00 git <defunct>\r\nyoh      3266012 1323230  0 22:05 pts/10   Z+     0:00 git <defunct>\r\nyoh      3266136 1323230  0 22:05 pts/10   Z+     0:00 git <defunct>\r\nyoh      3266739 1323230  0 22:05 pts/10   Z+     0:00 git <defunct>\r\nyoh      3266850 1323230  0 22:05 pts/10   Z+     0:00 git <defunct>\r\nyoh      3266878 1323230  0 22:05 pts/10   Z+     0:00 git <defunct>\r\nyoh      3267003 1323230  0 22:05 pts/10   Z+     0:00 git <defunct>\r\nyoh      3267063 1323230  0 22:05 pts/10   Z+     0:00 git <defunct>\r\nyoh      3267273 1323230  0 22:05 pts/10   Z+     0:00 git <defunct>\r\nyoh      3267297 1323230  0 22:05 pts/10   Z+     0:00 git <defunct>\r\nyoh      3267420 1323230  0 22:05 pts/10   Z+     0:00 git <defunct>\r\nyoh      3267479 1323230  0 22:05 pts/10   Z+     0:00 git <defunct>\r\nyoh      3267870 1323230  0 22:05 pts/10   Z+     0:00 git <defunct>\r\nyoh      3267944 1323230  0 22:05 pts/10   Z+     0:00 git <defunct>\r\nyoh      3268112 1323230  0 22:05 pts/10   Z+     0:00 git <defunct>\r\n\r\n```\r\n\r\nSure thing it must be specific to the ghosts of smaug", "closed_by": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/2041/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/2041/timeline", "performed_via_github_app": null}