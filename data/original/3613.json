{"url": "https://api.github.com/repos/datalad/datalad/issues/3613", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/3613/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/3613/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/3613/events", "html_url": "https://github.com/datalad/datalad/issues/3613", "id": 483612319, "node_id": "MDU6SXNzdWU0ODM2MTIzMTk=", "number": 3613, "title": "no annex (should be) left behind!", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 15, "created_at": "2019-08-21T19:34:26Z", "updated_at": "2019-10-21T18:01:41Z", "closed_at": "2019-10-21T16:16:46Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "I just found a busy (100-300% cpu busy) git-annex process running on smaug. That is a run away `annex get` invocation for some dataset where I guess I did `datalad get`, then interrupted (Ctrl-C), and then removed that dataset.\r\n\r\n<details>\r\n<summary>tree for that process from ps with a bunch of defunct child git processes</summary> \r\n\r\n```shell\r\n$> ps auxw -H | grep -A70 367131[2]\r\nyoh      3671312 66.7  0.2 1077111744 374584 pts/9 Sl Aug19 2074:56   /usr/lib/git-annex.linux/exe/git-annex --library-path /usr/lib/git-annex.linux//usr/lib/x86_64-linux-gnu/gconv:/usr/lib/git-annex.linux//usr/lib/x86_64-linux-gnu/audit:/usr/lib/git-annex.linux//etc/ld.so.conf.d:/usr/lib/git-annex.linux//lib64:/usr/lib/git-annex.linux//usr/lib/x86_64-linux-gnu:/usr/lib/git-annex.linux//lib/x86_64-linux-gnu: /usr/lib/git-annex.linux/shimmed/git-annex/git-annex get --json --json-progress -J8 -- .\r\nyoh      3671349  0.0  0.0      0     0 pts/9    Z    Aug19   0:00     [git] <defunct>\r\nyoh      3671350  0.0  0.0      0     0 pts/9    Z    Aug19   0:00     [git] <defunct>\r\nyoh      3671353  0.0  0.0      0     0 pts/9    Z    Aug19   0:00     [git] <defunct>\r\nyoh      3671362  0.0  0.0      0     0 pts/9    Z    Aug19   0:00     [git] <defunct>\r\nyoh      3671363  0.0  0.0      0     0 pts/9    Z    Aug19   0:00     [git] <defunct>\r\nyoh      3671364  0.0  0.0      0     0 pts/9    Z    Aug19   0:00     [git] <defunct>\r\nyoh      3671365  0.0  0.0      0     0 pts/9    Z    Aug19   0:00     [git] <defunct>\r\nyoh      3671366  0.0  0.0      0     0 pts/9    Z    Aug19   0:00     [git] <defunct>\r\nyoh      3671368  0.0  0.0      0     0 pts/9    Z    Aug19   0:00     [git] <defunct>\r\nyoh      3671369  0.0  0.0      0     0 pts/9    Z    Aug19   0:00     [git] <defunct>\r\nyoh      3671370  0.0  0.0      0     0 pts/9    Z    Aug19   0:00     [git] <defunct>\r\nyoh      3671371  0.0  0.0      0     0 pts/9    Z    Aug19   0:00     [git] <defunct>\r\nyoh      3671372  0.0  0.0      0     0 pts/9    Z    Aug19   0:00     [git] <defunct>\r\nyoh      3671373  0.0  0.0      0     0 pts/9    Z    Aug19   0:00     [git] <defunct>\r\nyoh      3671374  0.0  0.0      0     0 pts/9    Z    Aug19   0:00     [git] <defunct>\r\nyoh      3671375  0.0  0.0      0     0 pts/9    Z    Aug19   0:00     [git] <defunct>\r\nyoh      3671376  0.0  0.0      0     0 pts/9    Z    Aug19   0:00     [git] <defunct>\r\nyoh      3671377  0.0  0.0      0     0 pts/9    Z    Aug19   0:00     [git] <defunct>\r\nyoh      3671383  0.0  0.0      0     0 pts/9    Z    Aug19   0:00     [git] <defunct>\r\nyoh      3671384  0.0  0.0      0     0 pts/9    Z    Aug19   0:00     [git] <defunct>\r\nyoh      3671391  0.0  0.0      0     0 pts/9    Z    Aug19   0:00     [git] <defunct>\r\nyoh      3671392  0.0  0.0      0     0 pts/9    Z    Aug19   0:00     [git] <defunct>\r\nyoh      3671393  0.0  0.0      0     0 pts/9    Z    Aug19   0:00     [git] <defunct>\r\nyoh      3671394  0.0  0.0      0     0 pts/9    Z    Aug19   0:00     [git] <defunct>\r\nyoh      3671400  0.0  0.0      0     0 pts/9    Z    Aug19   0:00     [git] <defunct>\r\nyoh      3671401  0.0  0.0      0     0 pts/9    Z    Aug19   0:00     [git] <defunct>\r\nyoh      3671404  0.0  0.0      0     0 pts/9    Z    Aug19   0:00     [git] <defunct>\r\nyoh      3671405  0.0  0.0      0     0 pts/9    Z    Aug19   0:00     [git] <defunct>\r\nyoh      3671407  0.0  0.0      0     0 pts/9    Z    Aug19   0:00     [git] <defunct>\r\nyoh      3671409  0.0  0.0      0     0 pts/9    Z    Aug19   0:00     [git] <defunct>\r\nyoh      3671410  0.0  0.0      0     0 pts/9    Z    Aug19   0:00     [git] <defunct>\r\nyoh      3671412  0.0  0.0      0     0 pts/9    Z    Aug19   0:00     [git] <defunct>\r\nyoh      3671413  0.0  0.0      0     0 pts/9    Z    Aug19   0:00     [git] <defunct>\r\nyoh      3671418  0.0  0.0  11824   788 pts/9    S    Aug19   0:00     /usr/lib/git-annex.linux/exe/git --library-path /usr/lib/git-annex.linux//usr/lib/x86_64-linux-gnu/gconv:/usr/lib/git-annex.linux//usr/lib/x86_64-linux-gnu/audit:/usr/lib/git-annex.linux//etc/ld.so.conf.d:/usr/lib/git-annex.linux//lib64:/usr/lib/git-annex.linux//usr/lib/x86_64-linux-gnu:/usr/lib/git-annex.linux//lib/x86_64-linux-gnu: /usr/lib/git-annex.linux/shimmed/git/git --git-dir=.git --work-tree=. --literal-pathspecs cat-file --batch\r\nyoh      3671419  0.0  0.0  11824   788 pts/9    S    Aug19   0:00     /usr/lib/git-annex.linux/exe/git --library-path /usr/lib/git-annex.linux//usr/lib/x86_64-linux-gnu/gconv:/usr/lib/git-annex.linux//usr/lib/x86_64-linux-gnu/audit:/usr/lib/git-annex.linux//etc/ld.so.conf.d:/usr/lib/git-annex.linux//lib64:/usr/lib/git-annex.linux//usr/lib/x86_64-linux-gnu:/usr/lib/git-annex.linux//lib/x86_64-linux-gnu: /usr/lib/git-annex.linux/shimmed/git/git --git-dir=.git --work-tree=. --literal-pathspecs cat-file --batch\r\n\r\n```\r\n</details>\r\n\r\ncwd points to removed dataset:\r\n```shell\r\n$> ls -l /proc/3671312/cwd\r\nlrwxrwxrwx 1 yoh yoh 0 Aug 20 13:55 /proc/3671312/cwd -> /mnt/btrfs/scrap/tmp/ds002000\\ (deleted)\r\n```\r\n\r\n<details>\r\n<summary>and here is the head of strace for it</summary> \r\n\r\n```shell\r\n$> strace -f -p 3671312 2>&1 | head -n 100\r\nstrace: Process 3671312 attached with 46 threads\r\n[pid 3671417] futex(0x7fbcdc000bc8, FUTEX_WAIT_PRIVATE, 0, NULL <unfinished ...>\r\n[pid 3671416] futex(0x7fbd10000bcc, FUTEX_WAIT_PRIVATE, 0, NULL <unfinished ...>\r\n[pid 3671415] futex(0x7fbd64001168, FUTEX_WAIT_PRIVATE, 0, NULL <unfinished ...>\r\n[pid 3671414] futex(0x7fbd54003b08, FUTEX_WAIT_PRIVATE, 0, NULL <unfinished ...>\r\n[pid 3671411] futex(0x7fbcec000ba8, FUTEX_WAIT_PRIVATE, 0, NULL <unfinished ...>\r\n[pid 3671408] futex(0x7fbd84001048, FUTEX_WAIT_PRIVATE, 0, NULL <unfinished ...>\r\n[pid 3671403] futex(0x7fbd0c000ba8, FUTEX_WAIT_PRIVATE, 0, NULL <unfinished ...>\r\n[pid 3671402] futex(0x7fbd4c004ee8, FUTEX_WAIT_PRIVATE, 0, NULL <unfinished ...>\r\n[pid 3671399] restart_syscall(<... resuming interrupted poll ...> <unfinished ...>\r\n[pid 3671397] futex(0x7fbd18000bac, FUTEX_WAIT_PRIVATE, 0, NULL <unfinished ...>\r\n[pid 3671395] futex(0x7fbd38000ba8, FUTEX_WAIT_PRIVATE, 0, NULL <unfinished ...>\r\n[pid 3671388] futex(0x7fbd08000bac, FUTEX_WAIT_PRIVATE, 0, NULL <unfinished ...>\r\n[pid 3671396] futex(0x7fbd08001148, FUTEX_WAIT_PRIVATE, 0, NULL <unfinished ...>\r\n[pid 3671387] futex(0x7fbd20000bac, FUTEX_WAIT_PRIVATE, 0, NULL <unfinished ...>\r\n[pid 3671385] futex(0x7fbd1c000bac, FUTEX_WAIT_PRIVATE, 0, NULL <unfinished ...>\r\n[pid 3671381] futex(0x7fbd3c000bac, FUTEX_WAIT_PRIVATE, 0, NULL <unfinished ...>\r\n[pid 3671380] futex(0x7fbd40000ba8, FUTEX_WAIT_PRIVATE, 0, NULL <unfinished ...>\r\n[pid 3671379] futex(0x7fbd24000bcc, FUTEX_WAIT_PRIVATE, 0, NULL <unfinished ...>\r\n[pid 3671378] futex(0x7fbd34000bac, FUTEX_WAIT_PRIVATE, 0, NULL <unfinished ...>\r\n[pid 3671361] futex(0x7fbd60000ba8, FUTEX_WAIT_PRIVATE, 0, NULL <unfinished ...>\r\n[pid 3671360] futex(0x7fbd44000ba8, FUTEX_WAIT_PRIVATE, 0, NULL <unfinished ...>\r\n[pid 3671359] futex(0x7fbd70000ba8, FUTEX_WAIT_PRIVATE, 0, NULL <unfinished ...>\r\n[pid 3671358] epoll_wait(11,  <unfinished ...>\r\n[pid 3671357] futex(0x7fbd4c000ba8, FUTEX_WAIT_PRIVATE, 0, NULL <unfinished ...>\r\n[pid 3671358] <... epoll_wait resumed> [], 64, 0) = 0\r\n[pid 3671358] epoll_wait(11,  <unfinished ...>\r\n[pid 3671356] futex(0x7fbd8c000ba8, FUTEX_WAIT_PRIVATE, 0, NULL <unfinished ...>\r\n[pid 3671358] <... epoll_wait resumed> [], 64, 0) = 0\r\n[pid 3671358] epoll_wait(11,  <unfinished ...>\r\n[pid 3671355] futex(0x7fbd64000bac, FUTEX_WAIT_PRIVATE, 0, NULL <unfinished ...>\r\n[pid 3671354] futex(0x7fbd54000bac, FUTEX_WAIT_PRIVATE, 0, NULL <unfinished ...>\r\n[pid 3671346] futex(0x7fbd50000ba8, FUTEX_WAIT_PRIVATE, 0, NULL <unfinished ...>\r\n[pid 3671344] futex(0x7fbd58000ba8, FUTEX_WAIT_PRIVATE, 0, NULL <unfinished ...>\r\n[pid 3671343] epoll_wait(35,  <unfinished ...>\r\n[pid 3671342] futex(0x7fbd5c000bac, FUTEX_WAIT_PRIVATE, 0, NULL <unfinished ...>\r\n[pid 3671343] <... epoll_wait resumed> [], 64, 0) = 0\r\n[pid 3671343] epoll_wait(35, [], 64, 0) = 0\r\n[pid 3671340] futex(0x7fbd68000ba8, FUTEX_WAIT_PRIVATE, 0, NULL <unfinished ...>\r\n[pid 3671343] epoll_wait(35,  <unfinished ...>\r\n[pid 3671341] epoll_wait(31, [], 64, 0) = 0\r\n[pid 3671339] epoll_wait(27,  <unfinished ...>\r\n[pid 3671341] epoll_wait(31,  <unfinished ...>\r\n[pid 3671339] <... epoll_wait resumed> [], 64, 0) = 0\r\n[pid 3671341] <... epoll_wait resumed> [], 64, 0) = 0\r\n[pid 3671339] epoll_wait(27,  <unfinished ...>\r\n[pid 3671341] epoll_wait(31,  <unfinished ...>\r\n[pid 3671339] <... epoll_wait resumed> [], 64, 0) = 0\r\n[pid 3671339] epoll_wait(27,  <unfinished ...>\r\n[pid 3671338] epoll_wait(20,  <unfinished ...>\r\n[pid 3671337] epoll_wait(19,  <unfinished ...>\r\n[pid 3671338] <... epoll_wait resumed> [], 64, 0) = 0\r\n[pid 3671337] <... epoll_wait resumed> [], 64, 0) = 0\r\n[pid 3671338] epoll_wait(20,  <unfinished ...>\r\n[pid 3671337] epoll_wait(19,  <unfinished ...>\r\n[pid 3671338] <... epoll_wait resumed> [], 64, 0) = 0\r\n[pid 3671337] <... epoll_wait resumed> [], 64, 0) = 0\r\n[pid 3671338] epoll_wait(20,  <unfinished ...>\r\n[pid 3671337] epoll_wait(19,  <unfinished ...>\r\n[pid 3671335] futex(0x7fbd9be328a8, FUTEX_WAIT_PRIVATE, 0, NULL <unfinished ...>\r\n[pid 3671334] futex(0x7fbd80000bac, FUTEX_WAIT_PRIVATE, 0, NULL <unfinished ...>\r\n[pid 3671333] futex(0x7fbd9be32698, FUTEX_WAIT_PRIVATE, 0, NULL <unfinished ...>\r\n[pid 3671336] epoll_wait(15,  <unfinished ...>\r\n[pid 3671332] futex(0x7fbd9be32488, FUTEX_WAIT_PRIVATE, 0, NULL <unfinished ...>\r\n[pid 3671336] <... epoll_wait resumed> [], 64, 0) = 0\r\n[pid 3671336] epoll_wait(15,  <unfinished ...>\r\n[pid 3671331] futex(0x7fbd88000ba8, FUTEX_WAIT_PRIVATE, 0, NULL <unfinished ...>\r\n[pid 3671336] <... epoll_wait resumed> [], 64, 0) = 0\r\n[pid 3671329] epoll_wait(4,  <unfinished ...>\r\n[pid 3671336] epoll_wait(15,  <unfinished ...>\r\n[pid 3671329] <... epoll_wait resumed> [], 64, 0) = 0\r\n[pid 3671329] epoll_wait(4,  <unfinished ...>\r\n[pid 3671328] futex(0x7fbd9bdb74b8, FUTEX_WAIT_PRIVATE, 0, NULL <unfinished ...>\r\n[pid 3671329] <... epoll_wait resumed> [], 64, 0) = 0\r\n[pid 3671329] epoll_wait(4,  <unfinished ...>\r\n[pid 3671327] read(3,  <unfinished ...>\r\n[pid 3671312] futex(0x7fbd9bdb7398, FUTEX_WAIT_PRIVATE, 0, NULL <unfinished ...>\r\n[pid 3671327] <... read resumed> \"\\1\\0\\0\\0\\0\\0\\0\\0\", 8) = 8\r\n[pid 3671327] read(3, \"\\1\\0\\0\\0\\0\\0\\0\\0\", 8) = 8\r\n[pid 3671327] read(3, \"\\1\\0\\0\\0\\0\\0\\0\\0\", 8) = 8\r\n[pid 3671327] read(3, \"\\1\\0\\0\\0\\0\\0\\0\\0\", 8) = 8\r\n[pid 3671327] read(3, \"\\1\\0\\0\\0\\0\\0\\0\\0\", 8) = 8\r\n[pid 3671327] read(3, \"\\1\\0\\0\\0\\0\\0\\0\\0\", 8) = 8\r\n[pid 3671327] read(3, \"\\1\\0\\0\\0\\0\\0\\0\\0\", 8) = 8\r\n[pid 3671327] read(3, \"\\1\\0\\0\\0\\0\\0\\0\\0\", 8) = 8\r\n[pid 3671327] read(3, \"\\1\\0\\0\\0\\0\\0\\0\\0\", 8) = 8\r\n[pid 3671327] read(3, \"\\1\\0\\0\\0\\0\\0\\0\\0\", 8) = 8\r\n[pid 3671327] read(3, \"\\1\\0\\0\\0\\0\\0\\0\\0\", 8) = 8\r\n[pid 3671327] read(3, \"\\1\\0\\0\\0\\0\\0\\0\\0\", 8) = 8\r\n[pid 3671327] read(3, \"\\1\\0\\0\\0\\0\\0\\0\\0\", 8) = 8\r\n[pid 3671327] read(3, \"\\1\\0\\0\\0\\0\\0\\0\\0\", 8) = 8\r\n[pid 3671327] read(3, \"\\1\\0\\0\\0\\0\\0\\0\\0\", 8) = 8\r\n[pid 3671327] read(3, \"\\1\\0\\0\\0\\0\\0\\0\\0\", 8) = 8\r\n[pid 3671327] read(3, \"\\1\\0\\0\\0\\0\\0\\0\\0\", 8) = 8\r\n[pid 3671327] read(3, \"\\1\\0\\0\\0\\0\\0\\0\\0\", 8) = 8\r\n[pid 3671327] read(3, \"\\1\\0\\0\\0\\0\\0\\0\\0\", 8) = 8\r\n[pid 3671327] read(3, \"\\1\\0\\0\\0\\0\\0\\0\\0\", 8) = 8\r\n[pid 3671327] read(3, \"\\1\\0\\0\\0\\0\\0\\0\\0\", 8) = 8\r\n[pid 3671327] read(3, \"\\1\\0\\0\\0\\0\\0\\0\\0\", 8) = 8\r\n[pid 3671327] read(3, \"\\1\\0\\0\\0\\0\\0\\0\\0\", 8) = 8\r\n```\r\n</details>\r\n\r\nI wonder @joeyh -- shouldn't git annex process (eventually) die unhappily if its CWD / repo it tries to work on gets removed?\r\n\r\n<details>\r\n<summary>annex version details</summary> \r\n\r\n```shell\r\n$> git annex version\r\ngit-annex version: 7.20190730+git122-g708fc6567-1~ndall+1\r\nbuild flags: Assistant Webapp Pairing S3 WebDAV Inotify DBus DesktopNotify TorrentParser MagicMime Feeds Testsuite\r\ndependency versions: aws-0.20 bloomfilter-2.0.1.0 cryptonite-0.25 DAV-1.3.3 feed-1.0.0.0 ghc-8.4.4 http-client-0.5.13.1 persistent-sqlite-2.8.2 torrent-10000.1.1 uuid-1.3.13 yesod-1.6.0\r\nkey/value backends: SHA256E SHA256 SHA512E SHA512 SHA224E SHA224 SHA384E SHA384 SHA3_256E SHA3_256 SHA3_512E SHA3_512 SHA3_224E SHA3_224 SHA3_384E SHA3_384 SKEIN256E SKEIN256 SKEIN512E SKEIN512 BLAKE2B256E BLAKE2B256 BLAKE2B512E BLAKE2B512 BLAKE2B160E BLAKE2B160 BLAKE2B224E BLAKE2B224 BLAKE2B384E BLAKE2B384 BLAKE2BP512E BLAKE2BP512 BLAKE2S256E BLAKE2S256 BLAKE2S160E BLAKE2S160 BLAKE2S224E BLAKE2S224 BLAKE2SP256E BLAKE2SP256 BLAKE2SP224E BLAKE2SP224 SHA1E SHA1 MD5E MD5 WORM URL\r\nremote types: git gcrypt p2p S3 bup directory rsync web bittorrent webdav adb tahoe glacier ddar git-lfs hook external\r\noperating system: linux x86_64\r\nsupported repository versions: 5 7\r\nupgrade supported from repository versions: 0 1 2 3 4 5 6\r\n```\r\n</details>", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/3613/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/3613/timeline", "performed_via_github_app": null}