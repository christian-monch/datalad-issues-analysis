{"url": "https://api.github.com/repos/datalad/datalad/issues/4523", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/4523/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/4523/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/4523/events", "html_url": "https://github.com/datalad/datalad/issues/4523", "id": 617712640, "node_id": "MDU6SXNzdWU2MTc3MTI2NDA=", "number": 4523, "title": "`save` (without -r) sub-superdataset takes too long - checks its subdatasets", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 289240596, "node_id": "MDU6TGFiZWwyODkyNDA1OTY=", "url": "https://api.github.com/repos/datalad/datalad/labels/performance", "name": "performance", "color": "f4b2d8", "default": false, "description": "Improve performance of an existing feature"}], "state": "closed", "locked": false, "assignee": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2020-05-13T19:52:48Z", "updated_at": "2020-05-15T17:35:39Z", "closed_at": "2020-05-15T17:35:39Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Sorry if I have failed to find a previous issue - checked opened and some closed with `performance` but have not spotted one.\r\n\r\nUse case: `openneuro` subdataset which contains a good (>300) number of subdatasets but otherwise not burdened with too many files (about 900).  Just to save an updated state of that dataset without doing recursive save, takes over a minute.  Well -- in this case there even no updated state. I am explicitly pointing to current superdataset (`-d .`) and asking just to save possibly updated state of openneuro.  There is no `-r` : \r\n```shell\r\n$> datalad --version; time datalad save -d . -m 'there is no changes' openneuro\r\ndatalad 0.12.6\r\ndatalad save -d . -m 'there is no changes' openneuro  42.56s user 42.15s system 102% cpu 1:22.57 total\r\n\r\n$> time git -C openneuro status\r\nOn branch master\r\nnothing to commit, working tree clean\r\ngit -C openneuro status  1.71s user 3.18s system 134% cpu 3.640 total\r\n\r\n$> source ~datalad/datalad-master/venvs/dev3/bin/activate                                                                                    \r\n\r\n$> datalad --version; time datalad save -d . -m 'there is no changes' openneuro\r\ndatalad 0.13.0rc1.dev19\r\ndatalad save -d . -m 'there is no changes' openneuro  42.79s user 40.78s system 102% cpu 1:21.86 total\r\n```\r\n\r\nSo why does it need to then inspect every subdataset of the openneuro?  Here is what I see  with `-l DEBUG`:\r\n```\r\n[DEBUG  ] Done query repo: ['git', 'ls-tree', 'HEAD', '-z', '-r', '--full-tree', '-l'] \r\n[DEBUG  ] Done GitRepo(/mnt/datasets/datalad/crawl/openneuro/ds000105).get_content_info(...) \r\n[DEBUG  ] GitRepo(/mnt/datasets/datalad/crawl/openneuro/ds000107).get_content_info(...) \r\n[DEBUG  ] Query repo: ['git', 'ls-files', '--stage', '-z', '-d', '-m', '--exclude-standard', '-o'] \r\n[DEBUG  ] Done query repo: ['git', 'ls-files', '--stage', '-z', '-d', '-m', '--exclude-standard', '-o'] \r\n[DEBUG  ] Done GitRepo(/mnt/datasets/datalad/crawl/openneuro/ds000107).get_content_info(...) \r\n[DEBUG  ] GitRepo(/mnt/datasets/datalad/crawl/openneuro/ds000107).get_content_info(...) \r\n```\r\nis it something we could fix or it is just my misunderstanding again of normal `save` operation and I am missing a use-case where inspection of subdatasets would be needed for some reason?", "closed_by": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/4523/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/4523/timeline", "performed_via_github_app": null}