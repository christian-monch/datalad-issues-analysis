{"url": "https://api.github.com/repos/datalad/datalad/issues/2832", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/2832/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/2832/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/2832/events", "html_url": "https://github.com/datalad/datalad/pull/2832", "id": 360354693, "node_id": "MDExOlB1bGxSZXF1ZXN0MjE1NjMzMzg1", "number": 2832, "title": "BF: do not blow hard in python -O0 mode of operation", "user": {"login": "yarikoptic", "id": 39889, "node_id": "MDQ6VXNlcjM5ODg5", "avatar_url": "https://avatars.githubusercontent.com/u/39889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yarikoptic", "html_url": "https://github.com/yarikoptic", "followers_url": "https://api.github.com/users/yarikoptic/followers", "following_url": "https://api.github.com/users/yarikoptic/following{/other_user}", "gists_url": "https://api.github.com/users/yarikoptic/gists{/gist_id}", "starred_url": "https://api.github.com/users/yarikoptic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yarikoptic/subscriptions", "organizations_url": "https://api.github.com/users/yarikoptic/orgs", "repos_url": "https://api.github.com/users/yarikoptic/repos", "events_url": "https://api.github.com/users/yarikoptic/events{/privacy}", "received_events_url": "https://api.github.com/users/yarikoptic/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 63778590, "node_id": "MDU6TGFiZWw2Mzc3ODU5MA==", "url": "https://api.github.com/repos/datalad/datalad/labels/severity-normal", "name": "severity-normal", "color": "ff8888", "default": false, "description": "standard severity"}, {"id": 717765584, "node_id": "MDU6TGFiZWw3MTc3NjU1ODQ=", "url": "https://api.github.com/repos/datalad/datalad/labels/help%20wanted", "name": "help wanted", "color": "fbca04", "default": true, "description": "Someone else is requested to take over"}, {"id": 1037235281, "node_id": "MDU6TGFiZWwxMDM3MjM1Mjgx", "url": "https://api.github.com/repos/datalad/datalad/labels/do%20not%20merge", "name": "do not merge", "color": "fbca04", "default": false, "description": "Not to be merged, will trigger WIP app \"not passed\" status"}, {"id": 1453907298, "node_id": "MDU6TGFiZWwxNDUzOTA3Mjk4", "url": "https://api.github.com/repos/datalad/datalad/labels/stale-PR-closed-without-merge", "name": "stale-PR-closed-without-merge", "color": "ffffff", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2018-09-14T15:35:34Z", "updated_at": "2019-07-17T05:44:42Z", "closed_at": "2019-07-17T05:44:30Z", "author_association": "MEMBER", "active_lock_reason": null, "pull_request": {"url": "https://api.github.com/repos/datalad/datalad/pulls/2832", "html_url": "https://github.com/datalad/datalad/pull/2832", "diff_url": "https://github.com/datalad/datalad/pull/2832.diff", "patch_url": "https://github.com/datalad/datalad/pull/2832.patch"}, "body": "This fix is not yet a complete set of changes to be done, but it does\r\nfixes #2461  in that it would not blow on a basic import and otherwise\r\nlargely work\r\n\r\nOutstanding failures would be (edit: removed two leading ones which are due to vcr tapes, not -O0 per se)\r\n\r\n\t======================================================================\r\n\tERROR: Failure: TypeError (unsupported operand type(s) for +: 'NoneType' and 'str')\r\n\t----------------------------------------------------------------------\r\n\tTraceback (most recent call last):\r\n\t  File \"/usr/lib/python2.7/dist-packages/nose/loader.py\", line 418, in loadTestsFromName\r\n\t\taddr.filename, addr.module)\r\n\t  File \"/usr/lib/python2.7/dist-packages/nose/importer.py\", line 47, in importFromPath\r\n\t\treturn self.importFromDir(dir_path, fqname)\r\n\t  File \"/usr/lib/python2.7/dist-packages/nose/importer.py\", line 94, in importFromDir\r\n\t\tmod = load_module(part_fqname, fh, filename, desc)\r\n\t  File \"/home/yoh/proj/datalad/datalad-master/datalad/tests/test_auto.py\", line 37, in <module>\r\n\t\timport nibabel as nib\r\n\t  File \"/usr/lib/python2.7/dist-packages/nibabel/__init__.py\", line 41, in <module>\r\n\t\tfrom . import nifti1 as ni1\r\n\t  File \"/usr/lib/python2.7/dist-packages/nibabel/nifti1.py\", line 1750, in <module>\r\n\t\tclass Nifti1Pair(analyze.AnalyzeImage):\r\n\t  File \"/usr/lib/python2.7/dist-packages/nibabel/nifti1.py\", line 1780, in Nifti1Pair\r\n\t\t<default-sform-qform-codes>` for more details.  '''\r\n\tTypeError: unsupported operand type(s) for +: 'NoneType' and 'str'\r\n\r\n\t======================================================================\r\n\tERROR: datalad.tests.test_utils.test_import_module_from_file\r\n\t----------------------------------------------------------------------\r\n\tTraceback (most recent call last):\r\n\t  File \"/usr/lib/python2.7/dist-packages/nose/case.py\", line 197, in runTest\r\n\t\tself.test(*self.arg)\r\n\t  File \"/home/yoh/proj/datalad/datalad-master/datalad/tests/utils.py\", line 418, in newfunc\r\n\t\treturn t(*(arg + (d,)), **kw)\r\n\t  File \"/home/yoh/proj/datalad/datalad-master/datalad/tests/test_utils.py\", line 1029, in test_import_module_from_file\r\n\t\timport_module_from_file(op.join(topdir, 'dltestm2', 'dlsub1'))\r\n\t  File \"/home/yoh/proj/datalad/datalad-master/datalad/utils.py\", line 1881, in import_module_from_file\r\n\t\t\"Failed to import module from %s: %s\" % (modpath, exc_str(e)))\r\n\tRuntimeError: Failed to import module from /home/yoh/.tmp/datalad_temp_tree_test_import_module_from_filewcjvlE/dltestm2/dlsub1: No module named dls [utils.py:import_module_from_file:1872]\r\n\r\n\t======================================================================\r\n\tFAIL: datalad.downloaders.tests.test_http.test_docstring\r\n\t----------------------------------------------------------------------\r\n\tTraceback (most recent call last):\r\n\t  File \"/usr/lib/python2.7/dist-packages/nose/case.py\", line 197, in runTest\r\n\t\tself.test(*self.arg)\r\n\t  File \"/home/yoh/proj/datalad/datalad-master/datalad/downloaders/tests/test_http.py\", line 76, in test_docstring\r\n\t\tassert_in(\"\\ncredential: Credential\", doc)\r\n\tAssertionError: '\\ncredential: Credential' not found in ''\r\n\r\n\t======================================================================\r\n\tFAIL: datalad.interface.tests.test_add_archive_content.TestAddArchiveOptions.test_add_delete_after_and_drop\r\n\t----------------------------------------------------------------------\r\n\tTraceback (most recent call last):\r\n\t  File \"/usr/lib/python2.7/dist-packages/nose/case.py\", line 197, in runTest\r\n\t\tself.test(*self.arg)\r\n\t  File \"/home/yoh/proj/datalad/datalad-master/datalad/interface/tests/test_add_archive_content.py\", line 426, in test_add_delete_after_and_drop\r\n\t\tself.annex.whereis(key1, key=True, output='full')\r\n\tAssertionError: Exception not raised\r\n\r\n\t======================================================================\r\n\tFAIL: datalad.interface.tests.test_utils.test_eval_results_plus_build_doc\r\n\t----------------------------------------------------------------------\r\n\tTraceback (most recent call last):\r\n\t  File \"/usr/lib/python2.7/dist-packages/nose/case.py\", line 197, in runTest\r\n\t\tself.test(*self.arg)\r\n\t  File \"/home/yoh/proj/datalad/datalad-master/datalad/interface/tests/test_utils.py\", line 242, in test_eval_results_plus_build_doc\r\n\t\tassert_in(\"TestUtil's fake command\", doc1)\r\n\tAssertionError: \"TestUtil's fake command\" not found in u'Parameters\\n----------\\nnumber : str or None\\n  It\\'s a number.\\ndataset : Dataset or None, optional\\n  \"specify the dataset to update.  If no dataset is given, an attempt\\n  is made to identify the dataset based on the input and/or the\\n  current working directory. [Default: None]\\non_failure : {\\'ignore\\', \\'continue\\', \\'stop\\'}, optional\\n  behavior to perform on failure: \\'ignore\\' any failure is reported,\\n  but does not cause an exception; \\'continue\\' if any failure occurs an\\n  exception will be raised at the end, but processing other actions\\n  will continue for as long as possible; \\'stop\\': processing will stop\\n  on first failure and an exception is raised. A failure is any result\\n  with status \\'impossible\\' or \\'error\\'. Raised exception is an\\n  IncompleteResultsError that carries the result dictionaries of the\\n  failures in its `failed` attribute. [Default: \\'continue\\']\\nproc_post\\n  Like `proc_pre`, but procedures are executed after the main command\\n  has finished. [Default: None]\\nproc_pre\\n  DataLad procedure to run prior to the main command. The argument a\\n  list of lists with procedure names and optional arguments.\\n  Procedures are called in the order their are given in this list. It\\n  is important to provide the respective target dataset to run a\\n  procedure on as the `dataset` argument of the main command.\\n  [Default: None]\\nresult_filter : callable or None, optional\\n  if given, each to-be-returned status dictionary is passed to this\\n  callable, and is only returned if the callable\\'s return value does\\n  not evaluate to False or a ValueError exception is raised. If the\\n  given callable supports `**kwargs` it will additionally be passed\\n  the keyword arguments of the original API call. [Default: None]\\nresult_renderer : {\\'default\\', \\'json\\', \\'json_pp\\', \\'tailored\\'} or None, optional\\n  format of return value rendering on stdout. [Default: None]\\nresult_xfm : {\\'paths\\', \\'relpaths\\', \\'datasets\\', \\'successdatasets-or-none\\', \\'metadata\\'} or callable or None, optional\\n  if given, each to-be-returned result status dictionary is passed to\\n  this callable, and its return value becomes the result instead. This\\n  is different from `result_filter`, as it can perform arbitrary\\n  transformation of the result value. This is mostly useful for top-\\n  level command invocations that need to provide the results in a\\n  particular format. Instead of a callable, a label for a pre-crafted\\n  result transformation can be given. [Default: None]\\nreturn_type : {\\'generator\\', \\'list\\', \\'item-or-list\\'}, optional\\n  return value behavior switch. If \\'item-or-list\\' a single value is\\n  returned instead of a one-item return value list, or a list in case\\n  of multiple return values. `None` is return in case of an empty\\n  list. [Default: \\'list\\']\\n'\r\n\t-------------------- >> begin captured logging << --------------------\r\n\tdatalad.interface.utils: DEBUG: Determined class of decorated function: <class 'datalad.interface.tests.test_utils.TestUtils'>\r\n\t--------------------- >> end captured logging << ---------------------\r\n\r\n\t======================================================================\r\n\tFAIL: datalad.support.tests.test_external_versions.test_custom_versions\r\n\t----------------------------------------------------------------------\r\n\tTraceback (most recent call last):\r\n\t  File \"/usr/lib/python2.7/dist-packages/nose/case.py\", line 197, in runTest\r\n\t\tself.test(*self.arg)\r\n\t  File \"/home/yoh/proj/datalad/datalad-master/datalad/support/tests/test_external_versions.py\", line 133, in test_custom_versions\r\n\t\tassert_equal(set(ev.versions.keys()), {'cmd:annex'})\r\n\tAssertionError: Items in the second set but not the first:\r\n\t'cmd:annex'\r\n\r\n\t======================================================================\r\n\tFAIL: datalad.support.tests.test_external_versions.test_external_versions_rogue_module\r\n\t----------------------------------------------------------------------\r\n\tTraceback (most recent call last):\r\n\t  File \"/usr/lib/python2.7/dist-packages/nose/case.py\", line 197, in runTest\r\n\t\tself.test(*self.arg)\r\n\t  File \"/home/yoh/proj/datalad/datalad-master/datalad/tests/utils.py\", line 591, in newfunc\r\n\t\treturn t(*(arg + (filename,)), **kw)\r\n\t  File \"/home/yoh/proj/datalad/datalad-master/datalad/support/tests/test_external_versions.py\", line 127, in test_external_versions_rogue_module\r\n\t\tassert_in('pickaboo', cml.out)\r\n\tAssertionError: 'pickaboo' not found in ''\r\n\r\n\t======================================================================\r\n\tFAIL: datalad.support.tests.test_gitrepo.test_split_remote_branch\r\n\t----------------------------------------------------------------------\r\n\tTraceback (most recent call last):\r\n\t  File \"/usr/lib/python2.7/dist-packages/nose/case.py\", line 197, in runTest\r\n\t\tself.test(*self.arg)\r\n\t  File \"/home/yoh/proj/datalad/datalad-master/datalad/support/tests/test_gitrepo.py\", line 869, in test_split_remote_branch\r\n\t\tassert_raises(AssertionError, split_remote_branch, \"NoSlashesAtAll\")\r\n\tAssertionError: AssertionError not raised\r\n\r\n\t======================================================================\r\n\tFAIL: datalad.support.tests.test_locking.test_lock_if_check_fails\r\n\t----------------------------------------------------------------------\r\n\tTraceback (most recent call last):\r\n\t  File \"/usr/lib/python2.7/dist-packages/nose/case.py\", line 197, in runTest\r\n\t\tself.test(*self.arg)\r\n\t  File \"/home/yoh/proj/datalad/datalad-master/datalad/tests/utils.py\", line 591, in newfunc\r\n\t\treturn t(*(arg + (filename,)), **kw)\r\n\t  File \"/home/yoh/proj/datalad/datalad-master/datalad/support/tests/test_locking.py\", line 81, in test_lock_if_check_fails\r\n\t\tok_(q.get())\r\n\tAssertionError: None\r\n\t-------------------- >> begin captured logging << --------------------\r\n\tfasteners.process_lock: Level 5: Acquired file lock `/home/yoh/.tmp/datalad_temp_test_lock_if_check_failsapEa5w.lck` after waiting 0.000s [1 attempts were required]\r\n\tfasteners.process_lock: Level 5: Unlocked and closed file lock open on `/home/yoh/.tmp/datalad_temp_test_lock_if_check_failsapEa5w.lck`\r\n\tfasteners.process_lock: Level 5: Acquired file lock `/home/yoh/.tmp/datalad_temp_test_lock_if_check_failsapEa5w.get-lck` after waiting 0.000s [1 attempts were required]\r\n\tfasteners.process_lock: Level 5: Unlocked and closed file lock open on `/home/yoh/.tmp/datalad_temp_test_lock_if_check_failsapEa5w.get-lck`\r\n\tfasteners.process_lock: Level 5: Acquired file lock `/home/yoh/.tmp/datalad_temp_test_lock_if_check_failsapEa5w.lck` after waiting 0.000s [1 attempts were required]\r\n\tfasteners.process_lock: Level 5: Unlocked and closed file lock open on `/home/yoh/.tmp/datalad_temp_test_lock_if_check_failsapEa5w.lck`\r\n\t--------------------- >> end captured logging << ---------------------\r\n\r\n\t======================================================================\r\n\tFAIL: datalad.ui.tests.test_base.test_tests_ui\r\n\t----------------------------------------------------------------------\r\n\tTraceback (most recent call last):\r\n\t  File \"/usr/lib/python2.7/dist-packages/nose/case.py\", line 197, in runTest\r\n\t\tself.test(*self.arg)\r\n\t  File \"/home/yoh/proj/datalad/datalad-master/datalad/ui/tests/test_base.py\", line 71, in test_tests_ui\r\n\t\tassert_equal(ui.question(\"text\"), 'a')\r\n\tAssertionError: AssertionError not raised\r\n\r\n\t======================================================================\r\n\tFAIL: datalad.ui.tests.test_base.test_with_testsui\r\n\t----------------------------------------------------------------------\r\n\tTraceback (most recent call last):\r\n\t  File \"/usr/lib/python2.7/dist-packages/nose/case.py\", line 197, in runTest\r\n\t\tself.test(*self.arg)\r\n\t  File \"/home/yoh/proj/datalad/datalad-master/datalad/ui/tests/test_base.py\", line 100, in test_with_testsui\r\n\t\tassert_raises(AssertionError, nothing, 1, k=2)\r\n\tAssertionError: AssertionError not raised\r\n\r\n\t======================================================================\r\n\tFAIL: datalad.tests.test_dochelpers.test_borrow_kwargs\r\n\t----------------------------------------------------------------------\r\n\tTraceback (most recent call last):\r\n\t  File \"/usr/lib/python2.7/dist-packages/nose/case.py\", line 197, in runTest\r\n\t\tself.test(*self.arg)\r\n\t  File \"/home/yoh/proj/datalad/datalad-master/datalad/tests/test_dochelpers.py\", line 119, in test_borrow_kwargs\r\n\t\tassert_true('B.met1 doc' in B.met1.__doc__)\r\n\tAssertionError: False is not true\r\n\r\n\t----------------------------------------------------------------------\r\n\tRan 850 tests in 1671.522s\r\n\r\n\tFAILED (SKIP=52, errors=4, failures=10)\r\n\tpython -OO -m nose -s -v datalad 2>&1  945.75s user 702.32s system 98% cpu 27:54.59 total\r\n\r\nThis pull request fixes #2461\r\n", "closed_by": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/2832/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/2832/timeline", "performed_via_github_app": null}