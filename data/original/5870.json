{"url": "https://api.github.com/repos/datalad/datalad/issues/5870", "repository_url": "https://api.github.com/repos/datalad/datalad", "labels_url": "https://api.github.com/repos/datalad/datalad/issues/5870/labels{/name}", "comments_url": "https://api.github.com/repos/datalad/datalad/issues/5870/comments", "events_url": "https://api.github.com/repos/datalad/datalad/issues/5870/events", "html_url": "https://github.com/datalad/datalad/issues/5870", "id": 960385441, "node_id": "MDU6SXNzdWU5NjAzODU0NDE=", "number": 5870, "title": "TST: wrong invocation of \"echo\" on Windows?", "user": {"login": "adswa", "id": 29738718, "node_id": "MDQ6VXNlcjI5NzM4NzE4", "avatar_url": "https://avatars.githubusercontent.com/u/29738718?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adswa", "html_url": "https://github.com/adswa", "followers_url": "https://api.github.com/users/adswa/followers", "following_url": "https://api.github.com/users/adswa/following{/other_user}", "gists_url": "https://api.github.com/users/adswa/gists{/gist_id}", "starred_url": "https://api.github.com/users/adswa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adswa/subscriptions", "organizations_url": "https://api.github.com/users/adswa/orgs", "repos_url": "https://api.github.com/users/adswa/repos", "events_url": "https://api.github.com/users/adswa/events{/privacy}", "received_events_url": "https://api.github.com/users/adswa/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 188141023, "node_id": "MDU6TGFiZWwxODgxNDEwMjM=", "url": "https://api.github.com/repos/datalad/datalad/labels/platform-windows", "name": "platform-windows", "color": "0052cc", "default": false, "description": "Issue concerned with Windows"}, {"id": 3049454618, "node_id": "MDU6TGFiZWwzMDQ5NDU0NjE4", "url": "https://api.github.com/repos/datalad/datalad/labels/tests", "name": "tests", "color": "ffd3cc", "default": false, "description": "Add or improve existing tests"}], "state": "closed", "locked": false, "assignee": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2021-08-04T12:41:20Z", "updated_at": "2021-08-17T06:08:58Z", "closed_at": "2021-08-17T06:08:58Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "I ran tests under Windows and noticed a few failures where ``subprocess.Popen()`` would complain with a WinError2 (\"Can't find the specified file\"), such as\r\n\r\n```\r\n======================================================================\r\nERROR: datalad.tests.test_nonasyncrunner.test_inside_async\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\datalads\\AppData\\Local\\Programs\\Python\\Python39\\lib\\site-packages\\nose\\case.py\", line 198, in runTest\r\n    self.test(*self.arg)\r\n  File \"C:\\Users\\datalads\\repos\\datalad\\datalad\\tests\\test_nonasyncrunner.py\", line 141, in test_inside_async\r\n    result = loop.run_until_complete(main())\r\n  File \"C:\\Users\\datalads\\AppData\\Local\\Programs\\Python\\Python39\\lib\\asyncio\\base_events.py\", line 642, in run_until_complete\r\n    return future.result()\r\n  File \"C:\\Users\\datalads\\repos\\datalad\\datalad\\tests\\test_nonasyncrunner.py\", line 138, in main\r\n    return runner.run([\"echo\", \"abc\"], StdOutCapture)\r\n  File \"C:\\Users\\datalads\\repos\\datalad\\datalad\\cmd.py\", line 149, in run\r\n    results = run_command(\r\n  File \"C:\\Users\\datalads\\repos\\datalad\\datalad\\nonasyncrunner.py\", line 194, in run_command\r\n    process = subprocess.Popen(cmd, **kwargs)\r\n  File \"C:\\Users\\datalads\\AppData\\Local\\Programs\\Python\\Python39\\lib\\subprocess.py\", line 951, in __init__\r\n    self._execute_child(args, executable, preexec_fn, close_fds,\r\n  File \"C:\\Users\\datalads\\AppData\\Local\\Programs\\Python\\Python39\\lib\\subprocess.py\", line 1420, in _execute_child\r\n    hp, ht, pid, tid = _winapi.CreateProcess(executable, args,\r\nFileNotFoundError: [WinError 2] Das System kann die angegebene Datei nicht finden\r\n```\r\n\r\n```\r\n======================================================================\r\nERROR: datalad.tests.test_witless_runner.test_runner_no_stdin_no_capture\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\datalads\\AppData\\Local\\Programs\\Python\\Python39\\lib\\site-packages\\nose\\case.py\", line 198, in runTest\r\n    self.test(*self.arg)\r\n  File \"C:\\Users\\datalads\\AppData\\Local\\Programs\\Python\\Python39\\lib\\site-packages\\nose\\tools\\nontrivial.py\", line 97, in newfunc\r\n    result = func(*arg, **kw)\r\n  File \"C:\\Users\\datalads\\repos\\datalad\\datalad\\tests\\test_witless_runner.py\", line 170, in test_runner_no_stdin_no_capture\r\n    runner.run(\r\n  File \"C:\\Users\\datalads\\repos\\datalad\\datalad\\cmd.py\", line 149, in run\r\n    results = run_command(\r\n  File \"C:\\Users\\datalads\\repos\\datalad\\datalad\\nonasyncrunner.py\", line 194, in run_command\r\n    process = subprocess.Popen(cmd, **kwargs)\r\n  File \"C:\\Users\\datalads\\AppData\\Local\\Programs\\Python\\Python39\\lib\\subprocess.py\", line 951, in __init__\r\n    self._execute_child(args, executable, preexec_fn, close_fds,\r\n  File \"C:\\Users\\datalads\\AppData\\Local\\Programs\\Python\\Python39\\lib\\subprocess.py\", line 1420, in _execute_child\r\n    hp, ht, pid, tid = _winapi.CreateProcess(executable, args,\r\nFileNotFoundError: [WinError 2] Das System kann die angegebene Datei nicht finden\r\n```\r\n\r\nIn these cases, the test would call ``echo`` with some arguments, e.g.,  ``runner.run([\"echo\", \"abc\"]``. On Windows, [``echo`` is a command within ``cmd.exe``](https://stackoverflow.com/questions/44371876/why-is-popencmd-exe-echo-a-shell-true-not-running-echo). When I replace ``echo`` with ``\"C:\\\\WINDOWS\\\\system32\\\\cmd.exe\", \"/c\", \"echo\"``, ``subprocess.Popen()`` can execute the command. \r\n\r\nI know that via some magic, some things replace the Unixy call with a Windows equivalent. E.g., during start-up of datalad, I see a ``'C:\\\\WINDOWS\\\\system32\\\\cmd.exe /c \"ver\"'`` call being executed via ``Subprocess.Popen()``. But I am not sure how that works, or if this is intended for the tests at hand, or even anyhow useful", "closed_by": {"login": "mih", "id": 136479, "node_id": "MDQ6VXNlcjEzNjQ3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/136479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mih", "html_url": "https://github.com/mih", "followers_url": "https://api.github.com/users/mih/followers", "following_url": "https://api.github.com/users/mih/following{/other_user}", "gists_url": "https://api.github.com/users/mih/gists{/gist_id}", "starred_url": "https://api.github.com/users/mih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mih/subscriptions", "organizations_url": "https://api.github.com/users/mih/orgs", "repos_url": "https://api.github.com/users/mih/repos", "events_url": "https://api.github.com/users/mih/events{/privacy}", "received_events_url": "https://api.github.com/users/mih/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/datalad/datalad/issues/5870/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/datalad/datalad/issues/5870/timeline", "performed_via_github_app": null}